module.exports=[797521,(a,b,c)=>{"use strict";function d(a,b){return b}b.exports=function(){let a=Error.prepareStackTrace;Error.prepareStackTrace=d;let b=Error().stack;if(Error.prepareStackTrace=a,!Array.isArray(b))return;let c=b.slice(2),e=[];for(let a of c)a&&e.push(a.getFileName());return e}},882412,(a,b,c)=>{"use strict";let d,e={exit:[],beforeExit:[]},f={exit:function(){h("exit")},beforeExit:function(){h("beforeExit")}};function g(a){e[a].length>0||(process.removeListener(a,f[a]),0===e.exit.length&&0===e.beforeExit.length&&(d=void 0))}function h(a){for(let b of e[a]){let c=b.deref(),d=b.fn;void 0!==c&&d(c,a)}e[a]=[]}function i(a){for(let b of["exit","beforeExit"]){let c=e[b].indexOf(a);e[b].splice(c,c+1),g(b)}}function j(a,b,c){if(void 0===b)throw Error("the object can't be undefined");e[a].length>0||process.on(a,f[a]);let g=new WeakRef(b);g.fn=c,void 0===d&&(d=new FinalizationRegistry(i)),d.register(b,g),e[a].push(g)}b.exports={register:function(a,b){j("exit",a,b)},registerBeforeExit:function(a,b){j("beforeExit",a,b)},unregister:function(a){if(void 0!==d)for(let b of(d.unregister(a),["exit","beforeExit"]))e[b]=e[b].filter(b=>{let c=b.deref();return c&&c!==a}),g(b)}}},825006,a=>{a.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},685437,(a,b,c)=>{"use strict";b.exports={wait:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g===c)return void e(null,"ok");let h=g,i=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{h=g,(g=Atomics.load(a,b))===h?i(d>=1e3?1e3:2*d):g===c?e(null,"ok"):e(null,"not-equal")},d)};i(1)},waitDiff:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g!==c)return void e(null,"ok");let h=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{(g=Atomics.load(a,b))!==c?e(null,"ok"):h(d>=1e3?1e3:2*d)},d)};h(1)}}},669481,(a,b,c)=>{"use strict";b.exports={WRITE_INDEX:4,READ_INDEX:8}},288400,(a,b,c)=>{"use strict";let{version:d}=a.r(825006),{EventEmitter:e}=a.r(427699),{Worker:f}=a.r(37702),{join:g}=a.r(814747),{pathToFileURL:h}=a.r(792509),{wait:i}=a.r(685437),{WRITE_INDEX:j,READ_INDEX:k}=a.r(669481),l=a.r(500874),m=a.r(449719),o=Symbol("kImpl"),p=l.constants.MAX_STRING_LENGTH;class q{constructor(a){this._value=a}deref(){return this._value}}class r{register(){}unregister(){}}let s=process.env.NODE_V8_COVERAGE?r:a.g.FinalizationRegistry||r,t=process.env.NODE_V8_COVERAGE?q:a.g.WeakRef||q,u=new s(a=>{a.exited||a.terminate()});function v(a){m(!a[o].sync),a[o].needDrain&&(a[o].needDrain=!1,a.emit("drain"))}function w(a){let b=Atomics.load(a[o].state,j),c=a[o].data.length-b;if(c>0){if(0===a[o].buf.length){a[o].flushing=!1,a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a);return}let b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);d<=c?(a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))):a.flush(()=>{if(!a.destroyed){for(Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);d>a[o].data.length;)c/=2,b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))}})}else if(0===c){if(0===b&&0===a[o].buf.length)return;a.flush(()=>{Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0),w(a)})}else A(a,Error("overwritten"))}function x(a){let b=this.stream.deref();if(void 0===b){this.exited=!0,this.terminate();return}switch(a.code){case"READY":this.stream=new t(b),b.flush(()=>{b[o].ready=!0,b.emit("ready")});break;case"ERROR":A(b,a.err);break;case"EVENT":Array.isArray(a.args)?b.emit(a.name,...a.args):b.emit(a.name,a.args);break;case"WARNING":process.emitWarning(a.err);break;default:A(b,Error("this should not happen: "+a.code))}}function y(a){let b=this.stream.deref();void 0!==b&&(u.unregister(b),b.worker.exited=!0,b.worker.off("exit",y),A(b,0!==a?Error("the worker thread exited"):null))}function z(a,b){setImmediate(()=>{a.emit("error",b)})}function A(a,b){a[o].destroyed||(a[o].destroyed=!0,b&&(a[o].errored=b,z(a,b)),a.worker.exited?setImmediate(()=>{a[o].closed=!0,a.emit("close")}):a.worker.terminate().catch(()=>{}).then(()=>{a[o].closed=!0,a.emit("close")}))}function B(a,b,c){let d=Atomics.load(a[o].state,j),e=Buffer.byteLength(b);return a[o].data.write(b,d),Atomics.store(a[o].state,j,d+e),Atomics.notify(a[o].state,j),c(),!0}function C(a){if(!a[o].ended&&a[o].ending&&!a[o].flushing){a[o].ended=!0;try{a.flushSync();let b=Atomics.load(a[o].state,k);Atomics.store(a[o].state,j,-1),Atomics.notify(a[o].state,j);let c=0;for(;-1!==b;){if(Atomics.wait(a[o].state,k,b,1e3),b=Atomics.load(a[o].state,k),-2===b)return void A(a,Error("end() failed"));if(10==++c)return void A(a,Error("end() took too long (10s)"))}process.nextTick(()=>{a[o].finished=!0,a.emit("finish")})}catch(b){A(a,b)}}}function D(a){let b=()=>{a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a)};for(a[o].flushing=!1;0!==a[o].buf.length;){let c=Atomics.load(a[o].state,j),d=a[o].data.length-c;if(0===d){E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);continue}if(d<0)throw Error("overwritten");let e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);if(f<=d)a[o].buf=a[o].buf.slice(d),B(a,e,b);else{for(E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);f>a[o].buf.length;)d/=2,e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);a[o].buf=a[o].buf.slice(d),B(a,e,b)}}}function E(a){if(a[o].flushing)throw Error("unable to flush while flushing");let b=Atomics.load(a[o].state,j),c=0;for(;;){let d=Atomics.load(a[o].state,k);if(-2===d)throw Error("_flushSync failed");if(d!==b)Atomics.wait(a[o].state,k,d,1e3);else break;if(10==++c)throw Error("_flushSync took too long (10s)")}}b.exports=class extends e{constructor(a={}){if(super(),a.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[o]={},this[o].stateBuf=new SharedArrayBuffer(128),this[o].state=new Int32Array(this[o].stateBuf),this[o].dataBuf=new SharedArrayBuffer(a.bufferSize||4194304),this[o].data=Buffer.from(this[o].dataBuf),this[o].sync=a.sync||!1,this[o].ending=!1,this[o].ended=!1,this[o].needDrain=!1,this[o].destroyed=!1,this[o].flushing=!1,this[o].ready=!1,this[o].finished=!1,this[o].errored=null,this[o].closed=!1,this[o].buf="",this.worker=function(a,b){let{filename:c,workerData:e}=b,i=new f(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||g("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit/node_modules/thread-stream","lib","worker.js"),{...b.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===c.indexOf("file://")?c:h(c).href,dataBuf:a[o].dataBuf,stateBuf:a[o].stateBuf,workerData:{$context:{threadStreamVersion:d},...e}}});return i.stream=new q(a),i.on("message",x),i.on("exit",y),u.register(a,i),i}(this,a),this.on("message",(a,b)=>{this.worker.postMessage(a,b)})}write(a){if(this[o].destroyed)return z(this,Error("the worker has exited")),!1;if(this[o].ending)return z(this,Error("the worker is ending")),!1;if(this[o].flushing&&this[o].buf.length+a.length>=p)try{D(this),this[o].flushing=!0}catch(a){return A(this,a),!1}if(this[o].buf+=a,this[o].sync)try{return D(this),!0}catch(a){return A(this,a),!1}return this[o].flushing||(this[o].flushing=!0,setImmediate(w,this)),this[o].needDrain=this[o].data.length-this[o].buf.length-Atomics.load(this[o].state,j)<=0,!this[o].needDrain}end(){this[o].destroyed||(this[o].ending=!0,C(this))}flush(a){if(this[o].destroyed){"function"==typeof a&&process.nextTick(a,Error("the worker has exited"));return}let b=Atomics.load(this[o].state,j);i(this[o].state,k,b,1/0,(b,c)=>{if(b){A(this,b),process.nextTick(a,b);return}"not-equal"===c?this.flush(a):process.nextTick(a)})}flushSync(){this[o].destroyed||(D(this),E(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[o].ready}get destroyed(){return this[o].destroyed}get closed(){return this[o].closed}get writable(){return!this[o].destroyed&&!this[o].ending}get writableEnded(){return this[o].ending}get writableFinished(){return this[o].finished}get writableNeedDrain(){return this[o].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[o].errored}}},234761,(a,b,c)=>{"use strict";let{createRequire:d}=a.r(362562),e=a.r(797521),{join:f,isAbsolute:g,sep:h}=a.r(750227),i=a.r(296175),j=a.r(882412),k=a.r(288400);function l(a){a.ref(),a.flushSync(),a.end(),a.once("close",function(){a.unref()})}function m(a){a.flushSync()}b.exports=function(a){let{pipeline:b,targets:c,levels:o,dedupe:p,worker:q={},caller:r=e(),sync:s=!1}=a,t={...a.options},u="string"==typeof r?[r]:r,v="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},w=a.target;if(w&&c)throw Error("only one of target or targets can be specified");c?(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit/node_modules/pino/lib","worker.js"),t.targets=c.filter(a=>a.target).map(a=>({...a,target:z(a.target)})),t.pipelines=c.filter(a=>a.pipeline).map(a=>a.pipeline.map(b=>({...b,level:a.level,target:z(b.target)})))):b&&(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit/node_modules/pino/lib","worker.js"),t.pipelines=[b.map(a=>({...a,target:z(a.target)}))]),o&&(t.levels=o),p&&(t.dedupe=p),t.pinoWillSendConfig=!0;let x=new k({filename:z(w),workerData:t,workerOpts:q,sync:s});function y(){x.closed||(x.flushSync(),i(100),x.end())}return x.on("ready",function(){process.removeListener("exit",y),x.unref(),!1!==q.autoEnd&&(j.register(x,l),j.registerBeforeExit(x,m),x.on("close",function(){j.unregister(x)}))}),x.on("close",function(){process.removeListener("exit",y)}),process.on("exit",y),x;function z(a){let b;if(g(a=v[a]||a)||0===a.indexOf("file://"))return a;if("pino/file"===a)return f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit/node_modules/pino/lib","..","file.js");for(let c of u)try{let e="node:repl"===c?process.cwd()+h:c;b=d(e).resolve(a);break}catch(a){continue}if(!b)throw Error(`unable to determine transport target for "${a}"`);return b}}},129582,(a,b,c)=>{b.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},5337,(a,b,c)=>{"use strict";let d=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:e}=a.r(129582),f=e.info;function g(a,b){return a.level-b.level}b.exports=function(a,b){a=a||[],b=b||{dedupe:!1};let c=Object.create(e);c.silent=1/0,b.levels&&"object"==typeof b.levels&&Object.keys(b.levels).forEach(a=>{c[a]=b.levels[a]});let h={write:i,add:l,remove:m,emit:j,flushSync:k,end:function(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync(),a.end()},minLevel:0,lastId:0,streams:[],clone:function a(b){let c=Array(this.streams.length);for(let a=0;a<c.length;a++)c[a]={level:b,stream:this.streams[a].stream};return{write:i,add:l,remove:m,minLevel:b,streams:c,clone:a,emit:j,flushSync:k,[d]:!0}},[d]:!0,streamLevels:c};return Array.isArray(a)?a.forEach(l,h):l.call(h,a),a=null,h;function i(a){var c,e,f,g;let h,i,j=this.lastLevel,{streams:k}=this,l=0;for(let m=(c=k.length,b.dedupe?c-1:0);e=m,f=k.length,b.dedupe?e>=0:e<f;g=m,m=b.dedupe?g-1:g+1)if((h=k[m]).level<=j){if(0!==l&&l!==h.level)break;if((i=h.stream)[d]){let{lastTime:a,lastMsg:b,lastObj:c,lastLogger:d}=this;i.lastLevel=j,i.lastTime=a,i.lastMsg=b,i.lastObj=c,i.lastLogger=d}i.write(a),b.dedupe&&(l=h.level)}else if(!b.dedupe)break}function j(...a){for(let{stream:b}of this.streams)"function"==typeof b.emit&&b.emit(...a)}function k(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync()}function l(a){if(!a)return h;let b="function"==typeof a.write||a.stream,c=a.write?a:a.stream;if(!b)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:d,streamLevels:e}=this,i={stream:c,level:"number"==typeof a.levelVal?a.levelVal:"string"==typeof a.level?e[a.level]:"number"==typeof a.level?a.level:f,levelVal:void 0,id:++h.lastId};return d.unshift(i),d.sort(g),this.minLevel=d[0].level,h}function m(a){let{streams:b}=this,c=b.findIndex(b=>b.id===a);return c>=0&&(b.splice(c,1),b.sort(g),this.minLevel=b.length>0?b[0].level:-1),h}}},512389,(a,b,c)=>{"use strict";let d=a=>a&&"string"==typeof a.message,e=a=>{if(!a)return;let b=a.cause;if("function"!=typeof b)return d(b)?b:void 0;{let b=a.cause();return d(b)?b:void 0}},f=(a,b)=>{if(!d(a))return"";let c=a.stack||"";if(b.has(a))return c+"\ncauses have become circular...";let g=e(a);return g?(b.add(a),c+"\ncaused by: "+f(g,b)):c},g=(a,b,c)=>{if(!d(a))return"";let f=c?"":a.message||"";if(b.has(a))return f+": ...";let h=e(a);if(!h)return f;{b.add(a);let c="function"==typeof a.cause;return f+(c?"":": ")+g(h,b,c)}};b.exports={isErrorLike:d,getErrorCause:e,stackWithCauses:a=>f(a,new Set),messageWithCauses:a=>g(a,new Set)}},217347,(a,b,c)=>{"use strict";let d=Symbol("circular-ref-tag"),e=Symbol("pino-raw-err-ref"),f=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[e]},set:function(a){this[e]=a}}});Object.defineProperty(f,e,{writable:!0,value:{}}),b.exports={pinoErrProto:f,pinoErrorSymbols:{seen:d,rawSymbol:e}}},967291,(a,b,c)=>{"use strict";b.exports=function a(b){if(!f(b))return b;b[i]=void 0;let c=Object.create(g);for(let g in c.type="[object Function]"===j.call(b.constructor)?b.constructor.name:b.name,c.message=d(b),c.stack=e(b),Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),b)if(void 0===c[g]){let d=b[g];f(d)?"cause"===g||Object.prototype.hasOwnProperty.call(d,i)||(c[g]=a(d)):c[g]=d}return delete b[i],c.raw=b,c};let{messageWithCauses:d,stackWithCauses:e,isErrorLike:f}=a.r(512389),{pinoErrProto:g,pinoErrorSymbols:h}=a.r(217347),{seen:i}=h,{toString:j}=Object.prototype},86027,(a,b,c)=>{"use strict";b.exports=function a(b){if(!d(b))return b;b[g]=void 0;let c=Object.create(e);for(let e in c.type="[object Function]"===h.call(b.constructor)?b.constructor.name:b.name,c.message=b.message,c.stack=b.stack,Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),d(b.cause)&&!Object.prototype.hasOwnProperty.call(b.cause,g)&&(c.cause=a(b.cause)),b)if(void 0===c[e]){let f=b[e];d(f)?Object.prototype.hasOwnProperty.call(f,g)||(c[e]=a(f)):c[e]=f}return delete b[g],c.raw=b,c};let{isErrorLike:d}=a.r(512389),{pinoErrProto:e,pinoErrorSymbols:f}=a.r(217347),{seen:g}=f,{toString:h}=Object.prototype},752681,(a,b,c)=>{"use strict";b.exports={mapHttpRequest:function(a){return{req:f(a)}},reqSerializer:f};let d=Symbol("pino-raw-req-ref"),e=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=a.info||a.socket,c=Object.create(e);if(c.id="function"==typeof a.id?a.id():a.id||(a.info?a.info.id:void 0),c.method=a.method,a.originalUrl)c.url=a.originalUrl;else{let b=a.path;c.url="string"==typeof b?b:a.url?a.url.path||a.url:void 0}return a.query&&(c.query=a.query),a.params&&(c.params=a.params),c.headers=a.headers,c.remoteAddress=b&&b.remoteAddress,c.remotePort=b&&b.remotePort,c.raw=a.raw||a,c}Object.defineProperty(e,d,{writable:!0,value:{}})},928303,(a,b,c)=>{"use strict";b.exports={mapHttpResponse:function(a){return{res:f(a)}},resSerializer:f};let d=Symbol("pino-raw-res-ref"),e=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=Object.create(e);return b.statusCode=a.headersSent?a.statusCode:null,b.headers=a.getHeaders?a.getHeaders():a._headers,b.raw=a,b}Object.defineProperty(e,d,{writable:!0,value:{}})},744402,(a,b,c)=>{"use strict";let d=a.r(967291),e=a.r(86027),f=a.r(752681),g=a.r(928303);b.exports={err:d,errWithCause:e,mapHttpRequest:f.mapHttpRequest,mapHttpResponse:g.mapHttpResponse,req:f.reqSerializer,res:g.resSerializer,wrapErrorSerializer:function(a){return a===d?a:function(b){return a(d(b))}},wrapRequestSerializer:function(a){return a===f.reqSerializer?a:function(b){return a(f.reqSerializer(b))}},wrapResponseSerializer:function(a){return a===g.resSerializer?a:function(b){return a(g.resSerializer(b))}}}},596323,(a,b,c)=>{"use strict";let d=Symbol("pino.setLevel"),e=Symbol("pino.getLevel"),f=Symbol("pino.levelVal"),g=Symbol("pino.levelComp"),h=Symbol("pino.useLevelLabels"),i=Symbol("pino.useOnlyCustomLevels"),j=Symbol("pino.mixin"),k=Symbol("pino.lsCache"),l=Symbol("pino.chindings"),m=Symbol("pino.asJson"),o=Symbol("pino.write"),p=Symbol("pino.redactFmt"),q=Symbol("pino.time"),r=Symbol("pino.timeSliceIndex"),s=Symbol("pino.stream"),t=Symbol("pino.stringify"),u=Symbol("pino.stringifySafe"),v=Symbol("pino.stringifiers"),w=Symbol("pino.end"),x=Symbol("pino.formatOpts"),y=Symbol("pino.messageKey"),z=Symbol("pino.errorKey"),A=Symbol("pino.nestedKey"),B=Symbol("pino.nestedKeyStr"),C=Symbol("pino.mixinMergeStrategy"),D=Symbol("pino.msgPrefix"),E=Symbol("pino.wildcardFirst"),F=Symbol.for("pino.serializers"),G=Symbol.for("pino.formatters"),H=Symbol.for("pino.hooks");b.exports={setLevelSym:d,getLevelSym:e,levelValSym:f,levelCompSym:g,useLevelLabelsSym:h,mixinSym:j,lsCacheSym:k,chindingsSym:l,asJsonSym:m,writeSym:o,serializersSym:F,redactFmtSym:p,timeSym:q,timeSliceIndexSym:r,streamSym:s,stringifySym:t,stringifySafeSym:u,stringifiersSym:v,endSym:w,formatOptsSym:x,messageKeySym:y,errorKeySym:z,nestedKeySym:A,wildcardFirstSym:E,needsMetadataGsym:Symbol.for("pino.metadata"),useOnlyCustomLevelsSym:i,formattersSym:G,hooksSym:H,nestedKeyStrSym:B,mixinMergeStrategySym:C,msgPrefixSym:D}},408457,(a,b,c)=>{"use strict";let d=a.r(71347),{redactFmtSym:e,wildcardFirstSym:f}=a.r(596323),g=/[^.[\]]+|\[([^[\]]*?)\]/g,h="[Redacted]";b.exports=function(a,b){let{paths:c,censor:i,remove:j}=function(a){if(Array.isArray(a))return{paths:a,censor:h};let{paths:b,censor:c=h,remove:d}=a;if(!1===Array.isArray(b))throw Error("pino â€“ redact must contain an array of strings");return!0===d&&(c=void 0),{paths:b,censor:c,remove:d}}(a),k=c.reduce((a,b)=>{g.lastIndex=0;let c=g.exec(b),d=g.exec(b),e=void 0!==c[1]?c[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):c[0];if("*"===e&&(e=f),null===d)return a[e]=null,a;if(null===a[e])return a;let{index:h}=d,i=`${b.substr(h,b.length-1)}`;return a[e]=a[e]||[],e!==f&&0===a[e].length&&a[e].push(...a[f]||[]),e===f&&Object.keys(a).forEach(function(b){a[b]&&a[b].push(i)}),a[e].push(i),a},{}),l={[e]:d({paths:c,censor:i,serialize:b,strict:!1,remove:j})};return[...Object.keys(k),...Object.getOwnPropertySymbols(k)].reduce((a,c)=>{if(null===k[c])a[c]=a=>((...a)=>"function"==typeof i?b(i(...a)):b(i))(a,[c]);else{let e="function"==typeof i?(a,b)=>i(a,[c,...b]):i;a[c]=d({paths:k[c],censor:e,serialize:b,strict:!1,remove:j})}return a},l)}},55e4,(a,b,c)=>{"use strict";let d=1000000n*BigInt(Date.now()),e=process.hrtime.bigint();b.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`,isoTimeNano:()=>{let a=d+(process.hrtime.bigint()-e),b=a%1000000000n,c=new Date(Number(a/1000000000n*1000n+b/1000000n)),f=c.getUTCFullYear(),g=(c.getUTCMonth()+1).toString().padStart(2,"0"),h=c.getUTCDate().toString().padStart(2,"0"),i=c.getUTCHours().toString().padStart(2,"0"),j=c.getUTCMinutes().toString().padStart(2,"0"),k=c.getUTCSeconds().toString().padStart(2,"0");return`,"time":"${f}-${g}-${h}T${i}:${j}:${k}.${b.toString().padStart(9,"0")}Z"`}}},912525,(a,b,c)=>{"use strict";let d=a.r(522734),e=a.r(427699),f=a.r(224361).inherits,g=a.r(814747),h=a.r(296175),i=a.r(449719),j=Buffer.allocUnsafe(0),k="buffer",l="utf8",[m,o]=(process.versions.node||"0.0").split(".").map(Number),p=m>=22&&o>=7;function q(a,b){function c(c,d){if(c){b._reopening=!1,b._writing=!1,b._opening=!1,b.sync?process.nextTick(()=>{b.listenerCount("error")>0&&b.emit("error",c)}):b.emit("error",c);return}let e=b._reopening;b.fd=d,b.file=a,b._reopening=!1,b._opening=!1,b._writing=!1,b.sync?process.nextTick(()=>b.emit("ready")):b.emit("ready"),!b.destroyed&&(!b._writing&&b._len>b.minLength||b._flushPending?b._actualWrite():e&&process.nextTick(()=>b.emit("drain")))}b._opening=!0,b._writing=!0,b._asyncDrainScheduled=!1;let e=b.append?"a":"w",f=b.mode;if(b.sync)try{b.mkdir&&d.mkdirSync(g.dirname(a),{recursive:!0});let h=d.openSync(a,e,f);c(null,h)}catch(a){throw c(a),a}else b.mkdir?d.mkdir(g.dirname(a),{recursive:!0},b=>{if(b)return c(b);d.open(a,e,f,c)}):d.open(a,e,f,c)}function r(a){let b,c;if(!(this instanceof r))return new r(a);let{fd:e,dest:f,minLength:g,maxLength:i,maxWrite:m,periodicFlush:o,sync:p,append:u=!0,mkdir:x,retryEAGAIN:F,fsync:G,contentMode:H,mode:I}=a||{};if(e=e||f,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(g||0,16387),this.file=null,this.destroyed=!1,this.minLength=g||0,this.maxLength=i||0,this.maxWrite=m||16384,this._periodicFlush=o||0,this._periodicFlushTimer=void 0,this.sync=p||!1,this.writable=!0,this._fsync=G||!1,this.append=u||!1,this.mode=I,this.retryEAGAIN=F||(()=>!0),this.mkdir=x||!1,H===k)this._writingBuf=j,this.write=w,this.flush=z,this.flushSync=B,this._actualWrite=D,b=()=>d.writeSync(this.fd,this._writingBuf),c=()=>d.write(this.fd,this._writingBuf,this.release);else if(void 0===H||H===l)this._writingBuf="",this.write=v,this.flush=y,this.flushSync=A,this._actualWrite=C,b=()=>d.writeSync(this.fd,this._writingBuf,"utf8"),c=()=>d.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${l}" and "${k}", but passed ${H}`);if("number"==typeof e)this.fd=e,process.nextTick(()=>this.emit("ready"));else if("string"==typeof e)q(e,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(a,e)=>{if(a){if(("EAGAIN"===a.code||"EBUSY"===a.code)&&this.retryEAGAIN(a,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{h(100),this.release(void 0,0)}catch(a){this.release(a)}else setTimeout(c,100);else this._writing=!1,this.emit("error",a);return}this.emit("write",e);let f=s(this._writingBuf,this._len,e);if(this._len=f.len,this._writingBuf=f.writingBuf,this._writingBuf.length){if(!this.sync)return void c();try{do{let a=b(),c=s(this._writingBuf,this._len,a);this._len=c.len,this._writingBuf=c.writingBuf}while(this._writingBuf.length)}catch(a){this.release(a);return}}this._fsync&&d.fsyncSync(this.fd);let g=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):g>this.minLength?this._actualWrite():this._ending?g>0?this._actualWrite():(this._writing=!1,E(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(t,this)):this.emit("drain"))},this.on("newListener",function(a){"drain"===a&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function s(a,b,c){return"string"==typeof a&&Buffer.byteLength(a)!==c&&(c=Buffer.from(a).subarray(0,c).toString().length),b=Math.max(b-c,0),{writingBuf:a=a.slice(c),len:b}}function t(a){a.listenerCount("drain")>0&&(a._asyncDrainScheduled=!1,a.emit("drain"))}function u(a,b){return 0===a.length?j:1===a.length?a[0]:Buffer.concat(a,b)}function v(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||c[c.length-1].length+a.length>this.maxWrite?c.push(""+a):c[c.length-1]+=a,this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function w(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs,d=this._lens;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||d[d.length-1]+a.length>this.maxWrite?(c.push([a]),d.push(a.length)):(c[c.length-1].push(a),d[d.length-1]+=a.length),this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function x(a){this._flushPending=!0;let b=()=>{if(this._fsync)this._flushPending=!1,a();else try{d.fsync(this.fd,b=>{this._flushPending=!1,a(b)})}catch(b){a(b)}this.off("error",c)},c=c=>{this._flushPending=!1,a(c),this.off("drain",b)};this.once("drain",b),this.once("error",c)}function y(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite()))}function z(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite()))}function A(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let a="";for(;this._bufs.length||a;){a.length<=0&&(a=this._bufs[0]);try{let b=d.writeSync(this.fd,a,"utf8"),c=s(a,this._len,b);a=c.writingBuf,this._len=c.len,a.length<=0&&this._bufs.shift()}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}try{d.fsyncSync(this.fd)}catch{}}function B(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=j);let a=j;for(;this._bufs.length||a.length;){a.length<=0&&(a=u(this._bufs[0],this._lens[0]));try{let b=d.writeSync(this.fd,a);a=a.subarray(b),this._len=Math.max(this._len-b,0),a.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}}function C(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let b=d.writeSync(this.fd,this._writingBuf,"utf8");a(null,b)}catch(b){a(b)}else d.write(this.fd,this._writingBuf,"utf8",a)}function D(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:u(this._bufs.shift(),this._lens.shift()),this.sync)try{let b=d.writeSync(this.fd,this._writingBuf);a(null,b)}catch(b){a(b)}else p&&(this._writingBuf=Buffer.from(this._writingBuf)),d.write(this.fd,this._writingBuf,a)}function E(a){if(-1===a.fd)return void a.once("ready",E.bind(null,a));void 0!==a._periodicFlushTimer&&clearInterval(a._periodicFlushTimer),a.destroyed=!0,a._bufs=[],a._lens=[],i("number"==typeof a.fd,`sonic.fd must be a number, got ${typeof a.fd}`);try{d.fsync(a.fd,function(){1!==a.fd&&2!==a.fd?d.close(a.fd,b):b()})}catch{}function b(b){b?a.emit("error",b):(a._ending&&!a._writing&&a.emit("finish"),a.emit("close"))}}f(r,e),r.prototype.reopen=function(a){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening)return void this.once("ready",()=>{this.reopen(a)});if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(a&&(this.file=a),this._reopening=!0,this._writing)return;let b=this.fd;this.once("ready",()=>{b!==this.fd&&d.close(b,a=>{if(a)return this.emit("error",a)})}),q(this.file,this)},r.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");this._opening?this.once("ready",()=>{this.end()}):this._ending||(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():E(this)))},r.prototype.destroy=function(){this.destroyed||E(this)},r.SonicBoom=r,r.default=r,b.exports=r},348492,(a,b,c)=>{"use strict";let d=a.r(677652),e=a.r(91972),{mapHttpRequest:f,mapHttpResponse:g}=a.r(744402),h=a.r(912525),i=a.r(882412),{lsCacheSym:j,chindingsSym:k,writeSym:l,serializersSym:m,formatOptsSym:o,endSym:p,stringifiersSym:q,stringifySym:r,stringifySafeSym:s,wildcardFirstSym:t,nestedKeySym:u,formattersSym:v,messageKeySym:w,errorKeySym:x,nestedKeyStrSym:y,msgPrefixSym:z}=a.r(596323),{isMainThread:A}=a.r(37702),B=a.r(234761),C=d.tracingChannel("pino_asJson");function D(){}function E(a){let b="",c=0,d=!1,e=255,f=a.length;if(f>100)return JSON.stringify(a);for(var g=0;g<f&&e>=32;g++)(34===(e=a.charCodeAt(g))||92===e)&&(b+=a.slice(c,g)+"\\",c=g,d=!0);return d?b+=a.slice(c):b=a,e<32?JSON.stringify(a):'"'+b+'"'}function F(a,b,c,d){let e,f=this[r],g=this[s],h=this[q],i=this[p],l=this[k],o=this[m],z=this[v],A=this[w],B=this[x],C=this[j][c]+d;C+=l,z.log&&(a=z.log(a));let D=h[t],F="";for(let b in a)if(e=a[b],Object.prototype.hasOwnProperty.call(a,b)&&void 0!==e){o[b]?e=o[b](e):b===B&&o.err&&(e=o.err(e));let a=h[b]||D;switch(typeof e){case"undefined":case"function":continue;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e));break;case"string":e=(a||E)(e);break;default:e=(a||f)(e,g)}if(void 0===e)continue;F+=","+E(b)+":"+e}let G="";if(void 0!==b){e=o[A]?o[A](b):b;let a=h[A]||D;switch(typeof e){case"function":break;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e)),G=',"'+A+'":'+e;break;case"string":G=',"'+A+'":'+(e=(a||E)(e));break;default:G=',"'+A+'":'+(e=(a||f)(e,g))}}return this[u]&&F?C+this[y]+F.slice(1)+"}"+G+i:C+F+G+i}function G(a){let b=new h(a);return b.on("error",function a(c){if("EPIPE"===c.code){b.write=D,b.end=D,b.flushSync=D,b.destroy=D;return}b.removeListener("error",a),b.emit("error",c)}),!a.sync&&A&&(i.register(b,H),b.on("close",function(){i.unregister(b)})),b}function H(a,b){a.destroyed||("beforeExit"===b?(a.flush(),a.on("drain",function(){a.end()})):a.flushSync())}b.exports={noop:D,buildSafeSonicBoom:G,asChindings:function(a,b){let c,d=a[k],e=a[r],f=a[s],g=a[q],h=g[t],i=a[m];for(let j in b=(0,a[v].bindings)(b))if(c=b[j],!0===((j.length<5||"level"!==j&&"serializers"!==j&&"formatters"!==j&&"customLevels"!==j)&&b.hasOwnProperty(j)&&void 0!==c)){if(c=i[j]?i[j](c):c,void 0===(c=(g[j]||h||e)(c,f)))continue;d+=',"'+j+'":'+c}return d},asJson:function(a,b,c,d){return!1===C.hasSubscribers?F.call(this,a,b,c,d):C.traceSync(F,{instance:this,arguments},this,a,b,c,d)},genLog:function(a,b){if(!b)return c;return function(...d){b.call(this,d,c,a)};function c(b,...d){if("object"==typeof b){let c,h=b;null!==b&&(b.method&&b.headers&&b.socket?b=f(b):"function"==typeof b.setHeader&&(b=g(b))),null===h&&0===d.length?c=[null]:(h=d.shift(),c=d),"string"==typeof this[z]&&null!=h&&(h=this[z]+h),this[l](b,e(h,c,this[o]),a)}else{let c=void 0===b?d.shift():b;"string"==typeof this[z]&&null!=c&&(c=this[z]+c),this[l](null,e(c,d,this[o]),a)}}},createArgsNormalizer:function(a){return function(b,c,d={},e){if("string"==typeof d)e=G({dest:d}),d={};else if("string"==typeof e){if(d&&d.transport)throw Error("only one of option.transport or stream can be specified");e=G({dest:e})}else if(d instanceof h||d.writable||d._writableState)e=d,d={};else if(d.transport){let a;if(d.transport instanceof h||d.transport.writable||d.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(d.transport.targets&&d.transport.targets.length&&d.formatters&&"function"==typeof d.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");d.customLevels&&(a=d.useOnlyCustomLevels?d.customLevels:Object.assign({},d.levels,d.customLevels)),e=B({caller:c,...d.transport,levels:a})}if((d=Object.assign({},a,d)).serializers=Object.assign({},a.serializers,d.serializers),d.formatters=Object.assign({},a.formatters,d.formatters),d.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:f,onChild:g}=d;if(!1===f&&(d.level="silent"),g||(d.onChild=D),!e){var i;e=(i=process.stdout).write!==i.constructor.prototype.write?process.stdout:G({fd:process.stdout.fd||1})}return{opts:d,stream:e}}},stringify:function(a,b){try{return JSON.stringify(a)}catch(c){try{return(b||this[s])(a)}catch(a){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(a,b,c){return{level:a,bindings:b,log:c}},normalizeDestFileDescriptor:function(a){let b=Number(a);return"string"==typeof a&&Number.isFinite(b)?b:void 0===a?1:a}}},381878,(a,b,c)=>{"use strict";let{lsCacheSym:d,levelValSym:e,useOnlyCustomLevelsSym:f,streamSym:g,formattersSym:h,hooksSym:i,levelCompSym:j}=a.r(596323),{noop:k,genLog:l}=a.r(348492),{DEFAULT_LEVELS:m,SORTING_ORDER:o}=a.r(129582),p={fatal:a=>{let b=l(m.fatal,a);return function(...a){let c=this[g];if(b.call(this,...a),"function"==typeof c.flushSync)try{c.flushSync()}catch(a){}}},error:a=>l(m.error,a),warn:a=>l(m.warn,a),info:a=>l(m.info,a),debug:a=>l(m.debug,a),trace:a=>l(m.trace,a)},q=Object.keys(m).reduce((a,b)=>(a[m[b]]=b,a),{});function r(a,b,c){return a===o.DESC?b<=c:b>=c}b.exports={initialLsCache:Object.keys(q).reduce((a,b)=>(a[b]='{"level":'+Number(b),a),{}),genLsCache:function(a){let b=a[h].level,{labels:c}=a.levels,e={};for(let a in c){let d=b(c[a],Number(a));e[a]=JSON.stringify(d).slice(0,-1)}return a[d]=e,a},levelMethods:p,getLevel:function(a){let{levels:b,levelVal:c}=this;return b&&b.labels?b.labels[c]:""},setLevel:function(a){let{labels:b,values:c}=this.levels;if("number"==typeof a){if(void 0===b[a])throw Error("unknown level value"+a);a=b[a]}if(void 0===c[a])throw Error("unknown level "+a);let d=this[e],g=this[e]=c[a],h=this[f],m=this[j],o=this[i].logMethod;for(let a in c){if(!1===m(c[a],g)){this[a]=k;continue}this[a]=!function(a,b){if(b)return!1;switch(a){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(a,h)?l(c[a],o):p[a](o)}this.emit("level-change",a,g,b[d],d,this)},isLevelEnabled:function(a){let{values:b}=this.levels,c=b[a];return void 0!==c&&this[j](c,this[e])},mappings:function(a=null,b=!1){let c=a?Object.keys(a).reduce((b,c)=>(b[a[c]]=c,b),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),b?null:q,c),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),b?null:m,a)}},assertNoLevelCollisions:function(a,b){let{labels:c,values:d}=a;for(let a in b){if(a in d)throw Error("levels cannot be overridden");if(b[a]in c)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(a,b,c){if("number"==typeof a){if(![].concat(Object.keys(b||{}).map(a=>b[a]),c?[]:Object.keys(q).map(a=>+a),1/0).includes(a))throw Error(`default level:${a} must be included in custom levels`);return}if(!(a in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),c?null:m,b)))throw Error(`default level:${a} must be included in custom levels`)},genLevelComparison:function(a){return"string"==typeof a?r.bind(null,a):a},assertLevelComparison:function(a){if("function"!=typeof a&&!("string"==typeof a&&Object.values(o).includes(a)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},258588,(a,b,c)=>{"use strict";b.exports={version:"10.0.0"}},766646,(a,b,c)=>{"use strict";let{EventEmitter:d}=a.r(687769),{lsCacheSym:e,levelValSym:f,setLevelSym:g,getLevelSym:h,chindingsSym:i,parsedChindingsSym:j,mixinSym:k,asJsonSym:l,writeSym:m,mixinMergeStrategySym:o,timeSym:p,timeSliceIndexSym:q,streamSym:r,serializersSym:s,formattersSym:t,errorKeySym:u,messageKeySym:v,useOnlyCustomLevelsSym:w,needsMetadataGsym:x,redactFmtSym:y,stringifySym:z,formatOptsSym:A,stringifiersSym:B,msgPrefixSym:C,hooksSym:D}=a.r(596323),{getLevel:E,setLevel:F,isLevelEnabled:G,mappings:H,initialLsCache:I,genLsCache:J,assertNoLevelCollisions:K}=a.r(381878),{asChindings:L,asJson:M,buildFormatters:N,stringify:O,noop:P}=a.r(348492),{version:Q}=a.r(258588),R=a.r(408457),S={constructor:class{},child:function(a,b){if(!a)throw Error("missing bindings for child Pino");let c=this[s],d=this[t],e=Object.create(this);if(null==b)return e[t].bindings!==T&&(e[t]=N(d.level,T,d.log)),e[i]=L(e,a),this.onChild!==P&&this.onChild(e),e;if(!0===b.hasOwnProperty("serializers")){for(let a in e[s]=Object.create(null),c)e[s][a]=c[a];let a=Object.getOwnPropertySymbols(c);for(var f=0;f<a.length;f++){let b=a[f];e[s][b]=c[b]}for(let a in b.serializers)e[s][a]=b.serializers[a];let d=Object.getOwnPropertySymbols(b.serializers);for(var h=0;h<d.length;h++){let a=d[h];e[s][a]=b.serializers[a]}}else e[s]=c;if(b.hasOwnProperty("formatters")){let{level:a,bindings:c,log:f}=b.formatters;e[t]=N(a||d.level,c||T,f||d.log)}else e[t]=N(d.level,T,d.log);if(!0===b.hasOwnProperty("customLevels")&&(K(this.levels,b.customLevels),e.levels=H(b.customLevels,e[w]),J(e)),"object"==typeof b.redact&&null!==b.redact||Array.isArray(b.redact)){e.redact=b.redact;let a=R(e.redact,O),c={stringify:a[y]};e[z]=O,e[B]=a,e[A]=c}if("string"==typeof b.msgPrefix&&(e[C]=(this[C]||"")+b.msgPrefix),e[i]=L(e,a),void 0!==b.level&&b.level!==this.level||b.hasOwnProperty("customLevels")){let a=b.level||this.level;e[g](a)}return this.onChild(e),e},bindings:function(){let a=this[i],b=JSON.parse(`{${a.substr(1)}}`);return delete b.pid,delete b.hostname,b},setBindings:function(a){let b=L(this,a);this[i]=b,delete this[j]},flush:function(a){if(null!=a&&"function"!=typeof a)throw Error("callback must be a function");let b=this[r];"function"==typeof b.flush?b.flush(a||P):a&&a()},isLevelEnabled:G,version:Q,get level(){return this[h]()},set level(lvl){this[g](lvl)},get levelVal(){return this[f]},set levelVal(n){throw Error("levelVal is read-only")},get msgPrefix(){return this[C]},get[Symbol.toStringTag](){return"Pino"},[e]:I,[m]:function(a,b,c){let d,e=this[p](),f=this[k],g=this[u],h=this[v],i=this[o]||U,j=this[D].streamWrite;null==a?d={}:a instanceof Error?(d={[g]:a},void 0===b&&(b=a.message)):(d=a,void 0===b&&void 0===a[h]&&a[g]&&(b=a[g].message)),f&&(d=i(d,f(d,c,this)));let m=this[l](d,b,c,e),s=this[r];!0===s[x]&&(s.lastLevel=c,s.lastObj=d,s.lastMsg=b,s.lastTime=e.slice(this[q]),s.lastLogger=this),s.write(j?j(m):m)},[l]:M,[h]:E,[g]:F};Object.setPrototypeOf(S,d.prototype),b.exports=function(){return Object.create(S)};let T=a=>a;function U(a,b){return Object.assign(b,a)}},712042,(a,b,c)=>{"use strict";let d=a.r(660526),e=a.r(744402),f=a.r(797521),g=a.r(408457),h=a.r(55e4),i=a.r(766646),j=a.r(596323),{configure:k}=a.r(689465),{assertDefaultLevelFound:l,mappings:m,genLsCache:o,genLevelComparison:p,assertLevelComparison:q}=a.r(381878),{DEFAULT_LEVELS:r,SORTING_ORDER:s}=a.r(129582),{createArgsNormalizer:t,asChindings:u,buildSafeSonicBoom:v,buildFormatters:w,stringify:x,normalizeDestFileDescriptor:y,noop:z}=a.r(348492),{version:A}=a.r(258588),{chindingsSym:B,redactFmtSym:C,serializersSym:D,timeSym:E,timeSliceIndexSym:F,streamSym:G,stringifySym:H,stringifySafeSym:I,stringifiersSym:J,setLevelSym:K,endSym:L,formatOptsSym:M,messageKeySym:N,errorKeySym:O,nestedKeySym:P,mixinSym:Q,levelCompSym:R,useOnlyCustomLevelsSym:S,formattersSym:T,hooksSym:U,nestedKeyStrSym:V,mixinMergeStrategySym:W,msgPrefixSym:X}=j,{epochTime:Y,nullTime:Z}=h,{pid:$}=process,_=d.hostname(),aa=e.err,ab=t({level:"info",levelComparison:s.ASC,levels:r,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:$,hostname:_},serializers:Object.assign(Object.create(null),{err:aa}),formatters:Object.assign(Object.create(null),{bindings:a=>a,level:(a,b)=>({level:b})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:Y,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),ac=Object.assign(Object.create(null),e);function ad(...a){let b={},{opts:c,stream:d}=ab(b,f(),...a);c.level&&"string"==typeof c.level&&void 0!==r[c.level.toLowerCase()]&&(c.level=c.level.toLowerCase());let{redact:e,crlf:h,serializers:j,timestamp:s,messageKey:t,errorKey:v,nestedKey:y,base:A,name:$,level:_,customLevels:aa,levelComparison:ac,mixin:ae,mixinMergeStrategy:af,useOnlyCustomLevels:ag,formatters:ah,hooks:ai,depthLimit:aj,edgeLimit:ak,onChild:al,msgPrefix:am}=c,an=k({maximumDepth:aj,maximumBreadth:ak}),ao=w(ah.level,ah.bindings,ah.log),ap=x.bind({[I]:an}),aq=e?g(e,ap):{},ar=e?{stringify:aq[C]}:{stringify:ap},as=u.bind(null,{[B]:"",[D]:j,[J]:aq,[H]:x,[I]:an,[T]:ao}),at="";null!==A&&(at=as(void 0===$?A:Object.assign({},A,{name:$})));let au=s instanceof Function?s:s?Y:Z,av=au().indexOf(":")+1;if(ag&&!aa)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(ae&&"function"!=typeof ae)throw Error(`Unknown mixin type "${typeof ae}" - expected "function"`);if(am&&"string"!=typeof am)throw Error(`Unknown msgPrefix type "${typeof am}" - expected "string"`);l(_,aa,ag);let aw=m(aa,ag);return"function"==typeof d.emit&&d.emit("message",{code:"PINO_CONFIG",config:{levels:aw,messageKey:t,errorKey:v}}),q(ac),Object.assign(b,{levels:aw,[R]:p(ac),[S]:ag,[G]:d,[E]:au,[F]:av,[H]:x,[I]:an,[J]:aq,[L]:"}"+(h?"\r\n":"\n"),[M]:ar,[N]:t,[O]:v,[P]:y,[V]:y?`,${JSON.stringify(y)}:{`:"",[D]:j,[Q]:ae,[W]:af,[B]:at,[T]:ao,[U]:ai,silent:z,onChild:al,[X]:am}),Object.setPrototypeOf(b,i()),o(b),b[K](_),b}b.exports=ad,b.exports.destination=(a=process.stdout.fd)=>"object"==typeof a?(a.dest=y(a.dest||process.stdout.fd),v(a)):v({dest:y(a),minLength:0}),b.exports.transport=a.r(234761),b.exports.multistream=a.r(5337),b.exports.levels=m(),b.exports.stdSerializers=ac,b.exports.stdTimeFunctions=Object.assign({},h),b.exports.symbols=j,b.exports.version=A,b.exports.default=ad,b.exports.pino=ad},840879,(a,b,c)=>{"use strict";function d(a,b){return b}b.exports=function(){let a=Error.prepareStackTrace;Error.prepareStackTrace=d;let b=Error().stack;if(Error.prepareStackTrace=a,!Array.isArray(b))return;let c=b.slice(2),e=[];for(let a of c)a&&e.push(a.getFileName());return e}},175070,(a,b,c)=>{"use strict";let d,e={exit:[],beforeExit:[]},f={exit:function(){h("exit")},beforeExit:function(){h("beforeExit")}};function g(a){e[a].length>0||(process.removeListener(a,f[a]),0===e.exit.length&&0===e.beforeExit.length&&(d=void 0))}function h(a){for(let b of e[a]){let c=b.deref(),d=b.fn;void 0!==c&&d(c,a)}e[a]=[]}function i(a){for(let b of["exit","beforeExit"]){let c=e[b].indexOf(a);e[b].splice(c,c+1),g(b)}}function j(a,b,c){if(void 0===b)throw Error("the object can't be undefined");e[a].length>0||process.on(a,f[a]);let g=new WeakRef(b);g.fn=c,void 0===d&&(d=new FinalizationRegistry(i)),d.register(b,g),e[a].push(g)}b.exports={register:function(a,b){j("exit",a,b)},registerBeforeExit:function(a,b){j("beforeExit",a,b)},unregister:function(a){if(void 0!==d)for(let b of(d.unregister(a),["exit","beforeExit"]))e[b]=e[b].filter(b=>{let c=b.deref();return c&&c!==a}),g(b)}}},252873,a=>{a.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},566356,(a,b,c)=>{"use strict";b.exports={wait:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g===c)return void e(null,"ok");let h=g,i=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{h=g,(g=Atomics.load(a,b))===h?i(d>=1e3?1e3:2*d):g===c?e(null,"ok"):e(null,"not-equal")},d)};i(1)},waitDiff:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g!==c)return void e(null,"ok");let h=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{(g=Atomics.load(a,b))!==c?e(null,"ok"):h(d>=1e3?1e3:2*d)},d)};h(1)}}},245736,(a,b,c)=>{"use strict";b.exports={WRITE_INDEX:4,READ_INDEX:8}},276212,(a,b,c)=>{"use strict";let{version:d}=a.r(252873),{EventEmitter:e}=a.r(427699),{Worker:f}=a.r(37702),{join:g}=a.r(814747),{pathToFileURL:h}=a.r(792509),{wait:i}=a.r(566356),{WRITE_INDEX:j,READ_INDEX:k}=a.r(245736),l=a.r(500874),m=a.r(449719),o=Symbol("kImpl"),p=l.constants.MAX_STRING_LENGTH;class q{constructor(a){this._value=a}deref(){return this._value}}class r{register(){}unregister(){}}let s=process.env.NODE_V8_COVERAGE?r:a.g.FinalizationRegistry||r,t=process.env.NODE_V8_COVERAGE?q:a.g.WeakRef||q,u=new s(a=>{a.exited||a.terminate()});function v(a){m(!a[o].sync),a[o].needDrain&&(a[o].needDrain=!1,a.emit("drain"))}function w(a){let b=Atomics.load(a[o].state,j),c=a[o].data.length-b;if(c>0){if(0===a[o].buf.length){a[o].flushing=!1,a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a);return}let b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);d<=c?(a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))):a.flush(()=>{if(!a.destroyed){for(Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);d>a[o].data.length;)c/=2,b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))}})}else if(0===c){if(0===b&&0===a[o].buf.length)return;a.flush(()=>{Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0),w(a)})}else A(a,Error("overwritten"))}function x(a){let b=this.stream.deref();if(void 0===b){this.exited=!0,this.terminate();return}switch(a.code){case"READY":this.stream=new t(b),b.flush(()=>{b[o].ready=!0,b.emit("ready")});break;case"ERROR":A(b,a.err);break;case"EVENT":Array.isArray(a.args)?b.emit(a.name,...a.args):b.emit(a.name,a.args);break;case"WARNING":process.emitWarning(a.err);break;default:A(b,Error("this should not happen: "+a.code))}}function y(a){let b=this.stream.deref();void 0!==b&&(u.unregister(b),b.worker.exited=!0,b.worker.off("exit",y),A(b,0!==a?Error("the worker thread exited"):null))}function z(a,b){setImmediate(()=>{a.emit("error",b)})}function A(a,b){a[o].destroyed||(a[o].destroyed=!0,b&&(a[o].errored=b,z(a,b)),a.worker.exited?setImmediate(()=>{a[o].closed=!0,a.emit("close")}):a.worker.terminate().catch(()=>{}).then(()=>{a[o].closed=!0,a.emit("close")}))}function B(a,b,c){let d=Atomics.load(a[o].state,j),e=Buffer.byteLength(b);return a[o].data.write(b,d),Atomics.store(a[o].state,j,d+e),Atomics.notify(a[o].state,j),c(),!0}function C(a){if(!a[o].ended&&a[o].ending&&!a[o].flushing){a[o].ended=!0;try{a.flushSync();let b=Atomics.load(a[o].state,k);Atomics.store(a[o].state,j,-1),Atomics.notify(a[o].state,j);let c=0;for(;-1!==b;){if(Atomics.wait(a[o].state,k,b,1e3),b=Atomics.load(a[o].state,k),-2===b)return void A(a,Error("end() failed"));if(10==++c)return void A(a,Error("end() took too long (10s)"))}process.nextTick(()=>{a[o].finished=!0,a.emit("finish")})}catch(b){A(a,b)}}}function D(a){let b=()=>{a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a)};for(a[o].flushing=!1;0!==a[o].buf.length;){let c=Atomics.load(a[o].state,j),d=a[o].data.length-c;if(0===d){E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);continue}if(d<0)throw Error("overwritten");let e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);if(f<=d)a[o].buf=a[o].buf.slice(d),B(a,e,b);else{for(E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);f>a[o].buf.length;)d/=2,e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);a[o].buf=a[o].buf.slice(d),B(a,e,b)}}}function E(a){if(a[o].flushing)throw Error("unable to flush while flushing");let b=Atomics.load(a[o].state,j),c=0;for(;;){let d=Atomics.load(a[o].state,k);if(-2===d)throw Error("_flushSync failed");if(d!==b)Atomics.wait(a[o].state,k,d,1e3);else break;if(10==++c)throw Error("_flushSync took too long (10s)")}}b.exports=class extends e{constructor(a={}){if(super(),a.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[o]={},this[o].stateBuf=new SharedArrayBuffer(128),this[o].state=new Int32Array(this[o].stateBuf),this[o].dataBuf=new SharedArrayBuffer(a.bufferSize||4194304),this[o].data=Buffer.from(this[o].dataBuf),this[o].sync=a.sync||!1,this[o].ending=!1,this[o].ended=!1,this[o].needDrain=!1,this[o].destroyed=!1,this[o].flushing=!1,this[o].ready=!1,this[o].finished=!1,this[o].errored=null,this[o].closed=!1,this[o].buf="",this.worker=function(a,b){let{filename:c,workerData:e}=b,i=new f(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||g("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-utils/node_modules/thread-stream","lib","worker.js"),{...b.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===c.indexOf("file://")?c:h(c).href,dataBuf:a[o].dataBuf,stateBuf:a[o].stateBuf,workerData:{$context:{threadStreamVersion:d},...e}}});return i.stream=new q(a),i.on("message",x),i.on("exit",y),u.register(a,i),i}(this,a),this.on("message",(a,b)=>{this.worker.postMessage(a,b)})}write(a){if(this[o].destroyed)return z(this,Error("the worker has exited")),!1;if(this[o].ending)return z(this,Error("the worker is ending")),!1;if(this[o].flushing&&this[o].buf.length+a.length>=p)try{D(this),this[o].flushing=!0}catch(a){return A(this,a),!1}if(this[o].buf+=a,this[o].sync)try{return D(this),!0}catch(a){return A(this,a),!1}return this[o].flushing||(this[o].flushing=!0,setImmediate(w,this)),this[o].needDrain=this[o].data.length-this[o].buf.length-Atomics.load(this[o].state,j)<=0,!this[o].needDrain}end(){this[o].destroyed||(this[o].ending=!0,C(this))}flush(a){if(this[o].destroyed){"function"==typeof a&&process.nextTick(a,Error("the worker has exited"));return}let b=Atomics.load(this[o].state,j);i(this[o].state,k,b,1/0,(b,c)=>{if(b){A(this,b),process.nextTick(a,b);return}"not-equal"===c?this.flush(a):process.nextTick(a)})}flushSync(){this[o].destroyed||(D(this),E(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[o].ready}get destroyed(){return this[o].destroyed}get closed(){return this[o].closed}get writable(){return!this[o].destroyed&&!this[o].ending}get writableEnded(){return this[o].ending}get writableFinished(){return this[o].finished}get writableNeedDrain(){return this[o].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[o].errored}}},777829,(a,b,c)=>{"use strict";let{createRequire:d}=a.r(362562),e=a.r(840879),{join:f,isAbsolute:g,sep:h}=a.r(750227),i=a.r(296175),j=a.r(175070),k=a.r(276212);function l(a){a.ref(),a.flushSync(),a.end(),a.once("close",function(){a.unref()})}function m(a){a.flushSync()}b.exports=function(a){let{pipeline:b,targets:c,levels:o,dedupe:p,worker:q={},caller:r=e(),sync:s=!1}=a,t={...a.options},u="string"==typeof r?[r]:r,v="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},w=a.target;if(w&&c)throw Error("only one of target or targets can be specified");c?(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-utils/node_modules/pino/lib","worker.js"),t.targets=c.filter(a=>a.target).map(a=>({...a,target:z(a.target)})),t.pipelines=c.filter(a=>a.pipeline).map(a=>a.pipeline.map(b=>({...b,level:a.level,target:z(b.target)})))):b&&(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-utils/node_modules/pino/lib","worker.js"),t.pipelines=[b.map(a=>({...a,target:z(a.target)}))]),o&&(t.levels=o),p&&(t.dedupe=p),t.pinoWillSendConfig=!0;let x=new k({filename:z(w),workerData:t,workerOpts:q,sync:s});function y(){x.closed||(x.flushSync(),i(100),x.end())}return x.on("ready",function(){process.removeListener("exit",y),x.unref(),!1!==q.autoEnd&&(j.register(x,l),j.registerBeforeExit(x,m),x.on("close",function(){j.unregister(x)}))}),x.on("close",function(){process.removeListener("exit",y)}),process.on("exit",y),x;function z(a){let b;if(g(a=v[a]||a)||0===a.indexOf("file://"))return a;if("pino/file"===a)return f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-utils/node_modules/pino/lib","..","file.js");for(let c of u)try{let e="node:repl"===c?process.cwd()+h:c;b=d(e).resolve(a);break}catch(a){continue}if(!b)throw Error(`unable to determine transport target for "${a}"`);return b}}},131941,(a,b,c)=>{b.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},411193,(a,b,c)=>{"use strict";let d=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:e}=a.r(131941),f=e.info;function g(a,b){return a.level-b.level}b.exports=function(a,b){a=a||[],b=b||{dedupe:!1};let c=Object.create(e);c.silent=1/0,b.levels&&"object"==typeof b.levels&&Object.keys(b.levels).forEach(a=>{c[a]=b.levels[a]});let h={write:i,add:l,remove:m,emit:j,flushSync:k,end:function(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync(),a.end()},minLevel:0,lastId:0,streams:[],clone:function a(b){let c=Array(this.streams.length);for(let a=0;a<c.length;a++)c[a]={level:b,stream:this.streams[a].stream};return{write:i,add:l,remove:m,minLevel:b,streams:c,clone:a,emit:j,flushSync:k,[d]:!0}},[d]:!0,streamLevels:c};return Array.isArray(a)?a.forEach(l,h):l.call(h,a),a=null,h;function i(a){var c,e,f,g;let h,i,j=this.lastLevel,{streams:k}=this,l=0;for(let m=(c=k.length,b.dedupe?c-1:0);e=m,f=k.length,b.dedupe?e>=0:e<f;g=m,m=b.dedupe?g-1:g+1)if((h=k[m]).level<=j){if(0!==l&&l!==h.level)break;if((i=h.stream)[d]){let{lastTime:a,lastMsg:b,lastObj:c,lastLogger:d}=this;i.lastLevel=j,i.lastTime=a,i.lastMsg=b,i.lastObj=c,i.lastLogger=d}i.write(a),b.dedupe&&(l=h.level)}else if(!b.dedupe)break}function j(...a){for(let{stream:b}of this.streams)"function"==typeof b.emit&&b.emit(...a)}function k(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync()}function l(a){if(!a)return h;let b="function"==typeof a.write||a.stream,c=a.write?a:a.stream;if(!b)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:d,streamLevels:e}=this,i={stream:c,level:"number"==typeof a.levelVal?a.levelVal:"string"==typeof a.level?e[a.level]:"number"==typeof a.level?a.level:f,levelVal:void 0,id:++h.lastId};return d.unshift(i),d.sort(g),this.minLevel=d[0].level,h}function m(a){let{streams:b}=this,c=b.findIndex(b=>b.id===a);return c>=0&&(b.splice(c,1),b.sort(g),this.minLevel=b.length>0?b[0].level:-1),h}}},363657,(a,b,c)=>{"use strict";let d=a=>a&&"string"==typeof a.message,e=a=>{if(!a)return;let b=a.cause;if("function"!=typeof b)return d(b)?b:void 0;{let b=a.cause();return d(b)?b:void 0}},f=(a,b)=>{if(!d(a))return"";let c=a.stack||"";if(b.has(a))return c+"\ncauses have become circular...";let g=e(a);return g?(b.add(a),c+"\ncaused by: "+f(g,b)):c},g=(a,b,c)=>{if(!d(a))return"";let f=c?"":a.message||"";if(b.has(a))return f+": ...";let h=e(a);if(!h)return f;{b.add(a);let c="function"==typeof a.cause;return f+(c?"":": ")+g(h,b,c)}};b.exports={isErrorLike:d,getErrorCause:e,stackWithCauses:a=>f(a,new Set),messageWithCauses:a=>g(a,new Set)}},75138,(a,b,c)=>{"use strict";let d=Symbol("circular-ref-tag"),e=Symbol("pino-raw-err-ref"),f=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[e]},set:function(a){this[e]=a}}});Object.defineProperty(f,e,{writable:!0,value:{}}),b.exports={pinoErrProto:f,pinoErrorSymbols:{seen:d,rawSymbol:e}}},301411,(a,b,c)=>{"use strict";b.exports=function a(b){if(!f(b))return b;b[i]=void 0;let c=Object.create(g);for(let g in c.type="[object Function]"===j.call(b.constructor)?b.constructor.name:b.name,c.message=d(b),c.stack=e(b),Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),b)if(void 0===c[g]){let d=b[g];f(d)?"cause"===g||Object.prototype.hasOwnProperty.call(d,i)||(c[g]=a(d)):c[g]=d}return delete b[i],c.raw=b,c};let{messageWithCauses:d,stackWithCauses:e,isErrorLike:f}=a.r(363657),{pinoErrProto:g,pinoErrorSymbols:h}=a.r(75138),{seen:i}=h,{toString:j}=Object.prototype},874758,(a,b,c)=>{"use strict";b.exports=function a(b){if(!d(b))return b;b[g]=void 0;let c=Object.create(e);for(let e in c.type="[object Function]"===h.call(b.constructor)?b.constructor.name:b.name,c.message=b.message,c.stack=b.stack,Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),d(b.cause)&&!Object.prototype.hasOwnProperty.call(b.cause,g)&&(c.cause=a(b.cause)),b)if(void 0===c[e]){let f=b[e];d(f)?Object.prototype.hasOwnProperty.call(f,g)||(c[e]=a(f)):c[e]=f}return delete b[g],c.raw=b,c};let{isErrorLike:d}=a.r(363657),{pinoErrProto:e,pinoErrorSymbols:f}=a.r(75138),{seen:g}=f,{toString:h}=Object.prototype},237550,(a,b,c)=>{"use strict";b.exports={mapHttpRequest:function(a){return{req:f(a)}},reqSerializer:f};let d=Symbol("pino-raw-req-ref"),e=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=a.info||a.socket,c=Object.create(e);if(c.id="function"==typeof a.id?a.id():a.id||(a.info?a.info.id:void 0),c.method=a.method,a.originalUrl)c.url=a.originalUrl;else{let b=a.path;c.url="string"==typeof b?b:a.url?a.url.path||a.url:void 0}return a.query&&(c.query=a.query),a.params&&(c.params=a.params),c.headers=a.headers,c.remoteAddress=b&&b.remoteAddress,c.remotePort=b&&b.remotePort,c.raw=a.raw||a,c}Object.defineProperty(e,d,{writable:!0,value:{}})},529206,(a,b,c)=>{"use strict";b.exports={mapHttpResponse:function(a){return{res:f(a)}},resSerializer:f};let d=Symbol("pino-raw-res-ref"),e=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=Object.create(e);return b.statusCode=a.headersSent?a.statusCode:null,b.headers=a.getHeaders?a.getHeaders():a._headers,b.raw=a,b}Object.defineProperty(e,d,{writable:!0,value:{}})},345661,(a,b,c)=>{"use strict";let d=a.r(301411),e=a.r(874758),f=a.r(237550),g=a.r(529206);b.exports={err:d,errWithCause:e,mapHttpRequest:f.mapHttpRequest,mapHttpResponse:g.mapHttpResponse,req:f.reqSerializer,res:g.resSerializer,wrapErrorSerializer:function(a){return a===d?a:function(b){return a(d(b))}},wrapRequestSerializer:function(a){return a===f.reqSerializer?a:function(b){return a(f.reqSerializer(b))}},wrapResponseSerializer:function(a){return a===g.resSerializer?a:function(b){return a(g.resSerializer(b))}}}},236189,(a,b,c)=>{"use strict";let d=Symbol("pino.setLevel"),e=Symbol("pino.getLevel"),f=Symbol("pino.levelVal"),g=Symbol("pino.levelComp"),h=Symbol("pino.useLevelLabels"),i=Symbol("pino.useOnlyCustomLevels"),j=Symbol("pino.mixin"),k=Symbol("pino.lsCache"),l=Symbol("pino.chindings"),m=Symbol("pino.asJson"),o=Symbol("pino.write"),p=Symbol("pino.redactFmt"),q=Symbol("pino.time"),r=Symbol("pino.timeSliceIndex"),s=Symbol("pino.stream"),t=Symbol("pino.stringify"),u=Symbol("pino.stringifySafe"),v=Symbol("pino.stringifiers"),w=Symbol("pino.end"),x=Symbol("pino.formatOpts"),y=Symbol("pino.messageKey"),z=Symbol("pino.errorKey"),A=Symbol("pino.nestedKey"),B=Symbol("pino.nestedKeyStr"),C=Symbol("pino.mixinMergeStrategy"),D=Symbol("pino.msgPrefix"),E=Symbol("pino.wildcardFirst"),F=Symbol.for("pino.serializers"),G=Symbol.for("pino.formatters"),H=Symbol.for("pino.hooks");b.exports={setLevelSym:d,getLevelSym:e,levelValSym:f,levelCompSym:g,useLevelLabelsSym:h,mixinSym:j,lsCacheSym:k,chindingsSym:l,asJsonSym:m,writeSym:o,serializersSym:F,redactFmtSym:p,timeSym:q,timeSliceIndexSym:r,streamSym:s,stringifySym:t,stringifySafeSym:u,stringifiersSym:v,endSym:w,formatOptsSym:x,messageKeySym:y,errorKeySym:z,nestedKeySym:A,wildcardFirstSym:E,needsMetadataGsym:Symbol.for("pino.metadata"),useOnlyCustomLevelsSym:i,formattersSym:G,hooksSym:H,nestedKeyStrSym:B,mixinMergeStrategySym:C,msgPrefixSym:D}},366277,(a,b,c)=>{"use strict";let d=a.r(71347),{redactFmtSym:e,wildcardFirstSym:f}=a.r(236189),g=/[^.[\]]+|\[([^[\]]*?)\]/g,h="[Redacted]";b.exports=function(a,b){let{paths:c,censor:i,remove:j}=function(a){if(Array.isArray(a))return{paths:a,censor:h};let{paths:b,censor:c=h,remove:d}=a;if(!1===Array.isArray(b))throw Error("pino â€“ redact must contain an array of strings");return!0===d&&(c=void 0),{paths:b,censor:c,remove:d}}(a),k=c.reduce((a,b)=>{g.lastIndex=0;let c=g.exec(b),d=g.exec(b),e=void 0!==c[1]?c[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):c[0];if("*"===e&&(e=f),null===d)return a[e]=null,a;if(null===a[e])return a;let{index:h}=d,i=`${b.substr(h,b.length-1)}`;return a[e]=a[e]||[],e!==f&&0===a[e].length&&a[e].push(...a[f]||[]),e===f&&Object.keys(a).forEach(function(b){a[b]&&a[b].push(i)}),a[e].push(i),a},{}),l={[e]:d({paths:c,censor:i,serialize:b,strict:!1,remove:j})};return[...Object.keys(k),...Object.getOwnPropertySymbols(k)].reduce((a,c)=>{if(null===k[c])a[c]=a=>((...a)=>"function"==typeof i?b(i(...a)):b(i))(a,[c]);else{let e="function"==typeof i?(a,b)=>i(a,[c,...b]):i;a[c]=d({paths:k[c],censor:e,serialize:b,strict:!1,remove:j})}return a},l)}},677546,(a,b,c)=>{"use strict";let d=1000000n*BigInt(Date.now()),e=process.hrtime.bigint();b.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`,isoTimeNano:()=>{let a=d+(process.hrtime.bigint()-e),b=a%1000000000n,c=new Date(Number(a/1000000000n*1000n+b/1000000n)),f=c.getUTCFullYear(),g=(c.getUTCMonth()+1).toString().padStart(2,"0"),h=c.getUTCDate().toString().padStart(2,"0"),i=c.getUTCHours().toString().padStart(2,"0"),j=c.getUTCMinutes().toString().padStart(2,"0"),k=c.getUTCSeconds().toString().padStart(2,"0");return`,"time":"${f}-${g}-${h}T${i}:${j}:${k}.${b.toString().padStart(9,"0")}Z"`}}},981132,(a,b,c)=>{"use strict";let d=a.r(522734),e=a.r(427699),f=a.r(224361).inherits,g=a.r(814747),h=a.r(296175),i=a.r(449719),j=Buffer.allocUnsafe(0),k="buffer",l="utf8",[m,o]=(process.versions.node||"0.0").split(".").map(Number),p=m>=22&&o>=7;function q(a,b){function c(c,d){if(c){b._reopening=!1,b._writing=!1,b._opening=!1,b.sync?process.nextTick(()=>{b.listenerCount("error")>0&&b.emit("error",c)}):b.emit("error",c);return}let e=b._reopening;b.fd=d,b.file=a,b._reopening=!1,b._opening=!1,b._writing=!1,b.sync?process.nextTick(()=>b.emit("ready")):b.emit("ready"),!b.destroyed&&(!b._writing&&b._len>b.minLength||b._flushPending?b._actualWrite():e&&process.nextTick(()=>b.emit("drain")))}b._opening=!0,b._writing=!0,b._asyncDrainScheduled=!1;let e=b.append?"a":"w",f=b.mode;if(b.sync)try{b.mkdir&&d.mkdirSync(g.dirname(a),{recursive:!0});let h=d.openSync(a,e,f);c(null,h)}catch(a){throw c(a),a}else b.mkdir?d.mkdir(g.dirname(a),{recursive:!0},b=>{if(b)return c(b);d.open(a,e,f,c)}):d.open(a,e,f,c)}function r(a){let b,c;if(!(this instanceof r))return new r(a);let{fd:e,dest:f,minLength:g,maxLength:i,maxWrite:m,periodicFlush:o,sync:p,append:u=!0,mkdir:x,retryEAGAIN:F,fsync:G,contentMode:H,mode:I}=a||{};if(e=e||f,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(g||0,16387),this.file=null,this.destroyed=!1,this.minLength=g||0,this.maxLength=i||0,this.maxWrite=m||16384,this._periodicFlush=o||0,this._periodicFlushTimer=void 0,this.sync=p||!1,this.writable=!0,this._fsync=G||!1,this.append=u||!1,this.mode=I,this.retryEAGAIN=F||(()=>!0),this.mkdir=x||!1,H===k)this._writingBuf=j,this.write=w,this.flush=z,this.flushSync=B,this._actualWrite=D,b=()=>d.writeSync(this.fd,this._writingBuf),c=()=>d.write(this.fd,this._writingBuf,this.release);else if(void 0===H||H===l)this._writingBuf="",this.write=v,this.flush=y,this.flushSync=A,this._actualWrite=C,b=()=>d.writeSync(this.fd,this._writingBuf,"utf8"),c=()=>d.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${l}" and "${k}", but passed ${H}`);if("number"==typeof e)this.fd=e,process.nextTick(()=>this.emit("ready"));else if("string"==typeof e)q(e,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(a,e)=>{if(a){if(("EAGAIN"===a.code||"EBUSY"===a.code)&&this.retryEAGAIN(a,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{h(100),this.release(void 0,0)}catch(a){this.release(a)}else setTimeout(c,100);else this._writing=!1,this.emit("error",a);return}this.emit("write",e);let f=s(this._writingBuf,this._len,e);if(this._len=f.len,this._writingBuf=f.writingBuf,this._writingBuf.length){if(!this.sync)return void c();try{do{let a=b(),c=s(this._writingBuf,this._len,a);this._len=c.len,this._writingBuf=c.writingBuf}while(this._writingBuf.length)}catch(a){this.release(a);return}}this._fsync&&d.fsyncSync(this.fd);let g=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):g>this.minLength?this._actualWrite():this._ending?g>0?this._actualWrite():(this._writing=!1,E(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(t,this)):this.emit("drain"))},this.on("newListener",function(a){"drain"===a&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function s(a,b,c){return"string"==typeof a&&Buffer.byteLength(a)!==c&&(c=Buffer.from(a).subarray(0,c).toString().length),b=Math.max(b-c,0),{writingBuf:a=a.slice(c),len:b}}function t(a){a.listenerCount("drain")>0&&(a._asyncDrainScheduled=!1,a.emit("drain"))}function u(a,b){return 0===a.length?j:1===a.length?a[0]:Buffer.concat(a,b)}function v(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||c[c.length-1].length+a.length>this.maxWrite?c.push(""+a):c[c.length-1]+=a,this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function w(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs,d=this._lens;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||d[d.length-1]+a.length>this.maxWrite?(c.push([a]),d.push(a.length)):(c[c.length-1].push(a),d[d.length-1]+=a.length),this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function x(a){this._flushPending=!0;let b=()=>{if(this._fsync)this._flushPending=!1,a();else try{d.fsync(this.fd,b=>{this._flushPending=!1,a(b)})}catch(b){a(b)}this.off("error",c)},c=c=>{this._flushPending=!1,a(c),this.off("drain",b)};this.once("drain",b),this.once("error",c)}function y(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite()))}function z(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite()))}function A(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let a="";for(;this._bufs.length||a;){a.length<=0&&(a=this._bufs[0]);try{let b=d.writeSync(this.fd,a,"utf8"),c=s(a,this._len,b);a=c.writingBuf,this._len=c.len,a.length<=0&&this._bufs.shift()}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}try{d.fsyncSync(this.fd)}catch{}}function B(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=j);let a=j;for(;this._bufs.length||a.length;){a.length<=0&&(a=u(this._bufs[0],this._lens[0]));try{let b=d.writeSync(this.fd,a);a=a.subarray(b),this._len=Math.max(this._len-b,0),a.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}}function C(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let b=d.writeSync(this.fd,this._writingBuf,"utf8");a(null,b)}catch(b){a(b)}else d.write(this.fd,this._writingBuf,"utf8",a)}function D(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:u(this._bufs.shift(),this._lens.shift()),this.sync)try{let b=d.writeSync(this.fd,this._writingBuf);a(null,b)}catch(b){a(b)}else p&&(this._writingBuf=Buffer.from(this._writingBuf)),d.write(this.fd,this._writingBuf,a)}function E(a){if(-1===a.fd)return void a.once("ready",E.bind(null,a));void 0!==a._periodicFlushTimer&&clearInterval(a._periodicFlushTimer),a.destroyed=!0,a._bufs=[],a._lens=[],i("number"==typeof a.fd,`sonic.fd must be a number, got ${typeof a.fd}`);try{d.fsync(a.fd,function(){1!==a.fd&&2!==a.fd?d.close(a.fd,b):b()})}catch{}function b(b){b?a.emit("error",b):(a._ending&&!a._writing&&a.emit("finish"),a.emit("close"))}}f(r,e),r.prototype.reopen=function(a){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening)return void this.once("ready",()=>{this.reopen(a)});if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(a&&(this.file=a),this._reopening=!0,this._writing)return;let b=this.fd;this.once("ready",()=>{b!==this.fd&&d.close(b,a=>{if(a)return this.emit("error",a)})}),q(this.file,this)},r.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");this._opening?this.once("ready",()=>{this.end()}):this._ending||(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():E(this)))},r.prototype.destroy=function(){this.destroyed||E(this)},r.SonicBoom=r,r.default=r,b.exports=r},285985,(a,b,c)=>{"use strict";let d=a.r(677652),e=a.r(91972),{mapHttpRequest:f,mapHttpResponse:g}=a.r(345661),h=a.r(981132),i=a.r(175070),{lsCacheSym:j,chindingsSym:k,writeSym:l,serializersSym:m,formatOptsSym:o,endSym:p,stringifiersSym:q,stringifySym:r,stringifySafeSym:s,wildcardFirstSym:t,nestedKeySym:u,formattersSym:v,messageKeySym:w,errorKeySym:x,nestedKeyStrSym:y,msgPrefixSym:z}=a.r(236189),{isMainThread:A}=a.r(37702),B=a.r(777829),C=d.tracingChannel("pino_asJson");function D(){}function E(a){let b="",c=0,d=!1,e=255,f=a.length;if(f>100)return JSON.stringify(a);for(var g=0;g<f&&e>=32;g++)(34===(e=a.charCodeAt(g))||92===e)&&(b+=a.slice(c,g)+"\\",c=g,d=!0);return d?b+=a.slice(c):b=a,e<32?JSON.stringify(a):'"'+b+'"'}function F(a,b,c,d){let e,f=this[r],g=this[s],h=this[q],i=this[p],l=this[k],o=this[m],z=this[v],A=this[w],B=this[x],C=this[j][c]+d;C+=l,z.log&&(a=z.log(a));let D=h[t],F="";for(let b in a)if(e=a[b],Object.prototype.hasOwnProperty.call(a,b)&&void 0!==e){o[b]?e=o[b](e):b===B&&o.err&&(e=o.err(e));let a=h[b]||D;switch(typeof e){case"undefined":case"function":continue;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e));break;case"string":e=(a||E)(e);break;default:e=(a||f)(e,g)}if(void 0===e)continue;F+=","+E(b)+":"+e}let G="";if(void 0!==b){e=o[A]?o[A](b):b;let a=h[A]||D;switch(typeof e){case"function":break;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e)),G=',"'+A+'":'+e;break;case"string":G=',"'+A+'":'+(e=(a||E)(e));break;default:G=',"'+A+'":'+(e=(a||f)(e,g))}}return this[u]&&F?C+this[y]+F.slice(1)+"}"+G+i:C+F+G+i}function G(a){let b=new h(a);return b.on("error",function a(c){if("EPIPE"===c.code){b.write=D,b.end=D,b.flushSync=D,b.destroy=D;return}b.removeListener("error",a),b.emit("error",c)}),!a.sync&&A&&(i.register(b,H),b.on("close",function(){i.unregister(b)})),b}function H(a,b){a.destroyed||("beforeExit"===b?(a.flush(),a.on("drain",function(){a.end()})):a.flushSync())}b.exports={noop:D,buildSafeSonicBoom:G,asChindings:function(a,b){let c,d=a[k],e=a[r],f=a[s],g=a[q],h=g[t],i=a[m];for(let j in b=(0,a[v].bindings)(b))if(c=b[j],!0===((j.length<5||"level"!==j&&"serializers"!==j&&"formatters"!==j&&"customLevels"!==j)&&b.hasOwnProperty(j)&&void 0!==c)){if(c=i[j]?i[j](c):c,void 0===(c=(g[j]||h||e)(c,f)))continue;d+=',"'+j+'":'+c}return d},asJson:function(a,b,c,d){return!1===C.hasSubscribers?F.call(this,a,b,c,d):C.traceSync(F,{instance:this,arguments},this,a,b,c,d)},genLog:function(a,b){if(!b)return c;return function(...d){b.call(this,d,c,a)};function c(b,...d){if("object"==typeof b){let c,h=b;null!==b&&(b.method&&b.headers&&b.socket?b=f(b):"function"==typeof b.setHeader&&(b=g(b))),null===h&&0===d.length?c=[null]:(h=d.shift(),c=d),"string"==typeof this[z]&&null!=h&&(h=this[z]+h),this[l](b,e(h,c,this[o]),a)}else{let c=void 0===b?d.shift():b;"string"==typeof this[z]&&null!=c&&(c=this[z]+c),this[l](null,e(c,d,this[o]),a)}}},createArgsNormalizer:function(a){return function(b,c,d={},e){if("string"==typeof d)e=G({dest:d}),d={};else if("string"==typeof e){if(d&&d.transport)throw Error("only one of option.transport or stream can be specified");e=G({dest:e})}else if(d instanceof h||d.writable||d._writableState)e=d,d={};else if(d.transport){let a;if(d.transport instanceof h||d.transport.writable||d.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(d.transport.targets&&d.transport.targets.length&&d.formatters&&"function"==typeof d.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");d.customLevels&&(a=d.useOnlyCustomLevels?d.customLevels:Object.assign({},d.levels,d.customLevels)),e=B({caller:c,...d.transport,levels:a})}if((d=Object.assign({},a,d)).serializers=Object.assign({},a.serializers,d.serializers),d.formatters=Object.assign({},a.formatters,d.formatters),d.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:f,onChild:g}=d;if(!1===f&&(d.level="silent"),g||(d.onChild=D),!e){var i;e=(i=process.stdout).write!==i.constructor.prototype.write?process.stdout:G({fd:process.stdout.fd||1})}return{opts:d,stream:e}}},stringify:function(a,b){try{return JSON.stringify(a)}catch(c){try{return(b||this[s])(a)}catch(a){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(a,b,c){return{level:a,bindings:b,log:c}},normalizeDestFileDescriptor:function(a){let b=Number(a);return"string"==typeof a&&Number.isFinite(b)?b:void 0===a?1:a}}},692992,(a,b,c)=>{"use strict";let{lsCacheSym:d,levelValSym:e,useOnlyCustomLevelsSym:f,streamSym:g,formattersSym:h,hooksSym:i,levelCompSym:j}=a.r(236189),{noop:k,genLog:l}=a.r(285985),{DEFAULT_LEVELS:m,SORTING_ORDER:o}=a.r(131941),p={fatal:a=>{let b=l(m.fatal,a);return function(...a){let c=this[g];if(b.call(this,...a),"function"==typeof c.flushSync)try{c.flushSync()}catch(a){}}},error:a=>l(m.error,a),warn:a=>l(m.warn,a),info:a=>l(m.info,a),debug:a=>l(m.debug,a),trace:a=>l(m.trace,a)},q=Object.keys(m).reduce((a,b)=>(a[m[b]]=b,a),{});function r(a,b,c){return a===o.DESC?b<=c:b>=c}b.exports={initialLsCache:Object.keys(q).reduce((a,b)=>(a[b]='{"level":'+Number(b),a),{}),genLsCache:function(a){let b=a[h].level,{labels:c}=a.levels,e={};for(let a in c){let d=b(c[a],Number(a));e[a]=JSON.stringify(d).slice(0,-1)}return a[d]=e,a},levelMethods:p,getLevel:function(a){let{levels:b,levelVal:c}=this;return b&&b.labels?b.labels[c]:""},setLevel:function(a){let{labels:b,values:c}=this.levels;if("number"==typeof a){if(void 0===b[a])throw Error("unknown level value"+a);a=b[a]}if(void 0===c[a])throw Error("unknown level "+a);let d=this[e],g=this[e]=c[a],h=this[f],m=this[j],o=this[i].logMethod;for(let a in c){if(!1===m(c[a],g)){this[a]=k;continue}this[a]=!function(a,b){if(b)return!1;switch(a){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(a,h)?l(c[a],o):p[a](o)}this.emit("level-change",a,g,b[d],d,this)},isLevelEnabled:function(a){let{values:b}=this.levels,c=b[a];return void 0!==c&&this[j](c,this[e])},mappings:function(a=null,b=!1){let c=a?Object.keys(a).reduce((b,c)=>(b[a[c]]=c,b),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),b?null:q,c),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),b?null:m,a)}},assertNoLevelCollisions:function(a,b){let{labels:c,values:d}=a;for(let a in b){if(a in d)throw Error("levels cannot be overridden");if(b[a]in c)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(a,b,c){if("number"==typeof a){if(![].concat(Object.keys(b||{}).map(a=>b[a]),c?[]:Object.keys(q).map(a=>+a),1/0).includes(a))throw Error(`default level:${a} must be included in custom levels`);return}if(!(a in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),c?null:m,b)))throw Error(`default level:${a} must be included in custom levels`)},genLevelComparison:function(a){return"string"==typeof a?r.bind(null,a):a},assertLevelComparison:function(a){if("function"!=typeof a&&!("string"==typeof a&&Object.values(o).includes(a)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},55364,(a,b,c)=>{"use strict";b.exports={version:"10.0.0"}},192099,(a,b,c)=>{"use strict";let{EventEmitter:d}=a.r(687769),{lsCacheSym:e,levelValSym:f,setLevelSym:g,getLevelSym:h,chindingsSym:i,parsedChindingsSym:j,mixinSym:k,asJsonSym:l,writeSym:m,mixinMergeStrategySym:o,timeSym:p,timeSliceIndexSym:q,streamSym:r,serializersSym:s,formattersSym:t,errorKeySym:u,messageKeySym:v,useOnlyCustomLevelsSym:w,needsMetadataGsym:x,redactFmtSym:y,stringifySym:z,formatOptsSym:A,stringifiersSym:B,msgPrefixSym:C,hooksSym:D}=a.r(236189),{getLevel:E,setLevel:F,isLevelEnabled:G,mappings:H,initialLsCache:I,genLsCache:J,assertNoLevelCollisions:K}=a.r(692992),{asChindings:L,asJson:M,buildFormatters:N,stringify:O,noop:P}=a.r(285985),{version:Q}=a.r(55364),R=a.r(366277),S={constructor:class{},child:function(a,b){if(!a)throw Error("missing bindings for child Pino");let c=this[s],d=this[t],e=Object.create(this);if(null==b)return e[t].bindings!==T&&(e[t]=N(d.level,T,d.log)),e[i]=L(e,a),this.onChild!==P&&this.onChild(e),e;if(!0===b.hasOwnProperty("serializers")){for(let a in e[s]=Object.create(null),c)e[s][a]=c[a];let a=Object.getOwnPropertySymbols(c);for(var f=0;f<a.length;f++){let b=a[f];e[s][b]=c[b]}for(let a in b.serializers)e[s][a]=b.serializers[a];let d=Object.getOwnPropertySymbols(b.serializers);for(var h=0;h<d.length;h++){let a=d[h];e[s][a]=b.serializers[a]}}else e[s]=c;if(b.hasOwnProperty("formatters")){let{level:a,bindings:c,log:f}=b.formatters;e[t]=N(a||d.level,c||T,f||d.log)}else e[t]=N(d.level,T,d.log);if(!0===b.hasOwnProperty("customLevels")&&(K(this.levels,b.customLevels),e.levels=H(b.customLevels,e[w]),J(e)),"object"==typeof b.redact&&null!==b.redact||Array.isArray(b.redact)){e.redact=b.redact;let a=R(e.redact,O),c={stringify:a[y]};e[z]=O,e[B]=a,e[A]=c}if("string"==typeof b.msgPrefix&&(e[C]=(this[C]||"")+b.msgPrefix),e[i]=L(e,a),void 0!==b.level&&b.level!==this.level||b.hasOwnProperty("customLevels")){let a=b.level||this.level;e[g](a)}return this.onChild(e),e},bindings:function(){let a=this[i],b=JSON.parse(`{${a.substr(1)}}`);return delete b.pid,delete b.hostname,b},setBindings:function(a){let b=L(this,a);this[i]=b,delete this[j]},flush:function(a){if(null!=a&&"function"!=typeof a)throw Error("callback must be a function");let b=this[r];"function"==typeof b.flush?b.flush(a||P):a&&a()},isLevelEnabled:G,version:Q,get level(){return this[h]()},set level(lvl){this[g](lvl)},get levelVal(){return this[f]},set levelVal(n){throw Error("levelVal is read-only")},get msgPrefix(){return this[C]},get[Symbol.toStringTag](){return"Pino"},[e]:I,[m]:function(a,b,c){let d,e=this[p](),f=this[k],g=this[u],h=this[v],i=this[o]||U,j=this[D].streamWrite;null==a?d={}:a instanceof Error?(d={[g]:a},void 0===b&&(b=a.message)):(d=a,void 0===b&&void 0===a[h]&&a[g]&&(b=a[g].message)),f&&(d=i(d,f(d,c,this)));let m=this[l](d,b,c,e),s=this[r];!0===s[x]&&(s.lastLevel=c,s.lastObj=d,s.lastMsg=b,s.lastTime=e.slice(this[q]),s.lastLogger=this),s.write(j?j(m):m)},[l]:M,[h]:E,[g]:F};Object.setPrototypeOf(S,d.prototype),b.exports=function(){return Object.create(S)};let T=a=>a;function U(a,b){return Object.assign(b,a)}},607409,(a,b,c)=>{"use strict";let d=a.r(660526),e=a.r(345661),f=a.r(840879),g=a.r(366277),h=a.r(677546),i=a.r(192099),j=a.r(236189),{configure:k}=a.r(689465),{assertDefaultLevelFound:l,mappings:m,genLsCache:o,genLevelComparison:p,assertLevelComparison:q}=a.r(692992),{DEFAULT_LEVELS:r,SORTING_ORDER:s}=a.r(131941),{createArgsNormalizer:t,asChindings:u,buildSafeSonicBoom:v,buildFormatters:w,stringify:x,normalizeDestFileDescriptor:y,noop:z}=a.r(285985),{version:A}=a.r(55364),{chindingsSym:B,redactFmtSym:C,serializersSym:D,timeSym:E,timeSliceIndexSym:F,streamSym:G,stringifySym:H,stringifySafeSym:I,stringifiersSym:J,setLevelSym:K,endSym:L,formatOptsSym:M,messageKeySym:N,errorKeySym:O,nestedKeySym:P,mixinSym:Q,levelCompSym:R,useOnlyCustomLevelsSym:S,formattersSym:T,hooksSym:U,nestedKeyStrSym:V,mixinMergeStrategySym:W,msgPrefixSym:X}=j,{epochTime:Y,nullTime:Z}=h,{pid:$}=process,_=d.hostname(),aa=e.err,ab=t({level:"info",levelComparison:s.ASC,levels:r,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:$,hostname:_},serializers:Object.assign(Object.create(null),{err:aa}),formatters:Object.assign(Object.create(null),{bindings:a=>a,level:(a,b)=>({level:b})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:Y,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),ac=Object.assign(Object.create(null),e);function ad(...a){let b={},{opts:c,stream:d}=ab(b,f(),...a);c.level&&"string"==typeof c.level&&void 0!==r[c.level.toLowerCase()]&&(c.level=c.level.toLowerCase());let{redact:e,crlf:h,serializers:j,timestamp:s,messageKey:t,errorKey:v,nestedKey:y,base:A,name:$,level:_,customLevels:aa,levelComparison:ac,mixin:ae,mixinMergeStrategy:af,useOnlyCustomLevels:ag,formatters:ah,hooks:ai,depthLimit:aj,edgeLimit:ak,onChild:al,msgPrefix:am}=c,an=k({maximumDepth:aj,maximumBreadth:ak}),ao=w(ah.level,ah.bindings,ah.log),ap=x.bind({[I]:an}),aq=e?g(e,ap):{},ar=e?{stringify:aq[C]}:{stringify:ap},as=u.bind(null,{[B]:"",[D]:j,[J]:aq,[H]:x,[I]:an,[T]:ao}),at="";null!==A&&(at=as(void 0===$?A:Object.assign({},A,{name:$})));let au=s instanceof Function?s:s?Y:Z,av=au().indexOf(":")+1;if(ag&&!aa)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(ae&&"function"!=typeof ae)throw Error(`Unknown mixin type "${typeof ae}" - expected "function"`);if(am&&"string"!=typeof am)throw Error(`Unknown msgPrefix type "${typeof am}" - expected "string"`);l(_,aa,ag);let aw=m(aa,ag);return"function"==typeof d.emit&&d.emit("message",{code:"PINO_CONFIG",config:{levels:aw,messageKey:t,errorKey:v}}),q(ac),Object.assign(b,{levels:aw,[R]:p(ac),[S]:ag,[G]:d,[E]:au,[F]:av,[H]:x,[I]:an,[J]:aq,[L]:"}"+(h?"\r\n":"\n"),[M]:ar,[N]:t,[O]:v,[P]:y,[V]:y?`,${JSON.stringify(y)}:{`:"",[D]:j,[Q]:ae,[W]:af,[B]:at,[T]:ao,[U]:ai,silent:z,onChild:al,[X]:am}),Object.setPrototypeOf(b,i()),o(b),b[K](_),b}b.exports=ad,b.exports.destination=(a=process.stdout.fd)=>"object"==typeof a?(a.dest=y(a.dest||process.stdout.fd),v(a)):v({dest:y(a),minLength:0}),b.exports.transport=a.r(777829),b.exports.multistream=a.r(411193),b.exports.levels=m(),b.exports.stdSerializers=ac,b.exports.stdTimeFunctions=Object.assign({},h),b.exports.symbols=j,b.exports.version=A,b.exports.default=ad,b.exports.pino=ad},709920,(a,b,c)=>{"use strict";function d(a,b){return b}b.exports=function(){let a=Error.prepareStackTrace;Error.prepareStackTrace=d;let b=Error().stack;if(Error.prepareStackTrace=a,!Array.isArray(b))return;let c=b.slice(2),e=[];for(let a of c)a&&e.push(a.getFileName());return e}},884568,(a,b,c)=>{"use strict";let d,e={exit:[],beforeExit:[]},f={exit:function(){h("exit")},beforeExit:function(){h("beforeExit")}};function g(a){e[a].length>0||(process.removeListener(a,f[a]),0===e.exit.length&&0===e.beforeExit.length&&(d=void 0))}function h(a){for(let b of e[a]){let c=b.deref(),d=b.fn;void 0!==c&&d(c,a)}e[a]=[]}function i(a){for(let b of["exit","beforeExit"]){let c=e[b].indexOf(a);e[b].splice(c,c+1),g(b)}}function j(a,b,c){if(void 0===b)throw Error("the object can't be undefined");e[a].length>0||process.on(a,f[a]);let g=new WeakRef(b);g.fn=c,void 0===d&&(d=new FinalizationRegistry(i)),d.register(b,g),e[a].push(g)}b.exports={register:function(a,b){j("exit",a,b)},registerBeforeExit:function(a,b){j("beforeExit",a,b)},unregister:function(a){if(void 0!==d)for(let b of(d.unregister(a),["exit","beforeExit"]))e[b]=e[b].filter(b=>{let c=b.deref();return c&&c!==a}),g(b)}}},565151,a=>{a.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},442099,(a,b,c)=>{"use strict";b.exports={wait:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g===c)return void e(null,"ok");let h=g,i=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{h=g,(g=Atomics.load(a,b))===h?i(d>=1e3?1e3:2*d):g===c?e(null,"ok"):e(null,"not-equal")},d)};i(1)},waitDiff:function(a,b,c,d,e){let f=Date.now()+d,g=Atomics.load(a,b);if(g!==c)return void e(null,"ok");let h=d=>{Date.now()>f?e(null,"timed-out"):setTimeout(()=>{(g=Atomics.load(a,b))!==c?e(null,"ok"):h(d>=1e3?1e3:2*d)},d)};h(1)}}},391215,(a,b,c)=>{"use strict";b.exports={WRITE_INDEX:4,READ_INDEX:8}},893302,(a,b,c)=>{"use strict";let{version:d}=a.r(565151),{EventEmitter:e}=a.r(427699),{Worker:f}=a.r(37702),{join:g}=a.r(814747),{pathToFileURL:h}=a.r(792509),{wait:i}=a.r(442099),{WRITE_INDEX:j,READ_INDEX:k}=a.r(391215),l=a.r(500874),m=a.r(449719),o=Symbol("kImpl"),p=l.constants.MAX_STRING_LENGTH;class q{constructor(a){this._value=a}deref(){return this._value}}class r{register(){}unregister(){}}let s=process.env.NODE_V8_COVERAGE?r:a.g.FinalizationRegistry||r,t=process.env.NODE_V8_COVERAGE?q:a.g.WeakRef||q,u=new s(a=>{a.exited||a.terminate()});function v(a){m(!a[o].sync),a[o].needDrain&&(a[o].needDrain=!1,a.emit("drain"))}function w(a){let b=Atomics.load(a[o].state,j),c=a[o].data.length-b;if(c>0){if(0===a[o].buf.length){a[o].flushing=!1,a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a);return}let b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);d<=c?(a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))):a.flush(()=>{if(!a.destroyed){for(Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);d>a[o].data.length;)c/=2,b=a[o].buf.slice(0,c),d=Buffer.byteLength(b);a[o].buf=a[o].buf.slice(c),B(a,b,w.bind(null,a))}})}else if(0===c){if(0===b&&0===a[o].buf.length)return;a.flush(()=>{Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0),w(a)})}else A(a,Error("overwritten"))}function x(a){let b=this.stream.deref();if(void 0===b){this.exited=!0,this.terminate();return}switch(a.code){case"READY":this.stream=new t(b),b.flush(()=>{b[o].ready=!0,b.emit("ready")});break;case"ERROR":A(b,a.err);break;case"EVENT":Array.isArray(a.args)?b.emit(a.name,...a.args):b.emit(a.name,a.args);break;case"WARNING":process.emitWarning(a.err);break;default:A(b,Error("this should not happen: "+a.code))}}function y(a){let b=this.stream.deref();void 0!==b&&(u.unregister(b),b.worker.exited=!0,b.worker.off("exit",y),A(b,0!==a?Error("the worker thread exited"):null))}function z(a,b){setImmediate(()=>{a.emit("error",b)})}function A(a,b){a[o].destroyed||(a[o].destroyed=!0,b&&(a[o].errored=b,z(a,b)),a.worker.exited?setImmediate(()=>{a[o].closed=!0,a.emit("close")}):a.worker.terminate().catch(()=>{}).then(()=>{a[o].closed=!0,a.emit("close")}))}function B(a,b,c){let d=Atomics.load(a[o].state,j),e=Buffer.byteLength(b);return a[o].data.write(b,d),Atomics.store(a[o].state,j,d+e),Atomics.notify(a[o].state,j),c(),!0}function C(a){if(!a[o].ended&&a[o].ending&&!a[o].flushing){a[o].ended=!0;try{a.flushSync();let b=Atomics.load(a[o].state,k);Atomics.store(a[o].state,j,-1),Atomics.notify(a[o].state,j);let c=0;for(;-1!==b;){if(Atomics.wait(a[o].state,k,b,1e3),b=Atomics.load(a[o].state,k),-2===b)return void A(a,Error("end() failed"));if(10==++c)return void A(a,Error("end() took too long (10s)"))}process.nextTick(()=>{a[o].finished=!0,a.emit("finish")})}catch(b){A(a,b)}}}function D(a){let b=()=>{a[o].ending?C(a):a[o].needDrain&&process.nextTick(v,a)};for(a[o].flushing=!1;0!==a[o].buf.length;){let c=Atomics.load(a[o].state,j),d=a[o].data.length-c;if(0===d){E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);continue}if(d<0)throw Error("overwritten");let e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);if(f<=d)a[o].buf=a[o].buf.slice(d),B(a,e,b);else{for(E(a),Atomics.store(a[o].state,k,0),Atomics.store(a[o].state,j,0);f>a[o].buf.length;)d/=2,e=a[o].buf.slice(0,d),f=Buffer.byteLength(e);a[o].buf=a[o].buf.slice(d),B(a,e,b)}}}function E(a){if(a[o].flushing)throw Error("unable to flush while flushing");let b=Atomics.load(a[o].state,j),c=0;for(;;){let d=Atomics.load(a[o].state,k);if(-2===d)throw Error("_flushSync failed");if(d!==b)Atomics.wait(a[o].state,k,d,1e3);else break;if(10==++c)throw Error("_flushSync took too long (10s)")}}b.exports=class extends e{constructor(a={}){if(super(),a.bufferSize<4)throw Error("bufferSize must at least fit a 4-byte utf-8 char");this[o]={},this[o].stateBuf=new SharedArrayBuffer(128),this[o].state=new Int32Array(this[o].stateBuf),this[o].dataBuf=new SharedArrayBuffer(a.bufferSize||4194304),this[o].data=Buffer.from(this[o].dataBuf),this[o].sync=a.sync||!1,this[o].ending=!1,this[o].ended=!1,this[o].needDrain=!1,this[o].destroyed=!1,this[o].flushing=!1,this[o].ready=!1,this[o].finished=!1,this[o].errored=null,this[o].closed=!1,this[o].buf="",this.worker=function(a,b){let{filename:c,workerData:e}=b,i=new f(("__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{})["thread-stream-worker"]||g("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-adapter-wagmi/node_modules/thread-stream","lib","worker.js"),{...b.workerOpts,trackUnmanagedFds:!1,workerData:{filename:0===c.indexOf("file://")?c:h(c).href,dataBuf:a[o].dataBuf,stateBuf:a[o].stateBuf,workerData:{$context:{threadStreamVersion:d},...e}}});return i.stream=new q(a),i.on("message",x),i.on("exit",y),u.register(a,i),i}(this,a),this.on("message",(a,b)=>{this.worker.postMessage(a,b)})}write(a){if(this[o].destroyed)return z(this,Error("the worker has exited")),!1;if(this[o].ending)return z(this,Error("the worker is ending")),!1;if(this[o].flushing&&this[o].buf.length+a.length>=p)try{D(this),this[o].flushing=!0}catch(a){return A(this,a),!1}if(this[o].buf+=a,this[o].sync)try{return D(this),!0}catch(a){return A(this,a),!1}return this[o].flushing||(this[o].flushing=!0,setImmediate(w,this)),this[o].needDrain=this[o].data.length-this[o].buf.length-Atomics.load(this[o].state,j)<=0,!this[o].needDrain}end(){this[o].destroyed||(this[o].ending=!0,C(this))}flush(a){if(this[o].destroyed){"function"==typeof a&&process.nextTick(a,Error("the worker has exited"));return}let b=Atomics.load(this[o].state,j);i(this[o].state,k,b,1/0,(b,c)=>{if(b){A(this,b),process.nextTick(a,b);return}"not-equal"===c?this.flush(a):process.nextTick(a)})}flushSync(){this[o].destroyed||(D(this),E(this))}unref(){this.worker.unref()}ref(){this.worker.ref()}get ready(){return this[o].ready}get destroyed(){return this[o].destroyed}get closed(){return this[o].closed}get writable(){return!this[o].destroyed&&!this[o].ending}get writableEnded(){return this[o].ending}get writableFinished(){return this[o].finished}get writableNeedDrain(){return this[o].needDrain}get writableObjectMode(){return!1}get writableErrored(){return this[o].errored}}},412815,(a,b,c)=>{"use strict";let{createRequire:d}=a.r(362562),e=a.r(709920),{join:f,isAbsolute:g,sep:h}=a.r(750227),i=a.r(296175),j=a.r(884568),k=a.r(893302);function l(a){a.ref(),a.flushSync(),a.end(),a.once("close",function(){a.unref()})}function m(a){a.flushSync()}b.exports=function(a){let{pipeline:b,targets:c,levels:o,dedupe:p,worker:q={},caller:r=e(),sync:s=!1}=a,t={...a.options},u="string"==typeof r?[r]:r,v="__bundlerPathsOverrides"in globalThis?globalThis.__bundlerPathsOverrides:{},w=a.target;if(w&&c)throw Error("only one of target or targets can be specified");c?(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-adapter-wagmi/node_modules/pino/lib","worker.js"),t.targets=c.filter(a=>a.target).map(a=>({...a,target:z(a.target)})),t.pipelines=c.filter(a=>a.pipeline).map(a=>a.pipeline.map(b=>({...b,level:a.level,target:z(b.target)})))):b&&(w=v["pino-worker"]||f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-adapter-wagmi/node_modules/pino/lib","worker.js"),t.pipelines=[b.map(a=>({...a,target:z(a.target)}))]),o&&(t.levels=o),p&&(t.dedupe=p),t.pinoWillSendConfig=!0;let x=new k({filename:z(w),workerData:t,workerOpts:q,sync:s});function y(){x.closed||(x.flushSync(),i(100),x.end())}return x.on("ready",function(){process.removeListener("exit",y),x.unref(),!1!==q.autoEnd&&(j.register(x,l),j.registerBeforeExit(x,m),x.on("close",function(){j.unregister(x)}))}),x.on("close",function(){process.removeListener("exit",y)}),process.on("exit",y),x;function z(a){let b;if(g(a=v[a]||a)||0===a.indexOf("file://"))return a;if("pino/file"===a)return f("/ROOT/Desktop/walletconnect/chilly/node_modules/@reown/appkit-adapter-wagmi/node_modules/pino/lib","..","file.js");for(let c of u)try{let e="node:repl"===c?process.cwd()+h:c;b=d(e).resolve(a);break}catch(a){continue}if(!b)throw Error(`unable to determine transport target for "${a}"`);return b}}},149784,(a,b,c)=>{b.exports={DEFAULT_LEVELS:{trace:10,debug:20,info:30,warn:40,error:50,fatal:60},SORTING_ORDER:{ASC:"ASC",DESC:"DESC"}}},128403,(a,b,c)=>{"use strict";let d=Symbol.for("pino.metadata"),{DEFAULT_LEVELS:e}=a.r(149784),f=e.info;function g(a,b){return a.level-b.level}b.exports=function(a,b){a=a||[],b=b||{dedupe:!1};let c=Object.create(e);c.silent=1/0,b.levels&&"object"==typeof b.levels&&Object.keys(b.levels).forEach(a=>{c[a]=b.levels[a]});let h={write:i,add:l,remove:m,emit:j,flushSync:k,end:function(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync(),a.end()},minLevel:0,lastId:0,streams:[],clone:function a(b){let c=Array(this.streams.length);for(let a=0;a<c.length;a++)c[a]={level:b,stream:this.streams[a].stream};return{write:i,add:l,remove:m,minLevel:b,streams:c,clone:a,emit:j,flushSync:k,[d]:!0}},[d]:!0,streamLevels:c};return Array.isArray(a)?a.forEach(l,h):l.call(h,a),a=null,h;function i(a){var c,e,f,g;let h,i,j=this.lastLevel,{streams:k}=this,l=0;for(let m=(c=k.length,b.dedupe?c-1:0);e=m,f=k.length,b.dedupe?e>=0:e<f;g=m,m=b.dedupe?g-1:g+1)if((h=k[m]).level<=j){if(0!==l&&l!==h.level)break;if((i=h.stream)[d]){let{lastTime:a,lastMsg:b,lastObj:c,lastLogger:d}=this;i.lastLevel=j,i.lastTime=a,i.lastMsg=b,i.lastObj=c,i.lastLogger=d}i.write(a),b.dedupe&&(l=h.level)}else if(!b.dedupe)break}function j(...a){for(let{stream:b}of this.streams)"function"==typeof b.emit&&b.emit(...a)}function k(){for(let{stream:a}of this.streams)"function"==typeof a.flushSync&&a.flushSync()}function l(a){if(!a)return h;let b="function"==typeof a.write||a.stream,c=a.write?a:a.stream;if(!b)throw Error("stream object needs to implement either StreamEntry or DestinationStream interface");let{streams:d,streamLevels:e}=this,i={stream:c,level:"number"==typeof a.levelVal?a.levelVal:"string"==typeof a.level?e[a.level]:"number"==typeof a.level?a.level:f,levelVal:void 0,id:++h.lastId};return d.unshift(i),d.sort(g),this.minLevel=d[0].level,h}function m(a){let{streams:b}=this,c=b.findIndex(b=>b.id===a);return c>=0&&(b.splice(c,1),b.sort(g),this.minLevel=b.length>0?b[0].level:-1),h}}},79227,(a,b,c)=>{"use strict";let d=a=>a&&"string"==typeof a.message,e=a=>{if(!a)return;let b=a.cause;if("function"!=typeof b)return d(b)?b:void 0;{let b=a.cause();return d(b)?b:void 0}},f=(a,b)=>{if(!d(a))return"";let c=a.stack||"";if(b.has(a))return c+"\ncauses have become circular...";let g=e(a);return g?(b.add(a),c+"\ncaused by: "+f(g,b)):c},g=(a,b,c)=>{if(!d(a))return"";let f=c?"":a.message||"";if(b.has(a))return f+": ...";let h=e(a);if(!h)return f;{b.add(a);let c="function"==typeof a.cause;return f+(c?"":": ")+g(h,b,c)}};b.exports={isErrorLike:d,getErrorCause:e,stackWithCauses:a=>f(a,new Set),messageWithCauses:a=>g(a,new Set)}},159081,(a,b,c)=>{"use strict";let d=Symbol("circular-ref-tag"),e=Symbol("pino-raw-err-ref"),f=Object.create({},{type:{enumerable:!0,writable:!0,value:void 0},message:{enumerable:!0,writable:!0,value:void 0},stack:{enumerable:!0,writable:!0,value:void 0},aggregateErrors:{enumerable:!0,writable:!0,value:void 0},raw:{enumerable:!1,get:function(){return this[e]},set:function(a){this[e]=a}}});Object.defineProperty(f,e,{writable:!0,value:{}}),b.exports={pinoErrProto:f,pinoErrorSymbols:{seen:d,rawSymbol:e}}},411806,(a,b,c)=>{"use strict";b.exports=function a(b){if(!f(b))return b;b[i]=void 0;let c=Object.create(g);for(let g in c.type="[object Function]"===j.call(b.constructor)?b.constructor.name:b.name,c.message=d(b),c.stack=e(b),Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),b)if(void 0===c[g]){let d=b[g];f(d)?"cause"===g||Object.prototype.hasOwnProperty.call(d,i)||(c[g]=a(d)):c[g]=d}return delete b[i],c.raw=b,c};let{messageWithCauses:d,stackWithCauses:e,isErrorLike:f}=a.r(79227),{pinoErrProto:g,pinoErrorSymbols:h}=a.r(159081),{seen:i}=h,{toString:j}=Object.prototype},560971,(a,b,c)=>{"use strict";b.exports=function a(b){if(!d(b))return b;b[g]=void 0;let c=Object.create(e);for(let e in c.type="[object Function]"===h.call(b.constructor)?b.constructor.name:b.name,c.message=b.message,c.stack=b.stack,Array.isArray(b.errors)&&(c.aggregateErrors=b.errors.map(b=>a(b))),d(b.cause)&&!Object.prototype.hasOwnProperty.call(b.cause,g)&&(c.cause=a(b.cause)),b)if(void 0===c[e]){let f=b[e];d(f)?Object.prototype.hasOwnProperty.call(f,g)||(c[e]=a(f)):c[e]=f}return delete b[g],c.raw=b,c};let{isErrorLike:d}=a.r(79227),{pinoErrProto:e,pinoErrorSymbols:f}=a.r(159081),{seen:g}=f,{toString:h}=Object.prototype},553706,(a,b,c)=>{"use strict";b.exports={mapHttpRequest:function(a){return{req:f(a)}},reqSerializer:f};let d=Symbol("pino-raw-req-ref"),e=Object.create({},{id:{enumerable:!0,writable:!0,value:""},method:{enumerable:!0,writable:!0,value:""},url:{enumerable:!0,writable:!0,value:""},query:{enumerable:!0,writable:!0,value:""},params:{enumerable:!0,writable:!0,value:""},headers:{enumerable:!0,writable:!0,value:{}},remoteAddress:{enumerable:!0,writable:!0,value:""},remotePort:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=a.info||a.socket,c=Object.create(e);if(c.id="function"==typeof a.id?a.id():a.id||(a.info?a.info.id:void 0),c.method=a.method,a.originalUrl)c.url=a.originalUrl;else{let b=a.path;c.url="string"==typeof b?b:a.url?a.url.path||a.url:void 0}return a.query&&(c.query=a.query),a.params&&(c.params=a.params),c.headers=a.headers,c.remoteAddress=b&&b.remoteAddress,c.remotePort=b&&b.remotePort,c.raw=a.raw||a,c}Object.defineProperty(e,d,{writable:!0,value:{}})},798050,(a,b,c)=>{"use strict";b.exports={mapHttpResponse:function(a){return{res:f(a)}},resSerializer:f};let d=Symbol("pino-raw-res-ref"),e=Object.create({},{statusCode:{enumerable:!0,writable:!0,value:0},headers:{enumerable:!0,writable:!0,value:""},raw:{enumerable:!1,get:function(){return this[d]},set:function(a){this[d]=a}}});function f(a){let b=Object.create(e);return b.statusCode=a.headersSent?a.statusCode:null,b.headers=a.getHeaders?a.getHeaders():a._headers,b.raw=a,b}Object.defineProperty(e,d,{writable:!0,value:{}})},122961,(a,b,c)=>{"use strict";let d=a.r(411806),e=a.r(560971),f=a.r(553706),g=a.r(798050);b.exports={err:d,errWithCause:e,mapHttpRequest:f.mapHttpRequest,mapHttpResponse:g.mapHttpResponse,req:f.reqSerializer,res:g.resSerializer,wrapErrorSerializer:function(a){return a===d?a:function(b){return a(d(b))}},wrapRequestSerializer:function(a){return a===f.reqSerializer?a:function(b){return a(f.reqSerializer(b))}},wrapResponseSerializer:function(a){return a===g.resSerializer?a:function(b){return a(g.resSerializer(b))}}}},556794,(a,b,c)=>{"use strict";let d=Symbol("pino.setLevel"),e=Symbol("pino.getLevel"),f=Symbol("pino.levelVal"),g=Symbol("pino.levelComp"),h=Symbol("pino.useLevelLabels"),i=Symbol("pino.useOnlyCustomLevels"),j=Symbol("pino.mixin"),k=Symbol("pino.lsCache"),l=Symbol("pino.chindings"),m=Symbol("pino.asJson"),o=Symbol("pino.write"),p=Symbol("pino.redactFmt"),q=Symbol("pino.time"),r=Symbol("pino.timeSliceIndex"),s=Symbol("pino.stream"),t=Symbol("pino.stringify"),u=Symbol("pino.stringifySafe"),v=Symbol("pino.stringifiers"),w=Symbol("pino.end"),x=Symbol("pino.formatOpts"),y=Symbol("pino.messageKey"),z=Symbol("pino.errorKey"),A=Symbol("pino.nestedKey"),B=Symbol("pino.nestedKeyStr"),C=Symbol("pino.mixinMergeStrategy"),D=Symbol("pino.msgPrefix"),E=Symbol("pino.wildcardFirst"),F=Symbol.for("pino.serializers"),G=Symbol.for("pino.formatters"),H=Symbol.for("pino.hooks");b.exports={setLevelSym:d,getLevelSym:e,levelValSym:f,levelCompSym:g,useLevelLabelsSym:h,mixinSym:j,lsCacheSym:k,chindingsSym:l,asJsonSym:m,writeSym:o,serializersSym:F,redactFmtSym:p,timeSym:q,timeSliceIndexSym:r,streamSym:s,stringifySym:t,stringifySafeSym:u,stringifiersSym:v,endSym:w,formatOptsSym:x,messageKeySym:y,errorKeySym:z,nestedKeySym:A,wildcardFirstSym:E,needsMetadataGsym:Symbol.for("pino.metadata"),useOnlyCustomLevelsSym:i,formattersSym:G,hooksSym:H,nestedKeyStrSym:B,mixinMergeStrategySym:C,msgPrefixSym:D}},714923,(a,b,c)=>{"use strict";let d=a.r(71347),{redactFmtSym:e,wildcardFirstSym:f}=a.r(556794),g=/[^.[\]]+|\[([^[\]]*?)\]/g,h="[Redacted]";b.exports=function(a,b){let{paths:c,censor:i,remove:j}=function(a){if(Array.isArray(a))return{paths:a,censor:h};let{paths:b,censor:c=h,remove:d}=a;if(!1===Array.isArray(b))throw Error("pino â€“ redact must contain an array of strings");return!0===d&&(c=void 0),{paths:b,censor:c,remove:d}}(a),k=c.reduce((a,b)=>{g.lastIndex=0;let c=g.exec(b),d=g.exec(b),e=void 0!==c[1]?c[1].replace(/^(?:"|'|`)(.*)(?:"|'|`)$/,"$1"):c[0];if("*"===e&&(e=f),null===d)return a[e]=null,a;if(null===a[e])return a;let{index:h}=d,i=`${b.substr(h,b.length-1)}`;return a[e]=a[e]||[],e!==f&&0===a[e].length&&a[e].push(...a[f]||[]),e===f&&Object.keys(a).forEach(function(b){a[b]&&a[b].push(i)}),a[e].push(i),a},{}),l={[e]:d({paths:c,censor:i,serialize:b,strict:!1,remove:j})};return[...Object.keys(k),...Object.getOwnPropertySymbols(k)].reduce((a,c)=>{if(null===k[c])a[c]=a=>((...a)=>"function"==typeof i?b(i(...a)):b(i))(a,[c]);else{let e="function"==typeof i?(a,b)=>i(a,[c,...b]):i;a[c]=d({paths:k[c],censor:e,serialize:b,strict:!1,remove:j})}return a},l)}},241759,(a,b,c)=>{"use strict";let d=1000000n*BigInt(Date.now()),e=process.hrtime.bigint();b.exports={nullTime:()=>"",epochTime:()=>`,"time":${Date.now()}`,unixTime:()=>`,"time":${Math.round(Date.now()/1e3)}`,isoTime:()=>`,"time":"${new Date(Date.now()).toISOString()}"`,isoTimeNano:()=>{let a=d+(process.hrtime.bigint()-e),b=a%1000000000n,c=new Date(Number(a/1000000000n*1000n+b/1000000n)),f=c.getUTCFullYear(),g=(c.getUTCMonth()+1).toString().padStart(2,"0"),h=c.getUTCDate().toString().padStart(2,"0"),i=c.getUTCHours().toString().padStart(2,"0"),j=c.getUTCMinutes().toString().padStart(2,"0"),k=c.getUTCSeconds().toString().padStart(2,"0");return`,"time":"${f}-${g}-${h}T${i}:${j}:${k}.${b.toString().padStart(9,"0")}Z"`}}},277759,(a,b,c)=>{"use strict";let d=a.r(522734),e=a.r(427699),f=a.r(224361).inherits,g=a.r(814747),h=a.r(296175),i=a.r(449719),j=Buffer.allocUnsafe(0),k="buffer",l="utf8",[m,o]=(process.versions.node||"0.0").split(".").map(Number),p=m>=22&&o>=7;function q(a,b){function c(c,d){if(c){b._reopening=!1,b._writing=!1,b._opening=!1,b.sync?process.nextTick(()=>{b.listenerCount("error")>0&&b.emit("error",c)}):b.emit("error",c);return}let e=b._reopening;b.fd=d,b.file=a,b._reopening=!1,b._opening=!1,b._writing=!1,b.sync?process.nextTick(()=>b.emit("ready")):b.emit("ready"),!b.destroyed&&(!b._writing&&b._len>b.minLength||b._flushPending?b._actualWrite():e&&process.nextTick(()=>b.emit("drain")))}b._opening=!0,b._writing=!0,b._asyncDrainScheduled=!1;let e=b.append?"a":"w",f=b.mode;if(b.sync)try{b.mkdir&&d.mkdirSync(g.dirname(a),{recursive:!0});let h=d.openSync(a,e,f);c(null,h)}catch(a){throw c(a),a}else b.mkdir?d.mkdir(g.dirname(a),{recursive:!0},b=>{if(b)return c(b);d.open(a,e,f,c)}):d.open(a,e,f,c)}function r(a){let b,c;if(!(this instanceof r))return new r(a);let{fd:e,dest:f,minLength:g,maxLength:i,maxWrite:m,periodicFlush:o,sync:p,append:u=!0,mkdir:x,retryEAGAIN:F,fsync:G,contentMode:H,mode:I}=a||{};if(e=e||f,this._len=0,this.fd=-1,this._bufs=[],this._lens=[],this._writing=!1,this._ending=!1,this._reopening=!1,this._asyncDrainScheduled=!1,this._flushPending=!1,this._hwm=Math.max(g||0,16387),this.file=null,this.destroyed=!1,this.minLength=g||0,this.maxLength=i||0,this.maxWrite=m||16384,this._periodicFlush=o||0,this._periodicFlushTimer=void 0,this.sync=p||!1,this.writable=!0,this._fsync=G||!1,this.append=u||!1,this.mode=I,this.retryEAGAIN=F||(()=>!0),this.mkdir=x||!1,H===k)this._writingBuf=j,this.write=w,this.flush=z,this.flushSync=B,this._actualWrite=D,b=()=>d.writeSync(this.fd,this._writingBuf),c=()=>d.write(this.fd,this._writingBuf,this.release);else if(void 0===H||H===l)this._writingBuf="",this.write=v,this.flush=y,this.flushSync=A,this._actualWrite=C,b=()=>d.writeSync(this.fd,this._writingBuf,"utf8"),c=()=>d.write(this.fd,this._writingBuf,"utf8",this.release);else throw Error(`SonicBoom supports "${l}" and "${k}", but passed ${H}`);if("number"==typeof e)this.fd=e,process.nextTick(()=>this.emit("ready"));else if("string"==typeof e)q(e,this);else throw Error("SonicBoom supports only file descriptors and files");if(this.minLength>=this.maxWrite)throw Error(`minLength should be smaller than maxWrite (${this.maxWrite})`);this.release=(a,e)=>{if(a){if(("EAGAIN"===a.code||"EBUSY"===a.code)&&this.retryEAGAIN(a,this._writingBuf.length,this._len-this._writingBuf.length))if(this.sync)try{h(100),this.release(void 0,0)}catch(a){this.release(a)}else setTimeout(c,100);else this._writing=!1,this.emit("error",a);return}this.emit("write",e);let f=s(this._writingBuf,this._len,e);if(this._len=f.len,this._writingBuf=f.writingBuf,this._writingBuf.length){if(!this.sync)return void c();try{do{let a=b(),c=s(this._writingBuf,this._len,a);this._len=c.len,this._writingBuf=c.writingBuf}while(this._writingBuf.length)}catch(a){this.release(a);return}}this._fsync&&d.fsyncSync(this.fd);let g=this._len;this._reopening?(this._writing=!1,this._reopening=!1,this.reopen()):g>this.minLength?this._actualWrite():this._ending?g>0?this._actualWrite():(this._writing=!1,E(this)):(this._writing=!1,this.sync?this._asyncDrainScheduled||(this._asyncDrainScheduled=!0,process.nextTick(t,this)):this.emit("drain"))},this.on("newListener",function(a){"drain"===a&&(this._asyncDrainScheduled=!1)}),0!==this._periodicFlush&&(this._periodicFlushTimer=setInterval(()=>this.flush(null),this._periodicFlush),this._periodicFlushTimer.unref())}function s(a,b,c){return"string"==typeof a&&Buffer.byteLength(a)!==c&&(c=Buffer.from(a).subarray(0,c).toString().length),b=Math.max(b-c,0),{writingBuf:a=a.slice(c),len:b}}function t(a){a.listenerCount("drain")>0&&(a._asyncDrainScheduled=!1,a.emit("drain"))}function u(a,b){return 0===a.length?j:1===a.length?a[0]:Buffer.concat(a,b)}function v(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||c[c.length-1].length+a.length>this.maxWrite?c.push(""+a):c[c.length-1]+=a,this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function w(a){if(this.destroyed)throw Error("SonicBoom destroyed");let b=this._len+a.length,c=this._bufs,d=this._lens;return this.maxLength&&b>this.maxLength?this.emit("drop",a):(0===c.length||d[d.length-1]+a.length>this.maxWrite?(c.push([a]),d.push(a.length)):(c[c.length-1].push(a),d[d.length-1]+=a.length),this._len=b,!this._writing&&this._len>=this.minLength&&this._actualWrite()),this._len<this._hwm}function x(a){this._flushPending=!0;let b=()=>{if(this._fsync)this._flushPending=!1,a();else try{d.fsync(this.fd,b=>{this._flushPending=!1,a(b)})}catch(b){a(b)}this.off("error",c)},c=c=>{this._flushPending=!1,a(c),this.off("drain",b)};this.once("drain",b),this.once("error",c)}function y(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&this._bufs.push(""),this._actualWrite()))}function z(a){if(null!=a&&"function"!=typeof a)throw Error("flush cb must be a function");if(this.destroyed){let b=Error("SonicBoom destroyed");if(a)return void a(b);throw b}this.minLength<=0?a?.():(a&&x.call(this,a),this._writing||(0===this._bufs.length&&(this._bufs.push([]),this._lens.push(0)),this._actualWrite()))}function A(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift(this._writingBuf),this._writingBuf="");let a="";for(;this._bufs.length||a;){a.length<=0&&(a=this._bufs[0]);try{let b=d.writeSync(this.fd,a,"utf8"),c=s(a,this._len,b);a=c.writingBuf,this._len=c.len,a.length<=0&&this._bufs.shift()}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}try{d.fsyncSync(this.fd)}catch{}}function B(){if(this.destroyed)throw Error("SonicBoom destroyed");if(this.fd<0)throw Error("sonic boom is not ready yet");!this._writing&&this._writingBuf.length>0&&(this._bufs.unshift([this._writingBuf]),this._writingBuf=j);let a=j;for(;this._bufs.length||a.length;){a.length<=0&&(a=u(this._bufs[0],this._lens[0]));try{let b=d.writeSync(this.fd,a);a=a.subarray(b),this._len=Math.max(this._len-b,0),a.length<=0&&(this._bufs.shift(),this._lens.shift())}catch(b){if(("EAGAIN"===b.code||"EBUSY"===b.code)&&!this.retryEAGAIN(b,a.length,this._len-a.length))throw b;h(100)}}}function C(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf||this._bufs.shift()||"",this.sync)try{let b=d.writeSync(this.fd,this._writingBuf,"utf8");a(null,b)}catch(b){a(b)}else d.write(this.fd,this._writingBuf,"utf8",a)}function D(){let a=this.release;if(this._writing=!0,this._writingBuf=this._writingBuf.length?this._writingBuf:u(this._bufs.shift(),this._lens.shift()),this.sync)try{let b=d.writeSync(this.fd,this._writingBuf);a(null,b)}catch(b){a(b)}else p&&(this._writingBuf=Buffer.from(this._writingBuf)),d.write(this.fd,this._writingBuf,a)}function E(a){if(-1===a.fd)return void a.once("ready",E.bind(null,a));void 0!==a._periodicFlushTimer&&clearInterval(a._periodicFlushTimer),a.destroyed=!0,a._bufs=[],a._lens=[],i("number"==typeof a.fd,`sonic.fd must be a number, got ${typeof a.fd}`);try{d.fsync(a.fd,function(){1!==a.fd&&2!==a.fd?d.close(a.fd,b):b()})}catch{}function b(b){b?a.emit("error",b):(a._ending&&!a._writing&&a.emit("finish"),a.emit("close"))}}f(r,e),r.prototype.reopen=function(a){if(this.destroyed)throw Error("SonicBoom destroyed");if(this._opening)return void this.once("ready",()=>{this.reopen(a)});if(this._ending)return;if(!this.file)throw Error("Unable to reopen a file descriptor, you must pass a file to SonicBoom");if(a&&(this.file=a),this._reopening=!0,this._writing)return;let b=this.fd;this.once("ready",()=>{b!==this.fd&&d.close(b,a=>{if(a)return this.emit("error",a)})}),q(this.file,this)},r.prototype.end=function(){if(this.destroyed)throw Error("SonicBoom destroyed");this._opening?this.once("ready",()=>{this.end()}):this._ending||(this._ending=!0,this._writing||(this._len>0&&this.fd>=0?this._actualWrite():E(this)))},r.prototype.destroy=function(){this.destroyed||E(this)},r.SonicBoom=r,r.default=r,b.exports=r},20968,(a,b,c)=>{"use strict";let d=a.r(677652),e=a.r(91972),{mapHttpRequest:f,mapHttpResponse:g}=a.r(122961),h=a.r(277759),i=a.r(884568),{lsCacheSym:j,chindingsSym:k,writeSym:l,serializersSym:m,formatOptsSym:o,endSym:p,stringifiersSym:q,stringifySym:r,stringifySafeSym:s,wildcardFirstSym:t,nestedKeySym:u,formattersSym:v,messageKeySym:w,errorKeySym:x,nestedKeyStrSym:y,msgPrefixSym:z}=a.r(556794),{isMainThread:A}=a.r(37702),B=a.r(412815),C=d.tracingChannel("pino_asJson");function D(){}function E(a){let b="",c=0,d=!1,e=255,f=a.length;if(f>100)return JSON.stringify(a);for(var g=0;g<f&&e>=32;g++)(34===(e=a.charCodeAt(g))||92===e)&&(b+=a.slice(c,g)+"\\",c=g,d=!0);return d?b+=a.slice(c):b=a,e<32?JSON.stringify(a):'"'+b+'"'}function F(a,b,c,d){let e,f=this[r],g=this[s],h=this[q],i=this[p],l=this[k],o=this[m],z=this[v],A=this[w],B=this[x],C=this[j][c]+d;C+=l,z.log&&(a=z.log(a));let D=h[t],F="";for(let b in a)if(e=a[b],Object.prototype.hasOwnProperty.call(a,b)&&void 0!==e){o[b]?e=o[b](e):b===B&&o.err&&(e=o.err(e));let a=h[b]||D;switch(typeof e){case"undefined":case"function":continue;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e));break;case"string":e=(a||E)(e);break;default:e=(a||f)(e,g)}if(void 0===e)continue;F+=","+E(b)+":"+e}let G="";if(void 0!==b){e=o[A]?o[A](b):b;let a=h[A]||D;switch(typeof e){case"function":break;case"number":!1===Number.isFinite(e)&&(e=null);case"boolean":a&&(e=a(e)),G=',"'+A+'":'+e;break;case"string":G=',"'+A+'":'+(e=(a||E)(e));break;default:G=',"'+A+'":'+(e=(a||f)(e,g))}}return this[u]&&F?C+this[y]+F.slice(1)+"}"+G+i:C+F+G+i}function G(a){let b=new h(a);return b.on("error",function a(c){if("EPIPE"===c.code){b.write=D,b.end=D,b.flushSync=D,b.destroy=D;return}b.removeListener("error",a),b.emit("error",c)}),!a.sync&&A&&(i.register(b,H),b.on("close",function(){i.unregister(b)})),b}function H(a,b){a.destroyed||("beforeExit"===b?(a.flush(),a.on("drain",function(){a.end()})):a.flushSync())}b.exports={noop:D,buildSafeSonicBoom:G,asChindings:function(a,b){let c,d=a[k],e=a[r],f=a[s],g=a[q],h=g[t],i=a[m];for(let j in b=(0,a[v].bindings)(b))if(c=b[j],!0===((j.length<5||"level"!==j&&"serializers"!==j&&"formatters"!==j&&"customLevels"!==j)&&b.hasOwnProperty(j)&&void 0!==c)){if(c=i[j]?i[j](c):c,void 0===(c=(g[j]||h||e)(c,f)))continue;d+=',"'+j+'":'+c}return d},asJson:function(a,b,c,d){return!1===C.hasSubscribers?F.call(this,a,b,c,d):C.traceSync(F,{instance:this,arguments},this,a,b,c,d)},genLog:function(a,b){if(!b)return c;return function(...d){b.call(this,d,c,a)};function c(b,...d){if("object"==typeof b){let c,h=b;null!==b&&(b.method&&b.headers&&b.socket?b=f(b):"function"==typeof b.setHeader&&(b=g(b))),null===h&&0===d.length?c=[null]:(h=d.shift(),c=d),"string"==typeof this[z]&&null!=h&&(h=this[z]+h),this[l](b,e(h,c,this[o]),a)}else{let c=void 0===b?d.shift():b;"string"==typeof this[z]&&null!=c&&(c=this[z]+c),this[l](null,e(c,d,this[o]),a)}}},createArgsNormalizer:function(a){return function(b,c,d={},e){if("string"==typeof d)e=G({dest:d}),d={};else if("string"==typeof e){if(d&&d.transport)throw Error("only one of option.transport or stream can be specified");e=G({dest:e})}else if(d instanceof h||d.writable||d._writableState)e=d,d={};else if(d.transport){let a;if(d.transport instanceof h||d.transport.writable||d.transport._writableState)throw Error("option.transport do not allow stream, please pass to option directly. e.g. pino(transport)");if(d.transport.targets&&d.transport.targets.length&&d.formatters&&"function"==typeof d.formatters.level)throw Error("option.transport.targets do not allow custom level formatters");d.customLevels&&(a=d.useOnlyCustomLevels?d.customLevels:Object.assign({},d.levels,d.customLevels)),e=B({caller:c,...d.transport,levels:a})}if((d=Object.assign({},a,d)).serializers=Object.assign({},a.serializers,d.serializers),d.formatters=Object.assign({},a.formatters,d.formatters),d.prettyPrint)throw Error("prettyPrint option is no longer supported, see the pino-pretty package (https://github.com/pinojs/pino-pretty)");let{enabled:f,onChild:g}=d;if(!1===f&&(d.level="silent"),g||(d.onChild=D),!e){var i;e=(i=process.stdout).write!==i.constructor.prototype.write?process.stdout:G({fd:process.stdout.fd||1})}return{opts:d,stream:e}}},stringify:function(a,b){try{return JSON.stringify(a)}catch(c){try{return(b||this[s])(a)}catch(a){return'"[unable to serialize, circular reference is too complex to analyze]"'}}},buildFormatters:function(a,b,c){return{level:a,bindings:b,log:c}},normalizeDestFileDescriptor:function(a){let b=Number(a);return"string"==typeof a&&Number.isFinite(b)?b:void 0===a?1:a}}},10144,(a,b,c)=>{"use strict";let{lsCacheSym:d,levelValSym:e,useOnlyCustomLevelsSym:f,streamSym:g,formattersSym:h,hooksSym:i,levelCompSym:j}=a.r(556794),{noop:k,genLog:l}=a.r(20968),{DEFAULT_LEVELS:m,SORTING_ORDER:o}=a.r(149784),p={fatal:a=>{let b=l(m.fatal,a);return function(...a){let c=this[g];if(b.call(this,...a),"function"==typeof c.flushSync)try{c.flushSync()}catch(a){}}},error:a=>l(m.error,a),warn:a=>l(m.warn,a),info:a=>l(m.info,a),debug:a=>l(m.debug,a),trace:a=>l(m.trace,a)},q=Object.keys(m).reduce((a,b)=>(a[m[b]]=b,a),{});function r(a,b,c){return a===o.DESC?b<=c:b>=c}b.exports={initialLsCache:Object.keys(q).reduce((a,b)=>(a[b]='{"level":'+Number(b),a),{}),genLsCache:function(a){let b=a[h].level,{labels:c}=a.levels,e={};for(let a in c){let d=b(c[a],Number(a));e[a]=JSON.stringify(d).slice(0,-1)}return a[d]=e,a},levelMethods:p,getLevel:function(a){let{levels:b,levelVal:c}=this;return b&&b.labels?b.labels[c]:""},setLevel:function(a){let{labels:b,values:c}=this.levels;if("number"==typeof a){if(void 0===b[a])throw Error("unknown level value"+a);a=b[a]}if(void 0===c[a])throw Error("unknown level "+a);let d=this[e],g=this[e]=c[a],h=this[f],m=this[j],o=this[i].logMethod;for(let a in c){if(!1===m(c[a],g)){this[a]=k;continue}this[a]=!function(a,b){if(b)return!1;switch(a){case"fatal":case"error":case"warn":case"info":case"debug":case"trace":return!0;default:return!1}}(a,h)?l(c[a],o):p[a](o)}this.emit("level-change",a,g,b[d],d,this)},isLevelEnabled:function(a){let{values:b}=this.levels,c=b[a];return void 0!==c&&this[j](c,this[e])},mappings:function(a=null,b=!1){let c=a?Object.keys(a).reduce((b,c)=>(b[a[c]]=c,b),{}):null;return{labels:Object.assign(Object.create(Object.prototype,{Infinity:{value:"silent"}}),b?null:q,c),values:Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),b?null:m,a)}},assertNoLevelCollisions:function(a,b){let{labels:c,values:d}=a;for(let a in b){if(a in d)throw Error("levels cannot be overridden");if(b[a]in c)throw Error("pre-existing level values cannot be used for new levels")}},assertDefaultLevelFound:function(a,b,c){if("number"==typeof a){if(![].concat(Object.keys(b||{}).map(a=>b[a]),c?[]:Object.keys(q).map(a=>+a),1/0).includes(a))throw Error(`default level:${a} must be included in custom levels`);return}if(!(a in Object.assign(Object.create(Object.prototype,{silent:{value:1/0}}),c?null:m,b)))throw Error(`default level:${a} must be included in custom levels`)},genLevelComparison:function(a){return"string"==typeof a?r.bind(null,a):a},assertLevelComparison:function(a){if("function"!=typeof a&&!("string"==typeof a&&Object.values(o).includes(a)))throw Error('Levels comparison should be one of "ASC", "DESC" or "function" type')}}},613118,(a,b,c)=>{"use strict";b.exports={version:"10.0.0"}},219737,(a,b,c)=>{"use strict";let{EventEmitter:d}=a.r(687769),{lsCacheSym:e,levelValSym:f,setLevelSym:g,getLevelSym:h,chindingsSym:i,parsedChindingsSym:j,mixinSym:k,asJsonSym:l,writeSym:m,mixinMergeStrategySym:o,timeSym:p,timeSliceIndexSym:q,streamSym:r,serializersSym:s,formattersSym:t,errorKeySym:u,messageKeySym:v,useOnlyCustomLevelsSym:w,needsMetadataGsym:x,redactFmtSym:y,stringifySym:z,formatOptsSym:A,stringifiersSym:B,msgPrefixSym:C,hooksSym:D}=a.r(556794),{getLevel:E,setLevel:F,isLevelEnabled:G,mappings:H,initialLsCache:I,genLsCache:J,assertNoLevelCollisions:K}=a.r(10144),{asChindings:L,asJson:M,buildFormatters:N,stringify:O,noop:P}=a.r(20968),{version:Q}=a.r(613118),R=a.r(714923),S={constructor:class{},child:function(a,b){if(!a)throw Error("missing bindings for child Pino");let c=this[s],d=this[t],e=Object.create(this);if(null==b)return e[t].bindings!==T&&(e[t]=N(d.level,T,d.log)),e[i]=L(e,a),this.onChild!==P&&this.onChild(e),e;if(!0===b.hasOwnProperty("serializers")){for(let a in e[s]=Object.create(null),c)e[s][a]=c[a];let a=Object.getOwnPropertySymbols(c);for(var f=0;f<a.length;f++){let b=a[f];e[s][b]=c[b]}for(let a in b.serializers)e[s][a]=b.serializers[a];let d=Object.getOwnPropertySymbols(b.serializers);for(var h=0;h<d.length;h++){let a=d[h];e[s][a]=b.serializers[a]}}else e[s]=c;if(b.hasOwnProperty("formatters")){let{level:a,bindings:c,log:f}=b.formatters;e[t]=N(a||d.level,c||T,f||d.log)}else e[t]=N(d.level,T,d.log);if(!0===b.hasOwnProperty("customLevels")&&(K(this.levels,b.customLevels),e.levels=H(b.customLevels,e[w]),J(e)),"object"==typeof b.redact&&null!==b.redact||Array.isArray(b.redact)){e.redact=b.redact;let a=R(e.redact,O),c={stringify:a[y]};e[z]=O,e[B]=a,e[A]=c}if("string"==typeof b.msgPrefix&&(e[C]=(this[C]||"")+b.msgPrefix),e[i]=L(e,a),void 0!==b.level&&b.level!==this.level||b.hasOwnProperty("customLevels")){let a=b.level||this.level;e[g](a)}return this.onChild(e),e},bindings:function(){let a=this[i],b=JSON.parse(`{${a.substr(1)}}`);return delete b.pid,delete b.hostname,b},setBindings:function(a){let b=L(this,a);this[i]=b,delete this[j]},flush:function(a){if(null!=a&&"function"!=typeof a)throw Error("callback must be a function");let b=this[r];"function"==typeof b.flush?b.flush(a||P):a&&a()},isLevelEnabled:G,version:Q,get level(){return this[h]()},set level(lvl){this[g](lvl)},get levelVal(){return this[f]},set levelVal(n){throw Error("levelVal is read-only")},get msgPrefix(){return this[C]},get[Symbol.toStringTag](){return"Pino"},[e]:I,[m]:function(a,b,c){let d,e=this[p](),f=this[k],g=this[u],h=this[v],i=this[o]||U,j=this[D].streamWrite;null==a?d={}:a instanceof Error?(d={[g]:a},void 0===b&&(b=a.message)):(d=a,void 0===b&&void 0===a[h]&&a[g]&&(b=a[g].message)),f&&(d=i(d,f(d,c,this)));let m=this[l](d,b,c,e),s=this[r];!0===s[x]&&(s.lastLevel=c,s.lastObj=d,s.lastMsg=b,s.lastTime=e.slice(this[q]),s.lastLogger=this),s.write(j?j(m):m)},[l]:M,[h]:E,[g]:F};Object.setPrototypeOf(S,d.prototype),b.exports=function(){return Object.create(S)};let T=a=>a;function U(a,b){return Object.assign(b,a)}},536943,(a,b,c)=>{"use strict";let d=a.r(660526),e=a.r(122961),f=a.r(709920),g=a.r(714923),h=a.r(241759),i=a.r(219737),j=a.r(556794),{configure:k}=a.r(689465),{assertDefaultLevelFound:l,mappings:m,genLsCache:o,genLevelComparison:p,assertLevelComparison:q}=a.r(10144),{DEFAULT_LEVELS:r,SORTING_ORDER:s}=a.r(149784),{createArgsNormalizer:t,asChindings:u,buildSafeSonicBoom:v,buildFormatters:w,stringify:x,normalizeDestFileDescriptor:y,noop:z}=a.r(20968),{version:A}=a.r(613118),{chindingsSym:B,redactFmtSym:C,serializersSym:D,timeSym:E,timeSliceIndexSym:F,streamSym:G,stringifySym:H,stringifySafeSym:I,stringifiersSym:J,setLevelSym:K,endSym:L,formatOptsSym:M,messageKeySym:N,errorKeySym:O,nestedKeySym:P,mixinSym:Q,levelCompSym:R,useOnlyCustomLevelsSym:S,formattersSym:T,hooksSym:U,nestedKeyStrSym:V,mixinMergeStrategySym:W,msgPrefixSym:X}=j,{epochTime:Y,nullTime:Z}=h,{pid:$}=process,_=d.hostname(),aa=e.err,ab=t({level:"info",levelComparison:s.ASC,levels:r,messageKey:"msg",errorKey:"err",nestedKey:null,enabled:!0,base:{pid:$,hostname:_},serializers:Object.assign(Object.create(null),{err:aa}),formatters:Object.assign(Object.create(null),{bindings:a=>a,level:(a,b)=>({level:b})}),hooks:{logMethod:void 0,streamWrite:void 0},timestamp:Y,name:void 0,redact:null,customLevels:null,useOnlyCustomLevels:!1,depthLimit:5,edgeLimit:100}),ac=Object.assign(Object.create(null),e);function ad(...a){let b={},{opts:c,stream:d}=ab(b,f(),...a);c.level&&"string"==typeof c.level&&void 0!==r[c.level.toLowerCase()]&&(c.level=c.level.toLowerCase());let{redact:e,crlf:h,serializers:j,timestamp:s,messageKey:t,errorKey:v,nestedKey:y,base:A,name:$,level:_,customLevels:aa,levelComparison:ac,mixin:ae,mixinMergeStrategy:af,useOnlyCustomLevels:ag,formatters:ah,hooks:ai,depthLimit:aj,edgeLimit:ak,onChild:al,msgPrefix:am}=c,an=k({maximumDepth:aj,maximumBreadth:ak}),ao=w(ah.level,ah.bindings,ah.log),ap=x.bind({[I]:an}),aq=e?g(e,ap):{},ar=e?{stringify:aq[C]}:{stringify:ap},as=u.bind(null,{[B]:"",[D]:j,[J]:aq,[H]:x,[I]:an,[T]:ao}),at="";null!==A&&(at=as(void 0===$?A:Object.assign({},A,{name:$})));let au=s instanceof Function?s:s?Y:Z,av=au().indexOf(":")+1;if(ag&&!aa)throw Error("customLevels is required if useOnlyCustomLevels is set true");if(ae&&"function"!=typeof ae)throw Error(`Unknown mixin type "${typeof ae}" - expected "function"`);if(am&&"string"!=typeof am)throw Error(`Unknown msgPrefix type "${typeof am}" - expected "string"`);l(_,aa,ag);let aw=m(aa,ag);return"function"==typeof d.emit&&d.emit("message",{code:"PINO_CONFIG",config:{levels:aw,messageKey:t,errorKey:v}}),q(ac),Object.assign(b,{levels:aw,[R]:p(ac),[S]:ag,[G]:d,[E]:au,[F]:av,[H]:x,[I]:an,[J]:aq,[L]:"}"+(h?"\r\n":"\n"),[M]:ar,[N]:t,[O]:v,[P]:y,[V]:y?`,${JSON.stringify(y)}:{`:"",[D]:j,[Q]:ae,[W]:af,[B]:at,[T]:ao,[U]:ai,silent:z,onChild:al,[X]:am}),Object.setPrototypeOf(b,i()),o(b),b[K](_),b}b.exports=ad,b.exports.destination=(a=process.stdout.fd)=>"object"==typeof a?(a.dest=y(a.dest||process.stdout.fd),v(a)):v({dest:y(a),minLength:0}),b.exports.transport=a.r(412815),b.exports.multistream=a.r(128403),b.exports.levels=m(),b.exports.stdSerializers=ac,b.exports.stdTimeFunctions=Object.assign({},h),b.exports.symbols=j,b.exports.version=A,b.exports.default=ad,b.exports.pino=ad},990774,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s;var t,u,v,w,x,y,z,A,B,C,D,E=a.i(496872),F=a.i(203479),G=a.i(664435);a.i(420725);var H=a.i(511854),I=a.i(50516),J=a.i(993167),K=a.i(314531),L=a.i(490610),M=a.i(739741),N=a.i(832557),O=a.i(351428),P=a.i(884353),Q=a.i(811122),R=a.i(508144),S=a.i(961081),T=a.i(615408),U=a.i(736702),V=a.i(325163),W=a.i(881791),X=a.i(355279),Y=a.i(802320),Z=a.i(433273),$=a.i(358765),_=a.i(68822),aa=a.i(201246),ab=a.i(931410),ac=a.i(522110),ad=a.i(929278),ae=a.i(230158),af=a.i(29718);class ag{constructor(){}static getInstance({projectId:a,chainId:b,enableLogger:c,onTimeout:d,abortController:e,getActiveCaipNetwork:f,getCaipNetworks:g}){let{metadata:h,sdkVersion:i,sdkType:j}=O.OptionsController.getSnapshot();return ag.instance||(ag.instance=new af.W3mFrameProvider({projectId:a,chainId:b,enableLogger:c,onTimeout:d,abortController:e,getActiveCaipNetwork:f,getCaipNetworks:g,enableCloudAuthAccount:!!O.OptionsController.state.remoteFeatures?.emailCapture,metadata:h,sdkVersion:i,sdkType:j})),ag.instance}}var ah=a.i(427699),ai=a.i(227608),aj=a.i(852406),ak=a.i(712042),al=a.i(875086);let am="custom_context";var an=Object.defineProperty,ao=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?an(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class ap{constructor(a){ao(this,"nodeValue"),ao(this,"sizeInBytes"),ao(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class aq{constructor(a){ao(this,"lengthInNodes"),ao(this,"sizeInBytes"),ao(this,"head"),ao(this,"tail"),ao(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new ap(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}var ar=Object.defineProperty,as=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ar(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class at{constructor(a,b=1024e3){as(this,"logs"),as(this,"level"),as(this,"levelValue"),as(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=ak.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new aq(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===ak.levels.values.error?console.error(a):b===ak.levels.values.warn?console.warn(a):b===ak.levels.values.debug?console.debug(a):b===ak.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append((0,al.safeJsonStringify)({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new aq(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push((0,al.safeJsonStringify)({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var au=Object.defineProperty;class av{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?au(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new at(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var aw=Object.defineProperty,ax=Object.defineProperties,ay=Object.getOwnPropertyDescriptors,az=Object.getOwnPropertySymbols,aA=Object.prototype.hasOwnProperty,aB=Object.prototype.propertyIsEnumerable,aC=(a,b,c)=>b in a?aw(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,aD=(a,b)=>{for(var c in b||(b={}))aA.call(b,c)&&aC(a,c,b[c]);if(az)for(var c of az(b))aB.call(b,c)&&aC(a,c,b[c]);return a};function aE(a,b=am){return a[b]||""}function aF(a,b,c=am){let d=function(a,b,c=am){let d=aE(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=am){return a[c]=b,a}(a.child({context:d}),d,c)}function aG(a){var b;let c;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(c=new av(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:(0,ak.default)(ax(aD({},a.opts),ay({level:"trace"})),c),chunkLoggerController:c})}a.i(998734);var aH=a.i(29432),aI=Object.defineProperty,aJ=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aI(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class aK extends aH.IEvents{constructor(a){super(),this.opts=a,aJ(this,"protocol","wc"),aJ(this,"version",2)}}var aL=Object.defineProperty;class aM extends aH.IEvents{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aL(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class aN{constructor(a,b){this.logger=a,this.core=b}}class aO extends aH.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class aP extends aH.IEvents{constructor(a){super()}}class aQ{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class aR extends aH.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class aS extends aH.IEvents{constructor(a,b){super(),this.core=a,this.logger=b}}class aT{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class aU{constructor(a,b){this.projectId=a,this.logger=b}}class aV{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var aW=Object.defineProperty,aX=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?aW(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};ah.default;class aY{constructor(a){this.opts=a,aX(this,"protocol","wc"),aX(this,"version",2)}}ah.EventEmitter;class aZ{constructor(a){this.client=a}}var a$=a.i(66090),a_=a.i(771656),a0=a.i(391112),a1=a.i(492400),a2=a.i(438848),a3=a.i(491927),a4=a.i(101833),a5=a.i(35141);let a6=BigInt(0),a7=BigInt(1);function a8(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function a9(a){if(!a8(a))throw Error("Uint8Array expected")}function ba(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function bb(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function bc(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?a6:BigInt("0x"+a)}let bd="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,be=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function bf(a){if(a9(a),bd)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=be[a[c]];return b}function bg(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function bh(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(bd)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bg(a.charCodeAt(e)),f=bg(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function bi(a){return bc(bf(a))}function bj(a){return a9(a),bc(bf(Uint8Array.from(a).reverse()))}function bk(a,b){return bh(a.toString(16).padStart(2*b,"0"))}function bl(a,b){return bk(a,b).reverse()}function bm(a,b,c){let d;if("string"==typeof b)try{d=bh(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(a8(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function bn(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];a9(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let bo=a=>"bigint"==typeof a&&a6<=a;function bp(a,b,c){return bo(a)&&bo(b)&&bo(c)&&b<=a&&a<c}function bq(a,b,c,d){if(!bp(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let br=a=>(a7<<BigInt(a))-a7,bs=a=>new Uint8Array(a),bt={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||a8(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function bu(a,b,c={}){let d=(b,c,d)=>{let e=bt[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function bv(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let bw=BigInt(0),bx=BigInt(1),by=BigInt(2),bz=BigInt(3),bA=BigInt(4),bB=BigInt(5),bC=BigInt(8);function bD(a,b){let c=a%b;return c>=bw?c:b+c}function bE(a,b,c){let d=a;for(;b-- >bw;)d*=d,d%=c;return d}function bF(a,b){if(a===bw)throw Error("invert: expected non-zero number");if(b<=bw)throw Error("invert: expected positive modulus, got "+b);let c=bD(a,b),d=b,e=bw,f=bx,g=bx,h=bw;for(;c!==bw;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==bx)throw Error("invert: does not exist");return bD(e,b)}function bG(a,b){let c=(a.ORDER+bx)/bA,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function bH(a,b){let c=(a.ORDER-bB)/bC,d=a.mul(b,by),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,by),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let bI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bJ(a){return bu(a,bI.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function bK(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function bL(a,b){let c=(a.ORDER-bx)/by,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function bM(a,b){void 0!==b&&(0,a4.anumber)(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function bN(a,b,c=!1,d={}){let e;if(a<=bw)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=bM(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:br(f),ZERO:bw,ONE:bx,create:b=>bD(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return bw<=b&&b<a},is0:a=>a===bw,isOdd:a=>(a&bx)===bx,neg:b=>bD(-b,a),eql:(a,b)=>a===b,sqr:b=>bD(b*b,a),add:(b,c)=>bD(b+c,a),sub:(b,c)=>bD(b-c,a),mul:(b,c)=>bD(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<bw)throw Error("invalid exponent, negatives unsupported");if(c===bw)return a.ONE;if(c===bx)return b;let d=a.ONE,e=b;for(;c>bw;)c&bx&&(d=a.mul(d,e)),e=a.sqr(e),c>>=bx;return d})(h,a,b),div:(b,c)=>bD(b*bF(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>bF(b,a),sqrt:d.sqrt||(b=>(e||(e=a%bA===bz?bG:a%bC===bB?bH:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-bx,c=0;for(;b%by===bw;)b/=by,c++;let d=by,e=bN(a);for(;1===bL(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return bG;let f=e.pow(d,b),g=(b+bx)/by;return function(a,d){if(a.is0(d))return d;if(1!==bL(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=bx<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?bl(a,g):bk(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?bj(a):bi(a)},invertBatch:a=>bK(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function bO(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function bP(a){let b=bO(a);return b+Math.ceil(b/2)}let bQ=BigInt(0),bR=BigInt(1);function bS(a,b){let c=b.negate();return a?c:b}function bT(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function bU(a,b){bT(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:br(a),maxNumber:e,shiftBy:BigInt(a)}}function bV(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=bR);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let bW=new WeakMap,bX=new WeakMap;function bY(a){return bX.get(a)||1}function bZ(a){return bJ(a.Fp),bu(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bM(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function b$(a){void 0!==a.lowS&&ba("lowS",a.lowS),void 0!==a.prehash&&ba("prehash",a.prehash)}let b_={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=b_;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=bb(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?bb(e.length/2|128):"";return bb(a)+f+e+b},decode(a,b){let{Err:c}=b_,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=b_;if(a<b0)throw new b("integer: negative integers are not allowed");let c=bb(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=b_;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return bi(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=b_,e=bm("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=b_,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},b0=BigInt(0),b1=BigInt(1),b2=BigInt(2),b3=BigInt(3),b4=BigInt(4),b5=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),b6=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),b7=BigInt(0),b8=BigInt(1),b9=BigInt(2),ca=(a,b)=>(a+b/b9)/b,cb=bN(b5,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%b5,j=i*i*a%b5,k=bE(j,b,b5)*j%b5,l=bE(k,b,b5)*j%b5,m=bE(l,b9,b5)*i%b5,o=bE(m,d,b5)*m%b5,p=bE(o,e,b5)*o%b5,q=bE(p,g,b5)*p%b5,r=bE(q,h,b5)*q%b5,s=bE(r,g,b5)*p%b5,t=bE(s,b,b5)*j%b5,u=bE(t,f,b5)*o%b5,v=bE(u,c,b5)*i%b5,w=bE(v,b9,b5);if(!cb.eql(cb.sqr(w),a))throw Error("Cannot find square root");return w}}),cc=(w={a:b7,b:BigInt(7),Fp:cb,n:b6,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-b8*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=ca(b*a,b6),g=ca(-c*a,b6),h=bD(a-f*b-g*d,b6),i=bD(-f*c-g*b,b6),j=h>e,k=i>e;if(j&&(h=b6-h),k&&(i=b6-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},x=a3.sha256,{...(d=a=>(function(a){let b,c=(bu(b=bZ(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return bD(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:o}=function(a){var b;let c=function(a){let b=bZ(a);bu(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=bN(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return bn(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,b3),b4),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(a8(a)&&(a=bf(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:bi(bm("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=bD(b,g)),bq("private key",b,b1,g),b}function m(a){if(!(a instanceof q))throw Error("ProjectivePoint expected")}let o=bv((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),p=bv(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class q{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof q)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?q.ZERO:new q(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=bK(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(q.fromAffine)}static fromHex(a){let b=q.fromAffine(g(bm("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return q.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>a6;a>>=a7,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=br(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(q,e,a,b)}_setWindowSize(a){t.setWindowSize(this,a)}assertValidity(){p(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new q(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,b3),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new q(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,o=c.a,p=d.mul(c.b,b3),r=d.mul(b,g),s=d.mul(e,h),t=d.mul(f,i),u=d.add(b,e),v=d.add(g,h);u=d.mul(u,v),v=d.add(r,s),u=d.sub(u,v),v=d.add(b,f);let w=d.add(g,i);return v=d.mul(v,w),w=d.add(r,t),v=d.sub(v,w),w=d.add(e,f),j=d.add(h,i),w=d.mul(w,j),j=d.add(s,t),w=d.sub(w,j),l=d.mul(o,v),j=d.mul(p,t),l=d.add(j,l),j=d.sub(s,l),l=d.add(s,l),k=d.mul(j,l),s=d.add(r,r),s=d.add(s,r),t=d.mul(o,t),v=d.mul(p,v),s=d.add(s,t),t=d.sub(r,t),t=d.mul(o,t),v=d.add(v,t),r=d.mul(s,v),k=d.add(k,r),r=d.mul(w,v),j=d.mul(u,j),j=d.sub(j,r),r=d.mul(u,s),l=d.mul(w,l),new q(j,k,l=d.add(l,r))}subtract(a){return this.add(a.negate())}is0(){return this.equals(q.ZERO)}wNAF(a){return t.wNAFCached(this,a,q.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;bq("scalar",a,b0,e);let f=q.ZERO;if(a===b0)return f;if(this.is0()||a===b1)return this;if(!b||t.hasPrecomputes(this))return t.wNAFCachedUnsafe(this,a,q.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>b0||j>b0;)h&b1&&(k=k.add(m)),j&b1&&(l=l.add(m)),m=m.double(),h>>=b1,j>>=b1;return g&&(k=k.negate()),i&&(l=l.negate()),l=new q(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(bq("scalar",a,b1,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=t.constTimeNegate(c,j),l=t.constTimeNegate(h,l),l=new q(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return q.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=q.BASE,e=(a,b)=>b!==b0&&b!==b1&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return o(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===b1)return!0;if(b)return b(q,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===b1?this:b?b(q,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return ba("isCompressed",a),this.assertValidity(),f(q,this,a)}toHex(a=!0){return ba("isCompressed",a),bf(this.toRawBytes(a))}}q.BASE=new q(c.Gx,c.Gy,d.ONE),q.ZERO=new q(d.ZERO,d.ONE,d.ZERO);let{endo:r,nBitLength:s}=c,t=(b=r?Math.ceil(s/2):s,{constTimeNegate:bS,hasPrecomputes:a=>1!==bY(a),unsafeLadder(a,b,c=q.ZERO){let d=a;for(;b>bQ;)b&bR&&(c=c.add(d)),d=d.double(),b>>=bR;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=bU(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=q.ZERO,f=q.BASE,g=bU(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=bV(d,a,g);d=b,i?f=f.add(bS(k,c[l])):e=e.add(bS(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=q.ZERO){let f=bU(a,b);for(let a=0;a<f.windows&&d!==bQ;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=bV(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=bW.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&bW.set(b,c(d))),d},wNAFCached(a,b,c){let d=bY(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=bY(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){bT(c,b),bX.set(a,c),bW.delete(a)}});return{CURVE:c,ProjectivePoint:q,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return bp(a,b1,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(ba("isCompressed",c),c)?bn(Uint8Array.from([b.hasEvenY()?2:3]),f):bn(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=bi(e);if(!bp(b,b1,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&b1)===b1)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),p=(a,b,c)=>bi(a.slice(b,c));class q{constructor(a,b,c){bq("r",a,b1,e),bq("s",b,b1,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new q(p(a=bm("compactSignature",a,2*f),0,f),p(a,f,2*f))}static fromDER(a){let{r:b,s:c}=b_.toSig(bm("DER",a));return new q(b,c)}assertValidity(){}addRecoveryBit(a){return new q(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=t(bm("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+bf(bk(i,d.BYTES))),o=bF(i,e),p=j(-h*o),q=j(f*o),r=k.BASE.multiplyAndAddUnsafe(m,p,q);if(!r)throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>e>>b1}normalizeS(){return this.hasHighS()?new q(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return bh(this.toDERHex())}toDERHex(){return b_.hexFromSig(this)}toCompactRawBytes(){return bh(this.toCompactHex())}toCompactHex(){return bf(bk(this.r,f))+bf(bk(this.s,f))}}function r(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=bm("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=bi(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return j(s(a))},u=br(g);function v(a){return bq("num < 2^"+g,a,b0,u),bk(a,f)}let w={lowS:c.lowS,prehash:!1},x={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===r(a))throw Error("first arg must be private key");if(!1===r(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=w){let{seed:g,k2sig:h}=function(a,b,f=w){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:p}=f;null==i&&(i=!0),a=bm("msgHash",a),b$(f),m&&(a=bm("prehashed msgHash",g(a)));let r=t(a),u=l(b),x=[v(u),v(r)];if(null!=p&&!1!==p){let a=!0===p?h(d.BYTES):p;x.push(bm("extraEntropy",a))}return{seed:bn(...x),k2sig:function(a){var b;let c=s(a);if(!o(c))return;let d=bF(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===b0)return;let h=j(d*j(r+g*u));if(h===b0)return;let l=2*(f.x!==g)|Number(f.y&b1),m=h;return i&&h>e>>b1&&(m=(b=h)>e>>b1?j(-b):b,l^=1),new q(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=bs(a),e=bs(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=bs(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return bn(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=x){let g,h;b=bm("msgHash",b),d=bm("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(b$(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||a8(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(h=new q(a.r,a.s)),o){try{"compact"!==m&&(h=q.fromDER(a))}catch(a){if(!(a instanceof b_.Err))throw a}h||"der"===m||(h=q.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r,s}=h,u=t(b),v=bF(s,e),w=j(u*v),y=j(r*v),z=k.BASE.multiplyAndAddUnsafe(g,w,y)?.toAffine();return!!z&&j(z.x)===r},ProjectivePoint:k,Signature:q,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=bP(c.n);return function(a,b,c=!1){let d=a.length,e=bO(b),f=bP(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=bD(c?bj(a):bi(a),b-bx)+bx;return c?bl(g,e):bk(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...w,...{hash:a,hmac:(b,...c)=>(0,a5.hmac)(a,b,(0,a4.concatBytes)(...c)),randomBytes:a4.randomBytes}}))(x),create:d});cc.ProjectivePoint;let cd=(e=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[c,d,f,g]=e.map(b=>b.reduce((b,c)=>cb.add(cb.mul(b,a),c))),[h,i]=bK(cb,[d,g],!0);return a=cb.mul(c,h),b=cb.mul(b,cb.mul(f,i)),{x:a,y:b}}),ce=function(a,b){if(bJ(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=b0;for(let a=c-b1;a%b2===b0;a/=b2)d+=b1;let e=d,f=b2<<e-b1-b1,g=f*b2,h=(c-b1)/g,i=(h-b1)/b2,j=g-b1,k=a.pow(b,h),l=a.pow(b,(h+b1)/b2),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let o=a.mul(h,g);m=a.pow(o,f);let p=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(o,d),h=a.cmov(g,h,p),o=a.cmov(m,o,p);for(let b=e;b>b1;b--){let c=b-b2;c=b2<<c-b1;let e=a.pow(o,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(o,d),h=a.cmov(g,h,f),o=a.cmov(e,o,f)}return{isValid:p,value:h}};if(a.ORDER%b4===b3){let c=(a.ORDER-b3)/b4,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:o}=c(f,j);l=a.mul(e,d),l=a.mul(l,o),k=a.cmov(k,g,m),l=a.cmov(l,o,m);let p=a.isOdd(d)===a.isOdd(l);l=a.cmov(a.neg(l),l,p);let q=bK(a,[h],!0)[0];return{x:k=a.mul(k,q),y:l}}}(cb,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:cb.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(cc.ProjectivePoint,a=>{let{x:b,y:c}=ce(cb.create(a[0]));return cd(b,c)},(cb.ORDER,a3.sha256));class cf extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof cf){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof cf&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function cg(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function ch(a,b){if(cr(a)>b)throw new cw({givenSize:cr(a),maxSize:b})}function ci(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new cy({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function cj(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let ck=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function cl(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function cm(a){return a instanceof Uint8Array?cn(a):Array.isArray(a)?cn(new Uint8Array(a)):a}function cn(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=ck[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(ch(d,b.size),cp(d,b.size)):d}function co(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new ct({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,ci(c,{dir:"left",size:f})):j}function cp(a,b){return ci(a,{dir:"right",size:b})}function cq(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>cr(a)-1)throw new cx({offset:b,position:"start",size:cr(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&cr(a)!==c-b)throw new cx({offset:c,position:"end",size:cr(a)})}(f,b,c),f}function cr(a){return Math.ceil((a.length-2)/2)}function cs(a){return function(a,b={}){let{dir:c="left"}=b,d=a.replace("0x",""),e=0;for(let a=0;a<d.length-1;a++)if("0"===d["left"===c?a:d.length-a-1].toString())e++;else break;return"0"===(d="left"===c?d.slice(e):d.slice(0,d.length-e))?"0x":"right"===c&&d.length%2==1?`0x${d}0`:`0x${d}`}(a,{dir:"left"})}class ct extends cf{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class cu extends cf{constructor(a){super(`Value \`${"object"==typeof a?cj(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class cv extends cf{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class cw extends cf{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class cx extends cf{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class cy extends cf{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let cz=new TextEncoder;function cA(a){var b;return a instanceof Uint8Array?a:"string"==typeof a?cB(a):(b=a)instanceof Uint8Array?b:new Uint8Array(b)}function cB(a,b={}){let{size:c}=b,d=a;c&&(ch(a,c),d=cp(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=cg(e.charCodeAt(b++)),d=cg(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new cf(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}class cC extends cf{constructor(a){super(`Value \`${"object"==typeof a?cj(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class cD extends cf{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class cE extends cf{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let cF=2n**256n-1n;function cG(a,b={}){let{recovered:c}=b;if(void 0===a.r||void 0===a.s||c&&void 0===a.yParity)throw new c_({signature:a});if(a.r<0n||a.r>cF)throw new c0({value:a.r});if(a.s<0n||a.s>cF)throw new c1({value:a.s});if("number"==typeof a.yParity&&0!==a.yParity&&1!==a.yParity)throw new c2({value:a.yParity})}function cH(a){return cI(cn(a))}function cI(a){if(130!==a.length&&132!==a.length)throw new c$({signature:a});let b=BigInt(cq(a,0,32)),c=BigInt(cq(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{return cY(b)}catch{throw new c2({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}function cJ(a){if(void 0!==a.r&&void 0!==a.s)return cK(a)}function cK(a){let b="string"==typeof a?cI(a):a instanceof Uint8Array?cH(a):"string"==typeof a.r?cO(a):a.v?cN(a):{r:a.r,s:a.s,...void 0!==a.yParity?{yParity:a.yParity}:{}};return cG(b),b}function cL(a){return cM(cn(a))}function cM(a){let{r:b,s:c}=cc.Signature.fromDER(cm(a).slice(2));return{r:b,s:c}}function cN(a){return{r:a.r,s:a.s,yParity:cY(a.v)}}function cO(a){let b=(()=>{let b=a.v?Number(a.v):void 0,c=a.yParity?Number(a.yParity):void 0;if("number"==typeof b&&"number"!=typeof c&&(c=cY(b)),"number"!=typeof c)throw new c2({value:a.yParity});return c})();return{r:BigInt(a.r),s:BigInt(a.s),yParity:b}}function cP(a){let[b,c,d]=a;return cK({r:"0x"===c?0n:BigInt(c),s:"0x"===d?0n:BigInt(d),yParity:"0x"===b?0:Number(b)})}function cQ(a){return cB(cR(a))}function cR(a){cG(a);let b=a.r,c=a.s;return cl(co(b,{size:32}),co(c,{size:32}),"number"==typeof a.yParity?co(cZ(a.yParity),{size:1}):"0x")}function cS(a){return new cc.Signature(a.r,a.s).toDERRawBytes()}function cT(a){let b=new cc.Signature(a.r,a.s);return`0x${b.toDERHex()}`}function cU(a){return{r:a.r,s:a.s,v:cZ(a.yParity)}}function cV(a){let{r:b,s:c,yParity:d}=a;return{r:co(b,{size:32}),s:co(c,{size:32}),yParity:0===d?"0x0":"0x1"}}function cW(a){let{r:b,s:c,yParity:d}=a;return[d?"0x01":"0x",0n===b?"0x":cs(co(b)),0n===c?"0x":cs(co(c))]}function cX(a,b={}){try{return cG(a,b),!0}catch{return!1}}function cY(a){if(0===a||27===a)return 0;if(1===a||28===a)return 1;if(a>=35)return+(a%2==0);throw new c3({value:a})}function cZ(a){if(0===a)return 27;if(1===a)return 28;throw new c2({value:a})}class c$ extends cf{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${cr(cm(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class c_ extends cf{constructor({signature:a}){super(`Signature \`${cj(a)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class c0 extends cf{constructor({value:a}){super(`Value \`${a}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class c1 extends cf{constructor({value:a}){super(`Value \`${a}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class c2 extends cf{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class c3 extends cf{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}a.s(["InvalidRError",()=>c0,"InvalidSError",()=>c1,"InvalidSerializedSizeError",()=>c$,"InvalidVError",()=>c3,"InvalidYParityError",()=>c2,"MissingPropertiesError",()=>c_,"assert",()=>cG,"extract",()=>cJ,"from",()=>cK,"fromBytes",()=>cH,"fromDerBytes",()=>cL,"fromDerHex",()=>cM,"fromHex",()=>cI,"fromLegacy",()=>cN,"fromRpc",()=>cO,"fromTuple",()=>cP,"toBytes",()=>cQ,"toDerBytes",()=>cS,"toDerHex",()=>cT,"toHex",()=>cR,"toLegacy",()=>cU,"toRpc",()=>cV,"toTuple",()=>cW,"vToYParity",()=>cY,"validate",()=>cX,"yParityToV",()=>cZ],442746);var c4=a.i(442746),c4=c4;class c5 extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let c6={checksum:new c5(8192)}.checksum;a.i(268417);var c7=a.i(554876);function c8(a,b={}){let{as:c="string"==typeof a?"Hex":"Bytes"}=b,d=(0,c7.keccak_256)(cA(a));return"Bytes"===c?d:cn(d)}function c9(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new de({prefix:d,cause:new dg});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new de({prefix:d,cause:new df});return}throw new dd({publicKey:a})}function da(a){let b=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new cu(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new cv(a)}(a,{strict:c}),!0}catch{return!1}}(a))return db(a);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new cC(a);return!0}catch{return!1}}(a))return db(cn(a));let{prefix:b,x:c,y:d}=a;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:b??4,x:c,y:d}:{prefix:b,x:c}})();return c9(b),b}function db(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new dh({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(cq(a,0,32)),y:BigInt(cq(a,32,64))};if(132===a.length){let b=Number(cq(a,0,1));return{prefix:b,x:BigInt(cq(a,1,33)),y:BigInt(cq(a,33,65))}}return{prefix:Number(cq(a,0,1)),x:BigInt(cq(a,1,33))}}function dc(a,b={}){c9(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return cl(f?co(c,{size:1}):"0x",co(d,{size:32}),"bigint"==typeof e?co(e,{size:32}):"0x")}a.i(610181);class dd extends cf{constructor({publicKey:a}){super(`Value \`${cj(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class de extends cf{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class df extends cf{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class dg extends cf{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class dh extends cf{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${cr(cm(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let di=/^0x[a-fA-F0-9]{40}$/;function dj(a,b={}){let{strict:c=!0}=b;if(!di.test(a))throw new dl({address:a,cause:new dm});if(c){if(a.toLowerCase()===a)return;if(dk(a)!==a)throw new dl({address:a,cause:new dn})}}function dk(a){if(c6.has(a))return c6.get(a);dj(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=c8(function(a,b={}){let{size:c}=b,d=cz.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new cD({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new cE({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return c6.set(a,e),e}class dl extends cf{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class dm extends cf{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class dn extends cf{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function dp(a={}){let{as:b="Hex"}=a,c=ds({as:b}),d=dq({privateKey:c});return{privateKey:c,publicKey:d}}function dq(a){let{privateKey:b}=a;return da(cc.ProjectivePoint.fromPrivateKey(cm(b).slice(2)))}function dr(a){let{as:b="Hex",privateKey:c,publicKey:d}=a,e=cc.ProjectivePoint.fromHex(dc(d).slice(2)).multiply(cc.utils.normPrivateKeyToScalar(cm(c).slice(2))).toRawBytes(!0);return"Hex"===b?cn(e):e}function ds(a={}){let{as:b="Hex"}=a,c=cc.utils.randomPrivateKey();return"Hex"===b?cn(c):c}function dt(a){return function(a,b={}){let c=c8(`0x${dc(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(dj(a),c)?dk(a):a}(`0x${c}`,b)}(du(a))}function du(a){let{payload:b,signature:c}=a,{r:d,s:e,yParity:f}=c;return da(new cc.Signature(BigInt(d),BigInt(e)).addRecoveryBit(f).recoverPublicKey(cm(b).substring(2)))}function dv(a){let{extraEntropy:b=!1,hash:c,payload:d,privateKey:e}=a,{r:f,s:g,recovery:h}=cc.sign(cA(d),cA(e),{extraEntropy:"boolean"==typeof b?b:cm(b).slice(2),lowS:!0,...c?{prehash:!0}:{}});return{r:f,s:g,yParity:h}}function dw(a){let{address:b,hash:c,payload:d,publicKey:e,signature:f}=a;if(b){var g;return g=dt({payload:d,signature:f}),dj(b,{strict:!1}),dj(g,{strict:!1}),b.toLowerCase()===g.toLowerCase()}return cc.verify(f,cA(d),function(a,b={}){return cB(dc(a,b))}(e),...c?[{prehash:!0,lowS:!0}]:[])}a.s(["createKeyPair",()=>dp,"getPublicKey",()=>dq,"getSharedSecret",()=>dr,"noble",0,cc,"randomPrivateKey",()=>ds,"recoverAddress",()=>dt,"recoverPublicKey",()=>du,"sign",()=>dv,"verify",()=>dw],853518);var dx=a.i(853518),dx=dx;let dy=function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;let f=0,g=0,h=0;for(;a[f]===d;)g++,f++;let i=(a.length-f)*e+1>>>0,j=new Uint8Array(i);for(;f<a.length;){let d=a.charCodeAt(f);if(d>255)return;let e=b[d];if(255===e)return;let g=0;for(let a=i-1;(0!==e||g<h)&&-1!==a;a--,g++)e+=c*j[a]>>>0,j[a]=e%256>>>0,e=e/256>>>0;if(0!==e)throw Error("Non-zero carry");h=g,f++}let k=i-h;for(;k!==i&&0===j[k];)k++;let l=new Uint8Array(g+(i-k)),m=g;for(;k!==i;)l[m++]=j[k++];return l}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";let e=0,g=0,h=0,i=b.length;for(;h!==i&&0===b[h];)h++,e++;let j=(i-h)*f+1>>>0,k=new Uint8Array(j);for(;h!==i;){let a=b[h],d=0;for(let b=j-1;(0!==a||d<g)&&-1!==b;b--,d++)a+=256*k[b]>>>0,k[b]=a%c>>>0,a=a/c>>>0;if(0!==a)throw Error("Non-zero carry");g=d,h++}let l=j-g;for(;l!==j&&0===k[l];)l++;let m=d.repeat(e);for(;l<j;++l)m+=a.charAt(k[l]);return m},decodeUnsafe:g,decode:function(a){let b=g(a);if(b)return b;throw Error("Non-base"+c+" character")}}}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");var dz=a.i(92965),dA=a.i(746280),dB=a.i(39809);function dC(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function dD(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?dC(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function dE(a,b){b||(b=a.reduce((a,b)=>a+b.length,0));let c=dD(b),d=0;for(let b of a)c.set(b,d),d+=b.length;return dC(c)}var dF=a.i(559651);function dG(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}let dH=dG("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),dI=dG("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=dD((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),dJ={utf8:dH,"utf-8":dH,hex:dF.bases.base16,latin1:dI,ascii:dI,binary:dI,...dF.bases};function dK(a,b="utf8"){let c=dJ[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?dC(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}function dL(a,b="utf8"){let c=dJ[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):c.encoder.encode(a).substring(1)}var dM=a.i(717155),dN=a.i(715896);function dO(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function dP(a,b){return a.includes(":")?[a]:b.chains||[]}var dQ=Object.defineProperty,dR=Object.defineProperties,dS=Object.getOwnPropertyDescriptors,dT=Object.getOwnPropertySymbols,dU=Object.prototype.hasOwnProperty,dV=Object.prototype.propertyIsEnumerable,dW=(a,b,c)=>b in a?dQ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,dX=(a,b)=>{for(var c in b||(b={}))dU.call(b,c)&&dW(a,c,b[c]);if(dT)for(var c of dT(b))dV.call(b,c)&&dW(a,c,b[c]);return a},dY=(a,b,c)=>dW(a,"symbol"!=typeof b?b+"":b,c);let dZ="react-native",d$="node",d_="browser";function d0(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function d1(){return!(0,a1.getDocument)()&&!!(0,a1.getNavigator)()&&"ReactNative"===navigator.product}function d2(){return!d0()&&!!(0,a1.getNavigator)()&&!!(0,a1.getDocument)()}function d3(){return d1()?dZ:d0()?d$:d2()?d_:"unknown"}function d4(){var b;try{return d1()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function d5(){return(0,a2.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function d6(b,c,d){var e;let f,g=function(){if(d3()===dZ&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b=(0,a0.detect)();if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=d3())===d_?[f,(null==(e=(0,a1.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function d7(a,b){return a.filter(a=>b.includes(a)).length===a.length}function d8(a){return Object.fromEntries(a.entries())}function d9(a){return new Map(Object.entries(a))}function ea(a=a$.FIVE_MINUTES,b){let c,d,e,f,g=(0,a$.toMiliseconds)(a||a$.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function eb(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function ec(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function ed(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function ee(a,b){return(0,a$.fromMiliseconds)((b||Date.now())+(0,a$.toMiliseconds)(a))}function ef(a){return Date.now()>=(0,a$.toMiliseconds)(a)}function eg(a,b){return`${a}${b?`:${b}`:""}`}function eh(a=[],b=[]){return[...new Set([...a,...b])]}async function ei({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=d3();if(j===d_){let a;if(!(null!=(e=(0,a1.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===dZ&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function ej(a,b){let c="";try{if(d2()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function ek(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function el(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function em(){return"u">typeof process&&"true"===process.env.IS_VITEST}function en(a){return Buffer.from(a,"base64").toString("utf-8")}class eo{constructor({limit:a}){dY(this,"limit"),dY(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let ep=BigInt(0x100000000-1),eq=BigInt(32);function er(a,b=!1){return b?{h:Number(a&ep),l:Number(a>>eq&ep)}:{h:0|Number(a>>eq&ep),l:0|Number(a&ep)}}function es(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=er(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let et=(a,b,c)=>a>>>c,eu=(a,b,c)=>a<<32-c|b>>>c,ev=(a,b,c)=>a>>>c|b<<32-c,ew=(a,b,c)=>a<<32-c|b>>>c,ex=(a,b,c)=>a<<64-c|b>>>c-32,ey=(a,b,c)=>a>>>c-32|b<<64-c;function ez(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let eA=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),eB=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,eC=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),eD=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,eE=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),eF=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,eG="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function eH(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function eI(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function eJ(a,...b){if(!eH(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function eK(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");eI(a.outputLen),eI(a.blockLen)}function eL(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function eM(a,b){eJ(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function eN(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function eO(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function eP(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function eQ(a,b){return a<<32-b|a>>>b}let eR=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function eS(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let eT=eR?a=>a:a=>eS(a),eU=eR?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=eS(a[b]);return a},eV="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,eW=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function eX(a){if(eJ(a),eV)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=eW[a[c]];return b}function eY(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function eZ(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(eV)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=eY(a.charCodeAt(e)),f=eY(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function e$(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function e_(a){return"string"==typeof a&&(a=e$(a)),eJ(a),a}function e0(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];eJ(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class e1{}function e2(a){let b=b=>a().update(e_(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function e3(a=32){if(eG&&"function"==typeof eG.getRandomValues)return eG.getRandomValues(new Uint8Array(a));if(eG&&"function"==typeof eG.randomBytes)return Uint8Array.from(eG.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let e4=BigInt(0),e5=BigInt(1),e6=BigInt(2),e7=BigInt(7),e8=BigInt(256),e9=BigInt(113),fa=[],fb=[],fc=[];for(let a=0,b=e5,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],fa.push(2*(5*d+c)),fb.push((a+1)*(a+2)/2%64);let e=e4;for(let a=0;a<7;a++)(b=(b<<e5^(b>>e7)*e9)%e8)&e6&&(e^=e5<<(e5<<BigInt(a))-e5);fc.push(e)}let fd=es(fc,!0),fe=fd[0],ff=fd[1],fg=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,fh=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class fi extends e1{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,eI(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=eN(this.state)}clone(){return this._cloneInto()}keccak(){eU(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=fg(f,g,1)^c[d],i=fh(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=fb[c],f=fg(b,e,d),g=fh(b,e,d),h=fa[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=fe[d],a[1]^=ff[d]}eO(c)}(this.state32,this.rounds),eU(this.state32),this.posOut=0,this.pos=0}update(a){eL(this),eJ(a=e_(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){eL(this,!1),eJ(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return eI(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(eM(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,eO(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new fi(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let fj=e2(()=>new fi(136,1,32));class fk extends e1{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=eP(this.buffer)}update(a){eL(this),eJ(a=e_(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=eP(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){eL(this),eM(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,eO(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=eP(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let fl=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),fm=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),fn=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),fo=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),fp=new Uint32Array(64);class fq extends fk{constructor(a=32){super(64,a,8,!1),this.A=0|fl[0],this.B=0|fl[1],this.C=0|fl[2],this.D=0|fl[3],this.E=0|fl[4],this.F=0|fl[5],this.G=0|fl[6],this.H=0|fl[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)fp[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=fp[a-15],c=fp[a-2],d=eQ(b,7)^eQ(b,18)^b>>>3,e=eQ(c,17)^eQ(c,19)^c>>>10;fp[a]=e+fp[a-7]+d+fp[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,o;let b=j+(eQ(g,6)^eQ(g,11)^eQ(g,25))+((k=g)&h^~k&i)+fo[a]+fp[a]|0,p=(eQ(c,2)^eQ(c,13)^eQ(c,22))+((l=c)&(m=d)^l&(o=e)^m&o)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+p|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){eO(fp)}destroy(){this.set(0,0,0,0,0,0,0,0),eO(this.buffer)}}let fr=es(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),fs=fr[0],ft=fr[1],fu=new Uint32Array(80),fv=new Uint32Array(80);class fw extends fk{constructor(a=64){super(128,a,16,!1),this.Ah=0|fn[0],this.Al=0|fn[1],this.Bh=0|fn[2],this.Bl=0|fn[3],this.Ch=0|fn[4],this.Cl=0|fn[5],this.Dh=0|fn[6],this.Dl=0|fn[7],this.Eh=0|fn[8],this.El=0|fn[9],this.Fh=0|fn[10],this.Fl=0|fn[11],this.Gh=0|fn[12],this.Gl=0|fn[13],this.Hh=0|fn[14],this.Hl=0|fn[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:o,Hh:p,Hl:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|o,this.Hh=0|p,this.Hl=0|q}process(a,b){for(let c=0;c<16;c++,b+=4)fu[c]=a.getUint32(b),fv[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|fu[a-15],c=0|fv[a-15],d=ev(b,c,1)^ev(b,c,8)^et(b,c,7),e=ew(b,c,1)^ew(b,c,8)^eu(b,c,7),f=0|fu[a-2],g=0|fv[a-2],h=ev(f,g,19)^ex(f,g,61)^et(f,g,6),i=eC(e,ew(f,g,19)^ey(f,g,61)^eu(f,g,6),fv[a-7],fv[a-16]),j=eD(i,d,h,fu[a-7],fu[a-16]);fu[a]=0|j,fv[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:o,Gh:p,Gl:q,Hh:r,Hl:s}=this;for(let a=0;a<80;a++){let b=ev(k,l,14)^ev(k,l,18)^ex(k,l,41),t=ew(k,l,14)^ew(k,l,18)^ey(k,l,41),u=k&m^~k&p,v=eE(s,t,l&o^~l&q,ft[a],fv[a]),w=eF(v,r,b,u,fs[a],fu[a]),x=0|v,y=ev(c,d,28)^ex(c,d,34)^ex(c,d,39),z=ew(c,d,28)^ey(c,d,34)^ey(c,d,39),A=c&e^c&g^e&g,B=d&f^d&h^f&h;r=0|p,s=0|q,p=0|m,q=0|o,m=0|k,o=0|l,({h:k,l:l}=ez(0|i,0|j,0|w,0|x)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let C=eA(x,z,B);c=eB(C,w,y,A),d=0|C}({h:c,l:d}=ez(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=ez(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=ez(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=ez(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=ez(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:o}=ez(0|this.Fh,0|this.Fl,0|m,0|o)),({h:p,l:q}=ez(0|this.Gh,0|this.Gl,0|p,0|q)),({h:r,l:s}=ez(0|this.Hh,0|this.Hl,0|r,0|s)),this.set(c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s)}roundClean(){eO(fu,fv)}destroy(){eO(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class fx extends fw{constructor(){super(48),this.Ah=0|fm[0],this.Al=0|fm[1],this.Bh=0|fm[2],this.Bl=0|fm[3],this.Ch=0|fm[4],this.Cl=0|fm[5],this.Dh=0|fm[6],this.Dl=0|fm[7],this.Eh=0|fm[8],this.El=0|fm[9],this.Fh=0|fm[10],this.Fl=0|fm[11],this.Gh=0|fm[12],this.Gl=0|fm[13],this.Hh=0|fm[14],this.Hl=0|fm[15]}}let fy=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class fz extends fw{constructor(){super(32),this.Ah=0|fy[0],this.Al=0|fy[1],this.Bh=0|fy[2],this.Bl=0|fy[3],this.Ch=0|fy[4],this.Cl=0|fy[5],this.Dh=0|fy[6],this.Dl=0|fy[7],this.Eh=0|fy[8],this.El=0|fy[9],this.Fh=0|fy[10],this.Fl=0|fy[11],this.Gh=0|fy[12],this.Gl=0|fy[13],this.Hh=0|fy[14],this.Hl=0|fy[15]}}let fA=e2(()=>new fq),fB=e2(()=>new fw),fC=e2(()=>new fx),fD=e2(()=>new fz),fE=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),fF=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),fG=new Uint32Array(32);function fH(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=fG[2*a],j=fG[2*a+1],k=fG[2*b],l=fG[2*b+1],m=fG[2*c],o=fG[2*c+1],p=fG[2*d],q=fG[2*d+1],r=eA(i,k,g);j=eB(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:p,Dl:q}),({h:o,l:m}=ez(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:ev(l,k,24),Bl:ew(l,k,24)}),fG[2*a]=i,fG[2*a+1]=j,fG[2*b]=k,fG[2*b+1]=l,fG[2*c]=m,fG[2*c+1]=o,fG[2*d]=p,fG[2*d+1]=q}function fI(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=fG[2*a],j=fG[2*a+1],k=fG[2*b],l=fG[2*b+1],m=fG[2*c],o=fG[2*c+1],p=fG[2*d],q=fG[2*d+1],r=eA(i,k,g);j=eB(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:ev(q,p,16),Dl:ew(q,p,16)}),({h:o,l:m}=ez(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:ex(l,k,63),Bl:ey(l,k,63)}),fG[2*a]=i,fG[2*a+1]=j,fG[2*b]=k,fG[2*b+1]=l,fG[2*c]=m,fG[2*c+1]=o,fG[2*d]=p,fG[2*d+1]=q}class fJ extends e1{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,eI(a),eI(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=eN(this.buffer)}update(a){eL(this),eJ(a=e_(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(eU(d),this.compress(d,0,!1),eU(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));eU(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);eU(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){eL(this),eM(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,eO(this.buffer.subarray(b)),eU(c),this.compress(c,0,!0),eU(c);let d=eN(a);this.get().forEach((a,b)=>d[b]=eT(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class fK extends fJ{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|fF[0],this.v0h=0|fF[1],this.v1l=0|fF[2],this.v1h=0|fF[3],this.v2l=0|fF[4],this.v2h=0|fF[5],this.v3l=0|fF[6],this.v3h=0|fF[7],this.v4l=0|fF[8],this.v4h=0|fF[9],this.v5l=0|fF[10],this.v5h=0|fF[11],this.v6l=0|fF[12],this.v6h=0|fF[13],this.v7l=0|fF[14],this.v7h=0|fF[15],function(a,b={},c,d,e){if(eI(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=e_(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=eN(e=e_(e));this.v4l^=eT(a[0]),this.v4h^=eT(a[1]),this.v5l^=eT(a[2]),this.v5h^=eT(a[3])}if(void 0!==d){const a=eN(d=e_(d));this.v6l^=eT(a[0]),this.v6h^=eT(a[1]),this.v7l^=eT(a[2]),this.v7h^=eT(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:o,v7l:p,v7h:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|o,this.v7l=0|p,this.v7h=0|q}compress(a,b,c){this.get().forEach((a,b)=>fG[b]=a),fG.set(fF,16);let{h:d,l:e}=er(BigInt(this.length));fG[24]=fF[8]^e,fG[25]=fF[9]^d,c&&(fG[28]=~fG[28],fG[29]=~fG[29]);let f=0;for(let c=0;c<12;c++)fH(0,4,8,12,a,b+2*fE[f++]),fI(0,4,8,12,a,b+2*fE[f++]),fH(1,5,9,13,a,b+2*fE[f++]),fI(1,5,9,13,a,b+2*fE[f++]),fH(2,6,10,14,a,b+2*fE[f++]),fI(2,6,10,14,a,b+2*fE[f++]),fH(3,7,11,15,a,b+2*fE[f++]),fI(3,7,11,15,a,b+2*fE[f++]),fH(0,5,10,15,a,b+2*fE[f++]),fI(0,5,10,15,a,b+2*fE[f++]),fH(1,6,11,12,a,b+2*fE[f++]),fI(1,6,11,12,a,b+2*fE[f++]),fH(2,7,8,13,a,b+2*fE[f++]),fI(2,7,8,13,a,b+2*fE[f++]),fH(3,4,9,14,a,b+2*fE[f++]),fI(3,4,9,14,a,b+2*fE[f++]);this.v0l^=fG[0]^fG[16],this.v0h^=fG[1]^fG[17],this.v1l^=fG[2]^fG[18],this.v1h^=fG[3]^fG[19],this.v2l^=fG[4]^fG[20],this.v2h^=fG[5]^fG[21],this.v3l^=fG[6]^fG[22],this.v3h^=fG[7]^fG[23],this.v4l^=fG[8]^fG[24],this.v4h^=fG[9]^fG[25],this.v5l^=fG[10]^fG[26],this.v5h^=fG[11]^fG[27],this.v6l^=fG[12]^fG[28],this.v6h^=fG[13]^fG[29],this.v7l^=fG[14]^fG[30],this.v7h^=fG[15]^fG[31],eO(fG)}destroy(){this.destroyed=!0,eO(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let fL=(y=a=>new fK(a),(f=(a,b)=>y(b).update(e_(a)).digest()).outputLen=(g=y({})).outputLen,f.blockLen=g.blockLen,f.create=a=>y(a),f);function fM(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(fj(c)).toString("hex")}async function fN(a,b,c,d,e,f){switch(c.t){case"eip191":var g,h,i;let j;return await (g=a,h=b,i=c.s,j=c4.fromHex(i),dx.recoverAddress({payload:fM(h),signature:j}).toLowerCase()===g.toLowerCase());case"eip1271":return await fO(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function fO(a,b,c,d,e,f){let g=dO(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:fM(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function fP(a){let b=new Uint8Array(fA(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return dy.encode(b)}function fQ(a){let b=Buffer.from(a,"base64"),c=(0,dz.decode)(b).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=(0,dA.encode)(c),e=Buffer.from("TX"),f=fD(Buffer.concat([e,Buffer.from(d)]));return dB.base32.encode(f).replace(/=+$/,"")}function fR(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}var fS=Object.defineProperty,fT=Object.defineProperties,fU=Object.getOwnPropertyDescriptors,fV=Object.getOwnPropertySymbols,fW=Object.prototype.hasOwnProperty,fX=Object.prototype.propertyIsEnumerable,fY=(a,b,c)=>b in a?fS(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let fZ=a=>a?.split(":"),f$=a=>{let b=a&&fZ(a);if(b)return b[2]+":"+b[3]},f_=a=>{let b=a&&fZ(a);if(b)return b.pop()};async function f0(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=f1(e,e.iss),g=f_(e.iss);return await fN(g,f,d,f$(e.iss),c)}let f1=(a,b)=>{let c=`${a.domain} wants you to sign in with your Ethereum account:`,d=f_(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let e=a.statement||void 0,f=`URI: ${a.aud||a.uri}`,g=`Version: ${a.version}`,h=`Chain ID: ${(a=>{let b=a&&fZ(a);if(b)return a.includes("did:pkh:")?b[3]:b[1]})(b)}`,i=`Nonce: ${a.nonce}`,j=`Issued At: ${a.iat}`,k=a.exp?`Expiration Time: ${a.exp}`:void 0,l=a.nbf?`Not Before: ${a.nbf}`:void 0,m=a.requestId?`Request ID: ${a.requestId}`:void 0,o=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,p=f7(a.resources);return p&&(e=function(a="",b){f2(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(e,f4(p))),[c,d,"",e,"",f,g,h,i,j,k,l,m,o].filter(a=>null!=a).join(`
`)};function f2(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function f3(a){return f2(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function f4(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return f2(c),c}function f5(a){var b;let c=f4(a);f2(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function f6(a){let b=f4(a);f2(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function f7(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function f8(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function f9(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function ga(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function gb(a,...b){if(!f8(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function gc(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function gd(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ge(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let gf=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function gg(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(f8(a))a=gj(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function gh(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function gi(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function gj(a){return Uint8Array.from(a)}let gk=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),gl=gk("expand 16-byte k"),gm=gk("expand 32-byte k"),gn=gd(gl),go=gd(gm);function gp(a,b){return a<<b|a>>>32-b}function gq(a){return a.byteOffset%4==0}let gr=0x100000000-1,gs=new Uint32Array,gt=(a,b)=>255&a[b++]|(255&a[b++])<<8;class gu{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,gb(a=gg(a),32);const b=gt(a,0),c=gt(a,2),d=gt(a,4),e=gt(a,6),f=gt(a,8),g=gt(a,10),h=gt(a,12),i=gt(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=gt(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],o=e[8],p=e[9],q=gt(a,b+0),r=gt(a,b+2),s=gt(a,b+4),t=gt(a,b+6),u=gt(a,b+8),v=gt(a,b+10),w=gt(a,b+12),x=gt(a,b+14),y=d[0]+(8191&q),z=d[1]+((q>>>13|r<<3)&8191),A=d[2]+((r>>>10|s<<6)&8191),B=d[3]+((s>>>7|t<<9)&8191),C=d[4]+((t>>>4|u<<12)&8191),D=d[5]+(u>>>1&8191),E=d[6]+((u>>>14|v<<2)&8191),F=d[7]+((v>>>11|w<<5)&8191),G=d[8]+((w>>>8|x<<8)&8191),H=d[9]+(x>>>5|2048*!c),I=0,J=0+y*f+5*p*z+5*o*A+5*m*B+5*l*C;I=J>>>13,J&=8191,J+=5*k*D+5*j*E+5*i*F+5*h*G+5*g*H,I+=J>>>13,J&=8191;let K=I+y*g+z*f+5*p*A+5*o*B+5*m*C;I=K>>>13,K&=8191,K+=5*l*D+5*k*E+5*j*F+5*i*G+5*h*H,I+=K>>>13,K&=8191;let L=I+y*h+z*g+A*f+5*p*B+5*o*C;I=L>>>13,L&=8191,L+=5*m*D+5*l*E+5*k*F+5*j*G+5*i*H,I+=L>>>13,L&=8191;let M=I+y*i+z*h+A*g+B*f+5*p*C;I=M>>>13,M&=8191,M+=5*o*D+5*m*E+5*l*F+5*k*G+5*j*H,I+=M>>>13,M&=8191;let N=I+y*j+z*i+A*h+B*g+C*f;I=N>>>13,N&=8191,N+=5*p*D+5*o*E+5*m*F+5*l*G+5*k*H,I+=N>>>13,N&=8191;let O=I+y*k+z*j+A*i+B*h+C*g;I=O>>>13,O&=8191,O+=D*f+5*p*E+5*o*F+5*m*G+5*l*H,I+=O>>>13,O&=8191;let P=I+y*l+z*k+A*j+B*i+C*h;I=P>>>13,P&=8191,P+=D*g+E*f+5*p*F+5*o*G+5*m*H,I+=P>>>13,P&=8191;let Q=I+y*m+z*l+A*k+B*j+C*i;I=Q>>>13,Q&=8191,Q+=D*h+E*g+F*f+5*p*G+5*o*H,I+=Q>>>13,Q&=8191;let R=I+y*o+z*m+A*l+B*k+C*j;I=R>>>13,R&=8191,R+=D*i+E*h+F*g+G*f+5*p*H,I+=R>>>13,R&=8191;let S=I+y*p+z*o+A*m+B*l+C*k;I=S>>>13,S&=8191,S+=D*j+E*i+F*h+G*g+H*f,I+=S>>>13,S&=8191,J=8191&(I=(I=(I<<2)+I|0)+J|0),I>>>=13,K+=I,d[0]=J,d[1]=K,d[2]=L,d[3]=M,d[4]=N,d[5]=O,d[6]=P,d[7]=Q,d[8]=R,d[9]=S}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;ge(c)}update(a){gc(this),gb(a=gg(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){ge(this.h,this.r,this.buffer,this.pad)}digestInto(a){gc(this),function(a,b){gb(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let gv=(z=a=>new gu(a),(h=(a,b)=>z(b).update(gg(a)).digest()).outputLen=(i=z(new Uint8Array(32))).outputLen,h.blockLen=i.blockLen,h.create=a=>z(a),h),gw=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return ga(e),ga(g),f9(f),f9(c),(b,h,i,j,k=0)=>{gb(b),gb(h),gb(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),gb(j),ga(k),k<0||k>=gr)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],o=b.length,p,q;if(32===o)m.push(p=gj(b)),q=go;else if(16===o&&c)(p=new Uint8Array(32)).set(b),p.set(b,16),q=gn,m.push(p);else throw Error(`arx: invalid 32-byte key, got length=${o}`);gq(h)||m.push(h=gj(h));let r=gd(p);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(q,r,gd(h.subarray(0,16)),r),h=h.subarray(16)}let s=16-e;if(s!==h.length)throw Error(`arx: nonce must be ${s} or 16 bytes`);if(12!==s){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=gd(j),l=gq(e)&&gq(f),m=l?gd(e):gs,o=l?gd(f):gs;for(let p=0;p<i;g++){if(a(b,c,d,k,g,h),g>=gr)throw Error("arx: counter overflow");let q=Math.min(64,i-p);if(l&&64===q){let a=p/4;if(p%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)o[c=a+b]=m[c]^k[b];p+=64;continue}for(let a=0,b;a<q;a++)f[b=p+a]=e[b]^j[a];p+=q}}(a,q,r,gd(h),i,j,k,g),ge(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=c[0],u=c[1],v=c[2],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=o,E=p,F=q,G=r,H=s,I=e,J=t,K=u,L=v;for(let a=0;a<f;a+=2)E=E+(I=gp(I^(w=w+A|0),16))|0,w=w+(A=gp(A^E,12))|0,E=E+(I=gp(I^w,8))|0,A=gp(A^E,7),F=F+(J=gp(J^(x=x+B|0),16))|0,x=x+(B=gp(B^F,12))|0,F=F+(J=gp(J^x,8))|0,B=gp(B^F,7),G=G+(K=gp(K^(y=y+C|0),16))|0,y=y+(C=gp(C^G,12))|0,G=G+(K=gp(K^y,8))|0,C=gp(C^G,7),H=H+(L=gp(L^(z=z+D|0),16))|0,z=z+(D=gp(D^H,12))|0,H=H+(L=gp(L^z,8))|0,D=gp(D^H,7),G=G+(L=gp(L^(w=w+B|0),16))|0,w=w+(B=gp(B^G,12))|0,G=G+(L=gp(L^w,8))|0,B=gp(B^G,7),H=H+(I=gp(I^(x=x+C|0),16))|0,x=x+(C=gp(C^H,12))|0,H=H+(I=gp(I^x,8))|0,C=gp(C^H,7),E=E+(J=gp(J^(y=y+D|0),16))|0,y=y+(D=gp(D^E,12))|0,E=E+(J=gp(J^y,8))|0,D=gp(D^E,7),F=F+(K=gp(K^(z=z+A|0),16))|0,z=z+(A=gp(A^F,12))|0,F=F+(K=gp(K^z,8))|0,A=gp(A^F,7);let M=0;d[M++]=g+w|0,d[M++]=h+x|0,d[M++]=i+y|0,d[M++]=j+z|0,d[M++]=k+A|0,d[M++]=l+B|0,d[M++]=m+C|0,d[M++]=o+D|0,d[M++]=p+E|0,d[M++]=q+F|0,d[M++]=r+G|0,d[M++]=s+H|0,d[M++]=e+I|0,d[M++]=t+J|0,d[M++]=u+K|0,d[M++]=v+L|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),gx=new Uint8Array(16),gy=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(gx.subarray(c))},gz=new Uint8Array(32);function gA(a,b,c,d,e){var f,g;let h,i,j=a(b,c,gz),k=gv.create(j);e&&gy(k,e),gy(k,d);let l=(f=d.length,g=e?e.length:0,f9(!0),gi(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),gi(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return ge(j,l),m}let gB=((a,b)=>{function c(d,...e){if(gb(d),!gf)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?gb(b):gb(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&gb(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");gb(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,gb(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(gb(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=gh(f+16,e,!1)).set(d);let g=e.subarray(0,-16);gw(a,b,g,g,1);let h=gA(gw,a,b,g,c);return e.set(h,f),ge(h),e},decrypt(d,e){e=gh(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=gA(gw,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),gw(a,b,e,e,1),ge(h),e}}));class gC extends e1{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,eK(a);const c=e_(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),eO(e)}update(a){return eL(this),this.iHash.update(a),this}digestInto(a){eL(this),eJ(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let gD=(a,b,c)=>new gC(a,b).update(c).digest();gD.create=(a,b)=>new gC(a,b);let gE=Uint8Array.from([0]),gF=Uint8Array.of(),gG=BigInt(0),gH=BigInt(1);function gI(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function gJ(a,b,c=""){let d=eH(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function gK(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function gL(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?gG:BigInt("0x"+a)}function gM(a){return eJ(a),gL(eX(Uint8Array.from(a).reverse()))}function gN(a,b){return eZ(a.toString(16).padStart(2*b,"0"))}function gO(a,b){return gN(a,b).reverse()}function gP(a,b,c){let d;if("string"==typeof b)try{d=eZ(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(eH(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let gQ=a=>"bigint"==typeof a&&gG<=a;function gR(a,b,c,d){if(!(gQ(b)&&gQ(c)&&gQ(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function gS(a){let b;for(b=0;a>gG;a>>=gH,b+=1);return b}let gT=a=>(gH<<BigInt(a))-gH;function gU(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function gV(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let gW=BigInt(0),gX=BigInt(1),gY=BigInt(2),gZ=BigInt(3),g$=BigInt(4),g_=BigInt(5),g0=BigInt(7),g1=BigInt(8),g2=BigInt(9),g3=BigInt(16);function g4(a,b){let c=a%b;return c>=gW?c:b+c}function g5(a,b,c){let d=a;for(;b-- >gW;)d*=d,d%=c;return d}function g6(a,b){if(a===gW)throw Error("invert: expected non-zero number");if(b<=gW)throw Error("invert: expected positive modulus, got "+b);let c=g4(a,b),d=b,e=gW,f=gX;for(;c!==gW;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==gX)throw Error("invert: does not exist");return g4(e,b)}function g7(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function g8(a,b){let c=(a.ORDER+gX)/g$,d=a.pow(b,c);return g7(a,d,b),d}function g9(a,b){let c=(a.ORDER-g_)/g1,d=a.mul(b,gY),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,gY),e),h=a.mul(f,a.sub(g,a.ONE));return g7(a,h,b),h}function ha(a){if(a<gZ)throw Error("sqrt is not defined for small field");let b=a-gX,c=0;for(;b%gY===gW;)b/=gY,c++;let d=gY,e=hf(a);for(;1===hd(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return g8;let f=e.pow(d,b),g=(b+gX)/gY;return function(a,d){if(a.is0(d))return d;if(1!==hd(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=gX<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let hb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function hc(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function hd(a,b){let c=(a.ORDER-gX)/gY,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function he(a,b){void 0!==b&&eI(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function hf(a,b,c=!1,d={}){let e;if(a<=gW)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=he(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:gT(j),ZERO:gW,ONE:gX,allowedLengths:i,create:b=>g4(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return gW<=b&&b<a},is0:a=>a===gW,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&gX)===gX,neg:b=>g4(-b,a),eql:(a,b)=>a===b,sqr:b=>g4(b*b,a),add:(b,c)=>g4(b+c,a),sub:(b,c)=>g4(b-c,a),mul:(b,c)=>g4(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<gW)throw Error("invalid exponent, negatives unsupported");if(c===gW)return a.ONE;if(c===gX)return b;let d=a.ONE,e=b;for(;c>gW;)c&gX&&(d=a.mul(d,e)),e=a.sqr(e),c>>=gX;return d})(l,a,b),div:(b,c)=>g4(b*g6(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>g6(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%g$===gZ?g8:a%g1===g_?g9:a%g3===g2?(c=hf(a),f=(d=ha(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+g0)/g3,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),o=a.cmov(c,d,m);return g7(a,o,b),o}):ha(a)),e(l,b)}),toBytes:a=>c?gO(a,k):gN(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?gM(b):gL(eX(b));if(h&&(e=g4(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>hc(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function hg(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function hh(a){let b=hg(a);return b+Math.ceil(b/2)}let hi=BigInt(0),hj=BigInt(1);function hk(a,b){let c=b.negate();return a?c:b}function hl(a,b){let c=hc(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function hm(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function hn(a,b){hm(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:gT(a),maxNumber:e,shiftBy:BigInt(a)}}function ho(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=hj);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let hp=new WeakMap,hq=new WeakMap;function hr(a){return hq.get(a)||1}function hs(a){if(a!==hi)throw Error("invalid wNAF")}class ht{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>hi;)b&hj&&(c=c.add(d)),d=d.double(),b>>=hj;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=hn(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=hn(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=ho(c,a,f);c=g,i?e=e.add(hk(k,b[l])):d=d.add(hk(j,b[h]))}return hs(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=hn(a,this.bits);for(let a=0;a<e.windows&&c!==hi;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=ho(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return hs(c),d}getPrecomputes(a,b,c){let d=hp.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),hp.set(b,d))),d}cached(a,b,c){let d=hr(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=hr(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){hm(b,this.bits),hq.set(a,b),hp.delete(a)}hasCache(a){return 1!==hr(a)}}function hu(a,b,c){if(!b)return hf(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return gU(b,hb.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),e$("HashToScalar-");let hv=BigInt(0),hw=BigInt(1),hx=BigInt(2),hy=BigInt(1),hz=BigInt(2),hA=BigInt(3),hB=BigInt(5),hC=BigInt(8),hD=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),hE={p:hD,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:hC,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},hF=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(gU(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||e3,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?hx**BigInt(254):hx**BigInt(447),o=m+(g?BigInt(8)*hx**BigInt(251)-hw:BigInt(4)*hx**BigInt(445)-hw)+hw,p=a=>g4(a,b),q=gO(p(k),j);function r(a,c){let f,h=function(a,c){gR("u",a,hv,b),gR("scalar",c,m,o);let d=hw,f=hv,g=a,h=hw,j=hv;for(let b=BigInt(i-1);b>=hv;b--){let e=c>>b&hw;j^=e,({x_2:d,x_3:g}=t(j,d,g)),({x_2:f,x_3:h}=t(j,f,h)),j=e;let i=d+f,k=p(i*i),m=d-f,o=p(m*m),q=k-o,r=g+h,s=p((g-h)*i),u=p(r*m),v=s+u,w=s-u;g=p(v*v),h=p(a*p(w*w)),d=p(k*o),f=p(q*(k+p(l*q)))}return{x_2:d,x_3:g}=t(j,d,g),{x_2:f,x_3:h}=t(j,f,h),p(d*e(f))}((f=gP("u coordinate",c,j),g&&(f[31]&=127),p(gM(f))),gM(d(gP("scalar",a,j))));if(h===hv)throw Error("invalid private or public key received");return gO(p(h),j)}function s(a){return r(a,q)}function t(a,b,c){let d=p(a*(b-c));return{x_2:b=p(b-d),x_3:c=p(c+d)}}let u={secretKey:j,publicKey:j,seed:j},v=(a=h(j))=>(eJ(a,u.seed),a);return{keygen:function(a){let b=v(a);return{secretKey:b,publicKey:s(b)}},getSharedSecret:(a,b)=>r(a,b),getPublicKey:a=>s(a),scalarMult:r,scalarMultBase:s,utils:{randomSecretKey:v,randomPrivateKey:v},GuBytes:q.slice(),lengths:u}}({P:j=hf(hE.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,k,l,m,o,p,q,{pow_p_5_8:r,b2:s}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=g5(f=a*a%hD*a%hD,hz,hD)*f%hD,h=g5(g,hy,hD)*a%hD,i=g5(h,hB,hD)*h%hD,k=g5(i,b,hD)*i%hD,l=g5(k,c,hD)*k%hD,m=g5(l,d,hD)*l%hD,o=g5(m,e,hD)*m%hD,p=g5(o,e,hD)*m%hD,q=g5(p,b,hD)*i%hD,{pow_p_5_8:g5(q,hz,hD)*a%hD,b2:f});return g4(g5(r,hA,j)*s,j)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),hG=(a,b)=>(a+(a>=0?b:-b)/hM)/b;function hH(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function hI(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return gI(c.lowS,"lowS"),gI(c.prehash,"prehash"),void 0!==c.format&&hH(c.format),c}let hJ={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=hJ;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=gK(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?gK(e.length/2|128):"";return gK(a)+f+e+b},decode(a,b){let{Err:c}=hJ,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=hJ;if(a<hK)throw new b("integer: negative integers are not allowed");let c=gK(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=hJ;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return gL(eX(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=hJ,e=gP("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=hJ,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},hK=BigInt(0),hL=BigInt(1),hM=BigInt(2),hN=BigInt(3),hO=BigInt(4);function hP(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=gP("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function hQ(a){return Uint8Array.of(a?2:3)}function hR(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function hS(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:hf(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){eK(b),gU(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||e3,e=c.hmac||((a,...c)=>gD(b,a,e0(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||e3,e=Object.assign(hR(a.Fp,c),{seed:hh(c.ORDER)});function f(a){try{return!!hP(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=hg(b),f=hh(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=g4(c?gM(a):gL(eX(a)),b-gX)+gX;return c?gO(g,e):gN(g,e)}(gJ(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(hP(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=gP("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=hP(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>hP(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),p={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},q="compact";function r(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class s{constructor(a,b,c){this.r=r("r",a),this.s=r("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=q){var c,d;let e,f;if(c=a,hH(d=b),f=o.signature,gJ(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=hJ.toSig(gJ(a));return new s(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new s(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(eZ(a),b)}addRecoveryBit(a){return new s(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*hM<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(e0(hQ((1&i)==0),k)),m=g.inv(j),o=u(gP("msgHash",b)),p=g.create(-o*m),q=g.create(e*m),r=a.BASE.multiplyUnsafe(p).add(l.multiplyUnsafe(q));if(r.is0())throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>h>>hL}toBytes(a=q){if(hH(a),"der"===a)return eZ(hJ.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return e0(Uint8Array.of(this.recovery),b,c)}return e0(b,c)}toHex(a){return eX(this.toBytes(a))}assertValidity(){}static fromCompact(a){return s.fromBytes(gP("sig",a),"compact")}static fromDER(a){return s.fromBytes(gP("sig",a),"der")}normalizeS(){return this.hasHighS()?new s(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return eX(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return eX(this.toBytes("compact"))}}let t=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=gL(eX(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},u=c.bits2int_modN||function(a){return g.create(t(a))},v=gT(i);function w(a){return gR("num < 2^"+i,a,hK,v),g.toBytes(a)}function x(a,c){return gJ(a,void 0,"message"),c?gJ(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=hI(e,p),k=u(b=x(b,i)),l=hP(g,c),m=[w(l),w(k)];if(null!=j&&!1!==j){let a=!0===j?d(o.secretKey):j;m.push(gP("extraEntropy",a))}return{seed:e0(...m),k2sig:function(b){let c=t(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===hK)return;let j=g.create(d*g.create(k+i*l));if(j===hK)return;let m=2*(e.x!==i)|Number(e.y&hL),o=j;return f&&j>h>>hL&&(o=g.neg(j),m^=1),new s(i,o,m)}}}(c=gP("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return e0(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=hI(e,p);if(d=gP("publicKey",d),c=x(gP("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||eH(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new s(a.r,a.s);else if(c){try{b=s.fromBytes(gP("sig",a),"der")}catch(a){if(!(a instanceof hJ.Err))throw a}if(!b)try{b=s.fromBytes(gP("sig",a),"compact")}catch{return!1}}return b||!1}(b):s.fromBytes(gP("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=u(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),o=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!o.is0()&&g.create(o.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=hI(c,p);return b=x(b,d),s.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:s,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>hi))throw Error(`CURVE.${a} must be positive bigint`)}let e=hu(b.p,c.Fp,d),f=hu(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;gU(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=hR(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(gI(c,"isCompressed"),c)?(k(),e0(hQ(!d.isOdd(f)),g)):e0(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){gJ(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=o(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!p(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function o(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function p(a,b){let c=d.sqr(b),e=o(a);return d.eql(c,e)}if(!p(f.Gx,f.Gy))throw Error("bad curve params: generator point");let q=d.mul(d.pow(f.a,hN),hO),r=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(q,r)))throw Error("bad curve params: a or b");function s(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function t(a){if(!(a instanceof y))throw Error("ProjectivePoint expected")}function u(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=hG(g*a,c),i=hG(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<hK,m=k<hK;l&&(j=-j),m&&(k=-k);let o=gT(Math.ceil(gS(c)/2))+hL;if(j<hK||j>=o||k<hK||k>=o)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let v=gV((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),w=gV(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!p(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function x(a,b,c,e,f){return c=new y(d.mul(c.X,a),c.Y,c.Z),b=hk(e,b),c=hk(f,c),b.add(c)}class y{constructor(a,b,c){this.X=s("x",a),this.Y=s("y",b,!0),this.Z=s("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof y)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?y.ZERO:new y(b,c,d.ONE)}static fromBytes(a){let b=y.fromAffine(m(gJ(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return y.fromBytes(gP("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return A.createCache(this,a),b||this.multiply(hN),this}assertValidity(){w(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){t(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new y(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,hN),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(e,g);return p=d.add(p,p),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(c,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new y(i,j,k=d.add(k,k))}add(a){t(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,o=d.mul(f.b,hN),p=d.mul(b,g),q=d.mul(c,h),r=d.mul(e,i),s=d.add(b,c),u=d.add(g,h);s=d.mul(s,u),u=d.add(p,q),s=d.sub(s,u),u=d.add(b,e);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(p,r),u=d.sub(u,v),v=d.add(c,e),j=d.add(h,i),v=d.mul(v,j),j=d.add(q,r),v=d.sub(v,j),l=d.mul(m,u),j=d.mul(o,r),l=d.add(j,l),j=d.sub(q,l),l=d.add(q,l),k=d.mul(j,l),q=d.add(p,p),q=d.add(q,p),r=d.mul(m,r),u=d.mul(o,u),q=d.add(q,r),r=d.sub(p,r),r=d.mul(m,r),u=d.add(u,r),p=d.mul(q,u),k=d.add(k,p),p=d.mul(v,u),j=d.mul(s,j),j=d.sub(j,p),p=d.mul(s,q),l=d.mul(v,l),new y(j,k,l=d.add(l,p))}subtract(a){return this.add(a.negate())}is0(){return this.equals(y.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>A.cached(this,a,a=>hl(y,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=u(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=x(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return hl(y,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===hK||this.is0())return y.ZERO;if(a===hL)return this;if(A.hasCache(this))return this.multiply(a);if(!c)return A.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=u(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>hi||d>hi;)c&hj&&(f=f.add(e)),d&hj&&(g=g.add(e)),e=e.double(),c>>=hj,d>>=hj;return{p1:f,p2:g}}(y,this,d,f);return x(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return v(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===hL||(a?a(y,this):A.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===hL?this:a?a(y,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return gI(a,"isCompressed"),this.assertValidity(),l(y,this,a)}toHex(a=!0){return eX(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return hl(y,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=gS(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=gT(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(y,e,a,b)}static fromPrivateKey(a){return y.BASE.multiply(hP(e,a))}}y.BASE=new y(f.Gx,f.Gy,d.ONE),y.ZERO=new y(d.ZERO,d.ONE,d.ZERO),y.Fp=d,y.Fn=e;let z=e.BITS,A=new ht(y,b.endo?Math.ceil(z/2):z);return y.BASE.precompute(8),y}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,he(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let hT={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},hU={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},hV={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},hW=hf(hT.p),hX=hf(hU.p),hY=hf(hV.p),hZ=hS({...hT,Fp:hW,lowS:!1},fA);hS({...hU,Fp:hX,lowS:!1},fC),hS({...hV,Fp:hY,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},fB);let h$="base10",h_="base16",h0="base64pad",h1="base64url",h2="utf8";function h3(){return dL(e3(32),h_)}function h4(a){return dL(fA(dK(a,h_)),h_)}function h5(a){return dL(fA(dK(a,h2)),h_)}function h6(a){return Number(dL(a,h$))}function h7(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function h8(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function h9(a){if(2===h6(a.type))return dL(dE([a.type,a.sealed]),h0);if(1===h6(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return dL(dE([a.type,a.senderPublicKey,a.iv,a.sealed]),h0)}return dL(dE([a.type,a.iv,a.sealed]),h0)}function ia(a){let b=dK((a.encoding||h0)===h1?h8(a.encoded):a.encoded,h0),c=b.slice(0,1);if(1===h6(c)){let a=b.slice(1,33),d=b.slice(33,45);return{type:c,sealed:b.slice(45),iv:d,senderPublicKey:a}}if(2===h6(c))return{type:c,sealed:b.slice(1),iv:e3(12)};let d=b.slice(1,13);return{type:c,sealed:b.slice(13),iv:d}}function ib(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function ic(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function id(a){return a?.relay||{protocol:"irn"}}function ie(a){let b=dM.RELAY_JSONRPC[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var ig=Object.defineProperty,ih=Object.defineProperties,ii=Object.getOwnPropertyDescriptors,ij=Object.getOwnPropertySymbols,ik=Object.prototype.hasOwnProperty,il=Object.prototype.propertyIsEnumerable,im=(a,b,c)=>b in a?ig(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,io=(a,b)=>{for(var c in b||(b={}))ik.call(b,c)&&im(a,c,b[c]);if(ij)for(var c of ij(b))il.call(b,c)&&im(a,c,b[c]);return a};function ip(a){var b;if(!a.includes("wc:")){let b=en(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function iq(a){let b=new URLSearchParams;return Object.entries(io(io(ih(io({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),ii({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}function ir(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var is=Object.defineProperty,it=Object.defineProperties,iu=Object.getOwnPropertyDescriptors,iv=Object.getOwnPropertySymbols,iw=Object.prototype.hasOwnProperty,ix=Object.prototype.propertyIsEnumerable,iy=(a,b,c)=>b in a?is(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,iz=(a,b)=>{for(var c in b||(b={}))iw.call(b,c)&&iy(a,c,b[c]);if(iv)for(var c of iv(b))ix.call(b,c)&&iy(a,c,b[c]);return a},iA=(a,b)=>it(a,iu(b));function iB(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function iC(a){return a.includes(":")}function iD(a){return iC(a)?a.split(":")[0]:a}function iE(a){var b,c,d;let e={};if(!iL(a))return e;for(let[f,g]of Object.entries(a)){let a=iC(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=iD(f);e[j]=iA(iz({},e[j]),{chains:eh(a,null==(b=e[j])?void 0:b.chains),methods:eh(h,null==(c=e[j])?void 0:c.methods),events:eh(i,null==(d=e[j])?void 0:d.events)})}return e}function iF(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=eh(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}let iG={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},iH={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function iI(a,b){let{message:c,code:d}=iH[a];return{message:b?`${c} ${b}`:c,code:d}}function iJ(a,b){let{message:c,code:d}=iG[a];return{message:b?`${c} ${b}`:c,code:d}}function iK(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function iL(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function iM(a){return typeof a>"u"}function iN(a,b){return!!(b&&iM(a))||"string"==typeof a&&!!a.trim().length}function iO(a,b){return!!(b&&iM(a))||"number"==typeof a&&!isNaN(a)}function iP(a){return!!(iN(a,!1)&&a.includes(":"))&&2===a.split(":").length}function iQ(a){let b=!0;return iK(a)?a.length&&(b=a.every(a=>iN(a,!1))):b=!1,b}function iR(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,iQ(a?.methods)?iQ(a?.events)||(e=iJ("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=iJ("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function iS(a,b){let c=null;if(a&&iL(a)){let d,e=iR(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,iK(c)?c.forEach(a=>{f||function(a){if(iN(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&iP(a)}}return!1}(a)||(f=iJ("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=iJ("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=iI("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function iT(a){return iN(a.protocol,!0)}function iU(a){return"u">typeof a}function iV(a,b){let c;return!(!iP(b)||!(c=[],Object.values(a).forEach(a=>{c.push(...iB(a.accounts))}),c).includes(b))}function iW(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=iB(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=iX(Object.keys(a)),o=iX(Object.keys(b)),p=m.filter(a=>!o.includes(a));return p.length&&(h=iI("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${p.toString()}
      Received: ${Object.keys(b).toString()}`)),d7(k,l)||(h=iI("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=iB(b[a].accounts);d.includes(a)||(h=iI("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(d7(i[a].methods,j[a].methods)?d7(i[a].events,j[a].events)||(h=iI("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=iI("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function iX(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function iY(){let a=d3();return new Promise(b=>{switch(a){case d_:b(d2()&&navigator?.onLine);break;case dZ:b(iZ());break;default:b(!0)}})}async function iZ(){if(d1()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}let i$={};class i_{static get(a){return i$[a]}static set(a,b){i$[a]=b}static delete(a){delete i$[a]}}function i0(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function i1({logger:a,name:b}){let c="string"==typeof a?aG({opts:{level:a,name:b}}).logger:a;return c.level="string"==typeof a?a:a.level,c}var i2=a.i(26354);a.i(446105);var i3=a.i(221810),i4=a.i(619684),i5=a.i(552612);let i6="core",i7=`wc@2:${i6}:`,i8={database:":memory:"},i9="client_ed25519_seed",ja=a$.ONE_DAY,jb=a$.SIX_HOURS,jc="wss://relay.walletconnect.org",jd="relayer_message",je="relayer_message_ack",jf="relayer_connection_stalled",jg="relayer_publish",jh="payload",ji="connect",jj="disconnect",jk="error",jl="2.22.4",jm="link_mode",jn="relay",jo="inbound",jp="WALLETCONNECT_LINK_MODE_APPS",jq="subscription_created",jr="subscription_deleted",js=(a$.THIRTY_DAYS,a$.FIVE_SECONDS,a$.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:a$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:a$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:a$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:0},res:{ttl:a$.ONE_DAY,prompt:!1,tag:0}}}),jt="pairing_create",ju="pairing_delete",jv="history_created",jw="history_updated",jx="history_deleted",jy="expirer_created",jz="expirer_deleted",jA="expirer_expired",jB=(a$.ONE_DAY,"https://verify.walletconnect.org"),jC=`${jB}/v3`,jD=["https://verify.walletconnect.com",jB],jE="malformed_pairing_uri",jF="session_approve_started";var jG=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let jH=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class jI{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class jJ{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return jL(this,a)}}class jK{constructor(a){this.decoders=a}or(a){return jL(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let jL=(a,b)=>new jK({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class jM{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new jI(a,b,c),this.decoder=new jJ(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let jN=({name:a,prefix:b,encode:c,decode:d})=>new jM(a,b,c,d),jO=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=jG(c,b);return jN({prefix:a,name:b,encode:d,decode:a=>jH(e(a))})},jP=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>jN({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var jQ=Object.freeze({__proto__:null,identity:jN({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),jR=Object.freeze({__proto__:null,base2:jP({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),jS=Object.freeze({__proto__:null,base8:jP({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),jT=Object.freeze({__proto__:null,base10:jO({prefix:"9",name:"base10",alphabet:"0123456789"})}),jU=Object.freeze({__proto__:null,base16:jP({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:jP({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),jV=Object.freeze({__proto__:null,base32:jP({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:jP({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:jP({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:jP({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:jP({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:jP({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:jP({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:jP({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:jP({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),jW=Object.freeze({__proto__:null,base36:jO({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:jO({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),jX=Object.freeze({__proto__:null,base58btc:jO({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:jO({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),jY=Object.freeze({__proto__:null,base64:jP({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:jP({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:jP({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:jP({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let jZ=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),j$=jZ.reduce((a,b,c)=>(a[c]=b,a),[]),j_=jZ.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var j0=Object.freeze({__proto__:null,base256emoji:jN({prefix:"ðŸš€",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=j$[b],"")},decode:function(a){let b=[];for(let c of a){let a=j_[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function j1(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,j1.bytes=c-d+1,b}var j2=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let j3=(a,b,c=0)=>(j1(a,b,c),b),j4=(a,b)=>{let c=b.byteLength,d=j2(a),e=d+j2(c),f=new Uint8Array(e+c);return j3(a,f,0),j3(c,f,d),f.set(b,e),new j5(a,c,b,f)};class j5{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let j6=({name:a,code:b,encode:c})=>new j7(a,b,c);class j7{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?j4(this.code,b):b.then(a=>j4(this.code,a))}throw Error("Unknown type, must be binary type")}}let j8=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var j9=Object.freeze({__proto__:null,sha256:j6({name:"sha2-256",code:18,encode:j8("SHA-256")}),sha512:j6({name:"sha2-512",code:19,encode:j8("SHA-512")})}),ka=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:jH,digest:a=>j4(0,jH(a))}});new TextEncoder,new TextDecoder;let kb={...jQ,...jR,...jS,...jT,...jU,...jV,...jW,...jX,...jY,...j0};function kc(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function kd(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...j9,...ka});let ke=kd("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),kf=kd("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?kc(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),kg={utf8:ke,"utf-8":ke,hex:kb.base16,latin1:kf,ascii:kf,binary:kf,...kb};var kh=Object.defineProperty,ki=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?kh(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class kj{constructor(a,b){this.core=a,this.logger=b,ki(this,"keychain",new Map),ki(this,"name","keychain"),ki(this,"version","0.3"),ki(this,"initialized",!1),ki(this,"storagePrefix",i7),ki(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),ki(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),ki(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),ki(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=iI("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),ki(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=aF(b,this.name)}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,d8(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?d9(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var kk=Object.defineProperty,kl=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?kk(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class km{constructor(a,b,c){this.core=a,this.logger=b,kl(this,"name","crypto"),kl(this,"keychain"),kl(this,"randomSessionIdentifier",h3()),kl(this,"initialized",!1),kl(this,"clientId"),kl(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),kl(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),kl(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let a=await this.getClientSeed(),b=a_.generateKeyPair(a),c=a_.encodeIss(b.publicKey);return this.clientId=c,c}),kl(this,"generateKeyPair",()=>{let a,b;this.isInitialized();let c=(a=hF.utils.randomPrivateKey(),b=hF.getPublicKey(a),{privateKey:dL(a,h_),publicKey:dL(b,h_)});return this.setPrivateKey(c.publicKey,c.privateKey)}),kl(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=a_.generateKeyPair(b),d=this.randomSessionIdentifier;return await a_.signJWT(d,a,ja,c)}),kl(this,"generateSharedKey",(a,b,c)=>{var d,e,f;let g;this.isInitialized();let h=(d=this.getPrivateKey(a),dL((g=hF.getSharedSecret(dK(d,h_),dK(b,h_)),e=void 0,function(a,b,c,d=32){eK(a),eI(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=gF);let g=new Uint8Array(f*e),h=gD.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)gE[0]=a+1,i.update(0===a?gF:j).update(c).update(gE).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),eO(j,gE),g.slice(0,d)}(fA,(f=void 0,eK(fA),void 0===f&&(f=new Uint8Array(fA.outputLen)),gD(fA,e_(f),e_(g))),e,32)),h_));return this.setSymKey(h,c)}),kl(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||h4(a);return await this.keychain.set(c,a),c}),kl(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),kl(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),kl(this,"encode",async(a,b,c)=>{this.isInitialized();let d=ib(c),e=(0,al.safeJsonStringify)(b);if(2===d.type){var f;let a,b,d;return f=c?.encoding,a=dK("2",h$),b=e3(12),d=h9({type:a,sealed:dK(e,h2),iv:b}),f===h1?h7(d):d}if(ic(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let g=this.getSymKey(a),{type:h,senderPublicKey:i}=d;return function(a){var b;let c=(b="u">typeof a.type?a.type:0,dK(`${b}`,h$));if(1===h6(c)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let d="u">typeof a.senderPublicKey?dK(a.senderPublicKey,h_):void 0,e="u">typeof a.iv?dK(a.iv,h_):e3(12),f=h9({type:c,sealed:gB(dK(a.symKey,h_),e).encrypt(dK(a.message,h2)),iv:e,senderPublicKey:d});return a.encoding===h1?h7(f):f}({type:h,symKey:g,message:e,senderPublicKey:i,encoding:c?.encoding})}),kl(this,"decode",async(a,b,c)=>{let d;this.isInitialized();let e=ib({type:h6((d=ia({encoded:b,encoding:c?.encoding})).type),senderPublicKey:"u">typeof d.senderPublicKey?dL(d.senderPublicKey,h_):void 0,receiverPublicKey:c?.receiverPublicKey});if(2===e.type){let a=function(a,b){let{sealed:c}=ia({encoded:a,encoding:b});return dL(c,h2)}(b,c?.encoding);return(0,al.safeJsonParse)(a)}if(ic(e)){let b=e.receiverPublicKey,c=e.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=dK(a.symKey,h_),{sealed:c,iv:d}=ia({encoded:a.encoded,encoding:a.encoding}),e=gB(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return dL(e,h2)}({symKey:d,encoded:b,encoding:c?.encoding});return(0,al.safeJsonParse)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),kl(this,"getPayloadType",(a,b=h0)=>h6(ia({encoded:a,encoding:b}).type)),kl(this,"getPayloadSenderPublicKey",(a,b=h0)=>{let c=ia({encoded:a,encoding:b});return c.senderPublicKey?dL(c.senderPublicKey,h_):void 0}),this.core=a,this.logger=aF(b,this.name),this.keychain=c||new kj(this.core,this.logger)}get context(){return aE(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(i9)}catch{a=h3(),await this.keychain.set(i9,a)}return function(a,b="utf8"){let c=kg[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?kc(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var kn=Object.defineProperty,ko=Object.defineProperties,kp=Object.getOwnPropertyDescriptors,kq=Object.getOwnPropertySymbols,kr=Object.prototype.hasOwnProperty,ks=Object.prototype.propertyIsEnumerable,kt=(a,b,c)=>b in a?kn(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,ku=(a,b,c)=>kt(a,"symbol"!=typeof b?b+"":b,c);class kv extends aN{constructor(a,b){super(a,b),this.logger=a,this.core=b,ku(this,"messages",new Map),ku(this,"messagesWithoutClientAck",new Map),ku(this,"name","messages"),ku(this,"version","0.3"),ku(this,"initialized",!1),ku(this,"storagePrefix",i7),ku(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),ku(this,"set",async(a,b,c)=>{this.isInitialized();let d=h5(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===jo){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,ko(((a,b)=>{for(var c in b||(b={}))kr.call(b,c)&&kt(a,c,b[c]);if(kq)for(var c of kq(b))ks.call(b,c)&&kt(a,c,b[c]);return a})({},c),kp({[d]:b})))}return await this.persist(),d}),ku(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),ku(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),ku(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[h5(b)])),ku(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=h5(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),ku(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=aF(a,this.name),this.core=b}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,d8(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,d8(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?d9(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?d9(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var kw=Object.defineProperty,kx=Object.defineProperties,ky=Object.getOwnPropertyDescriptors,kz=Object.getOwnPropertySymbols,kA=Object.prototype.hasOwnProperty,kB=Object.prototype.propertyIsEnumerable,kC=(a,b,c)=>b in a?kw(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kD=(a,b)=>{for(var c in b||(b={}))kA.call(b,c)&&kC(a,c,b[c]);if(kz)for(var c of kz(b))kB.call(b,c)&&kC(a,c,b[c]);return a},kE=(a,b,c)=>kC(a,"symbol"!=typeof b?b+"":b,c);class kF extends aO{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,kE(this,"events",new ah.EventEmitter),kE(this,"name","publisher"),kE(this,"queue",new Map),kE(this,"publishTimeout",(0,a$.toMiliseconds)(a$.ONE_MINUTE)),kE(this,"initialPublishTimeout",(0,a$.toMiliseconds)(15*a$.ONE_SECOND)),kE(this,"needsTransportRestart",!1),kE(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||jb,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||(0,i3.getBigIntRpcId)().toString(),m=ie(id().protocol),o={id:l,method:c?.publishMethod||m.publish,params:kD({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf)},p=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{iM(null==(d=o.params)?void 0:d.prompt)&&(null==(e=o.params)||delete e.prompt),iM(null==(f=o.params)?void 0:f.tag)&&(null==(g=o.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=o.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(jg,b),a())};this.relayer.events.on(jg,b);let d=eb(new Promise((a,b)=>{this.rpcPublish(o,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(jg,b)}catch(a){this.queue.set(l,{request:o,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await eb(h,this.publishTimeout,p)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),kE(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:o=a$.FIVE_MINUTES}=h,p=h.id||(0,i3.getBigIntRpcId)().toString(),q=ie(id().protocol),r=k||q.publish,s={id:p,method:r,params:kD(kx(kD({},g),ky({ttl:o,prompt:l,tag:m,attestation:i})),j)},t=`Failed to publish custom payload, please try again. id:${p} tag:${m}`;try{iM(null==(b=s.params)?void 0:b.prompt)&&(null==(c=s.params)||delete c.prompt),iM(null==(d=s.params)?void 0:d.tag)&&(null==(e=s.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=s.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(jg,b),a())};this.relayer.events.on(jg,b);let c=eb(new Promise((a,b)=>{this.rpcPublish(s,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${r} id:${p} tag:${m}`);try{await c,this.events.removeListener(jg,b)}catch(a){this.queue.set(p,{request:s,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,payload:g,opts:h}}),await eb(a,this.publishTimeout,t)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(p)}}),kE(this,"on",(a,b)=>{this.events.on(a,b)}),kE(this,"once",(a,b)=>{this.events.once(a,b)}),kE(this,"off",(a,b)=>{this.events.off(a,b)}),kE(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=aF(b,this.name),this.registerEventListeners()}get context(){return aE(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(jg,kD(kD({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,kx(kD({},a),ky({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(jf);return}this.checkQueue()}),this.relayer.on(je,a=>{this.removeRequestFromQueue(a.id.toString())})}}var kG=Object.defineProperty,kH=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?kG(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class kI{constructor(){kH(this,"map",new Map),kH(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),kH(this,"get",a=>this.map.get(a)||[]),kH(this,"exists",(a,b)=>this.get(a).includes(b)),kH(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),kH(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var kJ=Object.defineProperty,kK=Object.defineProperties,kL=Object.getOwnPropertyDescriptors,kM=Object.getOwnPropertySymbols,kN=Object.prototype.hasOwnProperty,kO=Object.prototype.propertyIsEnumerable,kP=(a,b,c)=>b in a?kJ(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kQ=(a,b)=>{for(var c in b||(b={}))kN.call(b,c)&&kP(a,c,b[c]);if(kM)for(var c of kM(b))kO.call(b,c)&&kP(a,c,b[c]);return a},kR=(a,b,c)=>kP(a,"symbol"!=typeof b?b+"":b,c);class kS extends aR{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,kR(this,"subscriptions",new Map),kR(this,"topicMap",new kI),kR(this,"events",new ah.EventEmitter),kR(this,"name","subscription"),kR(this,"version","0.3"),kR(this,"pending",new Map),kR(this,"cached",[]),kR(this,"initialized",!1),kR(this,"storagePrefix",i7),kR(this,"subscribeTimeout",(0,a$.toMiliseconds)(a$.ONE_MINUTE)),kR(this,"initialSubscribeTimeout",(0,a$.toMiliseconds)(15*a$.ONE_SECOND)),kR(this,"clientId"),kR(this,"batchSubscribeTopicsLimit",500),kR(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),kR(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=id(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),kR(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),kR(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),kR(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),kR(this,"on",(a,b)=>{this.events.on(a,b)}),kR(this,"once",(a,b)=>{this.events.once(a,b)}),kR(this,"off",(a,b)=>{this.events.off(a,b)}),kR(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),kR(this,"start",async()=>{await this.onConnect()}),kR(this,"stop",async()=>{await this.onDisconnect()}),kR(this,"restart",async()=>{await this.restore(),await this.onRestart()}),kR(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),kR(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(jq,async a=>{this.logger.info(`Emitting ${jq}`),this.logger.debug({type:"event",event:jq,data:a}),await this.persist()}),this.events.on(jr,async a=>{this.logger.info(`Emitting ${jr}`),this.logger.debug({type:"event",event:jr,data:a}),await this.persist()})}),this.relayer=a,this.logger=aF(b,this.name),this.clientId=""}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=id(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=iJ("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==jn||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:ie(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===jm)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,a$.toMiliseconds)(a$.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(jq,c),b(d.id))};this.events.on(jq,c);try{let d=await eb(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(jq,c),b(d)}catch{}}),d=await eb(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(jf),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:ie(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await eb(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(jf)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:ie(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await eb(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(jf)}return b}rpcUnsubscribe(a,b,c){let d={method:ie(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,kK(kQ({},b),kL({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,kQ({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,kQ({},b)),this.topicMap.set(b.topic,a),this.events.emit(jq,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=iI("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(jr,kK(kQ({},c),kL({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=iI("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>kK(kQ({},a),kL({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,a$.toMiliseconds)(a$.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return h5(a+await this.getClientId())}}var kT=Object.defineProperty,kU=Object.getOwnPropertySymbols,kV=Object.prototype.hasOwnProperty,kW=Object.prototype.propertyIsEnumerable,kX=(a,b,c)=>b in a?kT(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,kY=(a,b)=>{for(var c in b||(b={}))kV.call(b,c)&&kX(a,c,b[c]);if(kU)for(var c of kU(b))kW.call(b,c)&&kX(a,c,b[c]);return a},kZ=(a,b,c)=>kX(a,"symbol"!=typeof b?b+"":b,c);class k$ extends aP{constructor(b){var c;super(b),kZ(this,"protocol","wc"),kZ(this,"version",2),kZ(this,"core"),kZ(this,"logger"),kZ(this,"events",new ah.EventEmitter),kZ(this,"provider"),kZ(this,"messages"),kZ(this,"subscriber"),kZ(this,"publisher"),kZ(this,"name","relayer"),kZ(this,"transportExplicitlyClosed",!1),kZ(this,"initialized",!1),kZ(this,"connectionAttemptInProgress",!1),kZ(this,"relayUrl"),kZ(this,"projectId"),kZ(this,"packageName"),kZ(this,"bundleId"),kZ(this,"hasExperiencedNetworkDisruption",!1),kZ(this,"pingTimeout"),kZ(this,"heartBeatTimeout",(0,a$.toMiliseconds)(a$.THIRTY_SECONDS+a$.FIVE_SECONDS)),kZ(this,"reconnectTimeout"),kZ(this,"connectPromise"),kZ(this,"reconnectInProgress",!1),kZ(this,"requestsInFlight",[]),kZ(this,"connectTimeout",(0,a$.toMiliseconds)(15*a$.ONE_SECOND)),kZ(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||(0,i3.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),kZ(this,"resetPingTimeout",()=>{d0()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),kZ(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),kZ(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected ðŸ›œ"),this.startPingTimeout(),this.events.emit("relayer_connect")}),kZ(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected ðŸ›‘"),this.requestsInFlight=[],this.onProviderDisconnect()}),kZ(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),kZ(this,"registerProviderListeners",()=>{this.provider.on(jh,this.onPayloadHandler),this.provider.on(ji,this.onConnectHandler),this.provider.on(jj,this.onDisconnectHandler),this.provider.on(jk,this.onProviderErrorHandler)}),this.core=b.core,this.logger=i1({logger:null!=(c=b.logger)?c:"error",name:this.name}),this.messages=new kv(this.logger,b.core),this.subscriber=new kS(this,this.logger),this.publisher=new kF(this,this.logger),this.projectId=b?.projectId,this.relayUrl=b?.relayUrl||jc,d1()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"?this.packageName=d4():d1()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"&&(this.bundleId=d4()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return aE(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:jn},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(jq,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(jq,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,kY({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await eb(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await iY())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=ee(a$.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(jd,a),await this.recordMessageEvent(a,jo)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(jj,c),await eb(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(jj,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(jj,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(jj,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,a$.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(d0())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new i2.JsonRpcProvider(new i5.default(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),o=d6(a,b,d),p=(j=m[1]||"",k={auth:e,ua:o,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+p}({sdkVersion:jl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),(0,i4.isJsonRpcRequest)(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:jn,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(kY({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else(0,i4.isJsonRpcResponse)(a)&&this.events.emit(je,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,jo),this.events.emit(jd,a))}async acknowledgePayload(a){let b=(0,i3.formatJsonRpcResult)(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(jh,this.onPayloadHandler),this.provider.off(ji,this.onConnectHandler),this.provider.off(jj,this.onDisconnectHandler),this.provider.off(jk,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let b=await iY();(function(b){var c,d;switch(d3()){case d_:c=b,!d1()&&d2()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case dZ:d=b,d1()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}})(async a=>{b!==a&&(b=a,a?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(d2()&&(0,a1.getDocument)())||(null==(a=(0,a1.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,a$.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function k_(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function k0(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let k1="[object Arguments]",k2="[object Object]";function k3(){}function k4(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var k5=Object.defineProperty,k6=Object.getOwnPropertySymbols,k7=Object.prototype.hasOwnProperty,k8=Object.prototype.propertyIsEnumerable,k9=(a,b,c)=>b in a?k5(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,la=(a,b)=>{for(var c in b||(b={}))k7.call(b,c)&&k9(a,c,b[c]);if(k6)for(var c of k6(b))k8.call(b,c)&&k9(a,c,b[c]);return a},lb=(a,b,c)=>k9(a,"symbol"!=typeof b?b+"":b,c);class lc extends aQ{constructor(a,b,c,d=i7,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,lb(this,"map",new Map),lb(this,"version","0.3"),lb(this,"cached",[]),lb(this,"initialized",!1),lb(this,"getKey"),lb(this,"storagePrefix",i7),lb(this,"recentlyDeleted",[]),lb(this,"recentlyDeletedLimit",200),lb(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{var b;this.getKey&&null!==a&&!iM(a)?this.map.set(this.getKey(a),a):(null==(b=a?.proposer)?void 0:b.publicKey)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),lb(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),lb(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),lb(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=k0(c),h=k0(d);if(g===k1&&(g=k2),h===k1&&(h=k2),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case k2:{if(!(b(c.constructor,d.constructor,e,f)||k4(c)&&k4(d)))return!1;let g=[...Object.keys(c),...k_(c)],h=[...Object.keys(d),...k_(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,k3)})):this.values)),lb(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=la(la({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),lb(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=aF(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=iI("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=iI("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=iI("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var ld=Object.defineProperty,le=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ld(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class lf{constructor(a,b){this.core=a,this.logger=b,le(this,"name","pairing"),le(this,"version","0.3"),le(this,"events",new ah.default),le(this,"pairings"),le(this,"initialized",!1),le(this,"storagePrefix",i7),le(this,"ignoredPayloadTypes",[1]),le(this,"registeredMethods",[]),le(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),le(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),le(this,"create",async a=>{this.isInitialized();let b=h3(),c=await this.core.crypto.setSymKey(b),d=ee(a$.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=iq({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(jt,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),le(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=ip(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||ee(a$.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(jt,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),le(this,"activate",async({topic:a})=>{this.isInitialized();let b=ee(a$.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),le(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=ea();this.events.once(eg("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),le(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),le(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),le(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),le(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",iJ("USER_DISCONNECTED")),await this.deletePairing(b))}),le(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return iq({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),le(this,"sendRequest",async(a,b,c)=>{let d=(0,i3.formatJsonRpcRequest)(b,c),e=await this.core.crypto.encode(a,d),f=js[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),le(this,"sendResult",async(a,b,c)=>{let d=(0,i3.formatJsonRpcResult)(a,c),e=await this.core.crypto.encode(b,d),f=js[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),le(this,"sendError",async(a,b,c)=>{let d=(0,i3.formatJsonRpcError)(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=js[f]?js[f].res:js.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),le(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,iJ("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),le(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>ef(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),le(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),le(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),le(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),le(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("pairing_ping",c),{}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("pairing_ping",c),{error:b.error})},500)}),le(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(ju,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),le(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=iJ("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),le(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(iJ("WC_METHOD_UNSUPPORTED",a))}),le(this,"isValidPair",(a,b)=>{var c;if(!iU(a)){let{message:c}=iI("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(jE),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(iN(a,!1)){if(b(a))return!0;let c=en(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=iI("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(jE),Error(c)}let d=ip(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=iI("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(jE),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=iI("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(jE),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,a$.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=iI("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),le(this,"isValidPing",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),le(this,"isValidDisconnect",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),le(this,"isValidPairingTopic",async a=>{if(!iN(a,!1)){let{message:b}=iI("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=iI("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(ef(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=iI("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=aF(b,this.name),this.pairings=new lc(this.core,this.logger,this.name,this.storagePrefix)}get context(){return aE(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(jd,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==jm&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);(0,i4.isJsonRpcRequest)(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):(0,i4.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(jA,async a=>{let{topic:b}=ed(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var lg=Object.defineProperty,lh=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?lg(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class li extends aM{constructor(a,b){super(a,b),this.core=a,this.logger=b,lh(this,"records",new Map),lh(this,"events",new ah.EventEmitter),lh(this,"name","history"),lh(this,"version","0.3"),lh(this,"cached",[]),lh(this,"initialized",!1),lh(this,"storagePrefix",i7),lh(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),lh(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:ee(a$.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(jv,d)}),lh(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=(0,i4.isJsonRpcError)(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(jw,b))}),lh(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),lh(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(jx,c)))}),this.persist()}),lh(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),lh(this,"on",(a,b)=>{this.events.on(a,b)}),lh(this,"once",(a,b)=>{this.events.once(a,b)}),lh(this,"off",(a,b)=>{this.events.off(a,b)}),lh(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=aF(b,this.name)}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:(0,i3.formatJsonRpcRequest)(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=iI("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=iI("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(jv,a=>{this.logger.info(`Emitting ${jv}`),this.logger.debug({type:"event",event:jv,record:a})}),this.events.on(jw,a=>{this.logger.info(`Emitting ${jw}`),this.logger.debug({type:"event",event:jw,record:a})}),this.events.on(jx,a=>{this.logger.info(`Emitting ${jx}`),this.logger.debug({type:"event",event:jx,record:a})}),this.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,a$.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(jx,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var lj=Object.defineProperty,lk=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?lj(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class ll extends aS{constructor(a,b){super(a,b),this.core=a,this.logger=b,lk(this,"expirations",new Map),lk(this,"events",new ah.EventEmitter),lk(this,"name","expirer"),lk(this,"version","0.3"),lk(this,"cached",[]),lk(this,"initialized",!1),lk(this,"storagePrefix",i7),lk(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),lk(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),lk(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(jy,{target:c,expiration:d})}),lk(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),lk(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(jz,{target:b,expiration:c})}}),lk(this,"on",(a,b)=>{this.events.on(a,b)}),lk(this,"once",(a,b)=>{this.events.once(a,b)}),lk(this,"off",(a,b)=>{this.events.off(a,b)}),lk(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=aF(b,this.name)}get context(){return aE(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return ec("topic",a);if("number"==typeof a)return ec("id",a);let{message:b}=iI("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=iI("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=iI("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,a$.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(jA,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(jy,a=>{this.logger.info(`Emitting ${jy}`),this.logger.debug({type:"event",event:jy,data:a}),this.persist()}),this.events.on(jA,a=>{this.logger.info(`Emitting ${jA}`),this.logger.debug({type:"event",event:jA,data:a}),this.persist()}),this.events.on(jz,a=>{this.logger.info(`Emitting ${jz}`),this.logger.debug({type:"event",event:jz,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}}var lm=Object.defineProperty,ln=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?lm(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class lo extends aT{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,ln(this,"name","verify-api"),ln(this,"abortController"),ln(this,"isDevEnv"),ln(this,"verifyUrlV3",jC),ln(this,"storagePrefix",i7),ln(this,"version",2),ln(this,"publicKey"),ln(this,"fetchPromise"),ln(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,a$.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ln(this,"register",async a=>{if(!d2()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,a1.getDocument)(),b=this.startAbortTimer(5*a$.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,a_.decodeJWT)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(a){this.logger.warn(a)}return""}),ln(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,a_.decodeJWT)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),ln(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*a$.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),ln(this,"getVerifyUrl",a=>{let b=a||jB;return jD.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${jB}`),b=jB),b}),ln(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(a$.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),ln(this,"persistPublicKey",async a=>{this.logger.debug(a,"persisting public key to local storage"),await this.store.setItem(this.storeKey,a),this.publicKey=a}),ln(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ln(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ln(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ln(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),ln(this,"validateAttestation",(a,b)=>{let c=function(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(h8(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=fA(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),dE([new Uint8Array([4]),c,d]));if(!hZ.verify(dE([i,j]),k,l))throw Error("Invalid signature");return(0,a_.decodeJWT)(a).payload}(a,b.publicKey),d={hasExpired:(0,a$.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=aF(b,this.name),this.abortController=new AbortController,this.isDevEnv=em(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return aE(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,a$.toMiliseconds)(a))}}var lp=Object.defineProperty,lq=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?lp(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class lr extends aU{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,lq(this,"context","echo"),lq(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=aF(b,this.context)}}var ls=Object.defineProperty,lt=Object.getOwnPropertySymbols,lu=Object.prototype.hasOwnProperty,lv=Object.prototype.propertyIsEnumerable,lw=(a,b,c)=>b in a?ls(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lx=(a,b)=>{for(var c in b||(b={}))lu.call(b,c)&&lw(a,c,b[c]);if(lt)for(var c of lt(b))lv.call(b,c)&&lw(a,c,b[c]);return a},ly=(a,b,c)=>lw(a,"symbol"!=typeof b?b+"":b,c);class lz extends aV{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,ly(this,"context","event-client"),ly(this,"storagePrefix",i7),ly(this,"storageVersion",.1),ly(this,"events",new Map),ly(this,"shouldPersist",!1),ly(this,"init",async()=>{if(!em())try{let a={eventId:el(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:d6(this.core.relayer.protocol,this.core.relayer.version,jl)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),ly(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=el(),g=this.core.projectId||"",h=lx({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),ly(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return lx(lx({},d),this.setMethods(d.eventId))}),ly(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),ly(this,"setEventListeners",()=>{this.core.heartbeat.on(ai.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,a$.fromMiliseconds)(Date.now())-(0,a$.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),ly(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),ly(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),ly(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),ly(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),ly(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,lx(lx({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),ly(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),ly(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${jl}${b}`,{method:"POST",body:JSON.stringify(a)})}),ly(this,"getAppDomain",()=>d5().url),this.logger=aF(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var lA=Object.defineProperty,lB=Object.getOwnPropertySymbols,lC=Object.prototype.hasOwnProperty,lD=Object.prototype.propertyIsEnumerable,lE=(a,b,c)=>b in a?lA(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lF=(a,b)=>{for(var c in b||(b={}))lC.call(b,c)&&lE(a,c,b[c]);if(lB)for(var c of lB(b))lD.call(b,c)&&lE(a,c,b[c]);return a},lG=(a,b,c)=>lE(a,"symbol"!=typeof b?b+"":b,c);class lH extends aK{constructor(a){var b;super(a),lG(this,"protocol","wc"),lG(this,"version",2),lG(this,"name",i6),lG(this,"relayUrl"),lG(this,"projectId"),lG(this,"customStoragePrefix"),lG(this,"events",new ah.EventEmitter),lG(this,"logger"),lG(this,"heartbeat"),lG(this,"relayer"),lG(this,"crypto"),lG(this,"storage"),lG(this,"history"),lG(this,"expirer"),lG(this,"pairing"),lG(this,"verify"),lG(this,"echoClient"),lG(this,"linkModeSupportedApps"),lG(this,"eventClient"),lG(this,"initialized",!1),lG(this,"logChunkController"),lG(this,"on",(a,b)=>this.events.on(a,b)),lG(this,"once",(a,b)=>this.events.once(a,b)),lG(this,"off",(a,b)=>this.events.off(a,b)),lG(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),lG(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:jm};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||jc,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=aG({opts:function(a){return ax(aD({},a),ay({level:a?.level||"info"}))}({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:i6}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=aF(d,this.name),this.heartbeat=new ai.HeartBeat,this.crypto=new km(this,this.logger,a?.keychain),this.history=new li(this,this.logger),this.expirer=new ll(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new aj.default(lF(lF({},i8),a?.storageOptions)),this.relayer=new k$({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new lf(this,this.logger),this.verify=new lo(this,this.logger,this.storage),this.echoClient=new lr(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new lz(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new lH(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return aE(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(jp,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(jp)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(a,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let lI="client",lJ=`wc@2:${lI}:`,lK="WALLETCONNECT_DEEPLINK_CHOICE",lL=(a$.THIRTY_DAYS,"Proposal expired"),lM=a$.SEVEN_DAYS,lN={wc_sessionPropose:{req:{ttl:a$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:a$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:a$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:a$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:a$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:a$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:a$.ONE_DAY,prompt:!1,tag:1114},res:{ttl:a$.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:a$.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:a$.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:a$.FIVE_MINUTES,prompt:!1,tag:1119}}},lO={min:a$.FIVE_MINUTES,max:a$.SEVEN_DAYS},lP="IDLE",lQ="ACTIVE",lR={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},lS=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],lT="wc@1.5:auth:",lU=`${lT}:PUB_KEY`;var lV=Object.defineProperty,lW=Object.defineProperties,lX=Object.getOwnPropertyDescriptors,lY=Object.getOwnPropertySymbols,lZ=Object.prototype.hasOwnProperty,l$=Object.prototype.propertyIsEnumerable,l_=(a,b,c)=>b in a?lV(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,l0=(a,b)=>{for(var c in b||(b={}))lZ.call(b,c)&&l_(a,c,b[c]);if(lY)for(var c of lY(b))l$.call(b,c)&&l_(a,c,b[c]);return a},l1=(a,b,c)=>l_(a,"symbol"!=typeof b?b+"":b,c);class l2 extends aZ{constructor(b){super(b),l1(this,"name","engine"),l1(this,"events",new ah.default),l1(this,"initialized",!1),l1(this,"requestQueue",{state:lP,queue:[]}),l1(this,"sessionRequestQueue",{state:lP,queue:[]}),l1(this,"emittedSessionRequests",new eo({limit:500})),l1(this,"requestQueueDelay",a$.ONE_SECOND),l1(this,"expectedPairingMethodMap",new Map),l1(this,"recentlyDeletedMap",new Map),l1(this,"recentlyDeletedLimit",200),l1(this,"relayMessageCache",[]),l1(this,"pendingSessions",new Map),l1(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(lN)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,a$.toMiliseconds)(this.requestQueueDelay)))}),l1(this,"connect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let b=lW(l0({},a),lX({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(b),b.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=iE(a),j=iE(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:eh(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:eh(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:eh(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(b.requiredNamespaces,b.optionalNamespaces),b.requiredNamespaces={};let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=b,i=c,j,k=!1;try{if(i){let a=this.client.core.pairing.pairings.get(i);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),k=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${i}) failed`),a}if(!i||!k){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});i=a,j=b}if(!i){let{message:a}=iI("NO_MATCHING_KEY",`connect() pairing topic: ${i}`);throw Error(a)}let l=await this.client.core.crypto.generateKeyPair(),m=lN.wc_sessionPropose.req.ttl||a$.FIVE_MINUTES,o=ee(m),p=lW(l0(l0({requiredNamespaces:d,optionalNamespaces:e,relays:h??[{protocol:"irn"}],proposer:{publicKey:l,metadata:this.client.metadata},expiryTimestamp:o,pairingTopic:i},f&&{sessionProperties:f}),g&&{scopedProperties:g}),lX({id:(0,i3.payloadId)()})),q=eg("session_connect",p.id),{reject:r,resolve:s,done:t}=ea(m,lL),u=({id:a})=>{a===p.id&&(this.client.events.off("proposal_expire",u),this.pendingSessions.delete(p.id),this.events.emit(q,{error:{message:lL,code:0}}))};return this.client.events.on("proposal_expire",u),this.events.once(q,({error:a,session:b})=>{this.client.events.off("proposal_expire",u),a?r(a):b&&s(b)}),await this.sendProposeSession({proposal:p,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:p.id}}}),await this.setProposal(p.id,p),{uri:j,approval:t}}),l1(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),l1(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[jF]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k}=a,l=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:m,proposer:o,requiredNamespaces:p,optionalNamespaces:q}=l,r=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:m});r||(r=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:jF,properties:{topic:m,trace:[jF,"session_namespaces_validation_success"]}}));let s=await this.client.core.crypto.generateKeyPair(),t=o.publicKey,u=await this.client.core.crypto.generateSharedKey(s,t),v=l0(l0(l0({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:s,metadata:this.client.metadata},expiry:ee(lM)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k});r.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(u,{transportType:jn,internal:{skipSubscribe:!0}})}catch(a){throw r.setError("subscribe_session_topic_failure"),a}r.addTrace("subscribe_session_topic_success");let w=lW(l0({},v),lX({topic:u,requiredNamespaces:p,optionalNamespaces:q,pairingTopic:m,acknowledged:!1,self:v.controller,peer:{publicKey:o.publicKey,metadata:o.metadata},controller:s,transportType:jn}));await this.client.session.set(u,w),r.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:u,proposal:l,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:s},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f}}}),r.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(u,iJ("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(u),a}return this.client.core.eventClient.deleteEvent({eventId:r.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:o.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(u,ee(lM)),{topic:u,acknowledged:()=>Promise.resolve(this.client.session.get(u))}}),l1(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:lN.wc_sessionPropose.reject}),await this.deleteProposal(c)}),l1(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=ea(),g=(0,i3.payloadId)(),h=(0,i3.getBigIntRpcId)().toString(),i=this.client.session.get(b).namespaces;return this.events.once(eg("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),l1(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=(0,i3.payloadId)(),{done:d,resolve:e,reject:f}=ea();return this.events.once(eg("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,ee(lM)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),l1(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=lN.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===jn&&await this.confirmOnlineStateOrThrow();let g=(0,i3.payloadId)(),h=(0,i3.getBigIntRpcId)().toString(),{done:i,resolve:j,reject:k}=ea(e,"Request expired. Please try again.");this.events.once(eg("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:lW(l0({},c),lX({expiryTimestamp:ee(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let o={request:lW(l0({},c),lX({expiryTimestamp:ee(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:o,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,o)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await ej(this.client.core.storage,lK);await ei({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),l1(this,"respond",async a=>{var b,c;this.isInitialized();let d=this.client.core.eventClient.createEvent({properties:{topic:a?.topic||(null==(c=null==(b=a?.response)?void 0:b.id)?void 0:c.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_validation_failure"),a}d.addTrace("session_request_response_validation_success");let{topic:e,response:f}=a,{id:g}=f,h=this.client.session.get(e);h.transportType===jn&&await this.confirmOnlineStateOrThrow();let i=this.getAppLinkIfEnabled(h.peer.metadata,h.transportType);try{d.addTrace("session_request_response_publish_started"),(0,i4.isJsonRpcResult)(f)?await this.sendResult({id:g,topic:e,result:f.result,throwOnFailedPublish:!0,appLink:i}):(0,i4.isJsonRpcError)(f)&&await this.sendError({id:g,topic:e,error:f.error,appLink:i}),this.cleanupAfterResponse(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_publish_failure"),a}}),l1(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=(0,i3.payloadId)(),c=(0,i3.getBigIntRpcId)().toString(),{done:d,resolve:e,reject:f}=ea();this.events.once(eg("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),l1(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=(0,i3.getBigIntRpcId)().toString(),f=(0,i3.payloadId)();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),l1(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:iJ("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=iI("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),l1(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!d7(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=iB(d),i=c[b];d7(dP(b,i),h)&&d7(i.methods,e)&&d7(i.events,g)||(f=!1)}),f)})(b,a)))),l1(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),l1(this,"authenticate",async(a,b)=>{var c,d,e,f,g;let h;this.isInitialized(),this.isValidAuthenticate(a);let i=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),j=i?jm:jn;j===jn&&await this.confirmOnlineStateOrThrow();let{chains:k,statement:l="",uri:m,domain:o,nonce:p,type:q,exp:r,nbf:s,methods:t=[],expiry:u}=a,v=[...a.resources||[]],{topic:w,uri:x}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:j});this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:x}});let y=await this.client.core.crypto.generateKeyPair(),z=h4(y);if(await Promise.all([this.client.auth.authKeys.set(lU,{responseTopic:z,publicKey:y}),this.client.auth.pairingTopics.set(z,{topic:z,pairingTopic:w})]),await this.client.core.relayer.subscribe(z,{transportType:j}),this.client.logger.info(`sending request to new pairing topic: ${w}`),t.length>0){let a,b,{namespace:c}=dO(k[0]),h=f3(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(c,"request",t));f7(v)&&(d=h,e=v.pop(),h=f3((f=f4(d),g=f4(e),f2(f),f2(g),a=Object.keys(f.att).concat(Object.keys(g.att)).sort((a,b)=>a.localeCompare(b)),b={att:{}},a.forEach(a=>{var c,d;Object.keys((null==(c=f.att)?void 0:c[a])||{}).concat(Object.keys((null==(d=g.att)?void 0:d[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(c=>{var d,e;b.att[a]=fT(((a,b)=>{for(var c in b||(b={}))fW.call(b,c)&&fY(a,c,b[c]);if(fV)for(var c of fV(b))fX.call(b,c)&&fY(a,c,b[c]);return a})({},b.att[a]),fU({[c]:(null==(d=f.att[a])?void 0:d[c])||(null==(e=g.att[a])?void 0:e[c])}))})}),b))),v.push(h)}let A=u&&u>lN.wc_sessionAuthenticate.req.ttl?u:lN.wc_sessionAuthenticate.req.ttl,B={authPayload:{type:q??"caip122",chains:k,statement:l,aud:m,domain:o,version:"1",nonce:p,iat:new Date().toISOString(),exp:r,nbf:s,resources:v},requester:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:ee(A)},C={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:k,methods:[...new Set(["personal_sign",...t])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:w,proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:ee(lN.wc_sessionPropose.req.ttl),id:(0,i3.payloadId)()},{done:D,resolve:E,reject:F}=ea(A,"Request expired"),G=(0,i3.payloadId)(),H=eg("session_connect",C.id),I=eg("session_request",G),J=async({error:a,session:b})=>{this.events.off(I,K),a?F(a):b&&E({session:b})},K=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(G,{message:"fulfilled",code:0}),a.error){let b=iJ("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(H,J),F(a.error.message))}await this.deleteProposal(C.id),this.events.off(H,J);let{cacaos:g,responder:h}=a.result,i=[],k=[];for(let a of g){await f0({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),F(iJ("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=f7(b.resources),d=[f$(b.iss)],e=f_(b.iss);if(c){let a=f5(c),b=f6(c);i.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(y,h.publicKey);i.length>0&&(f={topic:l,acknowledged:!0,self:{publicKey:y,metadata:this.client.metadata},peer:h,controller:h.publicKey,expiry:ee(lM),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:w,namespaces:iF([...new Set(i)],[...new Set(k)]),transportType:j},await this.client.core.relayer.subscribe(l,{transportType:j}),await this.client.session.set(l,f),w&&await this.client.core.pairing.updateMetadata({topic:w,metadata:h.metadata}),f=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=h.metadata.redirect)&&d.linkMode&&null!=(e=h.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.session.update(l,{transportType:jm})),E({auths:g,session:f})};this.events.once(H,J),this.events.once(I,K);try{if(i){let a=(0,i3.formatJsonRpcRequest)("wc_sessionAuthenticate",B,G);this.client.core.history.set(w,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:h1});h=ir(b,w,c)}else await Promise.all([this.sendRequest({topic:w,method:"wc_sessionAuthenticate",params:B,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:G}),this.sendRequest({topic:w,method:"wc_sessionPropose",params:C,expiry:lN.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:C.id})])}catch(a){throw this.events.off(H,J),this.events.off(I,K),a}return await this.setProposal(C.id,C),await this.setAuthRequest(G,{request:lW(l0({},B),lX({verifyContext:{}})),pairingTopic:w,transportType:j}),{uri:h??x,response:D}}),l1(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||jn;g===jn&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=h4(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await f0({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=iJ("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=f7(b.resources),f=[f$(b.iss)],g=f_(b.iss);if(d){let a=f5(d),b=f6(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let o=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:o,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:ee(lM),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:iF([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(o,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(o,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),l1(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===jn&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=h4(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:lN.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),l1(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return f1(b,c)}),l1(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),l1(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),l1(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,iJ("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(lK).catch(a=>this.client.logger.warn(a)),this.getPendingSessionRequests().forEach(a=>{a.topic===c&&this.deletePendingSessionRequest(a.id,iJ("USER_DISCONNECTED"))}),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=lP),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),l1(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,iJ("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),l1(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=lP,this.client.events.emit("session_request_expire",{id:a}))}),l1(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),l1(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),l1(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,ee(lN.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),l1(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=jn}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),l1(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||ee(lN.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),l1(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m,publishOpts:o={}}=b,p=(0,i3.formatJsonRpcRequest)(f,g,j),q=!!l;try{let a=q?h1:h0;c=await this.client.core.crypto.encode(e,p,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(lS.includes(f)){let a=h5(JSON.stringify(p)),b=h5(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let r=l0(l0({},lN[f].req),o);if(r.attestation=d,h&&(r.ttl=h),i&&(r.id=i),this.client.core.history.set(e,p),q){let b=ir(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;r.tvf=lW(l0({},m),lX({correlationId:p.id})),k?(a=l0({},r.internal),r.internal=lW(a,lX({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,r)):this.client.core.relayer.publish(e,c,r).catch(a=>this.client.logger.error(a))}return p.id}),l1(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=(0,i3.formatJsonRpcRequest)("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:h0}),f=h5(JSON.stringify(d)),g=h5(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:lW(l0({},c),lX({publishMethod:"wc_proposeSession",attestation:h}))})}),l1(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=(0,i3.formatJsonRpcResult)(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:h0}),i=(0,i3.formatJsonRpcRequest)("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:h0});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:lW(l0({},f),lX({publishMethod:"wc_approveSession"}))})}),l1(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=(0,i3.formatJsonRpcResult)(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?h1:h0;c=await this.client.core.crypto.encode(g,l,(a=l0({},j||{}),b={encoding:d},lW(a,lX(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=ir(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=lN[d.request.method].res;b.tvf=lW(l0({},e),lX({correlationId:f})),i?(a=l0({},b.internal),b.internal=lW(a,lX({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),l1(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=(0,i3.formatJsonRpcError)(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=l?h1:h0;c=await this.client.core.crypto.encode(f,k,(a=l0({},h||{}),b={encoding:d},lW(a,lX(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=ir(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||lN[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),l1(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;ef(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{ef(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),l1(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),l1(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),l1(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===lQ)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=lQ;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=lP}),l1(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),l1(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),l1(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=iI("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),l1(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),l1(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(l0({},c.params));let h=f.expiryTimestamp||ee(lN.wc_sessionPropose.req.ttl),i=l0({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:h5(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:lN.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),l1(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if((0,i4.isJsonRpcResult)(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if((0,i4.isJsonRpcError)(b)){await this.deleteProposal(d);let a=eg("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),l1(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l}=b.params,m=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!m)return this.client.logger.error(`Pending session not found for topic ${a}`);let o=this.client.proposal.get(m.proposalId),p=(c=l0(l0(l0({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:o.requiredNamespaces,optionalNamespaces:o.optionalNamespaces,controller:g.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:jn},lW(c,lX(e)));await this.client.session.set(p.topic,p),await this.setExpiry(p.topic,p.expiry),await this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:p.peer.metadata}),this.client.events.emit("session_connect",{session:p}),this.events.emit(eg("session_connect",m.proposalId),{session:p}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(p),await this.sendResult({id:b.id,topic:a,result:!0})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),l1(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;(0,i4.isJsonRpcResult)(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(eg("session_approve",c),{})):(0,i4.isJsonRpcError)(b)&&(await this.client.session.delete(a,iJ("USER_DISCONNECTED")),this.events.emit(eg("session_approve",c),{error:b.error}))}),l1(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=i_.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:iJ("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(l0({topic:a},c));try{i_.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw i_.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),l1(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),l1(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=eg("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("session_update",c),{}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("session_update",c),{error:b.error})}),l1(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,ee(lM)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),l1(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=eg("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("session_extend",c),{}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("session_extend",c),{error:b.error})}),l1(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),l1(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=eg("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("session_ping",c),{}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("session_ping",c),{error:b.error})},500)}),l1(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a,reason:b.params}),await Promise.all([new Promise(b=>{this.client.core.relayer.once(jg,async()=>{b(await this.deleteSession({topic:a,id:c}))})}),this.sendResult({id:c,topic:a,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:a,error:iJ("USER_DISCONNECTED")})]).catch(a=>this.client.logger.error(a))}catch(a){this.client.logger.error(a)}}),l1(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(l0({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:h5(JSON.stringify((0,i3.formatJsonRpcRequest)("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===jm&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),l1(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=eg("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("session_request",c),{result:b.result}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("session_request",c),{error:b.error})}),l1(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=i_.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(l0({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),i_.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),l1(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),(0,i4.isJsonRpcResult)(b)?this.events.emit(eg("session_request",c),{result:b.result}):(0,i4.isJsonRpcError)(b)&&this.events.emit(eg("session_request",c),{error:b.error})}),l1(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:h5(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===jm&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:lN.wc_sessionAuthenticate.autoReject,appLink:e})}}),l1(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),l1(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=lP,this.processSessionRequestQueue()},(0,a$.toMiliseconds)(this.requestQueueDelay))}),l1(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{let c=eg("session_request",a.request.id);if(0===this.events.listenerCount(c))throw Error(`emitting ${c} without any listeners`);this.events.emit(eg("session_request",a.request.id),{error:b})})}),l1(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===lQ)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),l1(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=lQ,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),l1(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:(0,i3.formatJsonRpcRequest)("wc_sessionPropose",lW(l0({},b),lX({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),l1(this,"isValidConnect",async a=>{let b;if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=a;if(iM(c)||await this.isValidPairingTopic(c),b=!1,h?h&&iK(h)&&h.length&&h.forEach(a=>{b=iT(a)}):b=!0,!b){let{message:a}=iI("MISSING_OR_INVALID",`connect() relays: ${h}`);throw Error(a)}if(d&&!iM(d)&&0!==iL(d)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(d,"requiredNamespaces")}if(e&&!iM(e)&&0!==iL(e)&&this.validateNamespaces(e,"optionalNamespaces"),f&&!iM(f)&&this.validateSessionProps(f,"sessionProperties"),g&&!iM(g)){this.validateSessionProps(g,"scopedProperties");let a=Object.keys(d||{}).concat(Object.keys(e||{}));if(!Object.keys(g).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(g)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),l1(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&iL(a)){let e,f=iR(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=dP(a,d),g=`${b} ${c}`,h=null,iK(f)&&f.length?f.forEach(a=>{h||iP(a)||(h=iJ("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):iP(a)||(h=iJ("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=iI("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),l1(this,"isValidApprove",async a=>{if(!iU(a))throw Error(iI("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=iS(c,"approve()");if(h)throw Error(h.message);let i=iW(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!iN(d,!0)){let{message:a}=iI("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(e&&!iM(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!iM(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),l1(this,"isValidReject",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!c||"object"!=typeof c||!c.code||!iO(c.code,!1)||!c.message||!iN(c.message,!1)){let{message:a}=iI("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),l1(this,"isValidSessionSettleRequest",a=>{let b;if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:c,controller:d,namespaces:e,expiry:f}=a;if(!iT(c)){let{message:a}=iI("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let g=(b=null,iN(d?.publicKey,!1)||(b=iI("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),b);if(g)throw Error(g.message);let h=iS(e,"onSessionSettleRequest()");if(h)throw Error(h.message);if(ef(f)){let{message:a}=iI("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),l1(this,"isValidUpdate",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=iS(c,"update()");if(e)throw Error(e.message);let f=iW(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),l1(this,"isValidExtend",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),l1(this,"isValidRequest",async a=>{var b;let c;if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:d,request:e,chainId:f,expiry:g}=a;this.checkRecentlyDeleted(d),await this.isValidSessionTopic(d);let{namespaces:h}=this.client.session.get(d);if(!iV(h,f)){let{message:a}=iI("MISSING_OR_INVALID",`request() chainId: ${f}`);throw Error(a)}if(iM(e)||!iN(e.method,!1)){let{message:a}=iI("MISSING_OR_INVALID",`request() ${JSON.stringify(e)}`);throw Error(a)}if(!(iN(b=e.method,!1)&&(c=[],Object.values(h).forEach(a=>{iB(a.accounts).includes(f)&&c.push(...a.methods)}),c).includes(b))){let{message:a}=iI("MISSING_OR_INVALID",`request() method: ${e.method}`);throw Error(a)}if(g&&(!iO(g,!1)||!(g<=lO.max)||!(g>=lO.min))){let{message:a}=iI("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${lO.min} and ${lO.max}`);throw Error(a)}}),l1(this,"isValidRespond",async a=>{var b;if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(iM(d)||iM(d.result)&&iM(d.error)||!iO(d.id,!1)||!iN(d.jsonrpc,!1)){let{message:a}=iI("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}let e=this.client.pendingRequest.get(d.id);if(e.topic!==c){let{message:a}=iI("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${d.id}, expected topic: ${e.topic}, received topic: ${c}`);throw Error(a)}}),l1(this,"isValidPing",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),l1(this,"isValidEmit",async a=>{var b;let c;if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:d,event:e,chainId:f}=a;await this.isValidSessionTopic(d);let{namespaces:g}=this.client.session.get(d);if(!iV(g,f)){let{message:a}=iI("MISSING_OR_INVALID",`emit() chainId: ${f}`);throw Error(a)}if(iM(e)||!iN(e.name,!1)||!(iN(b=e.name,!1)&&(c=[],Object.values(g).forEach(a=>{iB(a.accounts).includes(f)&&c.push(...a.events)}),c).includes(b))){let{message:a}=iI("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(e)}`);throw Error(a)}}),l1(this,"isValidDisconnect",async a=>{if(!iU(a)){let{message:b}=iI("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),l1(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!iN(c,!1))throw Error("uri is required parameter");if(!iN(d,!1))throw Error("domain is required parameter");if(!iN(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>dO(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=dO(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),l1(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||jB,validation:"UNKNOWN",origin:e.url||""}};try{if(f===jm){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),l1(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=iI("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),l1(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),l1(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),l1(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=iI("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),l1(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===jm&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),l1(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),l1(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=ek(a,"topic")||"",c=decodeURIComponent(ek(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:jm}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),l1(this,"registerLinkModeListeners",async()=>{var b;if(em()||d1()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),l1(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn(a,"Error getting TVF params")}return g}),l1(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),l1(this,"extractTxHashesFromResult",(a,b)=>{var c,d,e,f,g;try{if(!b)return[];let h=a.method,i=lR[h];if("sui_signTransaction"===h){let a,c,d,f;return[(e=b.transactionBytes,a=new Uint8Array(Buffer.from(e,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),(d=new Uint8Array(c.length+a.length)).set(c),d.set(a,c.length),f=fL(d,{dkLen:32}),dy.encode(f))]}if("near_signTransaction"===h)return[fP(b)];if("near_signTransactions"===h)return b.map(a=>fP(a));if("xrpl_signTransactionFor"===h||"xrpl_signTransaction"===h)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===h){let c,e,f,g;return[(d={transaction:a.params.transactionPayload,signature:b.signature},f=Uint8Array.from(Buffer.from(d.signature,"hex")),g=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=i0(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,g=dy.decode(e)[0],42===g?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):i0(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),o=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(o.length+1),i,...o])}({publicKey:function(a){let b=dy.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(d.transaction.address),signature:f,payload:d.transaction}),c=i0(Buffer.from(g).toString("hex")),e=(0,dN.blake2b)(c,void 0,32),"0x"+Buffer.from(e).toString("hex"))]}if("algo_signTxn"===h)return iK(b)?b.map(a=>fQ(a)):[fQ(b)];if("cosmos_signDirect"===h){let a,c,d,e,f;return[(a=Buffer.from(b.signed.bodyBytes,"base64"),c=Buffer.from(b.signed.authInfoBytes,"base64"),d=Buffer.from(b.signature.signature,"base64"),(e=[]).push(Buffer.from([10])),e.push(fR(a.length)),e.push(a),e.push(Buffer.from([18])),e.push(fR(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(fR(d.length)),e.push(d),f=fA(Buffer.concat(e)),Buffer.from(f).toString("hex").toUpperCase())]}if("wallet_sendCalls"===h){let a=[];try{if("string"==typeof b)return a.push(b),a;if("object"!=typeof b)return a;null!=b&&b.id&&a.push(b.id);let c=null==(g=null==(f=b?.capabilities)?void 0:f.caip345)?void 0:g.transactionHashes;c&&a.push(...c)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return a}if("string"==typeof b)return[b];let j=b[i.key];if(iK(j))return"solana_signAllTransactions"===h?j.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return dy.encode(e)})(a)):j;if("string"==typeof j)return[j]}catch(a){this.client.logger.warn(a,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn(a,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:a}=iI("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(jd,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(lU)?this.client.auth.authKeys.get(lU):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===jm?h1:h0});(0,i4.isJsonRpcRequest)(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:h5(c)})):(0,i4.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e}),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(jA,async a=>{let{topic:b,id:c}=ed(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,iI("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,iI("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(jt,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(ju,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!iN(a,!1)){let{message:b}=iI("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=iI("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(ef(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=iI("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!iN(a,!1)){let{message:b}=iI("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=iI("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(ef(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=iI("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=iI("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(iN(a,!1)){let{message:b}=iI("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=iI("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=iI("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=iI("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(ef(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=iI("EXPIRED",`proposal id: ${a}`);throw Error(b)}}}class l3 extends lc{constructor(a,b){super(a,b,"proposal",lJ),this.core=a,this.logger=b}}class l4 extends lc{constructor(a,b){super(a,b,"session",lJ),this.core=a,this.logger=b}}class l5 extends lc{constructor(a,b){super(a,b,"request",lJ,a=>a.id),this.core=a,this.logger=b}}class l6 extends lc{constructor(a,b){super(a,b,"authKeys",lT,()=>lU),this.core=a,this.logger=b}}class l7 extends lc{constructor(a,b){super(a,b,"pairingTopics",lT),this.core=a,this.logger=b}}class l8 extends lc{constructor(a,b){super(a,b,"requests",lT,a=>a.id),this.core=a,this.logger=b}}var l9=Object.defineProperty,ma=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?l9(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class mb{constructor(a,b){this.core=a,this.logger=b,ma(this,"authKeys"),ma(this,"pairingTopics"),ma(this,"requests"),this.authKeys=new l6(this.core,this.logger),this.pairingTopics=new l7(this.core,this.logger),this.requests=new l8(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var mc=Object.defineProperty,md=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?mc(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class me extends aY{constructor(a){super(a),md(this,"protocol","wc"),md(this,"version",2),md(this,"name",lI),md(this,"metadata"),md(this,"core"),md(this,"logger"),md(this,"events",new ah.EventEmitter),md(this,"engine"),md(this,"session"),md(this,"proposal"),md(this,"pendingRequest"),md(this,"auth"),md(this,"signConfig"),md(this,"on",(a,b)=>this.events.on(a,b)),md(this,"once",(a,b)=>this.events.once(a,b)),md(this,"off",(a,b)=>this.events.off(a,b)),md(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),md(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),md(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),md(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),md(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),md(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||lI,this.metadata=function(a){var b,c;let d=d5();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=dX(dX({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},dR(e,dS(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;const b=i1({logger:a?.logger||"error",name:this.name});this.logger=b,this.core=a?.core||new lH(a),this.session=new l4(this.core,this.logger),this.proposal=new l3(this.core,this.logger),this.pendingRequest=new l5(this.core,this.logger),this.engine=new l2(this),this.auth=new mb(this.core,this.logger)}static async init(a){let b=new me(a);return await b.initialize(),b}get context(){return aE(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var mf=a.i(652854);function mg(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function mh(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function mi(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let mj="[object String]",mk="[object Number]",ml="[object Boolean]",mm="[object Arguments]";function mn(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function mo(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(mg(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=mo(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,mo(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(mo(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(mn(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=mo(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),mp(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),mp(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),mp(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,mp(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(mi(a)){case mm:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case ml:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case mk:case"[object Object]":case"[object RegExp]":case"[object Set]":case mj:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),mp(b,a,c,d,e),b}return a}function mp(a,b,c=a,d,e){let f=[...Object.keys(b),...mh(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=mo(b[h],h,c,d,e))}}function mq(a){var b;return b=(b,c,d,e)=>{let f;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case mk:case mj:case ml:{let b=new a.constructor(a?.valueOf());return mp(b,a),b}case mm:{let b={};return mp(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},mo(a,void 0,a,new Map,b)}function mr(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===mi(a)}function ms(a){return"object"==typeof a&&null!==a}function mt(){}let mu="error",mv="universal_provider",mw=`wc@2:${mv}:`,mx="https://rpc.walletconnect.org/v1/",my="generic",mz=`${mx}bundler`,mA="call_status",mB="default_chain_changed";var mC=Object.defineProperty,mD=Object.defineProperties,mE=Object.getOwnPropertyDescriptors,mF=Object.getOwnPropertySymbols,mG=Object.prototype.hasOwnProperty,mH=Object.prototype.propertyIsEnumerable,mI=(a,b,c)=>b in a?mC(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,mJ=(a,b)=>{for(var c in b||(b={}))mG.call(b,c)&&mI(a,c,b[c]);if(mF)for(var c of mF(b))mH.call(b,c)&&mI(a,c,b[c]);return a},mK=(a,b)=>mD(a,mE(b));function mL(a,b,c){var d;let e=dO(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${mx}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function mM(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function mN(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>{var c,d;return(null==(c=b?.chains)?void 0:c.length)&&(null==(d=b?.chains)?void 0:d.length)>0}))}function mO(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(mg(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(mg(a))return a;if(Array.isArray(a)||mn(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...mh(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(mr(i)&&(i={...i}),mr(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=mq(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||ms(j)&&ms(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&mn(i)?b[h]=mq(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,mt)}(mN(mP(a)),mN(mP(b)))}function mP(a){var b,c,d,e,f;let g={};if(!iL(a))return g;for(let[h,i]of Object.entries(a)){let a=iC(h)?[h]:i.chains,j=i.methods||[],k=i.events||[],l=i.rpcMap||{},m=iD(h);g[m]=mK(mJ(mJ({},g[m]),i),{chains:eh(a,null==(b=g[m])?void 0:b.chains),methods:eh(j,null==(c=g[m])?void 0:c.methods),events:eh(k,null==(d=g[m])?void 0:d.events)}),(iL(l)||iL((null==(e=g[m])?void 0:e.rpcMap)||{}))&&(g[m].rpcMap=mJ(mJ({},l),null==(f=g[m])?void 0:f.rpcMap))}return g}function mQ(a){return a.includes(":")?a.split(":")[2]:a}function mR(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=iC(c)?[c]:d.chains?d.chains:mM(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function mS(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let mT={},mU=a=>mT[a],mV=(a,b)=>{mT[a]=b};var mW=Object.defineProperty,mX=Object.getOwnPropertySymbols,mY=Object.prototype.hasOwnProperty,mZ=Object.prototype.propertyIsEnumerable,m$=(a,b,c)=>b in a?mW(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,m_=(a,b)=>{for(var c in b||(b={}))mY.call(b,c)&&m$(a,c,b[c]);if(mX)for(var c of mX(b))mZ.call(b,c)&&m$(a,c,b[c]);return a};let m0="eip155",m1=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],m2=a=>a&&a.startsWith("0x")?BigInt(a).toString(10):a,m3=a=>a&&a.startsWith("0x")?a:`0x${BigInt(a).toString(16)}`,m4=a=>Object.keys(a).filter(a=>m1.includes(a)).reduce((b,c)=>(b[c]=m5(a[c]),b),{}),m5=a=>"string"==typeof a&&function(a){try{let b=JSON.parse(a);return"object"==typeof b&&null!==b&&!Array.isArray(b)}catch{return!1}}(a)?JSON.parse(a):a;var m6=Object.defineProperty;class m7{constructor(a){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?m6(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"storage"),this.storage=a}async getItem(a){return await this.storage.getItem(a)}async setItem(a,b){return await this.storage.setItem(a,b)}async removeItem(a){return await this.storage.removeItem(a)}static getStorage(a){return b||(b=new m7(a)),b}}var m8=Object.defineProperty,m9=Object.defineProperties,na=Object.getOwnPropertyDescriptors,nb=Object.getOwnPropertySymbols,nc=Object.prototype.hasOwnProperty,nd=Object.prototype.propertyIsEnumerable,ne=(a,b,c)=>b in a?m8(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;async function nf(a,b){let c,d=dO(a.result.capabilities.caip345.caip2),e=a.result.capabilities.caip345.transactionHashes,f=await Promise.allSettled(e.map(a=>ng(d.reference,a,b))),g=f.filter(a=>"fulfilled"===a.status).map(a=>a.value).filter(a=>a);f.filter(a=>"rejected"===a.status).forEach(a=>console.warn("Failed to fetch transaction receipt:",a.reason));let h=!g.length||g.some(a=>!a),i=g.every(a=>a?.status==="0x1"),j=g.every(a=>a?.status==="0x0"),k=g.some(a=>a?.status==="0x0");return h?c=100:i?c=200:j?c=500:k&&(c=600),{id:a.result.id,version:a.request.version,atomic:a.request.atomicRequired,chainId:a.request.chainId,capabilities:a.result.capabilities,receipts:g,status:c}}async function ng(a,b,c){return await c(parseInt(a)).request((0,i3.formatJsonRpcRequest)("eth_getTransactionReceipt",[b]))}async function nh({sendCalls:a,storage:b}){let c=await b.getItem(mA);await b.setItem(mA,m9(((a,b)=>{for(var c in b||(b={}))nc.call(b,c)&&ne(a,c,b[c]);if(nb)for(var c of nb(b))nd.call(b,c)&&ne(a,c,b[c]);return a})({},c),na({[a.result.id]:{request:a.request,result:a.result,expiry:ee(86400)}})))}async function ni({resultId:a,storage:b}){let c=await b.getItem(mA);if(c){for(let d in delete c[a],await b.setItem(mA,c),c)ef(c[d].expiry)&&delete c[d];await b.setItem(mA,c)}}async function nj({resultId:a,storage:b}){let c=await b.getItem(mA),d=c?.[a];if(d&&!ef(d.expiry))return d;await ni({resultId:a,storage:b})}var nk=Object.defineProperty,nl=Object.defineProperties,nm=Object.getOwnPropertyDescriptors,nn=Object.getOwnPropertySymbols,no=Object.prototype.hasOwnProperty,np=Object.prototype.propertyIsEnumerable,nq=(a,b,c)=>b in a?nk(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nr=(a,b)=>{for(var c in b||(b={}))no.call(b,c)&&nq(a,c,b[c]);if(nn)for(var c of nn(b))np.call(b,c)&&nq(a,c,b[c]);return a},ns=(a,b,c)=>nq(a,"symbol"!=typeof b?b+"":b,c);class nt{constructor(a){ns(this,"name","eip155"),ns(this,"client"),ns(this,"chainId"),ns(this,"namespace"),ns(this,"httpProviders"),ns(this,"events"),ns(this,"storage"),this.namespace=a.namespace,this.events=mU("events"),this.client=mU("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=m7.getStorage(this.client.core.storage)}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a);case"wallet_sendCalls":return await this.sendCalls(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b);let c=this.chainId;this.chainId=parseInt(a),this.events.emit(mB,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){let c=b||mL(`${this.name}:${a}`,this.namespace,this.client.core.projectId);return new i2.JsonRpcProvider(new mf.HttpConnection(c,mU("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(b.includes(":")?b.split(":")[1]:b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(a){let b=a||this.chainId;return this.httpProviders[b]||(this.httpProviders=nl(nr({},this.httpProviders),nm({[b]:this.createHttpProvider(b)})),this.httpProviders[b])}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g,h=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],i=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[];if(!h)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),k=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{},l=`${h}${i.join(",")}`,m=k?.[l];if(m)return m;try{g=((a,b,c)=>{let{sessionProperties:d={},scopedProperties:e={}}=a,f={};if(!iL(e)&&!iL(d))return;let g=m4(d);for(let a of c){let c=m2(a);if(!c)continue;f[m3(c)]=g;let d=e?.[`${m0}:${c}`];if(d){let a=d?.[`${m0}:${c}:${b}`];f[m3(c)]=m_(m_({},f[m3(c)]),m4(a||d))}}for(let[a,b]of Object.entries(f))0===Object.keys(b).length&&delete f[a];return Object.keys(f).length>0?f:void 0})(j,h,i)}catch(a){console.warn("Failed to extract capabilities from session",a)}if(g)return g;let o=await this.client.request(a);try{let b,c,d,e;await this.client.session.update(a.topic,{sessionProperties:(d=nr({},j.sessionProperties||{}),e={capabilities:(b=nr({},k||{}),c={[l]:o},nl(b,nm(c)))},nl(d,nm(e)))})}catch(a){console.warn("Failed to update session with capabilities",a)}return o}async getCallStatus(a){var b,c,d;let e=this.client.session.get(a.topic),f=null==(b=e.sessionProperties)?void 0:b.bundler_name;if(f){let b=this.getBundlerUrl(a.chainId,f);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let g=null==(c=e.sessionProperties)?void 0:c.bundler_url;if(g)try{return await this.getUserOperationReceipt(g,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,g)}let h=await nj({resultId:null==(d=a.request.params)?void 0:d[0],storage:this.storage});if(h)try{return await nf(h,this.getHttpProvider.bind(this))}catch(a){console.warn("Failed to fetch call status from stored send calls",a,h)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,i3.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${mz}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}async sendCalls(a){var b,c,d;let e=await this.client.request(a),f=null==(b=a.request.params)?void 0:b[0],g=e?.id,h=e?.capabilities||{},i=null==(c=h?.caip345)?void 0:c.caip2,j=null==(d=h?.caip345)?void 0:d.transactionHashes;return g&&i&&null!=j&&j.length&&await nh({sendCalls:{request:f,result:e},storage:this.storage}),e}}var nu=Object.defineProperty,nv=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nu(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class nw{constructor(a){nv(this,"name",my),nv(this,"client"),nv(this,"httpProviders"),nv(this,"events"),nv(this,"namespace"),nv(this,"chainId"),this.namespace=a.namespace,this.events=mU("events"),this.client=mU("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b);let c=this.chainId;this.chainId=a,this.events.emit(mB,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getNamespaceName(){let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return dO(a).namespace}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{var b,d;let e=dO(a),f=null==(d=null==(b=this.namespace)?void 0:b.rpcMap)?void 0:d[`${e.namespace}:${e.reference}`];c[e.reference]=this.createHttpProvider(a,f)}),c}getHttpProvider(a){let b=dO(a).reference,c=this.httpProviders[b];if(typeof c>"u")throw Error(`JSON-RPC provider for ${a} not found`);return c}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||mL(a,this.namespace,this.client.core.projectId);return new i2.JsonRpcProvider(new mf.default(c,mU("disableProviderPing")))}}var nx=Object.defineProperty,ny=Object.defineProperties,nz=Object.getOwnPropertyDescriptors,nA=Object.getOwnPropertySymbols,nB=Object.prototype.hasOwnProperty,nC=Object.prototype.propertyIsEnumerable,nD=(a,b,c)=>b in a?nx(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,nE=(a,b)=>{for(var c in b||(b={}))nB.call(b,c)&&nD(a,c,b[c]);if(nA)for(var c of nA(b))nC.call(b,c)&&nD(a,c,b[c]);return a},nF=(a,b,c)=>nD(a,"symbol"!=typeof b?b+"":b,c);class nG{constructor(a){var b,c;nF(this,"client"),nF(this,"namespaces"),nF(this,"optionalNamespaces"),nF(this,"sessionProperties"),nF(this,"scopedProperties"),nF(this,"events",new ah.default),nF(this,"rpcProviders",{}),nF(this,"session"),nF(this,"providerOpts"),nF(this,"logger"),nF(this,"uri"),nF(this,"disableProviderPing",!1),this.providerOpts=a,this.logger=i1({logger:null!=(b=a.logger)?b:mu,name:null!=(c=this.providerOpts.name)?c:mv}),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new nG(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:nE({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,(0,i3.formatJsonRpcResult)(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:iJ("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(a),this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=mR(this.session.namespaces);this.namespaces=mO(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){let{uri:b,approval:c}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});b&&(this.uri=b,this.events.emit("display_uri",b));let d=await c();this.session=d;let e=mR(d.namespaces);return this.namespaces=mO(this.namespaces,e),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a);this.getProvider(c).setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){try{this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(!iK(b))return;for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}catch(a){this.logger.warn(a,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await me.init({core:this.providerOpts.core,logger:this.providerOpts.logger||mu,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error(c,"Failed to get session"),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>iD(a)))];mV("client",this.client),mV("events",this.events),mV("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session);if(b?.length===0)return;let c=mM(b),d=ny(nE({},mO(this.namespaces,this.optionalNamespaces)[a]),nz({accounts:b,chains:c}));"eip155"===a?this.rpcProviders[a]=new nt({namespace:d}):this.rpcProviders[a]=new nw({namespace:d})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&iK(a)&&this.events.emit("accountsChanged",a.map(mQ))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=iD(a),e=mS(a)!==mS(b)?`${d}:${mS(b)}`:a;this.onChainChanged({currentCaipChainId:e})}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=ny(nE({},f),nz({namespaces:e})),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",ny(nE({},iJ("USER_DISCONNECTED")),nz({data:a.topic}))))}),this.on(mB,a=>{this.onChainChanged(ny(nE({},a),nz({internal:!0})))})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[my]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=mO(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>iD(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=iD(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged({currentCaipChainId:a,previousCaipChainId:b,internal:c=!1}){if(!this.namespaces)return;let[d,e]=this.validateChain(a);e&&(this.updateNamespaceChain(d,e),c?(this.events.emit("chainChanged",e),this.emitAccountsChangedOnChainChange({namespace:d,currentCaipChainId:a,previousCaipChainId:b})):this.getProvider(d).setDefaultChain(e),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:a,currentCaipChainId:b,previousCaipChainId:c}){var d,e;try{if(c===b)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${b}:`)).map(mQ);if(!iK(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn(a,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${mw}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${mw}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${mw}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(mw)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn(a,"Failed to cleanup storage")}}}var nH=a.i(341474),nI=a.i(577248),nJ=a.i(903112),nK=a.i(175787),nL=a.i(927383),nM=a.i(426779),nN=a.i(732924),nO=a.i(49377),nP=a.i(848800);let nQ={solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},nR={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace:a=>nQ[a]||[],createDefaultNamespace(a){return{methods:this.getMethodsByChainNamespace(a),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(a,b){if(!b)return{...a};let c={...a},d=new Set;if(b.methods&&Object.keys(b.methods).forEach(a=>d.add(a)),b.chains&&Object.keys(b.chains).forEach(a=>d.add(a)),b.events&&Object.keys(b.events).forEach(a=>d.add(a)),b.rpcMap&&Object.keys(b.rpcMap).forEach(a=>{let[b]=a.split(":");b&&d.add(b)}),d.forEach(a=>{c[a]||(c[a]=this.createDefaultNamespace(a))}),b.methods&&Object.entries(b.methods).forEach(([a,b])=>{c[a]&&(c[a].methods=b)}),b.chains&&Object.entries(b.chains).forEach(([a,b])=>{c[a]&&(c[a].chains=b)}),b.events&&Object.entries(b.events).forEach(([a,b])=>{c[a]&&(c[a].events=b)}),b.rpcMap){let a=new Set;Object.entries(b.rpcMap).forEach(([b,d])=>{let[e,f]=b.split(":");e&&f&&c[e]&&(c[e].rpcMap||(c[e].rpcMap={}),a.has(e)||(c[e].rpcMap={},a.add(e)),c[e].rpcMap[f]=d)})}return c},createNamespaces(a,b){let c=a.reduce((a,b)=>{let{id:c,chainNamespace:d,rpcUrls:e}=b,f=e.default.http[0];a[d]||(a[d]=this.createDefaultNamespace(d));let g=`${d}:${c}`,h=a[d];switch(h.chains.push(g),g){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":h.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":h.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K")}return h?.rpcMap&&f&&(h.rpcMap[c]=f),a},{});return this.applyNamespaceOverrides(c,b)},resolveReownName:async a=>{let b=await nL.EnsController.resolveName(a),c=Object.values(b?.addresses)||[];return c[0]?.address||!1},getChainsFromNamespaces:(a={})=>Object.values(a).flatMap(a=>Array.from(new Set([...a.chains||[],...a.accounts.map(a=>{let[b,c]=a.split(":");return`${b}:${c}`})]))),isSessionEventData:a=>"object"==typeof a&&null!==a&&"id"in a&&"topic"in a&&"params"in a&&"object"==typeof a.params&&null!==a.params&&"chainId"in a.params&&"event"in a.params&&"object"==typeof a.params.event&&null!==a.params.event,isUserRejectedRequestError(a){try{if("object"==typeof a&&null!==a){let b="number"==typeof a.code,c=b&&a.code===nR.RPC_ERROR_CODE.USER_REJECTED_METHODS,d=b&&a.code===nR.RPC_ERROR_CODE.USER_REJECTED;return c||d}return!1}catch{return!1}},isOriginAllowed(a,b,c){for(let d of[...b,...c])if(d.includes("*")){let b=d.replace(/[.*+?^${}()|[\]\\]/gu,"\\$&");if(RegExp(`^${b.replace(/\\\*/gu,".*")}$`,"u").test(a))return!0}else try{if(new URL(d).origin===a)return!0}catch(b){if(d===a)return!0}return!1},listenWcProvider({universalProvider:a,namespace:b,onConnect:c,onDisconnect:d,onAccountsChanged:e,onChainChanged:f,onDisplayUri:g}){c&&a.on("connect",()=>{c(nR.getWalletConnectAccounts(a,b))}),d&&a.on("disconnect",()=>{d()}),e&&a.on("accountsChanged",c=>{try{let d=a.session?.namespaces?.[b]?.accounts||[],f=a.rpcProviders?.[b]?.getDefaultChain(),g=c.map(a=>{let c=d.find(c=>c.includes(`${b}:${f}:${a}`));if(!c)return;let{chainId:e,chainNamespace:g}=nI.ParseUtil.parseCaipAddress(c);return{address:a,chainId:e,chainNamespace:g}}).filter(a=>void 0!==a);g.length>0&&e(g)}catch(a){console.warn("Failed to parse accounts for namespace on accountsChanged event",b,c,a)}}),f&&a.on("chainChanged",a=>{f(a)}),g&&a.on("display_uri",a=>{g(a)})},getWalletConnectAccounts(a,b){let c=new Set,d=a?.session?.namespaces?.[b]?.accounts?.map(a=>nI.ParseUtil.parseCaipAddress(a)).filter(({address:a})=>!c.has(a.toLowerCase())&&(c.add(a.toLowerCase()),!0));return d&&d.length>0?d:[]}};a.i(208436),a.i(205357);var nS=a.i(738951);a.i(675998);var nT=a.i(998772),nU=a.i(316903),nV=a.i(607409),nW=Object.defineProperty,nX=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?nW(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class nY{constructor(a){nX(this,"nodeValue"),nX(this,"sizeInBytes"),nX(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class nZ{constructor(a){nX(this,"lengthInNodes"),nX(this,"sizeInBytes"),nX(this,"head"),nX(this,"tail"),nX(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new nY(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}var n$=Object.defineProperty,n_=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?n$(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class n0{constructor(a,b=1024e3){n_(this,"logs"),n_(this,"level"),n_(this,"levelValue"),n_(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=nV.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new nZ(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===nV.levels.values.error?console.error(a):b===nV.levels.values.warn?console.warn(a):b===nV.levels.values.debug?console.debug(a):b===nV.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append((0,al.safeJsonStringify)({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new nZ(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push((0,al.safeJsonStringify)({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var n1=Object.defineProperty;class n2{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?n1(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new n0(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var n3=Object.defineProperty,n4=Object.defineProperties,n5=Object.getOwnPropertyDescriptors,n6=Object.getOwnPropertySymbols,n7=Object.prototype.hasOwnProperty,n8=Object.prototype.propertyIsEnumerable,n9=(a,b,c)=>b in a?n3(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,oa=(a,b)=>{for(var c in b||(b={}))n7.call(b,c)&&n9(a,c,b[c]);if(n6)for(var c of n6(b))n8.call(b,c)&&n9(a,c,b[c]);return a};let ob={createLogger(a,b="error"){var c,d,e;let f,{logger:g}="u">typeof(d={opts:n4(oa({},c={level:b}),n5({level:c?.level||"info"}))}).loggerOverride&&"string"!=typeof d.loggerOverride?{logger:d.loggerOverride,chunkLoggerController:null}:(f=new n2(null==(e=d.opts)?void 0:e.level,d.maxSizeInBytes),{logger:(0,nV.default)(n4(oa({},d.opts),n5({level:"trace"})),f),chunkLoggerController:f});return g.error=(...b)=>{for(let c of b)if(c instanceof Error)return void a(c,...b);a(void 0,...b)},g}};var oc=a.i(989474);let od={TOKEN_ADDRESSES_BY_SYMBOL:{USDC:{8453:oc.baseUSDC.asset,84532:oc.baseSepoliaUSDC.asset}},getTokenSymbolByAddress(a){if(!a)return;let[b]=Object.entries(od.TOKEN_ADDRESSES_BY_SYMBOL).find(([b,c])=>Object.values(c).includes(a))??[];return b}};var oe=a.i(4905);a.i(233991);var of=a.i(537786);let og=[I.ConstantsUtil.CONNECTOR_ID.AUTH,I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT];class oh{constructor(a){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=a=>L.ChainController.getCaipNetworks(a),this.getConnectorId=a=>N.ConnectorController.getConnectorId(a),a&&this.construct(a)}construct(a){this.projectId=a.projectId,this.namespace=a.namespace,this.adapterType=a.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:a,chainId:b}){let c=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===b?.toString());a&&c&&this.addConnection({connectorId:I.ConstantsUtil.CONNECTOR_ID.AUTH,accounts:a,caipNetwork:c})}setAuthProvider(a){a.onConnect(this.onAuthConnected.bind(this)),a.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:I.ConstantsUtil.CONNECTOR_ID.AUTH,type:"AUTH",name:I.ConstantsUtil.CONNECTOR_NAMES.AUTH,provider:a,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...a){let b=new Set;this.availableConnectors=[...a,...this.availableConnectors].filter(a=>!b.has(a.id)&&(b.add(a.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...a){let b=new Set;this.availableConnections=[...a,...this.availableConnections].filter(a=>!b.has(a.connectorId.toLowerCase())&&(b.add(a.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(a){this.availableConnections=this.availableConnections.filter(b=>b.connectorId.toLowerCase()!==a.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(a=!1){this.availableConnections=[],a&&this.emit("connections",this.availableConnections)}setStatus(a,b){L.ChainController.setAccountProp("status",a,b)}on(a,b){this.eventListeners.has(a)||this.eventListeners.set(a,new Set),this.eventListeners.get(a)?.add(b)}off(a,b){let c=this.eventListeners.get(a);c&&c.delete(b)}removeAllEventListeners(){this.eventListeners.forEach(a=>{a.clear()})}emit(a,b){let c=this.eventListeners.get(a);c&&c.forEach(a=>a(b))}async connectWalletConnect(a){try{let a=this.getWalletConnectConnector();return{clientId:(await a.connectWalletConnect()).clientId}}catch(a){if(nR.isUserRejectedRequestError(a))throw new of.UserRejectedRequestError(a);throw a}}async switchNetwork(a){let{caipNetwork:b}=a,c=P.ProviderController.getProviderId(b.chainNamespace),d=P.ProviderController.getProvider(b.chainNamespace);if(!d)throw Error("Provider not found");if("WALLET_CONNECT"===c)return void d.setDefaultChain(b.caipNetworkId);if("AUTH"===c){let a=N.ConnectorController.getAuthConnector()?.provider;if(!a)throw Error("Auth provider not found");let c=(0,$.getPreferredAccountType)(b.chainNamespace);await a.switchNetwork({chainId:b.caipNetworkId});let d=await a.getUser({chainId:b.caipNetworkId,preferredAccountType:c});this.emit("switchNetwork",d)}}getWalletConnectConnector(){let a=this.connectors.find(a=>"walletConnect"===a.id);if(!a)throw Error("WalletConnectConnector not found");return a}onConnect(a,b){if(a.length>0){let{address:c,chainId:d}=F.CoreHelperUtil.getAccount(a[0]),e=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===d?.toString()),f=this.connectors.find(a=>a.id===b);c&&(this.emit("accountChanged",{address:c,chainId:d,connector:f}),this.addConnection({connectorId:b,accounts:a.map(a=>{let{address:b}=F.CoreHelperUtil.getAccount(a);return{address:b}}),caipNetwork:e}))}}onAccountsChanged(a,b,c=!0){if(a.length>0){let{address:c}=F.CoreHelperUtil.getAccount(a[0]),d=this.getConnection({connectorId:b,connections:this.connections,connectors:this.connectors});c&&this.getConnectorId(I.ConstantsUtil.CHAIN.EVM)?.toLowerCase()===b.toLowerCase()&&this.emit("accountChanged",{address:c,chainId:d?.caipNetwork?.id,connector:d?.connector}),this.addConnection({connectorId:b,accounts:a.map(a=>{let{address:b}=F.CoreHelperUtil.getAccount(a);return{address:b}}),caipNetwork:d?.caipNetwork})}else c&&this.onDisconnect(b)}onDisconnect(a){this.removeProviderListeners(a),this.deleteConnection(a),this.getConnectorId(I.ConstantsUtil.CHAIN.EVM)?.toLowerCase()===a.toLowerCase()&&this.emitFirstAvailableConnection(),0===this.connections.length&&this.emit("disconnect")}onChainChanged(a,b){let c="string"==typeof a&&a.startsWith("0x")?parseInt(a,16).toString():a.toString(),d=this.getConnection({connectorId:b,connections:this.connections,connectors:this.connectors}),e=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===c);d&&this.addConnection({connectorId:b,accounts:d.accounts,caipNetwork:e}),this.getConnectorId(I.ConstantsUtil.CHAIN.EVM)?.toLowerCase()===b.toLowerCase()&&this.emit("switchNetwork",{chainId:c})}listenProviderEvents(a,b){if(og.includes(a))return;let c=b=>this.onAccountsChanged(b,a),d=b=>this.onChainChanged(b,a),e=()=>this.onDisconnect(a);this.providerHandlers[a]||(b.on("disconnect",e),b.on("accountsChanged",c),b.on("chainChanged",d),this.providerHandlers[a]={provider:b,disconnect:e,accountsChanged:c,chainChanged:d})}removeProviderListeners(a){if(this.providerHandlers[a]){let{provider:b,disconnect:c,accountsChanged:d,chainChanged:e}=this.providerHandlers[a];b.removeListener("disconnect",c),b.removeListener("accountsChanged",d),b.removeListener("chainChanged",e),this.providerHandlers[a]=null}}emitFirstAvailableConnection(){let a=this.getConnection({connections:this.connections,connectors:this.connectors});if(a){let[b]=a.accounts;this.emit("accountChanged",{address:b?.address,chainId:a.caipNetwork?.id,connector:a.connector})}}getConnection({address:a,connectorId:b,connections:c,connectors:d}){if(b){let e=c.find(a=>a.connectorId.toLowerCase()===b.toLowerCase());if(!e)return null;let f=d.find(a=>a.id.toLowerCase()===e.connectorId.toLowerCase()),g=a?e.accounts.find(b=>b.address.toLowerCase()===a.toLowerCase()):e.accounts[0];return{...e,account:g,connector:f}}let e=c.find(a=>a.accounts.length>0&&d.some(b=>b.id.toLowerCase()===a.connectorId.toLowerCase()));if(e){let[a]=e.accounts,b=d.find(a=>a.id.toLowerCase()===e.connectorId.toLowerCase());return{...e,account:a,connector:b}}return null}}class oi{constructor({provider:a,namespace:b}){this.id=I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=L.ChainController.getCaipNetworks.bind(L.ChainController),this.caipNetworks=this.getCaipNetworks(),this.provider=a,this.chain=b}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){let a=this.getCaipNetworks(),b=O.OptionsController.state.universalProviderConfigOverride,c=nR.createNamespaces(a,b);await this.provider.connect({optionalNamespaces:c})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){let a=this.chains.map(a=>a.caipNetworkId);return Z.SIWXUtil.universalProviderAuthenticate({universalProvider:this.provider,chains:a,methods:oj})}}let oj=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];class ok extends oh{async setUniversalProvider(a){if(!this.namespace)throw Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new oi({provider:a,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(a){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(a.chainId),provider:this.provider,address:""})}async disconnect(){try{let a=this.getWalletConnectConnector();await a.disconnect(),this.emit("disconnect")}catch(a){console.warn("UniversalAdapter:disconnect - error",a)}return{connections:[]}}syncConnections(){return Promise.resolve()}async getAccounts({namespace:a}){let b=this.provider;return Promise.resolve({accounts:(b?.session?.namespaces?.[a]?.accounts?.map(a=>{let[,,b]=a.split(":");return b}).filter((a,b,c)=>c.indexOf(a)===b)||[]).map(b=>F.CoreHelperUtil.createAccount(a,b,"bip122"===a?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(a){if(!(a.caipNetwork&&V.ConstantsUtil.BALANCE_SUPPORTED_CHAINS.includes(a.caipNetwork?.chainNamespace))||a.caipNetwork?.testnet)return{balance:"0.00",symbol:a.caipNetwork?.nativeCurrency.symbol||""};let b=L.ChainController.getAccountData();if(b?.balanceLoading&&a.chainId===L.ChainController.state.activeCaipNetwork?.id)return{balance:b?.balance||"0.00",symbol:b?.balanceSymbol||""};let c=(await L.ChainController.fetchTokenBalance()).find(b=>b.chainId===`${a.caipNetwork?.chainNamespace}:${a.chainId}`&&b.symbol===a.caipNetwork?.nativeCurrency.symbol);return{balance:c?.quantity.numeric||"0.00",symbol:c?.symbol||a.caipNetwork?.nativeCurrency.symbol||""}}async signMessage(a){let{provider:b,message:c,address:d}=a;if(!b)throw Error("UniversalAdapter:signMessage - provider is undefined");return{signature:L.ChainController.state.activeCaipNetwork?.chainNamespace===I.ConstantsUtil.CHAIN.SOLANA?(await b.request({method:"solana_signMessage",params:{message:dy.encode(new TextEncoder().encode(c)),pubkey:d}},L.ChainController.state.activeCaipNetwork?.caipNetworkId)).signature:await b.request({method:"personal_sign",params:[c,d]},L.ChainController.state.activeCaipNetwork?.caipNetworkId)}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(a){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return 0n}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(a){let{caipNetwork:b}=a,c=this.getWalletConnectConnector();if(b.chainNamespace===I.ConstantsUtil.CHAIN.EVM)try{await c.provider?.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,oe.toHex)(b.id)}]})}catch(a){if(4902===a.code||32603===a.code||5e3===a.code||a?.data?.originalError?.code===4902)try{await c.provider?.request({method:"wallet_addEthereumChain",params:[{chainId:(0,oe.toHex)(b.id),rpcUrls:[b?.rpcUrls.chainDefault?.http],chainName:b.name,nativeCurrency:b.nativeCurrency,blockExplorerUrls:[b.blockExplorers?.default.url]}]})}catch(a){throw Error("Chain is not supported")}}c.provider.setDefaultChain(b.caipNetworkId)}getWalletConnectProvider(){let a=this.connectors.find(a=>"WALLET_CONNECT"===a.type);return a?.provider}}let ol=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication"],om={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.includes("email")},processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.email:!!a},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b.filter(a=>"email"!==a)},processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.socials:"boolean"==typeof a?!!a&&V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.socials:a},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b},processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.swaps:"boolean"==typeof a?!!a&&V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.swaps:a},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>{if(!a?.config)return!1;let b=a.config;return!!a.isEnabled&&b.length>0&&b},processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.onramp:"boolean"==typeof a?!!a&&V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.onramp:a},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.activity:!!a},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.reownBranding:!!a},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>a.isEnabled&&(a.config??[]),processFallback:a=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:()=>V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:()=>V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:()=>V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:a=>!!a.isEnabled,processFallback:a=>void 0===a?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!a}},on={localSettingsOverridden:new Set,getApiConfig:(a,b)=>b?.find(b=>b.id===a),addWarning(a,b){if(void 0!==a){let a=om[b],c=a.isLegacy?`"features.${a.localFeatureName}" (now "${b}")`:`"features.${b}"`;this.localSettingsOverridden.add(c)}},processFeature(a,b,c,d,e){let f=om[a],g=b[f.localFeatureName];if(e&&!f.isAvailableOnBasic)return!1;if(d){let b=this.getApiConfig(f.apiFeatureName,c);return b?.config===null?this.processFallbackFeature(a,g):!!b?.config&&(void 0!==g&&this.addWarning(g,a),this.processApiFeature(a,b))}return this.processFallbackFeature(a,g)},processApiFeature:(a,b)=>om[a].processApi(b),processFallbackFeature:(a,b)=>om[a].processFallback(b),async fetchRemoteFeatures(a){let b=a.basic??!1,c=a.features||{};this.localSettingsOverridden.clear();let d=null,e=!1;try{e=null!=(d=await U.ApiController.fetchProjectConfig())}catch(a){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",a)}let f=e&&!b?V.ConstantsUtil.DEFAULT_REMOTE_FEATURES:V.ConstantsUtil.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(let a of ol){let g=this.processFeature(a,c,d,e,b);Object.assign(f,{[a]:g})}}catch(a){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",a),V.ConstantsUtil.DEFAULT_REMOTE_FEATURES}if(e&&this.localSettingsOverridden.size>0){let a=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;J.AlertController.open({debugMessage:aa.ErrorUtil.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(a)},"warning")}return f}};class oo{constructor(a){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(a,b)=>{if(a){let c=L.ChainController.getCaipNetworks(a)?.find(a=>a.id===b);if(c)return c;let d=L.ChainController.getNetworkData(a)?.caipNetwork;if(d)return d;let e=L.ChainController.getRequestedCaipNetworks(a);return e.filter(b=>b.chainNamespace===a)?.[0]}return L.ChainController.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{let a=this.getCaipNetwork();if(a)return a.id},this.getCaipNetworks=a=>L.ChainController.getCaipNetworks(a),this.getActiveChainNamespace=()=>L.ChainController.state.activeChain,this.setRequestedCaipNetworks=(a,b)=>{L.ChainController.setRequestedCaipNetworks(a,b)},this.getApprovedCaipNetworkIds=()=>L.ChainController.getAllApprovedCaipNetworkIds(),this.getCaipAddress=a=>L.ChainController.state.activeChain!==a&&a?L.ChainController.state.chains.get(a)?.accountState?.caipAddress:L.ChainController.state.activeCaipAddress,this.setClientId=a=>{nK.BlockchainApiController.setClientId(a)},this.getProvider=a=>P.ProviderController.getProvider(a),this.getProviderType=a=>P.ProviderController.getProviderId(a),this.getPreferredAccountType=a=>(0,$.getPreferredAccountType)(a),this.setCaipAddress=(a,b,c=!1)=>{L.ChainController.setAccountProp("caipAddress",a,b,c),L.ChainController.setAccountProp("address",F.CoreHelperUtil.getPlainAddress(a),b,c)},this.setBalance=(a,b,c)=>{L.ChainController.setAccountProp("balance",a,c),L.ChainController.setAccountProp("balanceSymbol",b,c)},this.setProfileName=(a,b)=>{L.ChainController.setAccountProp("profileName",a,b)},this.setProfileImage=(a,b)=>{L.ChainController.setAccountProp("profileImage",a,b)},this.setUser=(a,b)=>{L.ChainController.setAccountProp("user",a,b)},this.resetAccount=a=>{L.ChainController.resetAccount(a)},this.setCaipNetwork=a=>{L.ChainController.setActiveCaipNetwork(a)},this.setCaipNetworkOfNamespace=(a,b)=>{L.ChainController.setChainNetworkData(b,{caipNetwork:a})},this.setStatus=(a,b)=>{L.ChainController.setAccountProp("status",a,b),N.ConnectorController.isConnected()?S.StorageUtil.setConnectionStatus("connected"):S.StorageUtil.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=a=>L.ChainController.getAccountData(a)?.address,this.setConnectors=a=>{let b=[...N.ConnectorController.state.allConnectors,...a];N.ConnectorController.setConnectors(b)},this.setConnections=(a,b)=>{S.StorageUtil.setConnections(a,b),M.ConnectionController.setConnections(a,b)},this.fetchIdentity=a=>nK.BlockchainApiController.fetchIdentity(a),this.getReownName=a=>nL.EnsController.getNamesForAddress(a),this.getConnectors=()=>N.ConnectorController.getConnectors(),this.getConnectorImage=a=>R.AssetUtil.getConnectorImage(a),this.getConnections=a=>this.remoteFeatures.multiWallet?Q.ConnectionControllerUtil.getConnectionsData(a).connections:(J.AlertController.open(I.ConstantsUtil.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=a=>this.remoteFeatures.multiWallet?Q.ConnectionControllerUtil.getConnectionsData(a).recentConnections:(J.AlertController.open(I.ConstantsUtil.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async a=>{this.remoteFeatures.multiWallet?await M.ConnectionController.switchConnection(a):J.AlertController.open(I.ConstantsUtil.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info")},this.deleteConnection=a=>{this.remoteFeatures.multiWallet?(S.StorageUtil.deleteAddressFromConnection(a),M.ConnectionController.syncStorageConnections()):J.AlertController.open(I.ConstantsUtil.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info")},this.setConnectedWalletInfo=(a,b)=>{let c=P.ProviderController.getProviderId(b),d=a?{...a,type:c}:void 0;L.ChainController.setAccountProp("connectedWalletInfo",d,b)},this.getIsConnectedState=()=>!!L.ChainController.state.activeCaipAddress,this.addAddressLabel=(a,b,c)=>{let d=L.ChainController.getAccountData(c)?.addressLabels||{};L.ChainController.setAccountProp("addressLabels",{...d,[a]:b},c)},this.removeAddressLabel=(a,b)=>{let c=L.ChainController.getAccountData(b)?.addressLabels||{};L.ChainController.setAccountProp("addressLabels",{...c,[a]:void 0},b)},this.getAddress=a=>{let b=a||L.ChainController.state.activeChain;return L.ChainController.getAccountData(b)?.address},this.resetNetwork=a=>{L.ChainController.resetNetwork(a)},this.addConnector=a=>{N.ConnectorController.addConnector(a)},this.resetWcConnection=()=>{M.ConnectionController.resetWcConnection()},this.setAddressExplorerUrl=(a,b)=>{L.ChainController.setAccountProp("addressExplorerUrl",a,b)},this.setSmartAccountDeployed=(a,b)=>{L.ChainController.setAccountProp("smartAccountDeployed",a,b)},this.setPreferredAccountType=(a,b)=>{L.ChainController.setAccountProp("preferredAccountType",a,b)},this.setEIP6963Enabled=a=>{O.OptionsController.setEIP6963Enabled(a)},this.handleUnsafeRPCRequest=()=>{this.isOpen()?this.isTransactionStackEmpty()||this.redirect("ApproveTransaction"):this.open({view:"ApproveTransaction"})},this.options=a,this.version=a.sdkVersion,this.caipNetworks=this.extendCaipNetworks(a),this.chainNamespaces=this.getChainNamespacesSet(a.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(a),this.chainAdapters=this.createAdapters(a.adapters),this.readyPromise=this.initialize(a)}getChainNamespacesSet(a,b){let c=a?.map(a=>a.namespace).filter(a=>!!a);return c?.length?[...new Set(c)]:[...new Set(b?.map(a=>a.chainNamespace))]}async initialize(b){if(this.initializeProjectSettings(b),this.initControllers(b),await this.initChainAdapters(),this.sendInitializeEvent(b),O.OptionsController.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),b.basic||b.manualWCControl||(this.remoteFeatures=await on.fetchRemoteFeatures(b)),await U.ApiController.fetchUsage(),O.OptionsController.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&nN.OnRampController.setOnrampProviders(this.remoteFeatures.onramp),(O.OptionsController.state.remoteFeatures?.email||Array.isArray(O.OptionsController.state.remoteFeatures?.socials)&&O.OptionsController.state.remoteFeatures?.socials.length>0)&&await this.checkAllowedOrigins(),O.OptionsController.state.features?.reownAuthentication||O.OptionsController.state.remoteFeatures?.reownAuthentication){let{ReownAuthentication:b}=await a.A(605865),c=O.OptionsController.state.siwx;c instanceof b||(c&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),O.OptionsController.setSIWX(new b))}}async openSend(a){let b=a.namespace||L.ChainController.state.activeChain,c=this.getCaipAddress(b),d=this.getCaipNetwork(b)?.id;if(!c)throw Error("openSend: caipAddress not found");if(d?.toString()!==a.chainId.toString()){let c=L.ChainController.getCaipNetworkById(a.chainId,b);if(!c)throw Error(`openSend: caipNetwork with chainId ${a.chainId} not found`);await this.switchNetwork(c,{throwOnFailure:!0})}try{let b=od.getTokenSymbolByAddress(a.assetAddress);b&&await U.ApiController.fetchTokenImages([b])}catch{}return await nM.ModalController.open({view:"WalletSend",data:{send:a}}),new Promise((a,b)=>{let c=nO.SendController.subscribeKey("hash",b=>{b&&(e(),a({hash:b}))}),d=nM.ModalController.subscribe(a=>{a.open||(e(),b(Error("Modal closed")))}),e=this.createCleanupHandler([c,d])})}toModalOptions(){return{isSwap:function(a){return a?.view==="Swap"},isSend:function(a){return a?.view==="WalletSend"}}}async checkAllowedOrigins(){try{let a=await U.ApiController.fetchAllowedOrigins();if(!F.CoreHelperUtil.isClient())return;let b=window.location.origin;nR.isOriginAllowed(b,a,I.ConstantsUtil.DEFAULT_ALLOWED_ANCESTORS)||J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(a){if(!(a instanceof Error))return;switch(a.message){case"RATE_LIMITED":J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{let b=a.cause instanceof Error?a.cause:a;J.AlertController.open({displayMessage:aa.ErrorUtil.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:aa.ErrorUtil.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(b.message)},"error")}}}}createCleanupHandler(a){return()=>{a.forEach(a=>{try{a()}catch{}})}}sendInitializeEvent(a){let{...b}=a;delete b.adapters,delete b.universalProvider,W.EventsController.sendEvent({type:"track",event:"INITIALIZE",properties:{...b,networks:a.networks.map(a=>a.id),siweConfig:{options:a.siweConfig?.options||{}}}})}initControllers(a){this.initializeOptionsController(a),this.initializeChainController(a),this.initializeThemeController(a),this.initializeConnectionController(a),this.initializeConnectorController()}initAdapterController(){nJ.AdapterController.initialize(this.chainAdapters)}initializeThemeController(a){a.themeMode&&_.ThemeController.setThemeMode(a.themeMode),a.themeVariables&&_.ThemeController.setThemeVariables(a.themeVariables)}initializeChainController(a){if(!this.connectionControllerClient)throw Error("ConnectionControllerClient must be set");L.ChainController.initialize(a.adapters??[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});let b=this.getDefaultNetwork();b&&L.ChainController.setActiveCaipNetwork(b)}initializeConnectionController(a){M.ConnectionController.initialize(a.adapters??[]),M.ConnectionController.setWcBasic(a.basic??!1)}initializeConnectorController(){N.ConnectorController.initialize(this.chainNamespaces)}initializeProjectSettings(a){O.OptionsController.setProjectId(a.projectId),O.OptionsController.setSdkVersion(a.sdkVersion)}initializeOptionsController(a){O.OptionsController.setDebug(!1!==a.debug),O.OptionsController.setEnableWalletGuide(!1!==a.enableWalletGuide),O.OptionsController.setEnableWallets(!1!==a.enableWallets),O.OptionsController.setEIP6963Enabled(!1!==a.enableEIP6963),O.OptionsController.setEnableNetworkSwitch(!1!==a.enableNetworkSwitch),O.OptionsController.setEnableReconnect(!1!==a.enableReconnect),O.OptionsController.setEnableMobileFullScreen(!0===a.enableMobileFullScreen),O.OptionsController.setCoinbasePreference(a.coinbasePreference),O.OptionsController.setEnableAuthLogger(!1!==a.enableAuthLogger),O.OptionsController.setCustomRpcUrls(a.customRpcUrls),O.OptionsController.setEnableEmbedded(a.enableEmbedded),O.OptionsController.setAllWallets(a.allWallets),O.OptionsController.setIncludeWalletIds(a.includeWalletIds),O.OptionsController.setExcludeWalletIds(a.excludeWalletIds),O.OptionsController.setFeaturedWalletIds(a.featuredWalletIds),O.OptionsController.setTokens(a.tokens),O.OptionsController.setTermsConditionsUrl(a.termsConditionsUrl),O.OptionsController.setPrivacyPolicyUrl(a.privacyPolicyUrl),O.OptionsController.setCustomWallets(a.customWallets),O.OptionsController.setFeatures(a.features),O.OptionsController.setAllowUnsupportedChain(a.allowUnsupportedChain),O.OptionsController.setUniversalProviderConfigOverride(a.universalProviderConfigOverride),O.OptionsController.setPreferUniversalLinks(a.experimental_preferUniversalLinks),O.OptionsController.setDefaultAccountTypes(a.defaultAccountTypes);let b=this.getDefaultMetaData();if(!a.metadata&&b&&(a.metadata=b),O.OptionsController.setMetadata(a.metadata),O.OptionsController.setDisableAppend(a.disableAppend),O.OptionsController.setEnableEmbedded(a.enableEmbedded),O.OptionsController.setSIWX(a.siwx),this.features=O.OptionsController.state.features??{},!a.projectId)return void J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");if(a.adapters?.find(a=>a.namespace===I.ConstantsUtil.CHAIN.EVM)&&a.siweConfig){if(a.siwx)throw Error("Cannot set both `siweConfig` and `siwx` options");O.OptionsController.setSIWX(a.siweConfig.mapToSIWX())}}getDefaultMetaData(){return F.CoreHelperUtil.isClient()?{name:document.getElementsByTagName("title")?.[0]?.textContent||"",description:document.querySelector('meta[property="og:description"]')?.content||"",url:window.location.origin,icons:[document.querySelector('link[rel~="icon"]')?.href||""]}:null}setUnsupportedNetwork(a){let b=this.getActiveChainNamespace();if(b){let c=nU.CaipNetworksUtil.getUnsupportedNetwork(`${b}:${a}`);L.ChainController.setActiveCaipNetwork(c)}}getDefaultNetwork(){return nU.CaipNetworksUtil.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(a,b){return nU.CaipNetworksUtil.extendCaipNetwork(a,{customNetworkImageUrls:b.chainImages,projectId:b.projectId})}extendCaipNetworks(a){return nU.CaipNetworksUtil.extendCaipNetworks(a.networks,{customNetworkImageUrls:a.chainImages,customRpcUrls:a.customRpcUrls,projectId:a.projectId})}extendDefaultCaipNetwork(a){let b=a.networks.find(b=>b.id===a.defaultNetwork?.id);return b?nU.CaipNetworksUtil.extendCaipNetwork(b,{customNetworkImageUrls:a.chainImages,customRpcUrls:a.customRpcUrls,projectId:a.projectId}):void 0}async disconnectConnector(a,b){try{this.setLoading(!0,a);let c={connections:[]},d=this.getAdapter(a);return(L.ChainController.state.chains.get(a)?.accountState?.caipAddress||!O.OptionsController.state.enableReconnect)&&d?.disconnect&&(c=await d.disconnect({id:b})),this.setLoading(!1,a),c}catch(b){throw this.setLoading(!1,a),Error(`Failed to disconnect chains: ${b.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{let a=L.ChainController.state.activeChain,b=this.getAdapter(a),c=this.getCaipNetwork(a)?.id,d=M.ConnectionController.getConnections(a),e=this.remoteFeatures.multiWallet,f=d.length>0;if(!b)throw Error("Adapter not found");let g=await b.connectWalletConnect(c);f&&e||this.close(),this.setClientId(g?.clientId||null),S.StorageUtil.setConnectedNamespaces([...L.ChainController.state.chains.keys()]),await this.syncWalletConnectAccount(),await Z.SIWXUtil.initializeIfEnabled()},connectExternal:async a=>{let b=await this.onConnectExternal(a);return await this.connectInactiveNamespaces(a,b),b?{address:b.address}:void 0},reconnectExternal:async({id:a,info:b,type:c,provider:d})=>{let e=L.ChainController.state.activeChain,f=this.getAdapter(e);if(!e)throw Error("reconnectExternal: namespace not found");if(!f)throw Error("reconnectExternal: adapter not found");f?.reconnect&&(await f?.reconnect({id:a,info:b,type:c,provider:d,chainId:this.getCaipNetwork()?.id}),S.StorageUtil.addConnectedNamespace(e),this.syncConnectedWalletInfo(e))},disconnectConnector:async a=>{await this.disconnectConnector(a.namespace,a.id)},disconnect:async a=>{let{id:b,chainNamespace:c,initialDisconnect:d}=a||{},e=c||L.ChainController.state.activeChain,f=N.ConnectorController.getConnectorId(e),g=b===I.ConstantsUtil.CONNECTOR_ID.AUTH||f===I.ConstantsUtil.CONNECTOR_ID.AUTH,h=b===I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT||f===I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT;try{let a=Array.from(L.ChainController.state.chains.keys()),e=c?[c]:a;(h||g)&&(e=a);let f=e.map(async a=>{let c=N.ConnectorController.getConnectorId(a),e=await this.disconnectConnector(a,b||c);e&&(g&&S.StorageUtil.deleteConnectedSocialProvider(),e.connections.forEach(b=>{S.StorageUtil.addDisconnectedConnectorId(b.connectorId,a)})),d&&this.onDisconnectNamespace({chainNamespace:a,closeModal:!1})}),i=await Promise.allSettled(f);nO.SendController.resetSend(),M.ConnectionController.resetWcConnection(),Z.SIWXUtil.getSIWX()?.signOutOnDisconnect&&await Z.SIWXUtil.clearSessions(),N.ConnectorController.setFilterByNamespace(void 0),M.ConnectionController.syncStorageConnections();let j=i.filter(a=>"rejected"===a.status);if(j.length>0)throw Error(j.map(a=>a.reason.message).join(", "));W.EventsController.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:c||"all"}})}catch(a){throw Error(`Failed to disconnect chains: ${a.message}`)}},checkInstalled:a=>a?a.some(a=>!!window.ethereum?.[String(a)]):!!window.ethereum,signMessage:async a=>{let b=L.ChainController.state.activeChain,c=this.getAdapter(L.ChainController.state.activeChain);if(!b)throw Error("signMessage: namespace not found");if(!c)throw Error("signMessage: adapter not found");let d=this.getAddress(b);if(!d)throw Error("signMessage: address not found");let e=await c?.signMessage({message:a,address:d,provider:P.ProviderController.getProvider(b)});return e?.signature||""},sendTransaction:async a=>{let b=a.chainNamespace;if(!b)throw Error("sendTransaction: namespace not found");if(V.ConstantsUtil.SEND_SUPPORTED_NAMESPACES.includes(b)){let c=this.getAdapter(b);if(!c)throw Error("sendTransaction: adapter not found");let d=P.ProviderController.getProvider(b),e=await c?.sendTransaction({...a,caipNetwork:this.getCaipNetwork(),provider:d});return e?.hash||""}return""},estimateGas:async a=>{let b=a.chainNamespace;if(b===I.ConstantsUtil.CHAIN.EVM){let c=this.getAdapter(b);if(!c)throw Error("estimateGas: adapter is required but got undefined");let d=P.ProviderController.getProvider(b),e=this.getCaipNetwork();if(!e)throw Error("estimateGas: caipNetwork is required but got undefined");let f=await c?.estimateGas({...a,provider:d,caipNetwork:e});return f?.gas||0n}return 0n},getEnsAvatar:async()=>{let a=L.ChainController.state.activeChain;if(!a)throw Error("getEnsAvatar: namespace is required but got undefined");let b=this.getAddress(a);if(!b)throw Error("getEnsAvatar: address not found");await this.syncIdentity({address:b,chainId:Number(this.getCaipNetwork()?.id),chainNamespace:a});let c=L.ChainController.getAccountData();return c?.profileImage||!1},getEnsAddress:async a=>await nR.resolveReownName(a),writeContract:async a=>{let b=L.ChainController.state.activeChain,c=this.getAdapter(b);if(!b)throw Error("writeContract: namespace is required but got undefined");if(!c)throw Error("writeContract: adapter is required but got undefined");let d=this.getCaipNetwork(),e=this.getCaipAddress(),f=P.ProviderController.getProvider(b);if(!d||!e)throw Error("writeContract: caipNetwork or caipAddress is required but got undefined");let g=await c?.writeContract({...a,caipNetwork:d,provider:f,caipAddress:e});return g?.hash},parseUnits:(a,b)=>{let c=this.getAdapter(L.ChainController.state.activeChain);if(!c)throw Error("parseUnits: adapter is required but got undefined");return c?.parseUnits({value:a,decimals:b})??0n},formatUnits:(a,b)=>{let c=this.getAdapter(L.ChainController.state.activeChain);if(!c)throw Error("formatUnits: adapter is required but got undefined");return c?.formatUnits({value:a,decimals:b})??"0"},getCapabilities:async a=>{let b=this.getAdapter(L.ChainController.state.activeChain);if(!b)throw Error("getCapabilities: adapter is required but got undefined");return await b?.getCapabilities(a)},grantPermissions:async a=>{let b=this.getAdapter(L.ChainController.state.activeChain);if(!b)throw Error("grantPermissions: adapter is required but got undefined");return await b?.grantPermissions(a)},revokePermissions:async a=>{let b=this.getAdapter(L.ChainController.state.activeChain);if(!b)throw Error("revokePermissions: adapter is required but got undefined");return b?.revokePermissions?await b.revokePermissions(a):"0x"},walletGetAssets:async a=>{let b=this.getAdapter(L.ChainController.state.activeChain);if(!b)throw Error("walletGetAssets: adapter is required but got undefined");return await b?.walletGetAssets(a)??{}},updateBalance:a=>{let b=this.getAddress(a),c=this.getCaipNetwork(a);c&&b&&this.updateNativeBalance(b,c?.id,a)}},M.ConnectionController.setClient(this.connectionControllerClient)}async onConnectExternal(a){let b=L.ChainController.state.activeChain,c=a.chain||b,d=this.getAdapter(c),e=!0;if(a.type===ac.ConstantsUtil.CONNECTOR_TYPE_AUTH&&I.ConstantsUtil.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(a=>N.ConnectorController.getConnectorId(a)===I.ConstantsUtil.CONNECTOR_ID.AUTH)&&a.chain!==b&&(e=!1),a.chain&&a.chain!==b&&!a.caipNetwork){let b=this.getCaipNetworks().find(b=>b.chainNamespace===a.chain);b&&e&&this.setCaipNetwork(b)}if(!c)throw Error("connectExternal: namespace not found");if(!d)throw Error("connectExternal: adapter not found");let f=this.getCaipNetwork(c),g=a.caipNetwork||f,h=await d.connect({id:a.id,address:a.address,info:a.info,type:a.type,provider:a.provider,socialUri:a.socialUri,chainId:a.caipNetwork?.id||f?.id,rpcUrl:a.caipNetwork?.rpcUrls?.default?.http?.[0]||f?.rpcUrls?.default?.http?.[0]});if(h)return S.StorageUtil.addConnectedNamespace(c),this.syncProvider({...h,chainNamespace:c}),this.setStatus("connected",c),this.syncConnectedWalletInfo(c),S.StorageUtil.removeDisconnectedConnectorId(a.id,c),{address:h.address,connectedCaipNetwork:g}}async connectInactiveNamespaces(a,b){let c=a.type===ac.ConstantsUtil.CONNECTOR_TYPE_AUTH,d=ab.HelpersUtil.getOtherAuthNamespaces(b?.connectedCaipNetwork?.chainNamespace),e=L.ChainController.state.activeCaipNetwork,f=this.getAdapter(e?.chainNamespace);c&&(await Promise.all(d.map(async b=>{try{let c=P.ProviderController.getProvider(b),d=this.getCaipNetwork(b),e=this.getAdapter(b);await e?.connect({...a,provider:c,socialUri:void 0,chainId:d?.id,rpcUrl:d?.rpcUrls?.default?.http?.[0]})&&(S.StorageUtil.addConnectedNamespace(b),S.StorageUtil.removeDisconnectedConnectorId(a.id,b),this.setStatus("connected",b),this.syncConnectedWalletInfo(b))}catch(a){J.AlertController.warn(aa.ErrorUtil.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,aa.ErrorUtil.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(b,a instanceof Error?a.message:void 0),aa.ErrorUtil.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),e&&await f?.switchNetwork({caipNetwork:e}))}getApprovedCaipNetworksData(){if(P.ProviderController.getProviderId(L.ChainController.state.activeChain)===ac.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT){let a=this.universalProvider?.session?.namespaces;return{supportsAllNetworks:this.universalProvider?.session?.peer?.metadata.name==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(a){let b=a.chainNamespace;if(this.getAddressByChainNamespace(a.chainNamespace)){let c=P.ProviderController.getProviderId(b);if(a.chainNamespace===L.ChainController.state.activeChain){let c=this.getAdapter(b);await c?.switchNetwork({caipNetwork:a})}else if(this.setCaipNetwork(a),c===ac.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{let c=this.getAddressByChainNamespace(b);c&&this.syncAccount({address:c,chainId:a.id,chainNamespace:b})}}else this.setCaipNetwork(a)}getChainsFromNamespaces(a={}){return Object.values(a).flatMap(a=>Array.from(new Set([...a.chains||[],...a.accounts.map(a=>{let{chainId:b,chainNamespace:c}=nI.ParseUtil.parseCaipAddress(a);return`${c}:${b}`})])))}createAdapters(a){return this.createClients(),this.chainNamespaces.reduce((b,c)=>{let d=a?.find(a=>a.namespace===c);return d?(d.construct({namespace:c,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:a})=>a===c)}),b[c]=d):b[c]=new ok({namespace:c,networks:this.getCaipNetworks()}),b},{})}async initChainAdapter(a){this.onConnectors(a),this.listenAdapter(a);let b=this.getAdapter(a);if(!b)throw Error("adapter not found");await b.syncConnectors(),await this.createUniversalProviderForAdapter(a)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async a=>{await this.initChainAdapter(a)})),this.initAdapterController()}onConnectors(a){let b=this.getAdapter(a);b?.on("connectors",this.setConnectors.bind(this))}listenAdapter(a){let b=this.getAdapter(a);if(!b)return;let c=S.StorageUtil.getConnectionStatus();!1===O.OptionsController.state.enableReconnect?this.setStatus("disconnected",a):"connected"===c?this.setStatus("connecting",a):("disconnected"===c&&S.StorageUtil.clearAddressCache(),this.setStatus(c,a)),b.on("switchNetwork",({address:b,chainId:c})=>{let d=this.getCaipNetworks().find(a=>a.id.toString()===c.toString()||a.caipNetworkId.toString()===c.toString()),e=L.ChainController.state.activeChain===a,f=L.ChainController.state.chains.get(a)?.accountState?.address;if(d){let c=e&&b?b:f;c&&this.syncAccount({address:c,chainId:d.id,chainNamespace:a})}else this.setUnsupportedNetwork(c)}),b.on("disconnect",()=>{let b=this.remoteFeatures.multiWallet,c=Array.from(M.ConnectionController.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:a,closeModal:!b||0===c.length})}),b.on("connections",b=>{this.setConnections(b,a)}),b.on("pendingTransactions",()=>{let b=this.getAddress(a),c=L.ChainController.state.activeCaipNetwork;b&&c?.id&&this.updateNativeBalance(b,c.id,c.chainNamespace)}),b.on("accountChanged",({address:b,chainId:c,connector:d})=>{this.handlePreviousConnectorConnection(d);let e=L.ChainController.state.activeChain===a;d?.provider&&(this.syncProvider({id:d.id,type:d.type,provider:d?.provider,chainNamespace:a}),this.syncConnectedWalletInfo(a));let f=L.ChainController.getNetworkData(a)?.caipNetwork?.id,g=c||f;e&&g?this.syncAccount({address:b,chainId:g,chainNamespace:a}):!e&&g?(this.syncAccountInfo(b,g,a),this.syncBalance({address:b,chainId:g,chainNamespace:a})):this.syncAccountInfo(b,c,a),S.StorageUtil.addConnectedNamespace(a)})}async handlePreviousConnectorConnection(a){let b=a?.chain,c=a?.id,d=N.ConnectorController.getConnectorId(b),e=O.OptionsController.state.remoteFeatures?.multiWallet,f=d!==c,g=b&&c&&d&&f&&!e;try{g&&await M.ConnectionController.disconnect({id:d,namespace:b})}catch(a){console.warn("Error disconnecting previous connector",a)}}async createUniversalProviderForAdapter(a){await this.getUniversalProvider(),this.universalProvider&&await this.chainAdapters?.[a]?.setUniversalProvider?.(this.universalProvider)}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(a=>this.syncNamespaceConnection(a)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(a=>M.ConnectionController.disconnect({namespace:a,initialDisconnect:!0})))}catch(a){console.error("Error disconnecting existing connections:",a)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();let a=this.getAddress();this.getCaipAddress()||S.StorageUtil.deleteRecentWallet();let b=S.StorageUtil.getRecentWallet();W.EventsController.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:a,properties:{method:F.CoreHelperUtil.isMobile()?"mobile":"qrcode",name:b?.name||"Unknown",reconnect:!0,view:Y.RouterController.state.view,walletRank:b?.order}})}async syncNamespaceConnection(a){try{a===I.ConstantsUtil.CHAIN.EVM&&F.CoreHelperUtil.isSafeApp()&&N.ConnectorController.setConnectorId(I.ConstantsUtil.CONNECTOR_ID.SAFE,a);let b=N.ConnectorController.getConnectorId(a);switch(this.setStatus("connecting",a),b){case I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case I.ConstantsUtil.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(a)}}catch(b){console.warn("AppKit couldn't sync existing connection",b),this.setStatus("disconnected",a)}}onDisconnectNamespace(a){let{chainNamespace:b,closeModal:c}=a||{};L.ChainController.resetAccount(b),L.ChainController.resetNetwork(b),S.StorageUtil.removeConnectedNamespace(b);let d=Array.from(L.ChainController.state.chains.keys());(b?[b]:d).forEach(a=>S.StorageUtil.addDisconnectedConnectorId(N.ConnectorController.getConnectorId(a)||"",a)),N.ConnectorController.removeConnectorId(b),P.ProviderController.resetChain(b),this.setUser(null,b),this.setStatus("disconnected",b),this.setConnectedWalletInfo(null,b),!1!==c&&nM.ModalController.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(a=>{let b=this.getAdapter(a),c=this.getCaipAddress(a),d=this.getCaipNetwork(a);return b?.syncConnections({connectToFirstConnector:!c,caipNetwork:d})}))}async syncAdapterConnection(a){let b=this.getAdapter(a),c=this.getCaipNetwork(a),d=N.ConnectorController.getConnectorId(a),e=N.ConnectorController.getConnectors(a).find(a=>a.id===d);try{if(!b||!e)throw Error(`Adapter or connector not found for namespace ${a}`);if(!c?.id)throw Error("CaipNetwork not found");let d=await b?.syncConnection({namespace:a,id:e.id,chainId:c.id,rpcUrl:c?.rpcUrls?.default?.http?.[0]});d?(this.syncProvider({...d,chainNamespace:a}),await this.syncAccount({...d,chainNamespace:a}),this.setStatus("connected",a),W.EventsController.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:d.address,properties:{method:"browser",name:e.info?.name||e.name||"Unknown",reconnect:!0,view:Y.RouterController.state.view,walletRank:void 0}})):this.setStatus("disconnected",a)}catch(b){this.onDisconnectNamespace({chainNamespace:a,closeModal:!1})}}async syncWalletConnectAccount(){let a=Object.keys(this.universalProvider?.session?.namespaces||{}),b=this.chainNamespaces.map(async b=>{let c=this.getAdapter(b);if(!c)return;let d=this.universalProvider?.session?.namespaces?.[b]?.accounts||[],e=L.ChainController.state.activeCaipNetwork?.id,f=d.find(a=>{let{chainId:b}=nI.ParseUtil.parseCaipAddress(a);return b===e?.toString()})||d[0];if(f){let a=nI.ParseUtil.validateCaipAddress(f),{chainId:d,address:e}=nI.ParseUtil.parseCaipAddress(a);if(P.ProviderController.setProviderId(b,ac.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&L.ChainController.state.activeCaipNetwork&&c.namespace!==I.ConstantsUtil.CHAIN.EVM){let a=c.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:L.ChainController.state.activeCaipNetwork});P.ProviderController.setProvider(b,a)}else P.ProviderController.setProvider(b,this.universalProvider);N.ConnectorController.setConnectorId(I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT,b),S.StorageUtil.addConnectedNamespace(b),await this.syncAccount({address:e,chainId:d,chainNamespace:b})}else a.includes(b)&&this.setStatus("disconnected",b);let g=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(b),L.ChainController.setApprovedCaipNetworksData(b,{approvedCaipNetworkIds:g.approvedCaipNetworkIds,supportsAllNetworks:g.supportsAllNetworks})});await Promise.all(b)}syncProvider({type:a,provider:b,id:c,chainNamespace:d}){P.ProviderController.setProviderId(d,a),P.ProviderController.setProvider(d,b),N.ConnectorController.setConnectorId(c,d)}async syncAccount(a){let b=a.chainNamespace===L.ChainController.state.activeChain,c=L.ChainController.getCaipNetworkByNamespace(a.chainNamespace,a.chainId),{address:d,chainId:e,chainNamespace:f}=a,{chainId:g}=S.StorageUtil.getActiveNetworkProps(),h=c?.id||g,i=L.ChainController.state.activeCaipNetwork?.name===I.ConstantsUtil.UNSUPPORTED_NETWORK_NAME,j=L.ChainController.getNetworkProp("supportsAllNetworks",f);if(this.setStatus("connected",f),(!i||j)&&h){let a=this.getCaipNetworks().find(a=>a.id.toString()===h.toString()),g=this.getCaipNetworks().find(a=>a.chainNamespace===f);if(!j&&!a&&!g){let b=this.getApprovedCaipNetworkIds()||[],c=b.find(a=>nI.ParseUtil.parseCaipNetworkId(a)?.chainId===h.toString()),d=b.find(a=>nI.ParseUtil.parseCaipNetworkId(a)?.chainNamespace===f);a=this.getCaipNetworks().find(a=>a.caipNetworkId===c),g=this.getCaipNetworks().find(a=>a.caipNetworkId===d||"deprecatedCaipNetworkId"in a&&a.deprecatedCaipNetworkId===d)}let i=a||g;i?.chainNamespace===L.ChainController.state.activeChain?O.OptionsController.state.enableNetworkSwitch&&!O.OptionsController.state.allowUnsupportedChain&&L.ChainController.state.activeCaipNetwork?.name===I.ConstantsUtil.UNSUPPORTED_NETWORK_NAME?L.ChainController.showUnsupportedChainUI():this.setCaipNetwork(i):!b&&c&&this.setCaipNetworkOfNamespace(c,f),this.syncConnectedWalletInfo(f);let k=this.getAddress(f);ab.HelpersUtil.isLowerCaseMatch(d,k)||this.syncAccountInfo(d,i?.id,f),b?await this.syncBalance({address:d,chainId:i?.id,chainNamespace:f}):await this.syncBalance({address:d,chainId:c?.id,chainNamespace:f}),this.syncIdentity({address:d,chainId:e,chainNamespace:f})}}async syncAccountInfo(a,b,c){let d=this.getCaipAddress(c),e=b||d?.split(":")[1];if(!e)return;let f=`${c}:${e}:${a}`;this.setCaipAddress(f,c,!0),await this.syncIdentity({address:a,chainId:e,chainNamespace:c})}async syncReownName(a,b){try{let c=await this.getReownName(a);if(c[0]){let a=c[0];this.setProfileName(a.name,b)}else this.setProfileName(null,b)}catch{this.setProfileName(null,b)}}syncConnectedWalletInfo(a){let b=N.ConnectorController.getConnectorId(a),c=P.ProviderController.getProviderId(a);if(c===ac.ConstantsUtil.CONNECTOR_TYPE_ANNOUNCED||c===ac.ConstantsUtil.CONNECTOR_TYPE_INJECTED){if(b){let c=this.getConnectors().find(a=>{let c=a.id===b,d=a.info?.rdns===b,e=a.connectors?.some(a=>a.id===b||a.info?.rdns===b);return c||d||!!e});if(c){let{info:b,name:d,imageUrl:e}=c,f=e||this.getConnectorImage(c);this.setConnectedWalletInfo({name:d,icon:f,...b},a)}}}else if(c===ac.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT){let b=P.ProviderController.getProvider(a);b?.session&&this.setConnectedWalletInfo({...b.session.peer.metadata,name:b.session.peer.metadata.name,icon:b.session.peer.metadata.icons?.[0]},a)}else if(b&&(b===I.ConstantsUtil.CONNECTOR_ID.COINBASE_SDK||b===I.ConstantsUtil.CONNECTOR_ID.COINBASE)){let c=this.getConnectors().find(a=>a.id===b),d=c?.name||"Coinbase Wallet",e=c?.imageUrl||this.getConnectorImage(c),f=c?.info;this.setConnectedWalletInfo({...f,name:d,icon:e},a)}}async syncBalance(a){nH.NetworkUtil.getNetworksByNamespace(this.getCaipNetworks(),a.chainNamespace).find(b=>b.id.toString()===a.chainId?.toString())&&a.chainId&&await this.updateNativeBalance(a.address,a.chainId,a.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(a,b,c){let d=this.getAdapter(c),e=L.ChainController.getCaipNetworkByNamespace(c,b);if(d){let f=await d.getBalance({address:a,chainId:b,caipNetwork:e,tokens:this.options.tokens});return this.setBalance(f.balance,f.symbol,c),f}}async initializeUniversalAdapter(){let a=ob.createLogger((a,...b)=>{a&&this.handleAlertError(a),console.error(...b)}),b={projectId:this.options?.projectId,metadata:{name:this.options?.metadata?this.options?.metadata.name:"",description:this.options?.metadata?this.options?.metadata.description:"",url:this.options?.metadata?this.options?.metadata.url:"",icons:this.options?.metadata?this.options?.metadata.icons:[""]},logger:a};O.OptionsController.setManualWCControl(!!this.options?.manualWCControl),this.universalProvider=this.options.universalProvider??await nG.init(b);let c=this.universalProvider.disconnect.bind(this.universalProvider);this.universalProvider.disconnect=async()=>{try{return await c()}catch(a){if(a instanceof Error&&a.message.includes("Missing or invalid. Record was recently deleted"))return;throw a}},!1===O.OptionsController.state.enableReconnect&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(a=>{nR.listenWcProvider({universalProvider:this.universalProvider,namespace:a,onDisplayUri:a=>{M.ConnectionController.setUri(a)},onConnect:a=>{let{address:b}=F.CoreHelperUtil.getAccount(a[0]);M.ConnectionController.finalizeWcConnection(b)},onDisconnect:()=>{L.ChainController.state.noAdapters&&this.resetAccount(a),M.ConnectionController.resetWcConnection()},onChainChanged:b=>{let c=L.ChainController.state.activeChain,d=c&&N.ConnectorController.state.activeConnectorIds[c]===I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT;if(c===a&&(L.ChainController.state.noAdapters||d)){let a=this.getCaipNetworks().find(a=>a.id.toString()===b.toString()||a.caipNetworkId.toString()===b.toString()),c=this.getCaipNetwork();if(!a)return void this.setUnsupportedNetwork(b);c?.id.toString()!==a?.id.toString()&&c?.chainNamespace===a?.chainNamespace&&this.setCaipNetwork(a)}},onAccountsChanged:b=>{let c=L.ChainController.state.activeChain,d=c&&N.ConnectorController.state.activeConnectorIds[c]===I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT;if(c===a&&(L.ChainController.state.noAdapters||d)){let a=b?.[0];a&&this.syncAccount({address:a.address,chainId:a.chainId,chainNamespace:a.chainNamespace})}}})})}createUniversalProvider(){return!this.universalProviderInitPromise&&F.CoreHelperUtil.isClient()&&this.options?.projectId&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(a){W.EventsController.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:a instanceof Error?a.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",a)}return this.universalProvider}getDisabledCaipNetworks(){let a=L.ChainController.getAllApprovedCaipNetworkIds(),b=L.ChainController.getAllRequestedCaipNetworks();return F.CoreHelperUtil.sortRequestedNetworks(a,b).filter(a=>L.ChainController.isCaipNetworkDisabled(a))}handleAlertError(a){let[b,c]=Object.entries(aa.ErrorUtil.UniversalProviderErrors).find(([,{message:b}])=>a.message.includes(b))??[],{message:d,alertErrorKey:e}=c??{};if(b&&d&&!this.reportedAlertErrors[b]){let a=aa.ErrorUtil.ALERT_ERRORS[e];a&&(J.AlertController.open(a,"error"),this.reportedAlertErrors[b]=!0)}}getAdapter(a){if(a)return this.chainAdapters?.[a]}createAdapter(a){if(!a)return;let b=a.namespace;b&&(this.createClients(),a.namespace=b,a.construct({namespace:b,projectId:this.options?.projectId,networks:this.caipNetworks?.filter(({chainNamespace:a})=>a===b)}),this.chainNamespaces.includes(b)||this.chainNamespaces.push(b),this.chainAdapters&&(this.chainAdapters[b]=a))}async open(a){await this.injectModalUi(),a?.uri&&M.ConnectionController.setUri(a.uri);let{isSwap:b,isSend:c}=this.toModalOptions();return b(a)?nM.ModalController.open({...a,data:{swap:a.arguments}}):c(a)&&a.arguments?this.openSend(a.arguments):nM.ModalController.open(a)}async close(){await this.injectModalUi(),nM.ModalController.close()}setLoading(a,b){nM.ModalController.setLoading(a,b)}async disconnect(a){await M.ConnectionController.disconnect({namespace:a})}getSIWX(){return O.OptionsController.state.siwx}getError(){return""}getChainId(){return L.ChainController.state.activeCaipNetwork?.id}async switchNetwork(a,{throwOnFailure:b=!1}={}){let c=this.getCaipNetworks().find(b=>b.id===a.id);c?await L.ChainController.switchActiveNetwork(c,{throwOnFailure:b}):J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error")}getWalletProvider(){return L.ChainController.state.activeChain?P.ProviderController.state.providers[L.ChainController.state.activeChain]:null}getWalletProviderType(){return P.ProviderController.getProviderId(L.ChainController.state.activeChain)}subscribeProviders(a){return P.ProviderController.subscribeProviders(a)}getThemeMode(){return _.ThemeController.state.themeMode}getThemeVariables(){return _.ThemeController.state.themeVariables}setThemeMode(a){_.ThemeController.setThemeMode(a),(0,nT.setColorTheme)(_.ThemeController.state.themeMode)}setTermsConditionsUrl(a){O.OptionsController.setTermsConditionsUrl(a)}setPrivacyPolicyUrl(a){O.OptionsController.setPrivacyPolicyUrl(a)}setThemeVariables(a){_.ThemeController.setThemeVariables(a),(0,nT.setThemeVariables)(_.ThemeController.state.themeVariables)}subscribeTheme(a){return _.ThemeController.subscribe(a)}subscribeConnections(a){return this.remoteFeatures.multiWallet?M.ConnectionController.subscribe(a):(J.AlertController.open(I.ConstantsUtil.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>void 0)}getWalletInfo(a){if(a)return L.ChainController.state.chains.get(a)?.accountState?.connectedWalletInfo;let b=L.ChainController.getAccountData();return b?.connectedWalletInfo}getAccount(a){let b=a||L.ChainController.state.activeChain,c=N.ConnectorController.getAuthConnector(b),d=L.ChainController.getAccountData(b),e=S.StorageUtil.getConnectedConnectorId(L.ChainController.state.activeChain),f=M.ConnectionController.getConnections(b);if(!b)throw Error("AppKit:getAccount - namespace is required");let g=f.flatMap(a=>a.accounts.map(({address:a,type:c,publicKey:d})=>F.CoreHelperUtil.createAccount(b,a,c||"eoa",d)));if(d)return{allAccounts:g,caipAddress:d.caipAddress,address:F.CoreHelperUtil.getPlainAddress(d.caipAddress),isConnected:!!d.caipAddress,status:d.status,embeddedWalletInfo:c&&e===I.ConstantsUtil.CONNECTOR_ID.AUTH?{user:d.user?{...d.user,username:S.StorageUtil.getConnectedSocialUsername()}:void 0,authProvider:d.socialProvider||"email",accountType:(0,$.getPreferredAccountType)(b),isSmartAccountDeployed:!!d.smartAccountDeployed}:void 0}}subscribeAccount(a,b){let c=()=>{let c=this.getAccount(b);c&&a(c)};b?L.ChainController.subscribeChainProp("accountState",c,b):L.ChainController.subscribe(c),N.ConnectorController.subscribe(c)}subscribeNetwork(a){return L.ChainController.subscribe(({activeCaipNetwork:b})=>{a({caipNetwork:b,chainId:b?.id,caipNetworkId:b?.caipNetworkId})})}subscribeWalletInfo(a,b){return b?L.ChainController.subscribeChainProp("accountState",b=>a(b?.connectedWalletInfo),b):L.ChainController.subscribeChainProp("accountState",b=>a(b?.connectedWalletInfo))}subscribeShouldUpdateToAddress(a){L.ChainController.subscribeChainProp("accountState",b=>a(b?.shouldUpdateToAddress))}subscribeCaipNetworkChange(a){L.ChainController.subscribeKey("activeCaipNetwork",a)}getState(){return X.PublicStateController.state}getRemoteFeatures(){return O.OptionsController.state.remoteFeatures}subscribeState(a){return X.PublicStateController.subscribe(a)}subscribeRemoteFeatures(a){return O.OptionsController.subscribeKey("remoteFeatures",a)}showErrorMessage(a){nP.SnackController.showError(a)}showSuccessMessage(a){nP.SnackController.showSuccess(a)}getEvent(){return{...W.EventsController.state}}subscribeEvents(a){return W.EventsController.subscribe(a)}replace(a){Y.RouterController.replace(a)}redirect(a){Y.RouterController.push(a)}popTransactionStack(a){Y.RouterController.popTransactionStack(a)}isOpen(){return nM.ModalController.state.open}isTransactionStackEmpty(){return 0===Y.RouterController.state.transactionStack.length}static getInstance(){return this.instance}updateFeatures(a){O.OptionsController.setFeatures(a)}updateRemoteFeatures(a){O.OptionsController.setRemoteFeatures(a)}updateOptions(a){let b={...O.OptionsController.state||{},...a};O.OptionsController.setOptions(b)}setConnectMethodsOrder(a){O.OptionsController.setConnectMethodsOrder(a)}setWalletFeaturesOrder(a){O.OptionsController.setWalletFeaturesOrder(a)}setCollapseWallets(a){O.OptionsController.setCollapseWallets(a)}setSocialsOrder(a){O.OptionsController.setSocialsOrder(a)}getConnectMethodsOrder(){return nS.WalletUtil.getConnectOrderMethod(O.OptionsController.state.features,N.ConnectorController.getConnectors())}addNetwork(a,b){if(this.chainAdapters&&!this.chainAdapters[a])throw Error(`Adapter for namespace ${a} doesn't exist`);let c=this.extendCaipNetwork(b,this.options);this.getCaipNetworks().find(a=>a.id===c.id)||L.ChainController.addNetwork(c)}removeNetwork(a,b){if(this.chainAdapters&&!this.chainAdapters[a])throw Error(`Adapter for namespace ${a} doesn't exist`);this.getCaipNetworks().find(a=>a.id===b)&&L.ChainController.removeNetwork(a,b)}}let op=!1;class oq extends oo{async onAuthProviderConnected(a){let b=ab.HelpersUtil.userChainIdToChainNamespace(a?.chainId);if(a.message&&a.signature&&a.siwxMessage&&await Z.SIWXUtil.addEmbeddedWalletSession({chainId:a.siwxMessage.chainId,accountAddress:a.address,notBefore:a.siwxMessage.notBefore,statement:a.siwxMessage.statement,resources:a.siwxMessage.resources,requestId:a.siwxMessage.requestId,issuedAt:a.siwxMessage.issuedAt,domain:a.siwxMessage.domain,uri:a.siwxMessage.uri,version:a.siwxMessage.version,nonce:a.siwxMessage.nonce},a.message,a.signature),!b)throw Error("AppKit:onAuthProviderConnected - namespace is required");let c=b===I.ConstantsUtil.CHAIN.EVM?`eip155:${a.chainId}:${a.address}`:`${a.chainId}:${a.address}`,d=O.OptionsController.state.defaultAccountTypes[b],e=(0,$.getPreferredAccountType)(b),f=a.preferredAccountType||e||d;this.setCaipAddress(c,b);let{signature:g,siwxMessage:h,message:i,...j}=a,k=L.ChainController.getAccountData(b);this.setUser({...k?.user||{},...j},b),this.setSmartAccountDeployed(!!a.smartAccountDeployed,b),this.setPreferredAccountType(f,b),await Promise.all([this.syncAuthConnectorTheme(this.authProvider),this.syncAccount({address:a.address,chainId:a.chainId,chainNamespace:b})]),this.setLoading(!1,b)}setupAuthConnectorListeners(a){a.onRpcRequest(b=>{ad.W3mFrameHelpers.checkIfRequestExists(b)?ad.W3mFrameHelpers.checkIfRequestIsSafe(b)||this.handleUnsafeRPCRequest():(this.open(),console.error(ae.W3mFrameRpcConstants.RPC_METHOD_NOT_ALLOWED_MESSAGE,{method:b.method}),setTimeout(()=>{this.showErrorMessage(ae.W3mFrameRpcConstants.RPC_METHOD_NOT_ALLOWED_UI_MESSAGE)},300),a.rejectRpcRequests())}),a.onRpcError(()=>{this.isOpen()&&(this.isTransactionStackEmpty()?this.close():this.popTransactionStack("error"))}),a.onRpcSuccess((a,b)=>{let c=ad.W3mFrameHelpers.checkIfRequestIsSafe(b),d=this.getAddress(),e=L.ChainController.state.activeCaipNetwork;c||(d&&e?.id&&this.updateNativeBalance(d,e.id,e.chainNamespace),this.isTransactionStackEmpty()?this.close():this.popTransactionStack("success"))}),a.onNotConnected(()=>{let a=L.ChainController.state.activeChain;if(!a)throw Error("AppKit:onNotConnected - namespace is required");N.ConnectorController.getConnectorId(a)===I.ConstantsUtil.CONNECTOR_ID.AUTH&&(this.setCaipAddress(null,a),this.setLoading(!1,a))}),a.onConnect(this.onAuthProviderConnected.bind(this)),a.onSocialConnected(this.onAuthProviderConnected.bind(this)),a.onSetPreferredAccount(({address:a,type:b})=>{let c=L.ChainController.state.activeChain;if(!c)throw Error("AppKit:onSetPreferredAccount - namespace is required");a&&this.setPreferredAccountType(b,c)})}async syncAuthConnectorTheme(a){if(!a)return;let b=_.ThemeController.getSnapshot();await a.syncTheme({themeMode:b.themeMode,themeVariables:b.themeVariables,w3mThemeVariables:(0,T.getW3mThemeVariables)(b.themeVariables,b.themeMode)})}async syncAuthConnector(a,b){let c=I.ConstantsUtil.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(b),d=b===L.ChainController.state.activeChain;if(!c)return;this.setLoading(!0,b);let e=a.getLoginEmailUsed();this.setLoading(e,b),e&&this.setStatus("connecting",b);let f=a.getEmail(),g=a.getUsername(),h=L.ChainController.getAccountData(b)?.user||{};this.setUser({...h,username:g,email:f},b),this.setupAuthConnectorListeners(a);let{isConnected:i}=await a.isConnected();if(b&&c&&d)if(i&&this.connectionControllerClient?.connectExternal){await a.init(),await this.syncAuthConnectorTheme(a),await this.connectionControllerClient?.connectExternal({id:I.ConstantsUtil.CONNECTOR_ID.AUTH,info:{name:I.ConstantsUtil.CONNECTOR_ID.AUTH},type:ac.ConstantsUtil.CONNECTOR_TYPE_AUTH,provider:a,chainId:L.ChainController.getNetworkData(b)?.caipNetwork?.id,chain:b}),this.setStatus("connected",b);let c=S.StorageUtil.getConnectedSocialProvider();c?W.EventsController.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",address:this.getAddress(),properties:{provider:c,reconnect:!0}}):W.EventsController.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:this.getAddress(),properties:{method:"email",name:this.universalProvider?.session?.peer?.metadata?.name||"Unknown",reconnect:!0,view:Y.RouterController.state.view,walletRank:void 0}})}else N.ConnectorController.getConnectorId(b)===I.ConstantsUtil.CONNECTOR_ID.AUTH&&(this.setStatus("disconnected",b),S.StorageUtil.removeConnectedNamespace(b));this.setLoading(!1,b)}async checkExistingTelegramSocialConnection(a){try{if(!F.CoreHelperUtil.isTelegram())return;let b=S.StorageUtil.getTelegramSocialProvider();if(!b||!F.CoreHelperUtil.isClient())return;let c=new URL(window.location.href).searchParams.get("result_uri");if(!c)return;b&&L.ChainController.setAccountProp("socialProvider",b,a),await this.authProvider?.init();let d=N.ConnectorController.getAuthConnector();b&&d&&(this.setLoading(!0,a),await M.ConnectionController.connectExternal({id:d.id,type:d.type,socialUri:c},d.chain),S.StorageUtil.setConnectedSocialProvider(b),S.StorageUtil.removeTelegramSocialProvider(),W.EventsController.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:b}}))}catch(b){this.setLoading(!1,a),console.error("checkExistingSTelegramocialConnection error",b)}try{let a=new URL(window.location.href);a.searchParams.delete("result_uri"),window.history.replaceState({},document.title,a.toString())}catch(a){console.error("tma social login failed",a)}}createAuthProvider(a){if(!I.ConstantsUtil.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(a))return;let b=this.remoteFeatures?.email,c=Array.isArray(this.remoteFeatures?.socials)&&this.remoteFeatures.socials.length>0,d=ab.HelpersUtil.getActiveNamespaceConnectedToAuth()||a;!this.authProvider&&this.options?.projectId&&(b||c)&&(this.authProvider=ag.getInstance({projectId:this.options.projectId,enableLogger:this.options.enableAuthLogger,chainId:this.getCaipNetwork(d)?.caipNetworkId,abortController:aa.ErrorUtil.EmbeddedWalletAbortController,onTimeout:a=>{"iframe_load_failed"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):"iframe_request_timeout"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):"unverified_domain"===a&&J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},getActiveCaipNetwork:a=>(0,$.getActiveCaipNetwork)(a),getCaipNetworks:a=>L.ChainController.getCaipNetworks(a)}),X.PublicStateController.subscribeOpen(a=>{!a&&this.isTransactionStackEmpty()&&this.authProvider?.rejectRpcRequests()}));let e=a===L.ChainController.state.activeChain&&O.OptionsController.state.enableReconnect;!1===O.OptionsController.state.enableReconnect?this.syncAuthConnectorTheme(this.authProvider):this.authProvider&&e&&(this.syncAuthConnector(this.authProvider,a),this.checkExistingTelegramSocialConnection(a))}createAuthProviderForAdapter(a){this.createAuthProvider(a),this.authProvider&&this.chainAdapters?.[a]?.setAuthProvider?.(this.authProvider)}initControllers(a){super.initControllers(a),this.options.excludeWalletIds&&U.ApiController.initializeExcludedWallets({ids:this.options.excludeWalletIds})}async switchCaipNetwork(a){if(!a)return;let b=L.ChainController.state.activeChain,c=a.chainNamespace,d=this.getAddressByChainNamespace(c);if(c===b&&L.ChainController.getAccountData(c)?.caipAddress){let b=this.getAdapter(c);await b?.switchNetwork({caipNetwork:a}),this.setCaipNetwork(a)}else{let e=P.ProviderController.getProviderId(b)===ac.ConstantsUtil.CONNECTOR_TYPE_AUTH,f=P.ProviderController.getProviderId(c),g=f===ac.ConstantsUtil.CONNECTOR_TYPE_AUTH,h=I.ConstantsUtil.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(c);if(!c)throw Error("AppKit:switchCaipNetwork - networkNamespace is required");if((e&&void 0===f||g)&&h)try{if(L.ChainController.state.activeChain=a.chainNamespace,d){let b=this.getAdapter(c);await b?.switchNetwork({caipNetwork:a})}else await this.connectionControllerClient?.connectExternal?.({id:I.ConstantsUtil.CONNECTOR_ID.AUTH,provider:this.authProvider,chain:c,chainId:a.id,type:ac.ConstantsUtil.CONNECTOR_TYPE_AUTH,caipNetwork:a});this.setCaipNetwork(a)}catch(d){let b=this.getAdapter(c);await b?.switchNetwork({caipNetwork:a})}else if(f===ac.ConstantsUtil.CONNECTOR_TYPE_WALLET_CONNECT){if(!L.ChainController.state.noAdapters){let b=this.getAdapter(c);await b?.switchNetwork({caipNetwork:a})}this.setCaipNetwork(a),this.syncWalletConnectAccount()}else this.setCaipNetwork(a),d&&this.syncAccount({address:d,chainId:a.id,chainNamespace:c})}}async initialize(a){await super.initialize(a),this.chainNamespaces?.forEach(a=>{this.createAuthProviderForAdapter(a)}),await this.injectModalUi(),X.PublicStateController.set({initialized:!0})}async syncIdentity({address:a,chainId:b,chainNamespace:c}){let d=`${c}:${b}`,e=this.caipNetworks?.find(a=>a.caipNetworkId===d);if(e?.testnet){this.setProfileName(null,c),this.setProfileImage(null,c);return}let f=N.ConnectorController.getConnectorId(c)===I.ConstantsUtil.CONNECTOR_ID.AUTH;try{let{name:b,avatar:d}=await this.fetchIdentity({address:a});!b&&f?await this.syncReownName(a,c):(this.setProfileName(b,c),this.setProfileImage(d,c))}catch{1!==b&&this.setProfileImage(null,c)}}syncConnectedWalletInfo(a){let b=P.ProviderController.getProviderId(a);if(b===ac.ConstantsUtil.CONNECTOR_TYPE_AUTH){let c=this.authProvider;if(c){let d=S.StorageUtil.getConnectedSocialProvider()??"email",e=c.getEmail()??c.getUsername();this.setConnectedWalletInfo({name:b,identifier:e,social:d},a)}}else super.syncConnectedWalletInfo(a)}async injectModalUi(){if(F.CoreHelperUtil.isClient()&&!op)try{let a={...V.ConstantsUtil.DEFAULT_FEATURES,...this.options.features},b=this.remoteFeatures;if(await this.loadModalComponents(a,b),F.CoreHelperUtil.isClient()&&!document.querySelector("w3m-modal")){let a=document.createElement("w3m-modal");O.OptionsController.state.disableAppend||O.OptionsController.state.enableEmbedded||document.body.insertAdjacentElement("beforeend",a)}op=!0}catch(a){console.error("Error injecting modal UI:",a)}}async loadModalComponents(b,c){if(!F.CoreHelperUtil.isClient())return;let d=[];(c.email||c.socials&&c.socials.length>0)&&d.push(a.A(181762)),c.email&&d.push(a.A(16329)),c.socials&&d.push(a.A(864325)),c.swaps&&c.swaps.length>0&&d.push(a.A(454547)),b.send&&d.push(a.A(955260)),b.receive&&d.push(a.A(313644)),c.onramp&&c.onramp.length>0&&d.push(a.A(876908)),c.payWithExchange&&d.push(a.A(574901)),c.activity&&d.push(a.A(951381)),(b.pay||c.payments)&&d.push(a.A(139906)),c.emailCapture&&d.push(a.A(325806)),await Promise.all([...d,a.A(529064),a.A(190708)])}}let or=new Set(["children","localName","ref","style","className"]),os=({react:a,tagName:b,elementClass:c,events:d,displayName:e})=>{let f=new Set(Object.keys(d??{})),g=a.forwardRef((d,e)=>{a.useRef(new Map);let g=a.useRef(null),h={},i={};for(let[a,b]of Object.entries(d))or.has(a)?h["className"===a?"class":a]=b:f.has(a)||a in c.prototype?i[a]=b:h[a]=b;return("litPatchedCreateElement"===a.createElement.name||globalThis.litSsrReactEnabled)&&Object.keys(i).length&&(h._$litProps$=i),a.createElement(b,{...h,ref:a.useCallback(a=>{g.current=a,"function"==typeof e?e(a):null!==e&&(e.current=a)},[e])})});return g.displayName=e??c.name,g};a.i(745507);var ot=a.i(408037),ou=a.i(802774),ov=a.i(141071),ow=a.i(68160);os({tagName:"appkit-button",elementClass:ou.AppKitButton,react:G.default}),os({tagName:"appkit-network-button",elementClass:ow.AppKitNetworkButton,react:G.default}),os({tagName:"appkit-connect-button",elementClass:ov.AppKitConnectButton,react:G.default}),os({tagName:"appkit-account-button",elementClass:ot.AppKitAccountButton,react:G.default});var ox=a.i(156898);async function oy(a,b){let c;if((c="function"==typeof b.connector?a._internal.connectors.setup(b.connector):b.connector).uid===a.state.current)throw new ox.ConnectorAlreadyConnectedError;try{a.setState(a=>({...a,status:"connecting"})),c.emitter.emit("message",{type:"connecting"});let{connector:d,...e}=b,f=await c.connect(e);return c.emitter.off("connect",a._internal.events.connect),c.emitter.on("change",a._internal.events.change),c.emitter.on("disconnect",a._internal.events.disconnect),await a.storage?.setItem("recentConnectorId",c.id),a.setState(a=>({...a,connections:new Map(a.connections).set(c.uid,{accounts:e.withCapabilities?f.accounts.map(a=>"object"==typeof a?a.address:a):f.accounts,chainId:f.chainId,connector:c}),current:c.uid,status:"connected"})),{accounts:e.withCapabilities?f.accounts.map(a=>"object"==typeof a?a:{address:a,capabilities:{}}):f.accounts,chainId:f.chainId}}catch(b){throw a.setState(a=>({...a,status:a.current?"connected":"disconnected"})),b}}var oz=a.i(266297);let oA=a=>b=>{try{let c=a(b);if(c instanceof Promise)return c;return{then:a=>oA(a)(c),catch(a){return this}}}catch(a){return{then(a){return this},catch:b=>oA(b)(a)}}},oB=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},oC=a=>a?oB(a):oB;var oD=a.i(504984);a.i(78006);var oE=a.i(977988);class oF{constructor(a){Object.defineProperty(this,"uid",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"_emitter",{enumerable:!0,configurable:!0,writable:!0,value:new oE.EventEmitter})}on(a,b){this._emitter.on(a,b)}once(a,b){this._emitter.once(a,b)}off(a,b){this._emitter.off(a,b)}emit(a,...b){let c=b[0];this._emitter.emit(a,{uid:this.uid,...c})}listenerCount(a){return this._emitter.listenerCount(a)}}function oG(a,b){return JSON.parse(a,(a,c)=>{let d=c;return d?.__type==="bigint"&&(d=BigInt(d.value)),d?.__type==="Map"&&(d=new Map(d.value)),b?.(a,d)??d})}function oH(a,b){return a.slice(0,b).join(".")||"."}function oI(a,b){let{length:c}=a;for(let d=0;d<c;++d)if(a[d]===b)return d+1;return 0}function oJ(a,b,c,d){var e;let f,g,h,i;return JSON.stringify(a,(e=(a,c)=>{let d=c;return"bigint"==typeof d&&(d={__type:"bigint",value:c.toString()}),d instanceof Map&&(d={__type:"Map",value:Array.from(c.entries())}),b?.(a,d)??d},f=true,g="function"==typeof d,h=[],i=[],function(a,b){if("object"==typeof b)if(h.length){let c=oI(h,this);0===c?h[h.length]=this:(h.splice(c),i.splice(c)),i[i.length]=a;let e=oI(h,b);if(0!==e)return g?d.call(this,a,b,oH(i,e)):`[ref=${oH(i,e)}]`}else h[0]=b,i[0]=a;return f?e.call(this,a,b):b}),c??void 0)}function oK(a){let{deserialize:b=oG,key:c="wagmi",serialize:d=oJ,storage:e=oL}=a;function f(a){return a instanceof Promise?a.then(a=>a).catch(()=>null):a}return{...e,key:c,async getItem(a,d){let g=e.getItem(`${c}.${a}`),h=await f(g);return h?b(h)??null:d??null},async setItem(a,b){let g=`${c}.${a}`;null===b?await f(e.removeItem(g)):await f(e.setItem(g,d(b)))},async removeItem(a){await f(e.removeItem(`${c}.${a}`))}}}let oL={getItem:()=>null,setItem:()=>{},removeItem:()=>{}},oM=256;var oN=a.i(550745),oO=a.i(529579),oP=a.i(375642),oQ=a.i(81251),oR=a.i(471174),oS=a.i(910983),oT=a.i(927932),oU=a.i(52811);function oV(a){return"number"==typeof a?a:"wei"===a?0:Math.abs(oU.weiUnits[a])}var oW=a.i(954352),oX=a.i(567127);async function oY(a,b){let{allowFailure:c=!0,chainId:d,contracts:e,...f}=b,g=a.getClient({chainId:d});return(0,oT.getAction)(g,oX.multicall,"multicall")({allowFailure:c,contracts:e,...f})}var oZ=a.i(284284);async function o$(a,b){let{allowFailure:c=!0,blockNumber:d,blockTag:e,...f}=b,g=b.contracts;try{let b={};for(let[c,d]of g.entries()){let e=d.chainId??a.state.chainId;b[e]||(b[e]=[]),b[e]?.push({contract:d,index:c})}let h=(await Promise.all(Object.entries(b).map(([b,g])=>oY(a,{...f,allowFailure:c,blockNumber:d,blockTag:e,chainId:Number.parseInt(b,10),contracts:g.map(({contract:a})=>a)})))).flat(),i=Object.values(b).flatMap(a=>a.map(({index:a})=>a));return h.reduce((a,b,c)=>(a&&(a[i[c]]=b),a),[])}catch(f){if(f instanceof oW.ContractFunctionExecutionError)throw f;let b=()=>g.map(b=>(0,oZ.readContract)(a,{...b,blockNumber:d,blockTag:e}));if(c)return(await Promise.allSettled(b())).map(a=>"fulfilled"===a.status?{result:a.value,status:"success"}:{error:a.reason,result:void 0,status:"failure"});return await Promise.all(b())}}async function o_(a,b){let{address:c,blockNumber:d,blockTag:e,chainId:f,token:g,unit:h="ether"}=b;if(g)try{return await o0(a,{balanceAddress:c,chainId:f,symbolType:"string",tokenAddress:g})}catch(b){if("ContractFunctionExecutionError"===b.name){let b=await o0(a,{balanceAddress:c,chainId:f,symbolType:"bytes32",tokenAddress:g}),d=(0,oQ.hexToString)((0,oR.trim)(b.symbol,{dir:"right"}));return{...b,symbol:d}}throw b}let i=a.getClient({chainId:f}),j=(0,oT.getAction)(i,oS.getBalance,"getBalance"),k=await j(d?{address:c,blockNumber:d}:{address:c,blockTag:e}),l=a.chains.find(a=>a.id===f)??i.chain;return{decimals:l.nativeCurrency.decimals,formatted:(0,oP.formatUnits)(k,oV(h)),symbol:l.nativeCurrency.symbol,value:k}}async function o0(a,b){let{balanceAddress:c,chainId:d,symbolType:e,tokenAddress:f,unit:g}=b,h={abi:[{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:e}]}],address:f},[i,j,k]=await o$(a,{allowFailure:!1,contracts:[{...h,functionName:"balanceOf",args:[c],chainId:d},{...h,functionName:"decimals",chainId:d},{...h,functionName:"symbol",chainId:d}]}),l=(0,oP.formatUnits)(i??"0",oV(g??j));return{decimals:j,formatted:l,symbol:k,value:i}}var o1=a.i(644017);let o2=[];function o3(a){let b=[...a.state.connections.values()];return"reconnecting"===a.state.status||(0,o1.deepEqual)(o2,b)?o2:(o2=b,b)}var o4=a.i(979469);async function o5(a,b){let{account:c,chainId:d,...e}=b,f=c??(0,oO.getAccount)(a).address,g=a.getClient({chainId:d});return(0,oT.getAction)(g,o4.prepareTransactionRequest,"prepareTransactionRequest")({...e,...f?{account:f}:{}})}var o6=a.i(202101),o7=a.i(620994),o8=a.i(28091);async function o9(a,b){let c,{account:d,connector:e,...f}=b;return c="object"==typeof d&&"local"===d.type?a.getClient():await (0,o8.getConnectorClient)(a,{account:d,connector:e}),(0,oT.getAction)(c,o7.signMessage,"signMessage")({...f,...d?{account:d}:{}})}var pa=a.i(319175);async function pb(a,b){let{addEthereumChainParameter:c,chainId:d}=b,e=a.state.connections.get(b.connector?.uid??a.state.current);if(e){let a=e.connector;if(!a.switchChain)throw new pa.SwitchChainNotSupportedError({connector:a});return await a.switchChain({addEthereumChainParameter:c,chainId:d})}let f=a.chains.find(a=>a.id===d);if(!f)throw new ox.ChainNotConfiguredError;return a.setState(a=>({...a,chainId:d})),f}async function pc(a,b={}){let c;if(b.connector)c=b.connector;else{let{connections:b,current:d}=a.state,e=b.get(d);c=e?.connector}let d=a.state.connections;c&&(await c.disconnect(),c.emitter.off("change",a._internal.events.change),c.emitter.off("disconnect",a._internal.events.disconnect),c.emitter.on("connect",a._internal.events.connect),d.delete(c.uid)),a.setState(a=>{if(0===d.size)return{...a,connections:new Map,current:null,status:"disconnected"};let b=d.values().next().value;return{...a,connections:new Map(d),current:b.connector.uid}});{let b=a.state.current;if(!b)return;let c=a.state.connections.get(b)?.connector;if(!c)return;await a.storage?.setItem("recentConnectorId",c.id)}}var pd=a.i(683553);async function pe(a,b){let c,{chainId:d,connector:e,...f}=b;c=b.account?b.account:(await (0,o8.getConnectorClient)(a,{account:b.account,assertChainId:!1,chainId:d,connector:e})).account;let g=a.getClient({chainId:d});return(0,oT.getAction)(g,pd.estimateGas,"estimateGas")({...f,account:c})}var pf=a.i(510130);async function pg(a,b){let c,{account:d,chainId:e,connector:f,...g}=b;c="object"==typeof d&&d?.type==="local"?a.getClient({chainId:e}):await (0,o8.getConnectorClient)(a,{account:d??void 0,assertChainId:!1,chainId:e,connector:f});let h=(0,oT.getAction)(c,pf.sendTransaction,"sendTransaction");return await h({...g,...d?{account:d}:{},chain:e?{id:e}:null,gas:g.gas??void 0})}var ph=a.i(33238),pi=a.i(29819),pj=a.i(937376),pk=a.i(815167),pl=a.i(276834),pm=a.i(243978),pn=a.i(519270),po=a.i(497616),pp=a.i(647032);a.i(536943);Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;aH.IEvents;aH.IEvents,aH.IEvents,aH.IEvents,aH.IEvents,aH.IEvents,ah.default,ah.EventEmitter;let pq=BigInt(0),pr=BigInt(1);function ps(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function pt(a){if(!ps(a))throw Error("Uint8Array expected")}function pu(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function pv(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function pw(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?pq:BigInt("0x"+a)}let px="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,py=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function pz(a){if(pt(a),px)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=py[a[c]];return b}function pA(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function pB(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(px)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=pA(a.charCodeAt(e)),f=pA(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function pC(a){return pw(pz(a))}function pD(a){return pt(a),pw(pz(Uint8Array.from(a).reverse()))}function pE(a,b){return pB(a.toString(16).padStart(2*b,"0"))}function pF(a,b){return pE(a,b).reverse()}function pG(a,b,c){let d;if("string"==typeof b)try{d=pB(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(ps(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function pH(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];pt(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let pI=a=>"bigint"==typeof a&&pq<=a;function pJ(a,b,c){return pI(a)&&pI(b)&&pI(c)&&b<=a&&a<c}function pK(a,b,c,d){if(!pJ(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let pL=a=>(pr<<BigInt(a))-pr,pM=a=>new Uint8Array(a),pN={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||ps(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function pO(a,b,c={}){let d=(b,c,d)=>{let e=pN[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function pP(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let pQ=BigInt(0),pR=BigInt(1),pS=BigInt(2),pT=BigInt(3),pU=BigInt(4),pV=BigInt(5),pW=BigInt(8);function pX(a,b){let c=a%b;return c>=pQ?c:b+c}function pY(a,b,c){let d=a;for(;b-- >pQ;)d*=d,d%=c;return d}function pZ(a,b){if(a===pQ)throw Error("invert: expected non-zero number");if(b<=pQ)throw Error("invert: expected positive modulus, got "+b);let c=pX(a,b),d=b,e=pQ,f=pR,g=pR,h=pQ;for(;c!==pQ;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==pR)throw Error("invert: does not exist");return pX(e,b)}function p$(a,b){let c=(a.ORDER+pR)/pU,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function p_(a,b){let c=(a.ORDER-pV)/pW,d=a.mul(b,pS),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,pS),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let p0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function p1(a){return pO(a,p0.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function p2(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function p3(a,b){let c=(a.ORDER-pR)/pS,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function p4(a,b){void 0!==b&&(0,a4.anumber)(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function p5(a,b,c=!1,d={}){let e;if(a<=pQ)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=p4(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:pL(f),ZERO:pQ,ONE:pR,create:b=>pX(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return pQ<=b&&b<a},is0:a=>a===pQ,isOdd:a=>(a&pR)===pR,neg:b=>pX(-b,a),eql:(a,b)=>a===b,sqr:b=>pX(b*b,a),add:(b,c)=>pX(b+c,a),sub:(b,c)=>pX(b-c,a),mul:(b,c)=>pX(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<pQ)throw Error("invalid exponent, negatives unsupported");if(c===pQ)return a.ONE;if(c===pR)return b;let d=a.ONE,e=b;for(;c>pQ;)c&pR&&(d=a.mul(d,e)),e=a.sqr(e),c>>=pR;return d})(h,a,b),div:(b,c)=>pX(b*pZ(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>pZ(b,a),sqrt:d.sqrt||(b=>(e||(e=a%pU===pT?p$:a%pW===pV?p_:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-pR,c=0;for(;b%pS===pQ;)b/=pS,c++;let d=pS,e=p5(a);for(;1===p3(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return p$;let f=e.pow(d,b),g=(b+pR)/pS;return function(a,d){if(a.is0(d))return d;if(1!==p3(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=pR<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?pF(a,g):pE(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?pD(a):pC(a)},invertBatch:a=>p2(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function p6(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function p7(a){let b=p6(a);return b+Math.ceil(b/2)}let p8=BigInt(0),p9=BigInt(1);function qa(a,b){let c=b.negate();return a?c:b}function qb(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function qc(a,b){qb(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:pL(a),maxNumber:e,shiftBy:BigInt(a)}}function qd(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=p9);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let qe=new WeakMap,qf=new WeakMap;function qg(a){return qf.get(a)||1}function qh(a){return p1(a.Fp),pO(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...p4(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function qi(a){void 0!==a.lowS&&pu("lowS",a.lowS),void 0!==a.prehash&&pu("prehash",a.prehash)}let qj={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=qj;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=pv(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?pv(e.length/2|128):"";return pv(a)+f+e+b},decode(a,b){let{Err:c}=qj,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=qj;if(a<qk)throw new b("integer: negative integers are not allowed");let c=pv(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=qj;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return pC(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=qj,e=pG("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=qj,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},qk=BigInt(0),ql=BigInt(1),qm=BigInt(2),qn=BigInt(3),qo=BigInt(4),qp=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),qq=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),qr=BigInt(0),qs=BigInt(1),qt=BigInt(2),qu=(a,b)=>(a+b/qt)/b,qv=p5(qp,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%qp,j=i*i*a%qp,k=pY(j,b,qp)*j%qp,l=pY(k,b,qp)*j%qp,m=pY(l,qt,qp)*i%qp,o=pY(m,d,qp)*m%qp,p=pY(o,e,qp)*o%qp,q=pY(p,g,qp)*p%qp,r=pY(q,h,qp)*q%qp,s=pY(r,g,qp)*p%qp,t=pY(s,b,qp)*j%qp,u=pY(t,f,qp)*o%qp,v=pY(u,c,qp)*i%qp,w=pY(v,qt,qp);if(!qv.eql(qv.sqr(w),a))throw Error("Cannot find square root");return w}}),qw=(A={a:qr,b:BigInt(7),Fp:qv,n:qq,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-qs*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=qu(b*a,qq),g=qu(-c*a,qq),h=pX(a-f*b-g*d,qq),i=pX(-f*c-g*b,qq),j=h>e,k=i>e;if(j&&(h=qq-h),k&&(i=qq-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},B=a3.sha256,{...(l=a=>(function(a){let b,c=(pO(b=qh(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return pX(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:o}=function(a){var b;let c=function(a){let b=qh(a);pO(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=p5(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return pH(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,qn),qo),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(ps(a)&&(a=pz(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:pC(pG("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=pX(b,g)),pK("private key",b,ql,g),b}function m(a){if(!(a instanceof q))throw Error("ProjectivePoint expected")}let o=pP((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),p=pP(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class q{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof q)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?q.ZERO:new q(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=p2(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(q.fromAffine)}static fromHex(a){let b=q.fromAffine(g(pG("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return q.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>pq;a>>=pr,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=pL(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(q,e,a,b)}_setWindowSize(a){t.setWindowSize(this,a)}assertValidity(){p(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new q(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,qn),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(f,g);return p=d.add(p,p),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(e,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new q(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,o=c.a,p=d.mul(c.b,qn),r=d.mul(b,g),s=d.mul(e,h),t=d.mul(f,i),u=d.add(b,e),v=d.add(g,h);u=d.mul(u,v),v=d.add(r,s),u=d.sub(u,v),v=d.add(b,f);let w=d.add(g,i);return v=d.mul(v,w),w=d.add(r,t),v=d.sub(v,w),w=d.add(e,f),j=d.add(h,i),w=d.mul(w,j),j=d.add(s,t),w=d.sub(w,j),l=d.mul(o,v),j=d.mul(p,t),l=d.add(j,l),j=d.sub(s,l),l=d.add(s,l),k=d.mul(j,l),s=d.add(r,r),s=d.add(s,r),t=d.mul(o,t),v=d.mul(p,v),s=d.add(s,t),t=d.sub(r,t),t=d.mul(o,t),v=d.add(v,t),r=d.mul(s,v),k=d.add(k,r),r=d.mul(w,v),j=d.mul(u,j),j=d.sub(j,r),r=d.mul(u,s),l=d.mul(w,l),new q(j,k,l=d.add(l,r))}subtract(a){return this.add(a.negate())}is0(){return this.equals(q.ZERO)}wNAF(a){return t.wNAFCached(this,a,q.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;pK("scalar",a,qk,e);let f=q.ZERO;if(a===qk)return f;if(this.is0()||a===ql)return this;if(!b||t.hasPrecomputes(this))return t.wNAFCachedUnsafe(this,a,q.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>qk||j>qk;)h&ql&&(k=k.add(m)),j&ql&&(l=l.add(m)),m=m.double(),h>>=ql,j>>=ql;return g&&(k=k.negate()),i&&(l=l.negate()),l=new q(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(pK("scalar",a,ql,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=t.constTimeNegate(c,j),l=t.constTimeNegate(h,l),l=new q(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return q.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=q.BASE,e=(a,b)=>b!==qk&&b!==ql&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return o(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===ql)return!0;if(b)return b(q,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===ql?this:b?b(q,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return pu("isCompressed",a),this.assertValidity(),f(q,this,a)}toHex(a=!0){return pu("isCompressed",a),pz(this.toRawBytes(a))}}q.BASE=new q(c.Gx,c.Gy,d.ONE),q.ZERO=new q(d.ZERO,d.ONE,d.ZERO);let{endo:r,nBitLength:s}=c,t=(b=r?Math.ceil(s/2):s,{constTimeNegate:qa,hasPrecomputes:a=>1!==qg(a),unsafeLadder(a,b,c=q.ZERO){let d=a;for(;b>p8;)b&p9&&(c=c.add(d)),d=d.double(),b>>=p9;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=qc(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=q.ZERO,f=q.BASE,g=qc(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=qd(d,a,g);d=b,i?f=f.add(qa(k,c[l])):e=e.add(qa(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=q.ZERO){let f=qc(a,b);for(let a=0;a<f.windows&&d!==p8;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=qd(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=qe.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&qe.set(b,c(d))),d},wNAFCached(a,b,c){let d=qg(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=qg(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){qb(c,b),qf.set(a,c),qe.delete(a)}});return{CURVE:c,ProjectivePoint:q,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return pJ(a,ql,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(pu("isCompressed",c),c)?pH(Uint8Array.from([b.hasEvenY()?2:3]),f):pH(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=pC(e);if(!pJ(b,ql,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&ql)===ql)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),p=(a,b,c)=>pC(a.slice(b,c));class q{constructor(a,b,c){pK("r",a,ql,e),pK("s",b,ql,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new q(p(a=pG("compactSignature",a,2*f),0,f),p(a,f,2*f))}static fromDER(a){let{r:b,s:c}=qj.toSig(pG("DER",a));return new q(b,c)}assertValidity(){}addRecoveryBit(a){return new q(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=t(pG("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+pz(pE(i,d.BYTES))),o=pZ(i,e),p=j(-h*o),q=j(f*o),r=k.BASE.multiplyAndAddUnsafe(m,p,q);if(!r)throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>e>>ql}normalizeS(){return this.hasHighS()?new q(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return pB(this.toDERHex())}toDERHex(){return qj.hexFromSig(this)}toCompactRawBytes(){return pB(this.toCompactHex())}toCompactHex(){return pz(pE(this.r,f))+pz(pE(this.s,f))}}function r(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=pG("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=pC(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return j(s(a))},u=pL(g);function v(a){return pK("num < 2^"+g,a,qk,u),pE(a,f)}let w={lowS:c.lowS,prehash:!1},x={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===r(a))throw Error("first arg must be private key");if(!1===r(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=w){let{seed:g,k2sig:h}=function(a,b,f=w){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:p}=f;null==i&&(i=!0),a=pG("msgHash",a),qi(f),m&&(a=pG("prehashed msgHash",g(a)));let r=t(a),u=l(b),x=[v(u),v(r)];if(null!=p&&!1!==p){let a=!0===p?h(d.BYTES):p;x.push(pG("extraEntropy",a))}return{seed:pH(...x),k2sig:function(a){var b;let c=s(a);if(!o(c))return;let d=pZ(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===qk)return;let h=j(d*j(r+g*u));if(h===qk)return;let l=2*(f.x!==g)|Number(f.y&ql),m=h;return i&&h>e>>ql&&(m=(b=h)>e>>ql?j(-b):b,l^=1),new q(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=pM(a),e=pM(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=pM(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return pH(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=x){let g,h;b=pG("msgHash",b),d=pG("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(qi(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let o="string"==typeof a||ps(a),p=!o&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!o&&!p)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(p&&(h=new q(a.r,a.s)),o){try{"compact"!==m&&(h=q.fromDER(a))}catch(a){if(!(a instanceof qj.Err))throw a}h||"der"===m||(h=q.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r,s}=h,u=t(b),v=pZ(s,e),w=j(u*v),y=j(r*v),z=k.BASE.multiplyAndAddUnsafe(g,w,y)?.toAffine();return!!z&&j(z.x)===r},ProjectivePoint:k,Signature:q,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=p7(c.n);return function(a,b,c=!1){let d=a.length,e=p6(b),f=p7(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=pX(c?pD(a):pC(a),b-pR)+pR;return c?pF(g,e):pE(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...A,...{hash:a,hmac:(b,...c)=>(0,a5.hmac)(a,b,(0,a4.concatBytes)(...c)),randomBytes:a4.randomBytes}}))(B),create:l});qw.ProjectivePoint;let qx=(m=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[c,d,e,f]=m.map(b=>b.reduce((b,c)=>qv.add(qv.mul(b,a),c))),[g,h]=p2(qv,[d,f],!0);return a=qv.mul(c,g),b=qv.mul(b,qv.mul(e,h)),{x:a,y:b}}),qy=function(a,b){if(p1(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=qk;for(let a=c-ql;a%qm===qk;a/=qm)d+=ql;let e=d,f=qm<<e-ql-ql,g=f*qm,h=(c-ql)/g,i=(h-ql)/qm,j=g-ql,k=a.pow(b,h),l=a.pow(b,(h+ql)/qm),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let o=a.mul(h,g);m=a.pow(o,f);let p=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(o,d),h=a.cmov(g,h,p),o=a.cmov(m,o,p);for(let b=e;b>ql;b--){let c=b-qm;c=qm<<c-ql;let e=a.pow(o,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(o,d),h=a.cmov(g,h,f),o=a.cmov(e,o,f)}return{isValid:p,value:h}};if(a.ORDER%qo===qn){let c=(a.ORDER-qn)/qo,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:o}=c(f,j);l=a.mul(e,d),l=a.mul(l,o),k=a.cmov(k,g,m),l=a.cmov(l,o,m);let p=a.isOdd(d)===a.isOdd(l);l=a.cmov(a.neg(l),l,p);let q=p2(a,[h],!0)[0];return{x:k=a.mul(k,q),y:l}}}(qv,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:qv.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(qw.ProjectivePoint,a=>{let{x:b,y:c}=qy(qv.create(a[0]));return qx(b,c)},(qv.ORDER,a3.sha256));class qz extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof qz){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof qz&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function qA(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function qB(a,b){if(qL(a)>b)throw new qQ({givenSize:qL(a),maxSize:b})}function qC(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new qS({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function qD(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let qE=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function qF(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function qG(a){return a instanceof Uint8Array?qH(a):Array.isArray(a)?qH(new Uint8Array(a)):a}function qH(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=qE[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(qB(d,b.size),qJ(d,b.size)):d}function qI(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new qN({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,qC(c,{dir:"left",size:f})):j}function qJ(a,b){return qC(a,{dir:"right",size:b})}function qK(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>qL(a)-1)throw new qR({offset:b,position:"start",size:qL(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&qL(a)!==c-b)throw new qR({offset:c,position:"end",size:qL(a)})}(f,b,c),f}function qL(a){return Math.ceil((a.length-2)/2)}function qM(a){return function(a,b={}){let{dir:c="left"}=b,d=a.replace("0x",""),e=0;for(let a=0;a<d.length-1;a++)if("0"===d["left"===c?a:d.length-a-1].toString())e++;else break;return"0"===(d="left"===c?d.slice(e):d.slice(0,d.length-e))?"0x":"right"===c&&d.length%2==1?`0x${d}0`:`0x${d}`}(a,{dir:"left"})}class qN extends qz{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class qO extends qz{constructor(a){super(`Value \`${"object"==typeof a?qD(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class qP extends qz{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class qQ extends qz{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class qR extends qz{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class qS extends qz{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}let qT=new TextEncoder;function qU(a){var b;return a instanceof Uint8Array?a:"string"==typeof a?qV(a):(b=a)instanceof Uint8Array?b:new Uint8Array(b)}function qV(a,b={}){let{size:c}=b,d=a;c&&(qB(a,c),d=qJ(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=qA(e.charCodeAt(b++)),d=qA(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new qz(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}class qW extends qz{constructor(a){super(`Value \`${"object"==typeof a?qD(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class qX extends qz{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class qY extends qz{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let qZ=2n**256n-1n;function q$(a,b={}){let{recovered:c}=b;if(void 0===a.r||void 0===a.s||c&&void 0===a.yParity)throw new rj({signature:a});if(a.r<0n||a.r>qZ)throw new rk({value:a.r});if(a.s<0n||a.s>qZ)throw new rl({value:a.s});if("number"==typeof a.yParity&&0!==a.yParity&&1!==a.yParity)throw new rm({value:a.yParity})}function q_(a){return q0(qH(a))}function q0(a){if(130!==a.length&&132!==a.length)throw new ri({signature:a});let b=BigInt(qK(a,0,32)),c=BigInt(qK(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{return rg(b)}catch{throw new rm({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}function q1(a){if(void 0!==a.r&&void 0!==a.s)return q2(a)}function q2(a){let b="string"==typeof a?q0(a):a instanceof Uint8Array?q_(a):"string"==typeof a.r?q6(a):a.v?q5(a):{r:a.r,s:a.s,...void 0!==a.yParity?{yParity:a.yParity}:{}};return q$(b),b}function q3(a){return q4(qH(a))}function q4(a){let{r:b,s:c}=qw.Signature.fromDER(qG(a).slice(2));return{r:b,s:c}}function q5(a){return{r:a.r,s:a.s,yParity:rg(a.v)}}function q6(a){let b=(()=>{let b=a.v?Number(a.v):void 0,c=a.yParity?Number(a.yParity):void 0;if("number"==typeof b&&"number"!=typeof c&&(c=rg(b)),"number"!=typeof c)throw new rm({value:a.yParity});return c})();return{r:BigInt(a.r),s:BigInt(a.s),yParity:b}}function q7(a){let[b,c,d]=a;return q2({r:"0x"===c?0n:BigInt(c),s:"0x"===d?0n:BigInt(d),yParity:"0x"===b?0:Number(b)})}function q8(a){return qV(q9(a))}function q9(a){q$(a);let b=a.r,c=a.s;return qF(qI(b,{size:32}),qI(c,{size:32}),"number"==typeof a.yParity?qI(rh(a.yParity),{size:1}):"0x")}function ra(a){return new qw.Signature(a.r,a.s).toDERRawBytes()}function rb(a){let b=new qw.Signature(a.r,a.s);return`0x${b.toDERHex()}`}function rc(a){return{r:a.r,s:a.s,v:rh(a.yParity)}}function rd(a){let{r:b,s:c,yParity:d}=a;return{r:qI(b,{size:32}),s:qI(c,{size:32}),yParity:0===d?"0x0":"0x1"}}function re(a){let{r:b,s:c,yParity:d}=a;return[d?"0x01":"0x",0n===b?"0x":qM(qI(b)),0n===c?"0x":qM(qI(c))]}function rf(a,b={}){try{return q$(a,b),!0}catch{return!1}}function rg(a){if(0===a||27===a)return 0;if(1===a||28===a)return 1;if(a>=35)return+(a%2==0);throw new rn({value:a})}function rh(a){if(0===a)return 27;if(1===a)return 28;throw new rm({value:a})}class ri extends qz{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${qL(qG(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class rj extends qz{constructor({signature:a}){super(`Signature \`${qD(a)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class rk extends qz{constructor({value:a}){super(`Value \`${a}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class rl extends qz{constructor({value:a}){super(`Value \`${a}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class rm extends qz{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class rn extends qz{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}a.s(["InvalidRError",()=>rk,"InvalidSError",()=>rl,"InvalidSerializedSizeError",()=>ri,"InvalidVError",()=>rn,"InvalidYParityError",()=>rm,"MissingPropertiesError",()=>rj,"assert",()=>q$,"extract",()=>q1,"from",()=>q2,"fromBytes",()=>q_,"fromDerBytes",()=>q3,"fromDerHex",()=>q4,"fromHex",()=>q0,"fromLegacy",()=>q5,"fromRpc",()=>q6,"fromTuple",()=>q7,"toBytes",()=>q8,"toDerBytes",()=>ra,"toDerHex",()=>rb,"toHex",()=>q9,"toLegacy",()=>rc,"toRpc",()=>rd,"toTuple",()=>re,"vToYParity",()=>rg,"validate",()=>rf,"yParityToV",()=>rh],330288),a.i(330288);class ro extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let rp={checksum:new ro(8192)}.checksum;function rq(a,b={}){let{as:c="string"==typeof a?"Hex":"Bytes"}=b,d=(0,c7.keccak_256)(qU(a));return"Bytes"===c?d:qH(d)}function rr(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new rw({prefix:d,cause:new ry});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new rw({prefix:d,cause:new rx});return}throw new rv({publicKey:a})}function rs(a){let b=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new qO(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new qP(a)}(a,{strict:c}),!0}catch{return!1}}(a))return rt(a);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new qW(a);return!0}catch{return!1}}(a))return rt(qH(a));let{prefix:b,x:c,y:d}=a;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:b??4,x:c,y:d}:{prefix:b,x:c}})();return rr(b),b}function rt(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new rz({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(qK(a,0,32)),y:BigInt(qK(a,32,64))};if(132===a.length){let b=Number(qK(a,0,1));return{prefix:b,x:BigInt(qK(a,1,33)),y:BigInt(qK(a,33,65))}}return{prefix:Number(qK(a,0,1)),x:BigInt(qK(a,1,33))}}function ru(a,b={}){rr(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return qF(f?qI(c,{size:1}):"0x",qI(d,{size:32}),"bigint"==typeof e?qI(e,{size:32}):"0x")}class rv extends qz{constructor({publicKey:a}){super(`Value \`${qD(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class rw extends qz{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class rx extends qz{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class ry extends qz{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class rz extends qz{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${qL(qG(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let rA=/^0x[a-fA-F0-9]{40}$/;function rB(a,b={}){let{strict:c=!0}=b;if(!rA.test(a))throw new rD({address:a,cause:new rE});if(c){if(a.toLowerCase()===a)return;if(rC(a)!==a)throw new rD({address:a,cause:new rF})}}function rC(a){if(rp.has(a))return rp.get(a);rB(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=rq(function(a,b={}){let{size:c}=b,d=qT.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new qX({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new qY({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return rp.set(a,e),e}class rD extends qz{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class rE extends qz{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class rF extends qz{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function rG(a={}){let{as:b="Hex"}=a,c=rJ({as:b}),d=rH({privateKey:c});return{privateKey:c,publicKey:d}}function rH(a){let{privateKey:b}=a;return rs(qw.ProjectivePoint.fromPrivateKey(qG(b).slice(2)))}function rI(a){let{as:b="Hex",privateKey:c,publicKey:d}=a,e=qw.ProjectivePoint.fromHex(ru(d).slice(2)).multiply(qw.utils.normPrivateKeyToScalar(qG(c).slice(2))).toRawBytes(!0);return"Hex"===b?qH(e):e}function rJ(a={}){let{as:b="Hex"}=a,c=qw.utils.randomPrivateKey();return"Hex"===b?qH(c):c}function rK(a){return function(a,b={}){let c=rq(`0x${ru(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(rB(a),c)?rC(a):a}(`0x${c}`,b)}(rL(a))}function rL(a){let{payload:b,signature:c}=a,{r:d,s:e,yParity:f}=c;return rs(new qw.Signature(BigInt(d),BigInt(e)).addRecoveryBit(f).recoverPublicKey(qG(b).substring(2)))}function rM(a){let{extraEntropy:b=!1,hash:c,payload:d,privateKey:e}=a,{r:f,s:g,recovery:h}=qw.sign(qU(d),qU(e),{extraEntropy:"boolean"==typeof b?b:qG(b).slice(2),lowS:!0,...c?{prehash:!0}:{}});return{r:f,s:g,yParity:h}}function rN(a){let{address:b,hash:c,payload:d,publicKey:e,signature:f}=a;if(b){var g;return g=rK({payload:d,signature:f}),rB(b,{strict:!1}),rB(g,{strict:!1}),b.toLowerCase()===g.toLowerCase()}return qw.verify(f,qU(d),function(a,b={}){return qV(ru(a,b))}(e),...c?[{prehash:!0,lowS:!0}]:[])}function rO(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}a.s(["createKeyPair",()=>rG,"getPublicKey",()=>rH,"getSharedSecret",()=>rI,"noble",0,qw,"randomPrivateKey",()=>rJ,"recoverAddress",()=>rK,"recoverPublicKey",()=>rL,"sign",()=>rM,"verify",()=>rN],846605),a.i(846605),!function(a){if(a.length>=255)throw TypeError("Alphabet too long");let b=new Uint8Array(256);for(let a=0;a<b.length;a++)b[a]=255;for(let c=0;c<a.length;c++){let d=a.charAt(c),e=d.charCodeAt(0);if(255!==b[e])throw TypeError(d+" is ambiguous");b[e]=c}let c=a.length,d=a.charAt(0),e=Math.log(c)/Math.log(256)}("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),rO("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),rO("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){if(null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe){var b;return b=globalThis.Buffer.allocUnsafe(a),null!=globalThis.Buffer?new Uint8Array(b.buffer,b.byteOffset,b.byteLength):b}return new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),dF.bases.base16,dF.bases,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let rP=BigInt(0x100000000-1),rQ=BigInt(32);function rR(a,b=!1){return b?{h:Number(a&rP),l:Number(a>>rQ&rP)}:{h:0|Number(a>>rQ&rP),l:0|Number(a&rP)}}function rS(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=rR(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let rT=(a,b,c)=>a>>>c,rU=(a,b,c)=>a<<32-c|b>>>c,rV=(a,b,c)=>a>>>c|b<<32-c,rW=(a,b,c)=>a<<32-c|b>>>c,rX=(a,b,c)=>a<<64-c|b>>>c-32,rY=(a,b,c)=>a>>>c-32|b<<64-c;function rZ(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let r$=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),r_=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,r0=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),r1=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,r2=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),r3=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,r4="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function r5(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function r6(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function r7(a,...b){if(!r5(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function r8(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");r6(a.outputLen),r6(a.blockLen)}function r9(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function sa(a,b){r7(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function sb(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function sc(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function sd(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function se(a,b){return a<<32-b|a>>>b}let sf=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function sg(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let sh=sf?a=>a:a=>sg(a),si=sf?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=sg(a[b]);return a},sj="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,sk=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function sl(a){if(r7(a),sj)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=sk[a[c]];return b}function sm(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function sn(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(sj)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=sm(a.charCodeAt(e)),f=sm(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function so(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function sp(a){return"string"==typeof a&&(a=so(a)),r7(a),a}function sq(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];r7(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class sr{}function ss(a){let b=b=>a().update(sp(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function st(a=32){if(r4&&"function"==typeof r4.getRandomValues)return r4.getRandomValues(new Uint8Array(a));if(r4&&"function"==typeof r4.randomBytes)return Uint8Array.from(r4.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let su=BigInt(0),sv=BigInt(1),sw=BigInt(2),sx=BigInt(7),sy=BigInt(256),sz=BigInt(113),sA=[],sB=[],sC=[];for(let a=0,b=sv,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],sA.push(2*(5*d+c)),sB.push((a+1)*(a+2)/2%64);let e=su;for(let a=0;a<7;a++)(b=(b<<sv^(b>>sx)*sz)%sy)&sw&&(e^=sv<<(sv<<BigInt(a))-sv);sC.push(e)}let sD=rS(sC,!0),sE=sD[0],sF=sD[1],sG=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,sH=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class sI extends sr{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,r6(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=sb(this.state)}clone(){return this._cloneInto()}keccak(){si(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=sG(f,g,1)^c[d],i=sH(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=sB[c],f=sG(b,e,d),g=sH(b,e,d),h=sA[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=sE[d],a[1]^=sF[d]}sc(c)}(this.state32,this.rounds),si(this.state32),this.posOut=0,this.pos=0}update(a){r9(this),r7(a=sp(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){r9(this,!1),r7(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return r6(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(sa(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,sc(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new sI(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}ss(()=>new sI(136,1,32));class sJ extends sr{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=sd(this.buffer)}update(a){r9(this),r7(a=sp(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=sd(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){r9(this),sa(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,sc(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=sd(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let sK=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),sL=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),sM=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),sN=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),sO=new Uint32Array(64);class sP extends sJ{constructor(a=32){super(64,a,8,!1),this.A=0|sK[0],this.B=0|sK[1],this.C=0|sK[2],this.D=0|sK[3],this.E=0|sK[4],this.F=0|sK[5],this.G=0|sK[6],this.H=0|sK[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)sO[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=sO[a-15],c=sO[a-2],d=se(b,7)^se(b,18)^b>>>3,e=se(c,17)^se(c,19)^c>>>10;sO[a]=e+sO[a-7]+d+sO[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,o;let b=j+(se(g,6)^se(g,11)^se(g,25))+((k=g)&h^~k&i)+sN[a]+sO[a]|0,p=(se(c,2)^se(c,13)^se(c,22))+((l=c)&(m=d)^l&(o=e)^m&o)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+p|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){sc(sO)}destroy(){this.set(0,0,0,0,0,0,0,0),sc(this.buffer)}}let sQ=rS(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),sR=sQ[0],sS=sQ[1],sT=new Uint32Array(80),sU=new Uint32Array(80);class sV extends sJ{constructor(a=64){super(128,a,16,!1),this.Ah=0|sM[0],this.Al=0|sM[1],this.Bh=0|sM[2],this.Bl=0|sM[3],this.Ch=0|sM[4],this.Cl=0|sM[5],this.Dh=0|sM[6],this.Dl=0|sM[7],this.Eh=0|sM[8],this.El=0|sM[9],this.Fh=0|sM[10],this.Fl=0|sM[11],this.Gh=0|sM[12],this.Gl=0|sM[13],this.Hh=0|sM[14],this.Hl=0|sM[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:o,Hh:p,Hl:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|o,this.Hh=0|p,this.Hl=0|q}process(a,b){for(let c=0;c<16;c++,b+=4)sT[c]=a.getUint32(b),sU[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|sT[a-15],c=0|sU[a-15],d=rV(b,c,1)^rV(b,c,8)^rT(b,c,7),e=rW(b,c,1)^rW(b,c,8)^rU(b,c,7),f=0|sT[a-2],g=0|sU[a-2],h=rV(f,g,19)^rX(f,g,61)^rT(f,g,6),i=r0(e,rW(f,g,19)^rY(f,g,61)^rU(f,g,6),sU[a-7],sU[a-16]),j=r1(i,d,h,sT[a-7],sT[a-16]);sT[a]=0|j,sU[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:o,Gh:p,Gl:q,Hh:r,Hl:s}=this;for(let a=0;a<80;a++){let b=rV(k,l,14)^rV(k,l,18)^rX(k,l,41),t=rW(k,l,14)^rW(k,l,18)^rY(k,l,41),u=k&m^~k&p,v=r2(s,t,l&o^~l&q,sS[a],sU[a]),w=r3(v,r,b,u,sR[a],sT[a]),x=0|v,y=rV(c,d,28)^rX(c,d,34)^rX(c,d,39),z=rW(c,d,28)^rY(c,d,34)^rY(c,d,39),A=c&e^c&g^e&g,B=d&f^d&h^f&h;r=0|p,s=0|q,p=0|m,q=0|o,m=0|k,o=0|l,({h:k,l:l}=rZ(0|i,0|j,0|w,0|x)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let C=r$(x,z,B);c=r_(C,w,y,A),d=0|C}({h:c,l:d}=rZ(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=rZ(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=rZ(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=rZ(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=rZ(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:o}=rZ(0|this.Fh,0|this.Fl,0|m,0|o)),({h:p,l:q}=rZ(0|this.Gh,0|this.Gl,0|p,0|q)),({h:r,l:s}=rZ(0|this.Hh,0|this.Hl,0|r,0|s)),this.set(c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s)}roundClean(){sc(sT,sU)}destroy(){sc(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class sW extends sV{constructor(){super(48),this.Ah=0|sL[0],this.Al=0|sL[1],this.Bh=0|sL[2],this.Bl=0|sL[3],this.Ch=0|sL[4],this.Cl=0|sL[5],this.Dh=0|sL[6],this.Dl=0|sL[7],this.Eh=0|sL[8],this.El=0|sL[9],this.Fh=0|sL[10],this.Fl=0|sL[11],this.Gh=0|sL[12],this.Gl=0|sL[13],this.Hh=0|sL[14],this.Hl=0|sL[15]}}let sX=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class sY extends sV{constructor(){super(32),this.Ah=0|sX[0],this.Al=0|sX[1],this.Bh=0|sX[2],this.Bl=0|sX[3],this.Ch=0|sX[4],this.Cl=0|sX[5],this.Dh=0|sX[6],this.Dl=0|sX[7],this.Eh=0|sX[8],this.El=0|sX[9],this.Fh=0|sX[10],this.Fl=0|sX[11],this.Gh=0|sX[12],this.Gl=0|sX[13],this.Hh=0|sX[14],this.Hl=0|sX[15]}}let sZ=ss(()=>new sP),s$=ss(()=>new sV),s_=ss(()=>new sW),s0=(ss(()=>new sY),Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9])),s1=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),s2=new Uint32Array(32);function s3(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=s2[2*a],j=s2[2*a+1],k=s2[2*b],l=s2[2*b+1],m=s2[2*c],o=s2[2*c+1],p=s2[2*d],q=s2[2*d+1],r=r$(i,k,g);j=r_(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:p,Dl:q}),({h:o,l:m}=rZ(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:rV(l,k,24),Bl:rW(l,k,24)}),s2[2*a]=i,s2[2*a+1]=j,s2[2*b]=k,s2[2*b+1]=l,s2[2*c]=m,s2[2*c+1]=o,s2[2*d]=p,s2[2*d+1]=q}function s4(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=s2[2*a],j=s2[2*a+1],k=s2[2*b],l=s2[2*b+1],m=s2[2*c],o=s2[2*c+1],p=s2[2*d],q=s2[2*d+1],r=r$(i,k,g);j=r_(r,j,l,h),i=0|r,({Dh:q,Dl:p}={Dh:q^j,Dl:p^i}),({Dh:q,Dl:p}={Dh:rV(q,p,16),Dl:rW(q,p,16)}),({h:o,l:m}=rZ(o,m,q,p)),({Bh:l,Bl:k}={Bh:l^o,Bl:k^m}),({Bh:l,Bl:k}={Bh:rX(l,k,63),Bl:rY(l,k,63)}),s2[2*a]=i,s2[2*a+1]=j,s2[2*b]=k,s2[2*b+1]=l,s2[2*c]=m,s2[2*c+1]=o,s2[2*d]=p,s2[2*d+1]=q}class s5 extends sr{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,r6(a),r6(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=sb(this.buffer)}update(a){r9(this),r7(a=sp(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(si(d),this.compress(d,0,!1),si(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));si(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);si(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){r9(this),sa(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,sc(this.buffer.subarray(b)),si(c),this.compress(c,0,!0),si(c);let d=sb(a);this.get().forEach((a,b)=>d[b]=sh(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class s6 extends s5{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|s1[0],this.v0h=0|s1[1],this.v1l=0|s1[2],this.v1h=0|s1[3],this.v2l=0|s1[4],this.v2h=0|s1[5],this.v3l=0|s1[6],this.v3h=0|s1[7],this.v4l=0|s1[8],this.v4h=0|s1[9],this.v5l=0|s1[10],this.v5h=0|s1[11],this.v6l=0|s1[12],this.v6h=0|s1[13],this.v7l=0|s1[14],this.v7h=0|s1[15],function(a,b={},c,d,e){if(r6(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=sp(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=sb(e=sp(e));this.v4l^=sh(a[0]),this.v4h^=sh(a[1]),this.v5l^=sh(a[2]),this.v5h^=sh(a[3])}if(void 0!==d){const a=sb(d=sp(d));this.v6l^=sh(a[0]),this.v6h^=sh(a[1]),this.v7l^=sh(a[2]),this.v7h^=sh(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:o,v7l:p,v7h:q}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|o,this.v7l=0|p,this.v7h=0|q}compress(a,b,c){this.get().forEach((a,b)=>s2[b]=a),s2.set(s1,16);let{h:d,l:e}=rR(BigInt(this.length));s2[24]=s1[8]^e,s2[25]=s1[9]^d,c&&(s2[28]=~s2[28],s2[29]=~s2[29]);let f=0;for(let c=0;c<12;c++)s3(0,4,8,12,a,b+2*s0[f++]),s4(0,4,8,12,a,b+2*s0[f++]),s3(1,5,9,13,a,b+2*s0[f++]),s4(1,5,9,13,a,b+2*s0[f++]),s3(2,6,10,14,a,b+2*s0[f++]),s4(2,6,10,14,a,b+2*s0[f++]),s3(3,7,11,15,a,b+2*s0[f++]),s4(3,7,11,15,a,b+2*s0[f++]),s3(0,5,10,15,a,b+2*s0[f++]),s4(0,5,10,15,a,b+2*s0[f++]),s3(1,6,11,12,a,b+2*s0[f++]),s4(1,6,11,12,a,b+2*s0[f++]),s3(2,7,8,13,a,b+2*s0[f++]),s4(2,7,8,13,a,b+2*s0[f++]),s3(3,4,9,14,a,b+2*s0[f++]),s4(3,4,9,14,a,b+2*s0[f++]);this.v0l^=s2[0]^s2[16],this.v0h^=s2[1]^s2[17],this.v1l^=s2[2]^s2[18],this.v1h^=s2[3]^s2[19],this.v2l^=s2[4]^s2[20],this.v2h^=s2[5]^s2[21],this.v3l^=s2[6]^s2[22],this.v3h^=s2[7]^s2[23],this.v4l^=s2[8]^s2[24],this.v4h^=s2[9]^s2[25],this.v5l^=s2[10]^s2[26],this.v5h^=s2[11]^s2[27],this.v6l^=s2[12]^s2[28],this.v6h^=s2[13]^s2[29],this.v7l^=s2[14]^s2[30],this.v7h^=s2[15]^s2[31],sc(s2)}destroy(){this.destroyed=!0,sc(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}function s7(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function s8(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function s9(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function ta(a,...b){if(!s7(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function tb(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function tc(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function td(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}C=a=>new s6(a),(o=(a,b)=>C(b).update(sp(a)).digest()).outputLen=(p=C({})).outputLen,o.blockLen=p.blockLen,o.create=a=>C(a),Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;let te=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function tf(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(s7(a))a=ti(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function tg(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function th(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function ti(a){return Uint8Array.from(a)}let tj=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),tk=tj("expand 16-byte k"),tl=tj("expand 32-byte k"),tm=tc(tk),tn=tc(tl);function to(a,b){return a<<b|a>>>32-b}function tp(a){return a.byteOffset%4==0}let tq=0x100000000-1,tr=new Uint32Array,ts=(a,b)=>255&a[b++]|(255&a[b++])<<8;class tt{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,ta(a=tf(a),32);const b=ts(a,0),c=ts(a,2),d=ts(a,4),e=ts(a,6),f=ts(a,8),g=ts(a,10),h=ts(a,12),i=ts(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=ts(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],o=e[8],p=e[9],q=ts(a,b+0),r=ts(a,b+2),s=ts(a,b+4),t=ts(a,b+6),u=ts(a,b+8),v=ts(a,b+10),w=ts(a,b+12),x=ts(a,b+14),y=d[0]+(8191&q),z=d[1]+((q>>>13|r<<3)&8191),A=d[2]+((r>>>10|s<<6)&8191),B=d[3]+((s>>>7|t<<9)&8191),C=d[4]+((t>>>4|u<<12)&8191),D=d[5]+(u>>>1&8191),E=d[6]+((u>>>14|v<<2)&8191),F=d[7]+((v>>>11|w<<5)&8191),G=d[8]+((w>>>8|x<<8)&8191),H=d[9]+(x>>>5|2048*!c),I=0,J=0+y*f+5*p*z+5*o*A+5*m*B+5*l*C;I=J>>>13,J&=8191,J+=5*k*D+5*j*E+5*i*F+5*h*G+5*g*H,I+=J>>>13,J&=8191;let K=I+y*g+z*f+5*p*A+5*o*B+5*m*C;I=K>>>13,K&=8191,K+=5*l*D+5*k*E+5*j*F+5*i*G+5*h*H,I+=K>>>13,K&=8191;let L=I+y*h+z*g+A*f+5*p*B+5*o*C;I=L>>>13,L&=8191,L+=5*m*D+5*l*E+5*k*F+5*j*G+5*i*H,I+=L>>>13,L&=8191;let M=I+y*i+z*h+A*g+B*f+5*p*C;I=M>>>13,M&=8191,M+=5*o*D+5*m*E+5*l*F+5*k*G+5*j*H,I+=M>>>13,M&=8191;let N=I+y*j+z*i+A*h+B*g+C*f;I=N>>>13,N&=8191,N+=5*p*D+5*o*E+5*m*F+5*l*G+5*k*H,I+=N>>>13,N&=8191;let O=I+y*k+z*j+A*i+B*h+C*g;I=O>>>13,O&=8191,O+=D*f+5*p*E+5*o*F+5*m*G+5*l*H,I+=O>>>13,O&=8191;let P=I+y*l+z*k+A*j+B*i+C*h;I=P>>>13,P&=8191,P+=D*g+E*f+5*p*F+5*o*G+5*m*H,I+=P>>>13,P&=8191;let Q=I+y*m+z*l+A*k+B*j+C*i;I=Q>>>13,Q&=8191,Q+=D*h+E*g+F*f+5*p*G+5*o*H,I+=Q>>>13,Q&=8191;let R=I+y*o+z*m+A*l+B*k+C*j;I=R>>>13,R&=8191,R+=D*i+E*h+F*g+G*f+5*p*H,I+=R>>>13,R&=8191;let S=I+y*p+z*o+A*m+B*l+C*k;I=S>>>13,S&=8191,S+=D*j+E*i+F*h+G*g+H*f,I+=S>>>13,S&=8191,J=8191&(I=(I=(I<<2)+I|0)+J|0),I>>>=13,K+=I,d[0]=J,d[1]=K,d[2]=L,d[3]=M,d[4]=N,d[5]=O,d[6]=P,d[7]=Q,d[8]=R,d[9]=S}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;td(c)}update(a){tb(this),ta(a=tf(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){td(this.h,this.r,this.buffer,this.pad)}digestInto(a){tb(this),function(a,b){ta(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let tu=(D=a=>new tt(a),(q=(a,b)=>D(b).update(tf(a)).digest()).outputLen=(r=D(new Uint8Array(32))).outputLen,q.blockLen=r.blockLen,q.create=a=>D(a),q),tv=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return s9(e),s9(g),s8(f),s8(c),(b,h,i,j,k=0)=>{ta(b),ta(h),ta(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),ta(j),s9(k),k<0||k>=tq)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],o=b.length,p,q;if(32===o)m.push(p=ti(b)),q=tn;else if(16===o&&c)(p=new Uint8Array(32)).set(b),p.set(b,16),q=tm,m.push(p);else throw Error(`arx: invalid 32-byte key, got length=${o}`);tp(h)||m.push(h=ti(h));let r=tc(p);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(q,r,tc(h.subarray(0,16)),r),h=h.subarray(16)}let s=16-e;if(s!==h.length)throw Error(`arx: nonce must be ${s} or 16 bytes`);if(12!==s){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=tc(j),l=tp(e)&&tp(f),m=l?tc(e):tr,o=l?tc(f):tr;for(let p=0;p<i;g++){if(a(b,c,d,k,g,h),g>=tq)throw Error("arx: counter overflow");let q=Math.min(64,i-p);if(l&&64===q){let a=p/4;if(p%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)o[c=a+b]=m[c]^k[b];p+=64;continue}for(let a=0,b;a<q;a++)f[b=p+a]=e[b]^j[a];p+=q}}(a,q,r,tc(h),i,j,k,g),td(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=c[0],u=c[1],v=c[2],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=o,E=p,F=q,G=r,H=s,I=e,J=t,K=u,L=v;for(let a=0;a<f;a+=2)E=E+(I=to(I^(w=w+A|0),16))|0,w=w+(A=to(A^E,12))|0,E=E+(I=to(I^w,8))|0,A=to(A^E,7),F=F+(J=to(J^(x=x+B|0),16))|0,x=x+(B=to(B^F,12))|0,F=F+(J=to(J^x,8))|0,B=to(B^F,7),G=G+(K=to(K^(y=y+C|0),16))|0,y=y+(C=to(C^G,12))|0,G=G+(K=to(K^y,8))|0,C=to(C^G,7),H=H+(L=to(L^(z=z+D|0),16))|0,z=z+(D=to(D^H,12))|0,H=H+(L=to(L^z,8))|0,D=to(D^H,7),G=G+(L=to(L^(w=w+B|0),16))|0,w=w+(B=to(B^G,12))|0,G=G+(L=to(L^w,8))|0,B=to(B^G,7),H=H+(I=to(I^(x=x+C|0),16))|0,x=x+(C=to(C^H,12))|0,H=H+(I=to(I^x,8))|0,C=to(C^H,7),E=E+(J=to(J^(y=y+D|0),16))|0,y=y+(D=to(D^E,12))|0,E=E+(J=to(J^y,8))|0,D=to(D^E,7),F=F+(K=to(K^(z=z+A|0),16))|0,z=z+(A=to(A^F,12))|0,F=F+(K=to(K^z,8))|0,A=to(A^F,7);let M=0;d[M++]=g+w|0,d[M++]=h+x|0,d[M++]=i+y|0,d[M++]=j+z|0,d[M++]=k+A|0,d[M++]=l+B|0,d[M++]=m+C|0,d[M++]=o+D|0,d[M++]=p+E|0,d[M++]=q+F|0,d[M++]=r+G|0,d[M++]=s+H|0,d[M++]=e+I|0,d[M++]=t+J|0,d[M++]=u+K|0,d[M++]=v+L|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),tw=new Uint8Array(16),tx=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(tw.subarray(c))},ty=new Uint8Array(32);function tz(a,b,c,d,e){var f,g;let h,i,j=a(b,c,ty),k=tu.create(j);e&&tx(k,e),tx(k,d);let l=(f=d.length,g=e?e.length:0,s8(!0),th(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),th(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return td(j,l),m}t={blockSize:64,nonceLength:12,tagLength:16},u=(a,b,c)=>({encrypt(d,e){let f=d.length;(e=tg(f+16,e,!1)).set(d);let g=e.subarray(0,-16);tv(a,b,g,g,1);let h=tz(tv,a,b,g,c);return e.set(h,f),td(h),e},decrypt(d,e){e=tg(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=tz(tv,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),tv(a,b,e,e,1),td(h),e}}),Object.assign(function(a,...b){if(ta(a),!te)throw Error("Non little-endian hardware is not yet supported");if(void 0!==t.nonceLength){let a=b[0];if(!a)throw Error("nonce / iv required");t.varSizeNonce?ta(a):ta(a,t.nonceLength)}let c=t.tagLength;c&&void 0!==b[1]&&ta(b[1]);let d=u(a,...b),e=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");ta(b)}},f=!1;return{encrypt(a,b){if(f)throw Error("cannot encrypt() twice with same key + nonce");return f=!0,ta(a),e(d.encrypt.length,b),d.encrypt(a,b)},decrypt(a,b){if(ta(a),c&&a.length<c)throw Error("invalid ciphertext length: smaller than tagLength="+c);return e(d.decrypt.length,b),d.decrypt(a,b)}}},t);class tA extends sr{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,r8(a);const c=sp(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),sc(e)}update(a){return r9(this),this.iHash.update(a),this}digestInto(a){r9(this),r7(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let tB=(a,b,c)=>new tA(a,b).update(c).digest();tB.create=(a,b)=>new tA(a,b),Uint8Array.from([0]),Uint8Array.of();let tC=BigInt(0),tD=BigInt(1);function tE(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function tF(a,b,c=""){let d=r5(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function tG(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function tH(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?tC:BigInt("0x"+a)}function tI(a){return r7(a),tH(sl(Uint8Array.from(a).reverse()))}function tJ(a,b){return sn(a.toString(16).padStart(2*b,"0"))}function tK(a,b){return tJ(a,b).reverse()}function tL(a,b,c){let d;if("string"==typeof b)try{d=sn(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(r5(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let tM=a=>"bigint"==typeof a&&tC<=a;function tN(a,b,c,d){if(!(tM(b)&&tM(c)&&tM(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function tO(a){let b;for(b=0;a>tC;a>>=tD,b+=1);return b}let tP=a=>(tD<<BigInt(a))-tD;function tQ(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function tR(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let tS=BigInt(0),tT=BigInt(1),tU=BigInt(2),tV=BigInt(3),tW=BigInt(4),tX=BigInt(5),tY=BigInt(7),tZ=BigInt(8),t$=BigInt(9),t_=BigInt(16);function t0(a,b){let c=a%b;return c>=tS?c:b+c}function t1(a,b,c){let d=a;for(;b-- >tS;)d*=d,d%=c;return d}function t2(a,b){if(a===tS)throw Error("invert: expected non-zero number");if(b<=tS)throw Error("invert: expected positive modulus, got "+b);let c=t0(a,b),d=b,e=tS,f=tT;for(;c!==tS;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==tT)throw Error("invert: does not exist");return t0(e,b)}function t3(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function t4(a,b){let c=(a.ORDER+tT)/tW,d=a.pow(b,c);return t3(a,d,b),d}function t5(a,b){let c=(a.ORDER-tX)/tZ,d=a.mul(b,tU),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,tU),e),h=a.mul(f,a.sub(g,a.ONE));return t3(a,h,b),h}function t6(a){if(a<tV)throw Error("sqrt is not defined for small field");let b=a-tT,c=0;for(;b%tU===tS;)b/=tU,c++;let d=tU,e=ub(a);for(;1===t9(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return t4;let f=e.pow(d,b),g=(b+tT)/tU;return function(a,d){if(a.is0(d))return d;if(1!==t9(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=tT<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let t7=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function t8(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function t9(a,b){let c=(a.ORDER-tT)/tU,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function ua(a,b){void 0!==b&&r6(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function ub(a,b,c=!1,d={}){let e;if(a<=tS)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=ua(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:tP(j),ZERO:tS,ONE:tT,allowedLengths:i,create:b=>t0(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return tS<=b&&b<a},is0:a=>a===tS,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&tT)===tT,neg:b=>t0(-b,a),eql:(a,b)=>a===b,sqr:b=>t0(b*b,a),add:(b,c)=>t0(b+c,a),sub:(b,c)=>t0(b-c,a),mul:(b,c)=>t0(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<tS)throw Error("invalid exponent, negatives unsupported");if(c===tS)return a.ONE;if(c===tT)return b;let d=a.ONE,e=b;for(;c>tS;)c&tT&&(d=a.mul(d,e)),e=a.sqr(e),c>>=tT;return d})(l,a,b),div:(b,c)=>t0(b*t2(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>t2(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%tW===tV?t4:a%tZ===tX?t5:a%t_===t$?(c=ub(a),f=(d=t6(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+tY)/t_,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),o=a.cmov(c,d,m);return t3(a,o,b),o}):t6(a)),e(l,b)}),toBytes:a=>c?tK(a,k):tJ(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?tI(b):tH(sl(b));if(h&&(e=t0(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>t8(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function uc(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function ud(a){let b=uc(a);return b+Math.ceil(b/2)}let ue=BigInt(0),uf=BigInt(1);function ug(a,b){let c=b.negate();return a?c:b}function uh(a,b){let c=t8(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function ui(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function uj(a,b){ui(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:tP(a),maxNumber:e,shiftBy:BigInt(a)}}function uk(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=uf);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let ul=new WeakMap,um=new WeakMap;function un(a){return um.get(a)||1}function uo(a){if(a!==ue)throw Error("invalid wNAF")}class up{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>ue;)b&uf&&(c=c.add(d)),d=d.double(),b>>=uf;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=uj(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=uj(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=uk(c,a,f);c=g,i?e=e.add(ug(k,b[l])):d=d.add(ug(j,b[h]))}return uo(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=uj(a,this.bits);for(let a=0;a<e.windows&&c!==ue;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=uk(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return uo(c),d}getPrecomputes(a,b,c){let d=ul.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),ul.set(b,d))),d}cached(a,b,c){let d=un(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=un(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){ui(b,this.bits),um.set(a,b),ul.delete(a)}hasCache(a){return 1!==un(a)}}function uq(a,b,c){if(!b)return ub(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return tQ(b,t7.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),so("HashToScalar-");let ur=BigInt(0),us=BigInt(1),ut=BigInt(2),uu=BigInt(1),uv=BigInt(2),uw=BigInt(3),ux=BigInt(5),uy=BigInt(8),uz=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),uA={p:uz,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:uy,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},uB=(function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(tQ(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=g?32:56,i=BigInt(g?9:5),j=BigInt(g?121665:39081),k=g?ut**BigInt(254):ut**BigInt(447),l=k+(g?BigInt(8)*ut**BigInt(251)-us:BigInt(4)*ut**BigInt(445)-us)+us,m=a=>t0(a,b),o=tK(m(i),h);o.slice()}({P:s=ub(uA.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,j,k,l,m,o,p,{pow_p_5_8:q,b2:r}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=t1(f=a*a%uz*a%uz,uv,uz)*f%uz,h=t1(g,uu,uz)*a%uz,i=t1(h,ux,uz)*h%uz,j=t1(i,b,uz)*i%uz,k=t1(j,c,uz)*j%uz,l=t1(k,d,uz)*k%uz,m=t1(l,e,uz)*l%uz,o=t1(m,e,uz)*l%uz,p=t1(o,b,uz)*i%uz,{pow_p_5_8:t1(p,uv,uz)*a%uz,b2:f});return t0(t1(q,uw,s)*r,s)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),(a,b)=>(a+(a>=0?b:-b)/uH)/b);function uC(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function uD(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return tE(c.lowS,"lowS"),tE(c.prehash,"prehash"),void 0!==c.format&&uC(c.format),c}let uE={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=uE;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=tG(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?tG(e.length/2|128):"";return tG(a)+f+e+b},decode(a,b){let{Err:c}=uE,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=uE;if(a<uF)throw new b("integer: negative integers are not allowed");let c=tG(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=uE;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return tH(sl(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=uE,e=tL("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=uE,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},uF=BigInt(0),uG=BigInt(1),uH=BigInt(2),uI=BigInt(3),uJ=BigInt(4);function uK(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=tL("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function uL(a){return Uint8Array.of(a?2:3)}function uM(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function uN(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:ub(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){r8(b),tQ(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||st,e=c.hmac||((a,...c)=>tB(b,a,sq(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||st,e=Object.assign(uM(a.Fp,c),{seed:ud(c.ORDER)});function f(a){try{return!!uK(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=uc(b),f=ud(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=t0(c?tI(a):tH(sl(a)),b-tT)+tT;return c?tK(g,e):tJ(g,e)}(tF(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(uK(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=tL("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=uK(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>uK(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),p={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},q="compact";function r(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class s{constructor(a,b,c){this.r=r("r",a),this.s=r("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=q){var c,d;let e,f;if(c=a,uC(d=b),f=o.signature,tF(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=uE.toSig(tF(a));return new s(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new s(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(sn(a),b)}addRecoveryBit(a){return new s(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*uH<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(sq(uL((1&i)==0),k)),m=g.inv(j),o=u(tL("msgHash",b)),p=g.create(-o*m),q=g.create(e*m),r=a.BASE.multiplyUnsafe(p).add(l.multiplyUnsafe(q));if(r.is0())throw Error("point at infinify");return r.assertValidity(),r}hasHighS(){return this.s>h>>uG}toBytes(a=q){if(uC(a),"der"===a)return sn(uE.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return sq(Uint8Array.of(this.recovery),b,c)}return sq(b,c)}toHex(a){return sl(this.toBytes(a))}assertValidity(){}static fromCompact(a){return s.fromBytes(tL("sig",a),"compact")}static fromDER(a){return s.fromBytes(tL("sig",a),"der")}normalizeS(){return this.hasHighS()?new s(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return sl(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return sl(this.toBytes("compact"))}}let t=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=tH(sl(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},u=c.bits2int_modN||function(a){return g.create(t(a))},v=tP(i);function w(a){return tN("num < 2^"+i,a,uF,v),g.toBytes(a)}function x(a,c){return tF(a,void 0,"message"),c?tF(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:o,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=uD(e,p),k=u(b=x(b,i)),l=uK(g,c),m=[w(l),w(k)];if(null!=j&&!1!==j){let a=!0===j?d(o.secretKey):j;m.push(tL("extraEntropy",a))}return{seed:sq(...m),k2sig:function(b){let c=t(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===uF)return;let j=g.create(d*g.create(k+i*l));if(j===uF)return;let m=2*(e.x!==i)|Number(e.y&uG),o=j;return f&&j>h>>uG&&(o=g.neg(j),m^=1),new s(i,o,m)}}}(c=tL("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return sq(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=uD(e,p);if(d=tL("publicKey",d),c=x(tL("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||r5(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new s(a.r,a.s);else if(c){try{b=s.fromBytes(tL("sig",a),"der")}catch(a){if(!(a instanceof uE.Err))throw a}if(!b)try{b=s.fromBytes(tL("sig",a),"compact")}catch{return!1}}return b||!1}(b):s.fromBytes(tL("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=u(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),o=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!o.is0()&&g.create(o.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=uD(c,p);return b=x(b,d),s.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:s,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>ue))throw Error(`CURVE.${a} must be positive bigint`)}let e=uq(b.p,c.Fp,d),f=uq(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;tQ(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=uM(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(tE(c,"isCompressed"),c)?(k(),sq(uL(!d.isOdd(f)),g)):sq(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){tF(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=o(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!p(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function o(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function p(a,b){let c=d.sqr(b),e=o(a);return d.eql(c,e)}if(!p(f.Gx,f.Gy))throw Error("bad curve params: generator point");let q=d.mul(d.pow(f.a,uI),uJ),r=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(q,r)))throw Error("bad curve params: a or b");function s(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function t(a){if(!(a instanceof y))throw Error("ProjectivePoint expected")}function u(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=uB(g*a,c),i=uB(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<uF,m=k<uF;l&&(j=-j),m&&(k=-k);let o=tP(Math.ceil(tO(c)/2))+uG;if(j<uF||j>=o||k<uF||k>=o)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let v=tR((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),w=tR(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!p(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function x(a,b,c,e,f){return c=new y(d.mul(c.X,a),c.Y,c.Z),b=ug(e,b),c=ug(f,c),b.add(c)}class y{constructor(a,b,c){this.X=s("x",a),this.Y=s("y",b,!0),this.Z=s("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof y)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?y.ZERO:new y(b,c,d.ONE)}static fromBytes(a){let b=y.fromAffine(m(tF(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return y.fromBytes(tL("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return A.createCache(this,a),b||this.multiply(uI),this}assertValidity(){w(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){t(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new y(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,uI),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),o=d.mul(h,h),p=d.mul(e,g);return p=d.add(p,p),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,o),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(p,i),k=d.mul(c,k),o=d.mul(a,o),p=d.sub(l,o),p=d.mul(a,p),p=d.add(p,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,o),l=d.mul(l,p),j=d.add(j,l),o=d.mul(g,h),o=d.add(o,o),l=d.mul(o,p),i=d.sub(i,l),k=d.mul(o,m),k=d.add(k,k),new y(i,j,k=d.add(k,k))}add(a){t(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,o=d.mul(f.b,uI),p=d.mul(b,g),q=d.mul(c,h),r=d.mul(e,i),s=d.add(b,c),u=d.add(g,h);s=d.mul(s,u),u=d.add(p,q),s=d.sub(s,u),u=d.add(b,e);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(p,r),u=d.sub(u,v),v=d.add(c,e),j=d.add(h,i),v=d.mul(v,j),j=d.add(q,r),v=d.sub(v,j),l=d.mul(m,u),j=d.mul(o,r),l=d.add(j,l),j=d.sub(q,l),l=d.add(q,l),k=d.mul(j,l),q=d.add(p,p),q=d.add(q,p),r=d.mul(m,r),u=d.mul(o,u),q=d.add(q,r),r=d.sub(p,r),r=d.mul(m,r),u=d.add(u,r),p=d.mul(q,u),k=d.add(k,p),p=d.mul(v,u),j=d.mul(s,j),j=d.sub(j,p),p=d.mul(s,q),l=d.mul(v,l),new y(j,k,l=d.add(l,p))}subtract(a){return this.add(a.negate())}is0(){return this.equals(y.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>A.cached(this,a,a=>uh(y,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=u(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=x(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return uh(y,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===uF||this.is0())return y.ZERO;if(a===uG)return this;if(A.hasCache(this))return this.multiply(a);if(!c)return A.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=u(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>ue||d>ue;)c&uf&&(f=f.add(e)),d&uf&&(g=g.add(e)),e=e.double(),c>>=uf,d>>=uf;return{p1:f,p2:g}}(y,this,d,f);return x(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return v(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===uG||(a?a(y,this):A.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===uG?this:a?a(y,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return tE(a,"isCompressed"),this.assertValidity(),l(y,this,a)}toHex(a=!0){return sl(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return uh(y,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=tO(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=tP(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(y,e,a,b)}static fromPrivateKey(a){return y.BASE.multiply(uK(e,a))}}y.BASE=new y(f.Gx,f.Gy,d.ONE),y.ZERO=new y(d.ZERO,d.ONE,d.ZERO),y.Fp=d,y.Fn=e;let z=e.BITS,A=new up(y,b.endo?Math.ceil(z/2):z);return y.BASE.precompute(8),y}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,ua(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let uO={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},uP={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},uQ={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},uR=ub(uO.p),uS=ub(uP.p),uT=ub(uQ.p);uN({...uO,Fp:uR,lowS:!1},sZ),uN({...uP,Fp:uS,lowS:!1},s_),uN({...uQ,Fp:uT,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},s$),Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,a$.ONE_DAY,a$.SIX_HOURS,a$.THIRTY_DAYS,a$.FIVE_SECONDS,a$.THIRTY_DAYS,a$.ONE_DAY,a$.ONE_DAY,a$.THIRTY_SECONDS,a$.THIRTY_SECONDS,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_DAY;var uU=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var o=f-e;o!==f&&0===g[o];)o++;for(var p=new Uint8Array(d+(f-o)),q=d;o!==f;)p[q++]=g[o++];return p}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,o=g-1;(0!==l||m<d)&&-1!==o;o--,m++)l+=256*j[o]>>>0,j[o]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var p=g-d;p!==g&&0===j[p];)p++;for(var q=i.repeat(c);p<g;++p)q+=a.charAt(j[p]);return q},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let uV=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class uW{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class uX{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return uZ(this,a)}}class uY{constructor(a){this.decoders=a}or(a){return uZ(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let uZ=(a,b)=>new uY({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class u${constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new uW(a,b,c),this.decoder=new uX(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let u_=({name:a,prefix:b,encode:c,decode:d})=>new u$(a,b,c,d),u0=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=uU(c,b);return u_({prefix:a,name:b,encode:d,decode:a=>uV(e(a))})},u1=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>u_({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var u2=Object.freeze({__proto__:null,identity:u_({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),u3=Object.freeze({__proto__:null,base2:u1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),u4=Object.freeze({__proto__:null,base8:u1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),u5=Object.freeze({__proto__:null,base10:u0({prefix:"9",name:"base10",alphabet:"0123456789"})}),u6=Object.freeze({__proto__:null,base16:u1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:u1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),u7=Object.freeze({__proto__:null,base32:u1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:u1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:u1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:u1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:u1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:u1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:u1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:u1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:u1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),u8=Object.freeze({__proto__:null,base36:u0({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:u0({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),u9=Object.freeze({__proto__:null,base58btc:u0({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:u0({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),va=Object.freeze({__proto__:null,base64:u1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:u1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:u1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:u1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let vb=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),vc=vb.reduce((a,b,c)=>(a[c]=b,a),[]),vd=vb.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var ve=Object.freeze({__proto__:null,base256emoji:u_({prefix:"ðŸš€",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=vc[b],"")},decode:function(a){let b=[];for(let c of a){let a=vd[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function vf(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,vf.bytes=c-d+1,b}var vg=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let vh=(a,b,c=0)=>(vf(a,b,c),b),vi=(a,b)=>{let c=b.byteLength,d=vg(a),e=d+vg(c),f=new Uint8Array(e+c);return vh(a,f,0),vh(c,f,d),f.set(b,e),new vj(a,c,b,f)};class vj{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let vk=({name:a,code:b,encode:c})=>new vl(a,b,c);class vl{constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?vi(this.code,b):b.then(a=>vi(this.code,a))}throw Error("Unknown type, must be binary type")}}let vm=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var vn=Object.freeze({__proto__:null,sha256:vk({name:"sha2-256",code:18,encode:vm("SHA-256")}),sha512:vk({name:"sha2-512",code:19,encode:vm("SHA-512")})}),vo=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:uV,digest:a=>vi(0,uV(a))}});new TextEncoder,new TextDecoder;let vp={...u2,...u3,...u4,...u5,...u6,...u7,...u8,...u9,...va,...ve};function vq(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}function vr(a){let b,c,d,e,f,g,h,i=a.isNewChainsStale??!0;return(0,pp.createConnector)(j=>({id:"walletConnect",name:"WalletConnect",type:vr.type,provider:a.universalProvider,async setup(){let a=await this.getProvider().catch(()=>null);a&&(e||(e=this.onConnect.bind(this),a.on("connect",e)),g||(g=this.onSessionDelete.bind(this),a.on("session_delete",g)))},async connect({...a}={}){try{let b=L.ChainController.getCaipNetworks(),i=await this.getProvider();if(!i)throw new pa.ProviderNotFoundError;f||(f=this.onDisplayUri,i.on("display_uri",f));let j=await this.isChainsStale();i.session&&j&&await i.disconnect();let k=O.OptionsController.state.universalProviderConfigOverride;if(!i.session||j){let c=nR.createNamespaces(b,k);await i.connect({optionalNamespaces:c,..."pairingTopic"in a?{pairingTopic:a.pairingTopic}:{}}),this.setRequestedChainsIds(b.map(a=>Number(a.id)))}let l=await this.getAccounts(),m=await this.getChainId(),o=i.session?.namespaces?.eip155?.chains,p=o?.some(a=>Number(a.split(":")[1])===m),q=1;p?q=m:o?.[0]&&(q=Number(o[0].split(":")[1])),f&&(i.removeListener("display_uri",f),f=void 0),e&&(i.removeListener("connect",e),e=void 0),c||(c=this.onAccountsChanged.bind(this),i.on("accountsChanged",c)),d||(d=this.onChainChanged.bind(this),i.on("chainChanged",d)),h||(h=this.onDisconnect.bind(this),i.on("disconnect",h)),g||(g=this.onSessionDelete.bind(this),i.on("session_delete",g));let r=k?.defaultChain;return i.setDefaultChain(r??`eip155:${q}`),{accounts:l,chainId:q}}catch(a){if(/(user rejected|connection request reset)/i.test(a?.message))throw new pl.UserRejectedRequestError(a);throw a}},async disconnect(){let a=await this.getProvider();try{await a?.disconnect()}catch(a){if(!/No matching key/i.test(a.message))throw a}finally{d&&(a?.removeListener("chainChanged",d),d=void 0),h&&(a?.removeListener("disconnect",h),h=void 0),e||(e=this.onConnect.bind(this),a?.on("connect",e)),c&&(a?.removeListener("accountsChanged",c),c=void 0),g&&(a?.removeListener("session_delete",g),g=void 0),this.setRequestedChainsIds([])}},async getAccounts(){let a=await this.getProvider();if(!a?.session?.namespaces)return[];let b=a?.session?.namespaces[I.ConstantsUtil.CHAIN.EVM]?.accounts,c=b?.map(a=>a.split(":")[2])??[],d=new Set;return c.filter(a=>{let b=a?.toLowerCase();return!d.has(b)&&(d.add(b),!0)})},async getProvider({chainId:c}={}){b||(b=a.universalProvider,b?.events.setMaxListeners(1/0));let d=S.StorageUtil.getActiveNamespace(),e=L.ChainController.getActiveCaipNetwork()?.id;if(c&&e!==c&&d){let a=S.StorageUtil.getStoredActiveCaipNetworkId(),b=d?L.ChainController.getCaipNetworks(d):[],c=b?.find(b=>b.id===a);c&&c.chainNamespace===I.ConstantsUtil.CHAIN.EVM&&await this.switchChain?.({chainId:Number(c.id)})}return b},async getChainId(){let a=L.ChainController.getActiveCaipNetwork(I.ConstantsUtil.CHAIN.EVM)?.id;if(a)return a;let b=await this.getProvider(),c=b.session?.namespaces[I.ConstantsUtil.CHAIN.EVM]?.chains?.[0],d=L.ChainController.getCaipNetworks().find(a=>a.id===c);return d?.id},async isAuthorized(){try{let[a,b]=await Promise.all([this.getAccounts(),this.getProvider()]);if(!a.length)return!1;if(await this.isChainsStale()&&b.session)return await b.disconnect().catch(()=>{}),!1;return!0}catch{return!1}},async switchChain({addEthereumChainParameter:a,chainId:b}){let c=await this.getProvider();if(!c)throw new pa.ProviderNotFoundError;let d=L.ChainController.getCaipNetworks().find(a=>a.id===b);if(!d)throw new pl.SwitchChainError(new ox.ChainNotConfiguredError);try{await c.request({method:"wallet_switchEthereumChain",params:[{chainId:(0,oe.numberToHex)(b)}]}),d?.caipNetworkId&&c.setDefaultChain(d?.caipNetworkId),j.emitter.emit("change",{chainId:Number(b)});let a=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...a,b]),{...d,id:d.id}}catch(e){if(/(?:user rejected)/iu.test(e.message))throw new pl.UserRejectedRequestError(e);try{let e;e=a?.blockExplorerUrls?a.blockExplorerUrls:d.blockExplorers?.default.url?[d.blockExplorers?.default.url]:[];let f=d.rpcUrls?.chainDefault?.http||[],g={blockExplorerUrls:e,chainId:(0,oe.numberToHex)(b),chainName:d.name,iconUrls:a?.iconUrls,nativeCurrency:d.nativeCurrency,rpcUrls:f};await c.request({method:"wallet_addEthereumChain",params:[g]});let h=await this.getRequestedChainsIds();return this.setRequestedChainsIds([...h,b]),{...d,id:d.id}}catch(a){throw new pl.UserRejectedRequestError(a)}}},onAccountsChanged(a){0===a.length?this.onDisconnect():j.emitter.emit("change",{accounts:a.map(a=>(0,pm.getAddress)(a))})},onChainChanged(a){let b=Number(a);j.emitter.emit("change",{chainId:b})},onConnect(a){this.setRequestedChainsIds(L.ChainController.getCaipNetworks().map(a=>Number(a.id)))},async onDisconnect(a){this.setRequestedChainsIds([]),j.emitter.emit("disconnect");let b=await this.getProvider();c&&(b.removeListener("accountsChanged",c),c=void 0),d&&(b.removeListener("chainChanged",d),d=void 0),h&&(b.removeListener("disconnect",h),h=void 0),g&&(b.removeListener("session_delete",g),g=void 0),e||(e=this.onConnect.bind(this),b.on("connect",e))},onDisplayUri(a){j.emitter.emit("message",{type:"display_uri",data:a})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){if(!b?.session?.namespaces)return[];let a=b?.session?.namespaces[I.ConstantsUtil.CHAIN.EVM]?.accounts;return a?.map(a=>Number.parseInt(a.split(":")[1]??""))??[]},async getRequestedChainsIds(){return[...new Set(await j.storage?.getItem(this.requestedChainsStorageKey)??[])]},async isChainsStale(){if(!i)return!1;let a=j.chains.map(a=>a.id),b=this.getNamespaceChainsIds();if(b.length&&!b.some(b=>a.includes(b)))return!1;let c=await this.getRequestedChainsIds();return!a.every(a=>c.includes(Number(a)))},async setRequestedChainsIds(a){await j.storage?.setItem(this.requestedChainsStorageKey,a)},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}}))}({...vn,...vo}),vq("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),vq("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){var b;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?(b=globalThis.Buffer.allocUnsafe(a),null!=globalThis.Buffer?new Uint8Array(b.buffer,b.byteOffset,b.byteLength):b):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),vp.base16,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,a$.THIRTY_DAYS,a$.SEVEN_DAYS,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_DAY,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_DAY,a$.ONE_HOUR,a$.ONE_HOUR,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.FIVE_MINUTES,a$.SEVEN_DAYS,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable,vr.type="walletConnect";var vs=a.i(791477);let vt=(0,H.proxy)({pendingTransactions:0}),vu={state:vt,subscribeKey:(a,b)=>(0,vs.subscribeKey)(vt,a,b),increase(a){vt[a]+=1},decrease(a){vt[a]-=1},reset(a){vt[a]=0}};async function vv(b){if(F.CoreHelperUtil.isSafeApp()){let{safe:c}=await a.A(34997);if(c&&!b.some(a=>"safe"===a.type))return c()}return null}async function vw(b){try{let{baseAccount:c}=await a.A(34997);if(c&&!b.some(a=>"baseAccount"===a.id))return c()}catch(a){console.error("Failed to import Coinbase Wallet SDK:",a)}return null}let vx={enable:!1,pollingInterval:3e4};function vy(a){return{formatters:void 0,fees:void 0,serializers:void 0,...a}}vy({id:"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",name:"Solana",network:"solana-mainnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!1,chainNamespace:"solana",caipNetworkId:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",deprecatedCaipNetworkId:"solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ"}),vy({id:"EtWTRABZaYq6iMfeYKouRu166VU2xqa1",name:"Solana Devnet",network:"solana-devnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1",deprecatedCaipNetworkId:"solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K"}),vy({id:"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z",name:"Solana Testnet",network:"solana-testnet",nativeCurrency:{name:"Solana",symbol:"SOL",decimals:9},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},blockExplorers:{default:{name:"Solscan",url:"https://solscan.io"}},testnet:!0,chainNamespace:"solana",caipNetworkId:"solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z"}),vy({id:"000000000019d6689c085ae165831e93",caipNetworkId:"bip122:000000000019d6689c085ae165831e93",chainNamespace:"bip122",name:"Bitcoin",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}}),vy({id:"000000000933ea01ad0ee984209779ba",caipNetworkId:"bip122:000000000933ea01ad0ee984209779ba",chainNamespace:"bip122",name:"Bitcoin Testnet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0}),vy({id:"00000008819873e925422c1ff0f99f7c",caipNetworkId:"bip122:00000008819873e925422c1ff0f99f7c",chainNamespace:"bip122",name:"Bitcoin Signet",nativeCurrency:{name:"Bitcoin",symbol:"BTC",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}},testnet:!0});var vz=a.i(729992),vA=a.i(493847),vB=a.i(93782),vC=a.i(408811),vD=a.i(346821),vE=a.i(264494),vF=a.i(240504),vG=a.i(461206),vH=a.i(612429),vI=a.i(967697),vJ=class extends vI.Subscribable{constructor(a={}){super(),this.config=a,this.#a=new Map}#a;build(a,b,c){let d=b.queryKey,e=b.queryHash??(0,vF.hashQueryKeyByOptions)(d,b),f=this.get(e);return f||(f=new vG.Query({client:a,queryKey:d,queryHash:e,options:a.defaultQueryOptions(b),state:c,defaultOptions:a.getQueryDefaults(d)}),this.add(f)),f}add(a){this.#a.has(a.queryHash)||(this.#a.set(a.queryHash,a),this.notify({type:"added",query:a}))}remove(a){let b=this.#a.get(a.queryHash);b&&(a.destroy(),b===a&&this.#a.delete(a.queryHash),this.notify({type:"removed",query:a}))}clear(){vH.notifyManager.batch(()=>{this.getAll().forEach(a=>{this.remove(a)})})}get(a){return this.#a.get(a)}getAll(){return[...this.#a.values()]}find(a){let b={exact:!0,...a};return this.getAll().find(a=>(0,vF.matchQuery)(b,a))}findAll(a={}){let b=this.getAll();return Object.keys(a).length>0?b.filter(b=>(0,vF.matchQuery)(a,b)):b}notify(a){vH.notifyManager.batch(()=>{this.listeners.forEach(b=>{b(a)})})}onFocus(){vH.notifyManager.batch(()=>{this.getAll().forEach(a=>{a.onFocus()})})}onOnline(){vH.notifyManager.batch(()=>{this.getAll().forEach(a=>{a.onOnline()})})}},vK=a.i(170797),vL=vI,vM=class extends vL.Subscribable{constructor(a={}){super(),this.config=a,this.#b=new Set,this.#c=new Map,this.#d=0}#b;#c;#d;build(a,b,c){let d=new vK.Mutation({client:a,mutationCache:this,mutationId:++this.#d,options:a.defaultMutationOptions(b),state:c});return this.add(d),d}add(a){this.#b.add(a);let b=vN(a);if("string"==typeof b){let c=this.#c.get(b);c?c.push(a):this.#c.set(b,[a])}this.notify({type:"added",mutation:a})}remove(a){if(this.#b.delete(a)){let b=vN(a);if("string"==typeof b){let c=this.#c.get(b);if(c)if(c.length>1){let b=c.indexOf(a);-1!==b&&c.splice(b,1)}else c[0]===a&&this.#c.delete(b)}}this.notify({type:"removed",mutation:a})}canRun(a){let b=vN(a);if("string"!=typeof b)return!0;{let c=this.#c.get(b),d=c?.find(a=>"pending"===a.state.status);return!d||d===a}}runNext(a){let b=vN(a);if("string"!=typeof b)return Promise.resolve();{let c=this.#c.get(b)?.find(b=>b!==a&&b.state.isPaused);return c?.continue()??Promise.resolve()}}clear(){vH.notifyManager.batch(()=>{this.#b.forEach(a=>{this.notify({type:"removed",mutation:a})}),this.#b.clear(),this.#c.clear()})}getAll(){return Array.from(this.#b)}find(a){let b={exact:!0,...a};return this.getAll().find(a=>(0,vF.matchMutation)(b,a))}findAll(a={}){return this.getAll().filter(b=>(0,vF.matchMutation)(a,b))}notify(a){vH.notifyManager.batch(()=>{this.listeners.forEach(b=>{b(a)})})}resumePausedMutations(){let a=this.getAll().filter(a=>a.state.isPaused);return vH.notifyManager.batch(()=>Promise.all(a.map(a=>a.continue().catch(vF.noop))))}};function vN(a){return a.options.scope?.id}var vO=a.i(760420),vP=a.i(649858),vQ=a.i(258197);let vR=new class{#e;#f;#g;#h;#i;#j;#k;#l;constructor(a={}){this.#e=a.queryCache||new vJ,this.#f=a.mutationCache||new vM,this.#g=a.defaultOptions||{},this.#h=new Map,this.#i=new Map,this.#j=0}mount(){this.#j++,1===this.#j&&(this.#k=vO.focusManager.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#l=vP.onlineManager.subscribe(async a=>{a&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#j--,0===this.#j&&(this.#k?.(),this.#k=void 0,this.#l?.(),this.#l=void 0)}isFetching(a){return this.#e.findAll({...a,fetchStatus:"fetching"}).length}isMutating(a){return this.#f.findAll({...a,status:"pending"}).length}getQueryData(a){let b=this.defaultQueryOptions({queryKey:a});return this.#e.get(b.queryHash)?.state.data}ensureQueryData(a){let b=this.defaultQueryOptions(a),c=this.#e.build(this,b),d=c.state.data;return void 0===d?this.fetchQuery(a):(a.revalidateIfStale&&c.isStaleByTime((0,vF.resolveStaleTime)(b.staleTime,c))&&this.prefetchQuery(b),Promise.resolve(d))}getQueriesData(a){return this.#e.findAll(a).map(({queryKey:a,state:b})=>[a,b.data])}setQueryData(a,b,c){let d=this.defaultQueryOptions({queryKey:a}),e=this.#e.get(d.queryHash),f=e?.state.data,g=(0,vF.functionalUpdate)(b,f);if(void 0!==g)return this.#e.build(this,d).setData(g,{...c,manual:!0})}setQueriesData(a,b,c){return vH.notifyManager.batch(()=>this.#e.findAll(a).map(({queryKey:a})=>[a,this.setQueryData(a,b,c)]))}getQueryState(a){let b=this.defaultQueryOptions({queryKey:a});return this.#e.get(b.queryHash)?.state}removeQueries(a){let b=this.#e;vH.notifyManager.batch(()=>{b.findAll(a).forEach(a=>{b.remove(a)})})}resetQueries(a,b){let c=this.#e;return vH.notifyManager.batch(()=>(c.findAll(a).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...a},b)))}cancelQueries(a,b={}){let c={revert:!0,...b};return Promise.all(vH.notifyManager.batch(()=>this.#e.findAll(a).map(a=>a.cancel(c)))).then(vF.noop).catch(vF.noop)}invalidateQueries(a,b={}){return vH.notifyManager.batch(()=>(this.#e.findAll(a).forEach(a=>{a.invalidate()}),a?.refetchType==="none")?Promise.resolve():this.refetchQueries({...a,type:a?.refetchType??a?.type??"active"},b))}refetchQueries(a,b={}){let c={...b,cancelRefetch:b.cancelRefetch??!0};return Promise.all(vH.notifyManager.batch(()=>this.#e.findAll(a).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let b=a.fetch(void 0,c);return c.throwOnError||(b=b.catch(vF.noop)),"paused"===a.state.fetchStatus?Promise.resolve():b}))).then(vF.noop)}fetchQuery(a){let b=this.defaultQueryOptions(a);void 0===b.retry&&(b.retry=!1);let c=this.#e.build(this,b);return c.isStaleByTime((0,vF.resolveStaleTime)(b.staleTime,c))?c.fetch(b):Promise.resolve(c.state.data)}prefetchQuery(a){return this.fetchQuery(a).then(vF.noop).catch(vF.noop)}fetchInfiniteQuery(a){return a.behavior=(0,vQ.infiniteQueryBehavior)(a.pages),this.fetchQuery(a)}prefetchInfiniteQuery(a){return this.fetchInfiniteQuery(a).then(vF.noop).catch(vF.noop)}ensureInfiniteQueryData(a){return a.behavior=(0,vQ.infiniteQueryBehavior)(a.pages),this.ensureQueryData(a)}resumePausedMutations(){return vP.onlineManager.isOnline()?this.#f.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#f}getDefaultOptions(){return this.#g}setDefaultOptions(a){this.#g=a}setQueryDefaults(a,b){this.#h.set((0,vF.hashKey)(a),{queryKey:a,defaultOptions:b})}getQueryDefaults(a){let b=[...this.#h.values()],c={};return b.forEach(b=>{(0,vF.partialMatchKey)(a,b.queryKey)&&Object.assign(c,b.defaultOptions)}),c}setMutationDefaults(a,b){this.#i.set((0,vF.hashKey)(a),{mutationKey:a,defaultOptions:b})}getMutationDefaults(a){let b=[...this.#i.values()],c={};return b.forEach(b=>{(0,vF.partialMatchKey)(a,b.mutationKey)&&Object.assign(c,b.defaultOptions)}),c}defaultQueryOptions(a){if(a._defaulted)return a;let b={...this.#g.queries,...this.getQueryDefaults(a.queryKey),...a,_defaulted:!0};return b.queryHash||(b.queryHash=(0,vF.hashQueryKeyByOptions)(b.queryKey,b)),void 0===b.refetchOnReconnect&&(b.refetchOnReconnect="always"!==b.networkMode),void 0===b.throwOnError&&(b.throwOnError=!!b.suspense),!b.networkMode&&b.persister&&(b.networkMode="offlineFirst"),b.queryFn===vF.skipToken&&(b.enabled=!1),b}defaultMutationOptions(a){return a?._defaulted?a:{...this.#g.mutations,...a?.mutationKey&&this.getMutationDefaults(a.mutationKey),...a,_defaulted:!0}}clear(){this.#e.clear(),this.#f.clear()}},vS="your_project_id_here",vT="demo-project-id",vU=new class extends oh{constructor(a){const b=nU.CaipNetworksUtil.extendCaipNetworks(a.networks,{projectId:a.projectId,customNetworkImageUrls:{},customRpcUrls:a.customRpcUrls});super(),this.balancePromises={},this.namespace=I.ConstantsUtil.CHAIN.EVM,this.adapterType=I.ConstantsUtil.ADAPTER_TYPES.WAGMI,this.projectId=a.projectId,this.pendingTransactionsFilter={...vx,...a.pendingTransactionsFilter??{}},this.createConfig({...a,networks:b}),this.checkChainId()}construct(a){this.checkChainId(),this.setupWatchers()}async getAccounts(a){let b=this.getWagmiConnector(a.id);if(!b)return{accounts:[]};if(b.id===I.ConstantsUtil.CONNECTOR_ID.AUTH){let a=await b.getProvider();if(!a?.user)return{accounts:[]};let{address:c,accounts:d}=a.user;return Promise.resolve({accounts:(d||[{address:c,type:"eoa"}]).map(a=>F.CoreHelperUtil.createAccount("eip155",a.address,a.type))})}let{addresses:c,address:d}=(0,oO.getAccount)(this.wagmiConfig);return Promise.resolve({accounts:[...new Set(c||[d])].map(a=>F.CoreHelperUtil.createAccount("eip155",a||"","eoa"))})}checkChainId(){let{chainId:a}=(0,oO.getAccount)(this.wagmiConfig);a&&this.emit("switchNetwork",{chainId:a})}getWagmiConnector(a){return this.wagmiConfig.connectors.find(b=>b.id===a)}createConfig(a){this.wagmiChains=a.networks.filter(a=>a.chainNamespace===I.ConstantsUtil.CHAIN.EVM);let b={},d=[...a.connectors??[]];this.wagmiChains.forEach(c=>{let d=a.transports?.[c.id],e=nU.CaipNetworksUtil.getCaipNetworkId(c);d?b[c.id]=nU.CaipNetworksUtil.extendWagmiTransports(c,a.projectId,d):b[c.id]=nU.CaipNetworksUtil.getViemTransport(c,a.projectId,a.customRpcUrls?.[e])}),this.wagmiConfig=function(a){let b,d,e,{multiInjectedProviderDiscovery:f=!0,storage:g=oK({storage:{getItem:a=>oL.getItem(a),removeItem(a){oL.removeItem(a)},setItem(a,b){try{oL.setItem(a,b)}catch{}}}}),syncConnectedChain:h=!0,ssr:i=!1,...j}=a,k,l=oC(()=>j.chains),m=oC(()=>{let a=[],b=new Set;for(let c of j.connectors??[]){let d=o(c);if(a.push(d),!i&&d.rdns)for(let a of"string"==typeof d.rdns?[d.rdns]:d.rdns)b.add(a)}return a});function o(a){let b=new oF(function(a=11){if(!c||oM+a>512){c="",oM=0;for(let a=0;a<256;a++)c+=(256+256*Math.random()|0).toString(16).substring(1)}return c.substring(oM,oM+++a)}()),d={...a({emitter:b,chains:l.getState(),storage:g,transports:j.transports}),emitter:b,uid:b.uid};return b.on("connect",w),d.setup?.(),d}function p(a){let{info:b}=a,c=a.provider;return(0,oD.injected)({target:{...b,id:b.rdns,provider:c}})}let q=new Map;function r(){return{chainId:l.getState()[0].id,connections:new Map,current:null,status:"disconnected"}}let s="0.0.0-canary-";b=oN.version.startsWith(s)?Number.parseInt(oN.version.replace(s,""),10):Number.parseInt(oN.version.split(".")[0]??"0",10);let t=oC((e=g?(d={migrate(a,c){if(c===b)return a;let d=r(),e=u(a,d.chainId);return{...d,chainId:e}},name:"store",partialize:a=>({connections:{__type:"Map",value:Array.from(a.connections.entries()).map(([a,b])=>{let{id:c,name:d,type:e,uid:f}=b.connector;return[a,{...b,connector:{id:c,name:d,type:e,uid:f}}]})},chainId:a.chainId,current:a.current}),merge(a,b){"object"==typeof a&&a&&"status"in a&&delete a.status;let c=u(a,b.chainId);return{...b,...a,chainId:c}},skipHydration:i,storage:g,version:b},(a,b,c)=>{let e,f={storage:function(a,b){let c;try{c=a()}catch(a){return}return{getItem:a=>{var b;let d=a=>null===a?null:JSON.parse(a,void 0),e=null!=(b=c.getItem(a))?b:null;return e instanceof Promise?e.then(d):d(e)},setItem:(a,b)=>c.setItem(a,JSON.stringify(b,void 0)),removeItem:a=>c.removeItem(a)}}(()=>localStorage),partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...d},g=!1,h=new Set,i=new Set,j=f.storage;if(!j)return r((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${f.name}', the given storage is currently unavailable.`),a(...b)},b,c);let k=()=>{let a=f.partialize({...b()});return j.setItem(f.name,{state:a,version:f.version})},l=c.setState;c.setState=(a,b)=>{l(a,b),k()};let m=r((...b)=>{a(...b),k()},b,c);c.getInitialState=()=>m;let o=()=>{var c,d;if(!j)return;g=!1,h.forEach(a=>{var c;return a(null!=(c=b())?c:m)});let l=(null==(d=f.onRehydrateStorage)?void 0:d.call(f,null!=(c=b())?c:m))||void 0;return oA(j.getItem.bind(j))(f.name).then(a=>{if(a)if("number"!=typeof a.version||a.version===f.version)return[!1,a.state];else{if(f.migrate)return[!0,f.migrate(a.state,a.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(c=>{var d;let[g,h]=c;if(a(e=f.merge(h,null!=(d=b())?d:m),!0),g)return k()}).then(()=>{null==l||l(e,void 0),e=b(),g=!0,i.forEach(a=>a(e))}).catch(a=>{null==l||l(void 0,a)})};return c.persist={setOptions:a=>{f={...f,...a},a.storage&&(j=a.storage)},clearStorage:()=>{null==j||j.removeItem(f.name)},getOptions:()=>f,rehydrate:()=>o(),hasHydrated:()=>g,onHydrate:a=>(h.add(a),()=>{h.delete(a)}),onFinishHydration:a=>(i.add(a),()=>{i.delete(a)})},f.skipHydration||o(),e||m}):r,(a,b,c)=>{let d=c.subscribe;return c.subscribe=(a,b,e)=>{let f=a;if(b){let d=(null==e?void 0:e.equalityFn)||Object.is,g=a(c.getState());f=c=>{let e=a(c);if(!d(g,e)){let a=g;b(g=e,a)}},(null==e?void 0:e.fireImmediately)&&b(g,g)}return d(f)},e(a,b,c)}));function u(a,b){return a&&"object"==typeof a&&"chainId"in a&&"number"==typeof a.chainId&&l.getState().some(b=>b.id===a.chainId)?a.chainId:b}function v(a){t.setState(b=>{let c=b.connections.get(a.uid);return c?{...b,connections:new Map(b.connections).set(a.uid,{accounts:a.accounts??c.accounts,chainId:a.chainId??c.chainId,connector:c.connector})}:b})}function w(a){"connecting"!==t.getState().status&&"reconnecting"!==t.getState().status&&t.setState(b=>{let c=m.getState().find(b=>b.uid===a.uid);return c?(c.emitter.listenerCount("connect")&&c.emitter.off("connect",v),c.emitter.listenerCount("change")||c.emitter.on("change",v),c.emitter.listenerCount("disconnect")||c.emitter.on("disconnect",x),{...b,connections:new Map(b.connections).set(a.uid,{accounts:a.accounts,chainId:a.chainId,connector:c}),current:a.uid,status:"connected"}):b})}function x(a){t.setState(b=>{let c=b.connections.get(a.uid);if(c){let a=c.connector;a.emitter.listenerCount("change")&&c.connector.emitter.off("change",v),a.emitter.listenerCount("disconnect")&&c.connector.emitter.off("disconnect",x),a.emitter.listenerCount("connect")||c.connector.emitter.on("connect",w)}if(b.connections.delete(a.uid),0===b.connections.size)return{...b,connections:new Map,current:null,status:"disconnected"};let d=b.connections.values().next().value;return{...b,connections:new Map(b.connections),current:d.connector.uid}})}return t.setState(r()),h&&t.subscribe(({connections:a,current:b})=>b?a.get(b)?.chainId:void 0,a=>{if(l.getState().some(b=>b.id===a))return t.setState(b=>({...b,chainId:a??b.chainId}))}),k?.subscribe(a=>{let b=new Set,c=new Set;for(let a of m.getState())if(b.add(a.id),a.rdns)for(let b of"string"==typeof a.rdns?[a.rdns]:a.rdns)c.add(b);let d=[];for(let e of a){if(c.has(e.info.rdns))continue;let a=o(p(e));b.has(a.id)||d.push(a)}(!g||t.persist.hasHydrated())&&m.setState(a=>[...a,...d],!0)}),{get chains(){return l.getState()},get connectors(){return m.getState()},storage:g,getClient:function(a={}){let b,c=a.chainId??t.getState().chainId,d=l.getState().find(a=>a.id===c);if(a.chainId&&!d)throw new ox.ChainNotConfiguredError;{let a=q.get(t.getState().chainId);if(a&&!d)return a;if(!d)throw new ox.ChainNotConfiguredError}{let a=q.get(c);if(a)return a}if(j.client)b=j.client({chain:d});else{let a=d.id,c=l.getState().map(a=>a.id),e={};for(let[b,d]of Object.entries(j))if("chains"!==b&&"client"!==b&&"connectors"!==b&&"transports"!==b)if("object"==typeof d)if(a in d)e[b]=d[a];else{if(c.some(a=>a in d))continue;e[b]=d}else e[b]=d;b=(0,oz.createClient)({...e,chain:d,batch:e.batch??{multicall:!0},transport:b=>j.transports[a]({...b,connectors:m})})}return q.set(c,b),b},get state(){return t.getState()},setState(a){let b;b="function"==typeof a?a(t.getState()):a;let c=r();"object"!=typeof b&&(b=c),Object.keys(c).some(a=>!(a in b))&&(b=c),t.setState(b,!0)},subscribe:(a,b,c)=>t.subscribe(a,b,c?{...c,fireImmediately:c.emitImmediately}:void 0),_internal:{mipd:k,async revalidate(){let a=t.getState(),b=a.connections,c=a.current;for(let[,a]of b){let d=a.connector;d.isAuthorized&&await d.isAuthorized()||(b.delete(d.uid),c===d.uid&&(c=null))}t.setState(a=>({...a,connections:b,current:c}))},store:t,ssr:!!i,syncConnectedChain:h,transports:j.transports,chains:{setState(a){let b="function"==typeof a?a(l.getState()):a;if(0!==b.length)return l.setState(b,!0)},subscribe:a=>l.subscribe(a)},connectors:{providerDetailToConnector:p,setup:o,setState:a=>m.setState("function"==typeof a?a(m.getState()):a,!0),subscribe:a=>m.subscribe(a)},events:{change:v,connect:w,disconnect:x}}}}({...a,chains:this.wagmiChains,connectors:d,transports:b})}setupWatchPendingTransactions(){if(!this.pendingTransactionsFilter.enable||this.unwatchPendingTransactions)return;this.unwatchPendingTransactions=function(a,b){let c,d,{syncConnectedChain:e=a._internal.syncConnectedChain,...f}=b,g=b=>{c&&c();let d=a.getClient({chainId:b});return c=(0,oT.getAction)(d,pk.watchPendingTransactions,"watchPendingTransactions")(f)},h=g(b.chainId);return e&&!b.chainId&&(d=a.subscribe(({chainId:a})=>a,async a=>g(a))),()=>{h?.(),d?.()}}(this.wagmiConfig,{pollingInterval:this.pendingTransactionsFilter.pollingInterval,onError:()=>{},onTransactions:()=>{this.emit("pendingTransactions"),vu.increase("pendingTransactions")}});let a=vu.subscribeKey("pendingTransactions",b=>{b>=I.ConstantsUtil.LIMITS.PENDING_TRANSACTIONS&&(this.unwatchPendingTransactions?.(),a())})}setupWatchers(){!function(a,b){let{onChange:c}=b;a.subscribe(()=>o3(a),c,{equalityFn:o1.deepEqual})}(this.wagmiConfig,{onChange:a=>{this.clearConnections(),this.addConnection(...a.map(a=>{let b=this.getCaipNetworks().find(b=>b.id===a.chainId),c=a.connector.id===I.ConstantsUtil.CONNECTOR_ID.AUTH;return{accounts:a.accounts.map(a=>({address:this.toChecksummedAddress(a)})),caipNetwork:b,connectorId:a.connector.id,auth:c?{name:S.StorageUtil.getConnectedSocialProvider(),username:S.StorageUtil.getConnectedSocialUsername()}:void 0}}))}}),(0,pj.watchAccount)(this.wagmiConfig,{onChange:(a,b)=>{if("disconnected"===a.status&&b.address&&this.emit("disconnect"),a?.chainId&&a?.chainId!==b?.chainId&&this.emit("switchNetwork",{chainId:a.chainId}),"connected"===a.status){let c=a.address!==b?.address,d=a.connector.id!==b.connector?.id,e="connected"!==b.status;(c||d||e)&&(this.setupWatchPendingTransactions(),this.handleAccountChanged({address:a.address,chainId:a.chainId,connector:a.connector}))}}})}async addThirdPartyConnectors(){let a=[],{enableCoinbase:b}=O.OptionsController.state||{};if(!1!==b){let b=await vw(this.wagmiConfig.connectors);b&&a.push(b)}let c=await vv(this.wagmiConfig.connectors);c&&a.push(c),await Promise.all(a.map(a=>{let b=this.configureInternalConnector(a);return this.addWagmiConnector(b)}))}addWagmiConnectors(){let a=[];!1!==O.OptionsController.state.enableInjected&&a.push((0,oD.injected)({shimDisconnect:!0}));let{features:b,remoteFeatures:c,projectId:d,enableAuthLogger:e}=O.OptionsController.state,f=c?.email??b?.email??!0,g=c?.socials??b?.socials,h=Array.isArray(g)&&g?.length>0;(f||h)&&a.push(function(a){let b,c,d=[];function e(a){let b=L.ChainController.getCaipNetworks(I.ConstantsUtil.CHAIN.EVM),c=Number(nH.NetworkUtil.parseEvmChainId(a));if(!b.some(b=>String(b.id)===String(a))){let a=L.ChainController.getActiveCaipNetwork(I.ConstantsUtil.CHAIN.EVM)?.id||b[0]?.id;a&&Number.isInteger(Number(a))&&(c=Number(a))}if(!c)throw Error("ChainId not found in networks");return c}async function f(c={}){let g=(b||(b=ag.getInstance({projectId:a.options.projectId,chainId:(0,$.getActiveCaipNetwork)()?.caipNetworkId,enableLogger:a.options.enableAuthLogger,onTimeout:a=>{"iframe_load_failed"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):"iframe_request_timeout"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):"unverified_domain"===a&&J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},abortController:aa.ErrorUtil.EmbeddedWalletAbortController,getActiveCaipNetwork:a=>(0,$.getActiveCaipNetwork)(a),getCaipNetworks:a=>L.ChainController.getCaipNetworks(a)})),b),h=c.chainId;if(c.isReconnecting){let b=nH.NetworkUtil.parseEvmChainId(g.getLastUsedChainId()||""),c=a.chains?.[0].id;if(!(h=b||c))throw Error("ChainId not found in provider")}let i=(0,$.getPreferredAccountType)("eip155"),{address:j,chainId:k,accounts:l}=await Z.SIWXUtil.authConnectorAuthenticate({authConnector:g,chainId:h,preferredAccountType:i,socialUri:c.socialUri,chainNamespace:I.ConstantsUtil.CHAIN.EVM});d=l?.map(a=>a.address)||[j];let m=e(k);return{accounts:d,account:j,chainId:m,chain:{id:m,unsupported:!1}}}return(0,pp.createConnector)(b=>({id:I.ConstantsUtil.CONNECTOR_ID.AUTH,name:I.ConstantsUtil.CONNECTOR_NAMES.AUTH,type:"AUTH",chain:I.ConstantsUtil.CHAIN.EVM,async connect(a={}){if(c){let b=await c;return{accounts:a.withCapabilities?b.accounts.map(a=>({address:a,capabilities:{}})):b.accounts,chainId:b.chainId}}c||(c=new Promise(b=>{b(f(a))}));let b=await c;return c=void 0,{accounts:a.withCapabilities?b.accounts.map(a=>({address:a,capabilities:{}})):b.accounts,chainId:b.chainId}},async disconnect(){let a=await this.getProvider();await a.disconnect()},getAccounts:()=>d?.length?(b.emitter.emit("change",{accounts:d}),Promise.resolve(d)):Promise.resolve([]),async getProvider(){return this.provider||(this.provider=ag.getInstance({projectId:a.options.projectId,chainId:(0,$.getActiveCaipNetwork)()?.caipNetworkId,enableLogger:a.options.enableAuthLogger,abortController:aa.ErrorUtil.EmbeddedWalletAbortController,onTimeout:a=>{"iframe_load_failed"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):"iframe_request_timeout"===a?J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):"unverified_domain"===a&&J.AlertController.open(aa.ErrorUtil.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},getActiveCaipNetwork:a=>(0,$.getActiveCaipNetwork)(a),getCaipNetworks:a=>L.ChainController.getCaipNetworks(a)})),Promise.resolve(this.provider)},async getChainId(){let a=await this.getProvider(),{chainId:b}=await a.getChainId();return e(b)},async isAuthorized(){let a=L.ChainController.state.activeChain===I.ConstantsUtil.CHAIN.EVM;return(!I.ConstantsUtil.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(a=>N.ConnectorController.getConnectorId(a)===I.ConstantsUtil.CONNECTOR_ID.AUTH)||!!a)&&Promise.resolve((await this.getProvider()).getLoginEmailUsed())},async switchChain({chainId:a}){try{let c=b.chains.find(b=>b.id===a);if(!c)throw new pl.SwitchChainError(Error("chain not found on connector."));let e=await this.getProvider(),f=(0,$.getPreferredAccountType)("eip155"),g=await e.connect({chainId:a,preferredAccountType:f});return d=g?.accounts?.map(a=>a.address)||[g.address],b.emitter.emit("change",{chainId:Number(a),accounts:d}),c}catch(a){if(a instanceof Error)throw new pl.SwitchChainError(a);throw a}},onAccountsChanged(a){0===a.length?this.onDisconnect():b.emitter.emit("change",{accounts:a.map(pm.getAddress)})},onChainChanged(a){let c=Number(a);b.emitter.emit("change",{chainId:c})},async onDisconnect(a){let b=await this.getProvider();await b.disconnect()}}))}({chains:this.wagmiChains,options:{projectId:d,enableAuthLogger:e}})),a.forEach(a=>{this.configureInternalConnector(a)})}configureInternalConnector(a){let b=this.wagmiConfig._internal.connectors.setup(a);return this.wagmiConfig._internal.connectors.setState(a=>[...a,b]),b}async handleAccountChanged({address:a,chainId:b,connector:c}){if(!this.namespace)throw Error("WagmiAdapter:handleAccountChanged - namespace is required");let d=await c.getProvider().catch(()=>void 0);this.emit("accountChanged",{address:this.toChecksummedAddress(a),chainId:b,connector:{id:c.id,name:po.PresetsUtil.ConnectorNamesMap[c.id]??c.name,imageId:po.PresetsUtil.ConnectorImageIds[c.id],type:po.PresetsUtil.ConnectorTypesMap[c.type]??"EXTERNAL",info:c.id===I.ConstantsUtil.CONNECTOR_ID.INJECTED?void 0:{rdns:c.id},provider:d,chain:this.namespace,chains:[]}})}async signMessage(a){try{return{signature:await o9(this.wagmiConfig,{message:a.message,account:a.address})}}catch(a){throw Error("WagmiAdapter:signMessage - Sign message failed")}}async sendTransaction(a){let{chainId:b,address:c}=(0,oO.getAccount)(this.wagmiConfig),d={account:c,to:a.to,value:Number.isNaN(Number(a.value))?BigInt(0):BigInt(a.value),gas:a.gas?BigInt(a.gas):void 0,gasPrice:a.gasPrice?BigInt(a.gasPrice):void 0,data:a.data,chainId:b,type:"legacy",parameters:["nonce"]};await o5(this.wagmiConfig,d);let e=await pg(this.wagmiConfig,d);return await (0,pi.waitForTransactionReceipt)(this.wagmiConfig,{hash:e,timeout:25e3}),{hash:e}}async writeContract(a){let{caipNetwork:b,...c}=a,d=Number(nH.NetworkUtil.caipNetworkIdToNumber(b.caipNetworkId));return{hash:await (0,ph.writeContract)(this.wagmiConfig,{chain:this.wagmiChains?.[d],chainId:d,address:c.tokenAddress,account:c.fromAddress,abi:c.abi,functionName:c.method,args:c.args,__mode:"prepared"})}}async estimateGas(a){try{return{gas:await pe(this.wagmiConfig,{account:a.address,to:a.to,data:a.data,type:"legacy"})}}catch(a){throw Error("WagmiAdapter:estimateGas - error estimating gas")}}parseUnits(a){return(0,pn.parseUnits)(a.value,a.decimals)}formatUnits(a){return(0,oP.formatUnits)(a.value,a.decimals)}async addWagmiConnector(a){if(!this.namespace)throw Error("WagmiAdapter:addWagmiConnector - namespace is required");let{enableEIP6963:b}=O.OptionsController.state||{};if(a.type===I.ConstantsUtil.CONNECTOR_ID.INJECTED&&!1===b||a.id===I.ConstantsUtil.CONNECTOR_ID.AUTH||a.id===I.ConstantsUtil.CONNECTOR_ID.WALLET_CONNECT)return;let c=await a.getProvider().catch(()=>void 0),d=K.AssetController.state.connectorImages;this.addConnector({id:a.id,explorerId:po.PresetsUtil.ConnectorExplorerIds[a.id],imageUrl:d?.[a.id]??a.icon,name:po.PresetsUtil.ConnectorNamesMap[a.id]??a.name,imageId:po.PresetsUtil.ConnectorImageIds[a.id],type:po.PresetsUtil.ConnectorTypesMap[a.type]??"EXTERNAL",info:a.id===I.ConstantsUtil.CONNECTOR_ID.INJECTED?void 0:{rdns:a.id},provider:c,chain:this.namespace,chains:[]})}async syncConnectors(){!function(a,b){let{onChange:c}=b;a._internal.connectors.subscribe((a,b)=>{c(Object.values(a),b)})}(this.wagmiConfig,{onChange:a=>{a.forEach(a=>this.addWagmiConnector(a))}}),this.addWagmiConnectors(),await Promise.all(this.wagmiConfig.connectors.map(a=>this.addWagmiConnector(a))),this.addThirdPartyConnectors()}async syncConnections(){let a=this.connectors.filter(a=>{let{hasDisconnected:b,hasConnected:c}=ab.HelpersUtil.getConnectorStorageInfo(a.id,this.namespace);return!b&&c}).map(a=>this.getWagmiConnector(a.id)).filter(Boolean);await (0,o6.reconnect)(this.wagmiConfig,{connectors:a})}async syncConnection(a){let{id:b,chainId:c}=a,d=o3(this.wagmiConfig).find(a=>a.connector.id===b),e=this.getWagmiConnector(b),f=await e?.getProvider();if(F.CoreHelperUtil.isSafeApp()&&b===I.ConstantsUtil.CONNECTOR_ID.SAFE&&!d?.accounts.length){let a=this.getWagmiConnector("safe");if(a){let b=await oy(this.wagmiConfig,{connector:a,chainId:Number(c)}),e=await a.getProvider();return{chainId:Number(c),address:this.toChecksummedAddress(b.accounts[0]),provider:e,type:d?.connector.type?.toUpperCase(),id:d?.connector.id}}}return{chainId:Number(d?.chainId),address:this.toChecksummedAddress(d?.accounts[0]),provider:f,type:d?.connector.type?.toUpperCase(),id:d?.connector.id}}async connectWalletConnect(a){try{let b=this.getWalletConnectConnector();await b.authenticate();let c=this.getWagmiConnector("walletConnect");if(!c)throw Error("UniversalAdapter:connectWalletConnect - connector not found");let d=await oy(this.wagmiConfig,{connector:c,chainId:a?Number(a):void 0});return d.chainId!==Number(a)&&await pb(this.wagmiConfig,{chainId:d.chainId}),{clientId:await b.provider.client.core.crypto.getClientId()}}catch(a){if(a instanceof pl.UserRejectedRequestError||of.ErrorUtil.isUserRejectedRequestError(a))throw new of.UserRejectedRequestError(a);throw a}}async connect(a){try{let{id:b,address:c,provider:d,type:e,info:f,chainId:g,socialUri:h}=a,i=this.getWagmiConnector(b);if(!i)throw Error("connectionControllerClient:connectExternal - connector is undefined");d&&f&&i.id===I.ConstantsUtil.CONNECTOR_ID.EIP6963&&i.setEip6963Wallet?.({provider:d,info:f});let j=this.wagmiConfig.state?.connections?.get(i.uid);if(j){await this.wagmiConfig.storage?.setItem("recentConnectorId",i.id);let a=[...j.accounts].sort((a,b)=>ab.HelpersUtil.isLowerCaseMatch(a,c)?-1:+!!ab.HelpersUtil.isLowerCaseMatch(b,c));return this.wagmiConfig?.setState(b=>({...b,connections:new Map(b.connections).set(i.uid,{accounts:a,chainId:j.chainId,connector:j.connector}),current:i.uid,status:"connected"})),{address:this.toChecksummedAddress(a[0]),chainId:j.chainId,provider:d,type:e,id:b}}let k=await oy(this.wagmiConfig,{connector:i,chainId:g?Number(g):void 0,socialUri:h});return{address:this.toChecksummedAddress(k.accounts[0]),chainId:k.chainId,provider:d,type:e,id:b}}catch(a){if(a instanceof pl.UserRejectedRequestError||of.ErrorUtil.isUserRejectedRequestError(a))throw new of.UserRejectedRequestError(a);throw a}}get connections(){return Array.from(this.wagmiConfig.state.connections.values()).map(a=>({accounts:a.accounts.map(a=>({address:this.toChecksummedAddress(a)})),connectorId:a.connector.id}))}async reconnect(a){let{id:b}=a,c=this.getWagmiConnector(b);if(!c)throw Error("connectionControllerClient:connectExternal - connector is undefined");await (0,o6.reconnect)(this.wagmiConfig,{connectors:[c]})}async getBalance(a){let b=a.address,c=this.getCaipNetworks().find(b=>b.id===a.chainId);if(!b)return Promise.resolve({balance:"0.00",symbol:"ETH"});if(c&&this.wagmiConfig){let b=`${c.caipNetworkId}:${a.address}`,d=this.balancePromises[b];if(d)return d;let e=S.StorageUtil.getNativeBalanceCacheForCaipAddress(b);return e?{balance:e.balance,symbol:e.symbol}:(this.balancePromises[b]=new Promise(async d=>{try{let e=Number(a.chainId),f=await o_(this.wagmiConfig,{address:a.address,chainId:e,token:a.tokens?.[c.caipNetworkId]?.address});S.StorageUtil.updateNativeBalanceCache({caipAddress:b,balance:f.formatted,symbol:f.symbol,timestamp:Date.now()}),d({balance:f.formatted,symbol:f.symbol})}catch(a){console.warn("Appkit:WagmiAdapter:getBalance - Error getting balance",a),d({balance:"0.00",symbol:"ETH"})}}).finally(()=>{delete this.balancePromises[b]}),this.balancePromises[b]||{balance:"0.00",symbol:"ETH"})}return{balance:"",symbol:""}}getWalletConnectProvider(){return this.getWagmiConnector("walletConnect")?.provider}async disconnect(a){if(a.id){let b=this.getWagmiConnector(a.id),c=o3(this.wagmiConfig).find(b=>ab.HelpersUtil.isLowerCaseMatch(b.connector.id,a.id));return(await pc(this.wagmiConfig,{connector:b}),!1===O.OptionsController.state.enableReconnect&&this.deleteConnection(a.id),c)?{connections:[{accounts:c.accounts.map(a=>({address:this.toChecksummedAddress(a)})),connectorId:c.connector.id}]}:{connections:[]}}return this.disconnectAll()}async disconnectAll(){let a=o3(this.wagmiConfig),b=await Promise.allSettled(a.map(async a=>{let b=this.getWagmiConnector(a.connector.id);return b&&await pc(this.wagmiConfig,{connector:b}),a}));return this.wagmiConfig.state.connections.clear(),{connections:b.filter(a=>"fulfilled"===a.status).map(({value:a})=>({accounts:a.accounts.map(a=>({address:this.toChecksummedAddress(a)})),connectorId:a.connector.id}))}}async switchNetwork(a){let{caipNetwork:b}=a,c=this.wagmiConfig.chains.find(a=>a.id.toString()===b.id.toString());if(!c)throw Error("connectionControllerClient:switchNetwork - wagmiChain is undefined");let{name:d,nativeCurrency:e,rpcUrls:f,blockExplorers:g,id:h}=c,i=b.rpcUrls?.chainDefault?.http?.[0]??f.default.http[0]??"",j=g?.default.url??b.blockExplorers?.default?.url??"",k=e??b.nativeCurrency,l=d??b.name;await pb(this.wagmiConfig,{chainId:h,addEthereumChainParameter:{chainName:l,nativeCurrency:k,rpcUrls:[i],blockExplorerUrls:[j]}}),await super.switchNetwork(a)}async getCapabilities(a){if(!this.wagmiConfig)throw Error("connectionControllerClient:getCapabilities - wagmiConfig is undefined");let b=o3(this.wagmiConfig)[0],c=b?this.getWagmiConnector(b.connector.id):null;if(!c)throw Error("connectionControllerClient:getCapabilities - connector is undefined");let d=await c.getProvider();if(!d)throw Error("connectionControllerClient:getCapabilities - provider is undefined");return await d.request({method:"wallet_getCapabilities",params:[a]})}async grantPermissions(a){if(!this.wagmiConfig)throw Error("connectionControllerClient:grantPermissions - wagmiConfig is undefined");let b=o3(this.wagmiConfig)[0],c=b?this.getWagmiConnector(b.connector.id):null;if(!c)throw Error("connectionControllerClient:grantPermissions - connector is undefined");let d=await c.getProvider();if(!d)throw Error("connectionControllerClient:grantPermissions - provider is undefined");return d.request({method:"wallet_grantPermissions",params:a})}async revokePermissions(a){if(!this.wagmiConfig)throw Error("connectionControllerClient:revokePermissions - wagmiConfig is undefined");let b=o3(this.wagmiConfig)[0],c=b?this.getWagmiConnector(b.connector.id):null;if(!c)throw Error("connectionControllerClient:revokePermissions - connector is undefined");let d=await c.getProvider();if(!d)throw Error("connectionControllerClient:revokePermissions - provider is undefined");return d.request({method:"wallet_revokePermissions",params:a})}async walletGetAssets(a){if(!this.wagmiConfig)throw Error("connectionControllerClient:walletGetAssets - wagmiConfig is undefined");let b=o3(this.wagmiConfig)[0],c=b?this.getWagmiConnector(b.connector.id):null;if(!c)throw Error("connectionControllerClient:walletGetAssets - connector is undefined");let d=await c.getProvider();if(!d)throw Error("connectionControllerClient:walletGetAssets - provider is undefined");return d.request({method:"wallet_getAssets",params:[a]})}setAuthProvider(a){if(!this.namespace)throw Error("WagmiAdapter:setAuthProvider - namespace is required");this.addConnector({id:I.ConstantsUtil.CONNECTOR_ID.AUTH,type:"AUTH",name:I.ConstantsUtil.CONNECTOR_NAMES.AUTH,provider:a,imageId:po.PresetsUtil.ConnectorImageIds[I.ConstantsUtil.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}async setUniversalProvider(a){a.on("connect",()=>{let a=o3(this.wagmiConfig),b=this.getWagmiConnector("walletConnect");if(b&&!a.find(a=>a.connector.id===b.id)){if("eip155"===L.ChainController.state.activeChain)return;(0,o6.reconnect)(this.wagmiConfig,{connectors:[b]})}});let b=vr({universalProvider:a});return this.configureInternalConnector(b),this.addConnector(new oi({provider:a,caipNetworks:this.getCaipNetworks(),namespace:"eip155"})),Promise.resolve()}toChecksummedAddress(a){return(0,pm.checksumAddress)(a.toLowerCase())}}({storage:oK({storage:{getItem:a=>null,setItem(a,b){},removeItem(a){}}}),ssr:!0,projectId:vS||vT,networks:[vz.mainnet,vA.sepolia,vB.polygon,vC.arbitrum,vD.baseSepolia,vE.celoAlfajores]});vU.wagmiConfig,v={adapters:[vU],projectId:vS||vT,networks:[vz.mainnet,vA.sepolia,vB.polygon,vC.arbitrum,vD.baseSepolia,vE.celoAlfajores],defaultNetwork:vD.baseSepolia,metadata:{name:"Chilly - Decentralized Order Tracking",description:"Track and manage orders on the blockchain with Chilly",url:"https://chilly-app.vercel.app",icons:["https://avatars.githubusercontent.com/u/179229932"]},features:{analytics:!0,email:!0,socials:["google","x","github","discord","apple"],emailShowWallets:!0}},k||(k=new oq({...v,sdkVersion:F.CoreHelperUtil.generateSdkVersion(v.adapters??[],"react","1.8.12")}));var vV=a.i(730135),vW=a.i(224870);function vX({children:a}){return(0,E.jsx)(vW.WagmiProvider,{config:vU.wagmiConfig,children:(0,E.jsx)(vV.QueryClientProvider,{client:vR,children:a})})}a.s(["Web3Provider",()=>vX],990774)},555639,a=>{"use strict";var b=a.i(283352),c=a.i(568843),d=a.i(927932),e=a.i(664435),f=a.i(876048),g=a.i(836860);function h(a={}){let{enabled:b=!0,onLogs:i,config:j,...k}=a,l=(0,g.useConfig)(a),m=(0,f.useChainId)({config:l}),o=a.chainId??m;(0,e.useEffect)(()=>{if(b&&i)return function(a,b){let e,f,{syncConnectedChain:g=a._internal.syncConnectedChain,...h}=b,i=b=>{e&&e();let f=a.getClient({chainId:b});return e=(0,d.getAction)(f,c.watchContractEvent,"watchContractEvent")(h)},j=i(b.chainId);return g&&!b.chainId&&(f=a.subscribe(({chainId:a})=>a,async a=>i(a))),()=>{j?.(),f?.()}}(l,{...k,chainId:o,onLogs:i})},[o,l,b,i,k.abi,k.address,k.args,k.batch,k.eventName,k.fromBlock,k.onError,k.poll,k.pollingInterval,k.strict,k.syncConnectedChain])}var i=a.i(87318),j=a.i(354938),k=a.i(735908);let l={0xaa36a7:process.env.NEXT_PUBLIC_CONTRACT_ADDRESS_SEPOLIA||"0x",137:process.env.NEXT_PUBLIC_CONTRACT_ADDRESS_POLYGON||"0x",42161:process.env.NEXT_PUBLIC_CONTRACT_ADDRESS_ARBITRUM||"0x"};function m(){let{address:a,chainId:c}=(0,b.useAccount)(),{addNotification:d}=(0,i.useNotifications)(),e=c?l[c]:void 0;h({address:e,abi:k.OrderTrackingABI,eventName:"OrderCreated",onLogs(b){b.forEach(b=>{let{orderId:c,buyer:e,seller:f,orderNumber:g}=b.args;if(a&&(e.toLowerCase()===a.toLowerCase()||f.toLowerCase()===a.toLowerCase())){let h=e.toLowerCase()===a.toLowerCase(),{title:i,message:k}=(0,j.getNotificationMessage)(j.NotificationType.ORDER_CREATED,c.toString(),void 0,h);d({type:j.NotificationType.ORDER_CREATED,title:i,message:`${k} - Order #${g}`,orderId:c.toString(),txHash:b.transactionHash,blockNumber:Number(b.blockNumber),isCustomer:h,customerAddress:e,merchantAddress:f})}})}}),h({address:e,abi:k.OrderTrackingABI,eventName:"OrderStatusUpdated",onLogs(b){b.forEach(b=>{let{orderId:c,newStatus:e,updatedBy:f}=b.args;if(a){let g=j.NotificationType.ORDER_UPDATED;switch(e){case j.OrderStatus.Confirmed:g=j.NotificationType.ORDER_CONFIRMED;break;case j.OrderStatus.Shipped:g=j.NotificationType.ORDER_SHIPPED;break;case j.OrderStatus.Delivered:g=j.NotificationType.ORDER_DELIVERED}let h=f.toLowerCase()!==a.toLowerCase(),{title:i,message:k}=(0,j.getNotificationMessage)(g,c.toString(),void 0,h);d({type:g,title:i,message:k,orderId:c.toString(),txHash:b.transactionHash,blockNumber:Number(b.blockNumber),isCustomer:h})}})}}),h({address:e,abi:k.OrderTrackingABI,eventName:"OrderCancelled",onLogs(b){b.forEach(b=>{let{orderId:c,cancelledBy:e,reason:f}=b.args;if(a){let{title:g,message:h}=(0,j.getNotificationMessage)(j.NotificationType.ORDER_CANCELLED,c.toString());d({type:j.NotificationType.ORDER_CANCELLED,title:g,message:`${h} - Reason: ${f}`,orderId:c.toString(),txHash:b.transactionHash,blockNumber:Number(b.blockNumber),isCustomer:e.toLowerCase()===a.toLowerCase()})}})}}),h({address:e,abi:k.OrderTrackingABI,eventName:"TrackingNumberAdded",onLogs(b){b.forEach(b=>{let{orderId:c,trackingNumber:e}=b.args;if(a){let{title:a,message:f}=(0,j.getNotificationMessage)(j.NotificationType.TRACKING_ADDED,c.toString(),e,!0);d({type:j.NotificationType.TRACKING_ADDED,title:a,message:f,orderId:c.toString(),txHash:b.transactionHash,blockNumber:Number(b.blockNumber),isCustomer:!0})}})}})}function o(){return m(),null}a.s(["OrderEventListener",()=>o,"useOrderEventListener",()=>m],555639)},256184,a=>{"use strict";var b=a.i(496872),c=a.i(87318),d=a.i(664435),e=a.i(354938);function f(){let{notifications:a}=(0,c.useNotifications)(),[f,g]=(0,d.useState)([]),h=(0,d.useRef)([]);return((0,d.useEffect)(()=>{let b=a.filter(a=>!a.read),c=h.current.filter(a=>!a.read),d=b.filter(a=>!c.some(b=>b.id===a.id));if(d.length>0){let a=d.slice(-3);Promise.resolve().then(()=>{g(b=>[...b,...a]),a.forEach(a=>{setTimeout(()=>{g(b=>b.filter(b=>b.id!==a.id))},5e3)})})}h.current=a},[a]),0===f.length)?null:(0,b.jsx)("div",{className:"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-md",children:f.map(a=>(0,b.jsxs)("div",{className:`flex items-start gap-3 p-4 rounded-lg border shadow-lg animate-in slide-in-from-right duration-300 ${(a=>{switch(a){case e.NotificationType.ORDER_CREATED:return"bg-green-50 border-green-200 text-green-900 dark:bg-green-900/20 dark:border-green-800 dark:text-green-100";case e.NotificationType.ORDER_CONFIRMED:return"bg-blue-50 border-blue-200 text-blue-900 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-100";case e.NotificationType.ORDER_SHIPPED:return"bg-purple-50 border-purple-200 text-purple-900 dark:bg-purple-900/20 dark:border-purple-800 dark:text-purple-100";case e.NotificationType.ORDER_DELIVERED:return"bg-emerald-50 border-emerald-200 text-emerald-900 dark:bg-emerald-900/20 dark:border-emerald-800 dark:text-emerald-100";case e.NotificationType.ORDER_CANCELLED:return"bg-red-50 border-red-200 text-red-900 dark:bg-red-900/20 dark:border-red-800 dark:text-red-100";case e.NotificationType.TRACKING_ADDED:return"bg-indigo-50 border-indigo-200 text-indigo-900 dark:bg-indigo-900/20 dark:border-indigo-800 dark:text-indigo-100";default:return"bg-gray-50 border-gray-200 text-gray-900 dark:bg-gray-900/20 dark:border-gray-800 dark:text-gray-100"}})(a.type)}`,children:[(0,b.jsxs)("div",{className:"shrink-0 mt-0.5",children:[a.type===e.NotificationType.ORDER_CREATED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a.type===e.NotificationType.ORDER_CONFIRMED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),a.type===e.NotificationType.ORDER_SHIPPED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),a.type===e.NotificationType.ORDER_DELIVERED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.type===e.NotificationType.ORDER_CANCELLED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),a.type===e.NotificationType.TRACKING_ADDED&&(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.title}),(0,b.jsx)("p",{className:"mt-1 text-sm opacity-90",children:a.message}),a.orderId&&(0,b.jsxs)("p",{className:"mt-1 text-xs opacity-75",children:["Order #",a.orderId]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void g(a=>a.filter(a=>a.id!==b))},className:"shrink-0 opacity-70 hover:opacity-100 transition-opacity","aria-label":"Dismiss",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},a.id))})}a.s(["NotificationToast",()=>f])}];

//# sourceMappingURL=Desktop_walletconnect_chilly_c0108d40._.js.map